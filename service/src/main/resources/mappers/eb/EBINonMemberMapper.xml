<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kap.service.dao.eb.EBINonMemberMapper">
	<!--
		쿼리명 : EBINonMemberMapper.selectNonMemberList
		설  명 : 비회원 교육 과정 목록 조회
	      수정일      수정자       수정내용
        ==========   ========   ==============
        2023.12.15    장두석       최초생성
    -->
	<select id="selectNonMemberList" parameterType="EBINonMemberDTO" resultType="EBINonMemberDTO">
		SELECT /*EBINonMemberMapper.selectNonMemberList*/
				EDCTN_SEQ
				, PARNT_SEQ
				, (SELECT CD_NM FROM CO_CODE_MST WHERE CD_SEQ = AA.PARNT_SEQ) AS PRNT_CD_NM
				, CTGRY_CD
				, CTGRY_CD_NM
				, NM
				, SMMRY_NM
				, STDUY_DD_CD
				, STDUY_DD_CD_NM
				, STDUY_TIME_CD
				, STDUY_TIME_CD_NM
				, ACCS_STRT_DTM
				, ACCS_END_DTM
				, CASE
					WHEN NOW() <![CDATA[<]]> ACCS_STRT_DTM THEN '접수대기'
					WHEN NOW() <![CDATA[>]]> ACCS_STRT_DTM AND NOW() <![CDATA[<]]>  ACCS_END_DTM THEN '접수중'
					WHEN NOW() <![CDATA[>]]> ACCS_END_DTM OR (FXNUM_IMPSB_YN = 'N' AND ACCS_CNT <![CDATA[>=]]> FXNUM_CNT) THEN '마감'
					END  AS ACCS_STATUS_NM
				, EDCTN_STRT_DTM
				, EDCTN_END_DTM
				, CASE
				    WHEN NOW() <![CDATA[<]]> EDCTN_STRT_DTM THEN '교육대기'
					WHEN NOW() <![CDATA[>]]> EDCTN_STRT_DTM AND NOW() <![CDATA[<]]> EDCTN_END_DTM THEN '교육중'
					WHEN NOW() <![CDATA[>]]> EDCTN_END_DTM THEN '교육종료'
				END  AS EDCTN_STATUS_NM
				, (SELECT NAME FROM CP_ISTTR_MST WHERE ISTTR_SEQ = AA.MIN_ISTTR_SEQ) AS ISTTR_NAME
				, (SELECT FFLTN_NM FROM CP_ISTTR_MST WHERE ISTTR_SEQ = AA.MIN_ISTTR_SEQ) AS FFLTN_NM
				, CASE WHEN ISTTR_CNT <![CDATA[<=]]>1 THEN ''
					WHEN ISTTR_CNT <![CDATA[>]]>  1 THEN ISTTR_CNT-1
					END ISTTR_OUT_CNT
				, FXNUM_CNT
				, ACCS_CNT
				, PIC_NM
				, PIC_EMAIL
				, PIC_TEL_NO
				, PLACE_SEQ
		     	, PLACE_NM
		     	, ITRDC_CNTN
				, STDUY_TRGT_CNTN
				, STDUY_SUPLS_NM
		     	, PC_STDUY_CNTN
		     	, MBL_STDUY_CNTN
		     	, BDGET_EXPNS_YN
		     	, CASE BDGET_EXPNS_YN
		     	    WHEN 'Y' THEN '마감'
					WHEN 'N' THEN '미마감'
					WHEN 'C' THEN '교육취소'
				END BDGET_EXPNS_NM
				, REG_ID
				, REG_NAME
				, REG_DTM
				, MOD_ID
				, MOD_NAME
		     	, MOD_DTM
				, EXPS_YN
			FROM (SELECT
				EDCTN_SEQ
			    , CTGRY_CD
				, (SELECT CD_NM FROM CO_CODE_MST WHERE CD = CTGRY_CD) AS CTGRY_CD_NM
				, (SELECT PARNT_SEQ FROM CO_CODE_MST WHERE CD = CTGRY_CD) AS PARNT_SEQ
				, NM
				, SMMRY_NM
				, STDUY_DD_CD
				, (SELECT CD_NM FROM CO_CODE_MST WHERE CD = STDUY_DD_CD) AS STDUY_DD_CD_NM
				, STDUY_TIME_CD
				, (SELECT CD_NM FROM CO_CODE_MST WHERE CD = STDUY_TIME_CD) AS STDUY_TIME_CD_NM
				, ACCS_STRT_DTM
				, ACCS_END_DTM
				, EDCTN_STRT_DTM
				, EDCTN_END_DTM
				, (SELECT MIN(ISTTR_SEQ) FROM NMB_EDCTN_ISTTR_REL WHERE EDCTN_SEQ = A.EDCTN_SEQ) AS MIN_ISTTR_SEQ
				, (SELECT COUNT(ISTTR_SEQ) FROM NMB_EDCTN_ISTTR_REL WHERE EDCTN_SEQ = A.EDCTN_SEQ) AS ISTTR_CNT
				, FXNUM_CNT
				, FXNUM_IMPSB_YN
				, (SELECT COUNT(PTCPT_SEQ) FROM NMB_EDCTN_PTCPT_MST WHERE EDCTN_SEQ = A.EDCTN_SEQ AND STTS_CD = 'EDU_STTS_CD01') AS ACCS_CNT
				, PIC_NM
				, PIC_EMAIL
				, PIC_TEL_NO
				, PLACE_SEQ
				, (SELECT NM FROM ED_EDCTN_PLACE_MST WHERE PLACE_SEQ = A.PLACE_SEQ) AS PLACE_NM
				, ITRDC_CNTN
				, STDUY_TRGT_CNTN
			    , STDUY_SUPLS_NM
				, PC_STDUY_CNTN
				, MBL_STDUY_CNTN
			   	, BDGET_EXPNS_YN
				, REG_ID
				, (SELECT NAME FROM CO_ADM_MST WHERE ID = A.REG_ID) AS REG_NAME
				, REG_DTM
				, MOD_ID
				, (SELECT NAME FROM CO_ADM_MST WHERE ID = A.MOD_ID) AS MOD_NAME
				, MOD_DTM
			    , EXPS_YN
				FROM NMB_EDCTN_PRCS_MST A
			<include refid="selectLecturerNonMemberListSql" />
		) AA

		<include refid="selectNonMemberListwhereSql" />

		ORDER BY
			REG_DTM DESC
		<if test="excelYn != 'Y'.toString() ">
			limit #{firstIndex}, #{recordCountPerPage}
		</if>
	</select>

	<!--
		쿼리명 : EBINonMemberMapper.selectNonMemberListCnt
		설  명 : 비회원 교육 과정 목록 카운트
	      수정일      수정자       수정내용
        ==========   ========   ==============
        2023.12.15    장두석       최초생성
    -->
	<select id="selectNonMemberListCnt" parameterType="EBINonMemberDTO" resultType="java.lang.Integer">
		SELECT /*EBINonMemberMapper.selectNonMemberListCnt*/
			COUNT(*)
		FROM
		    (SELECT
				EDCTN_SEQ
				, CTGRY_CD
				, (SELECT CD_NM FROM CO_CODE_MST WHERE CD = CTGRY_CD) AS CTGRY_CD_NM
				, (SELECT PARNT_SEQ FROM CO_CODE_MST WHERE CD = CTGRY_CD) AS PARNT_SEQ
				, NM
				, SMMRY_NM
				, STDUY_DD_CD
				, (SELECT CD_NM FROM CO_CODE_MST WHERE CD = STDUY_DD_CD) AS STDUY_DD_CD_NM
				, STDUY_TIME_CD
				, (SELECT CD_NM FROM CO_CODE_MST WHERE CD = STDUY_TIME_CD) AS STDUY_TIME_CD_NM
				, ACCS_STRT_DTM
				, ACCS_END_DTM
				, EDCTN_STRT_DTM
				, EDCTN_END_DTM
				, (SELECT MIN(ISTTR_SEQ) FROM NMB_EDCTN_ISTTR_REL WHERE EDCTN_SEQ = A.EDCTN_SEQ) AS MIN_ISTTR_SEQ
				, (SELECT COUNT(ISTTR_SEQ) FROM NMB_EDCTN_ISTTR_REL WHERE EDCTN_SEQ = A.EDCTN_SEQ) AS ISTTR_CNT
				, FXNUM_CNT
				, FXNUM_IMPSB_YN
				, (SELECT COUNT(PTCPT_SEQ) FROM NMB_EDCTN_PTCPT_MST WHERE EDCTN_SEQ = A.EDCTN_SEQ AND STTS_CD = 'EDU_STTS_CD01') AS ACCS_CNT
				, PIC_NM
				, PIC_EMAIL
				, PIC_TEL_NO
				, PLACE_SEQ
				, (SELECT NM FROM ED_EDCTN_PLACE_MST WHERE PLACE_SEQ = A.PLACE_SEQ) AS PLACE_NM
				, ITRDC_CNTN
				, STDUY_TRGT_CNTN
				, STDUY_SUPLS_NM
				, PC_STDUY_CNTN
				, MBL_STDUY_CNTN
				, BDGET_EXPNS_YN
				, REG_ID
				, (SELECT NAME FROM CO_ADM_MST WHERE ID = A.REG_ID) AS REG_NAME
				, REG_DTM
				, MOD_ID
				, (SELECT NAME FROM CO_ADM_MST WHERE ID = A.MOD_ID) AS MOD_NAME
				, MOD_DTM
				, EXPS_YN
			FROM NMB_EDCTN_PRCS_MST A
			<include refid="selectLecturerNonMemberListSql" />
			) AA
		<include refid="selectNonMemberListwhereSql" />
	</select>

	<!--
		쿼리명 : EBINonMemberMapper.selectNonMemberExcelList
		설  명 : 비회원 교육 과정 엑셀 목록 조회
	      수정일      수정자       수정내용
        ==========   ========   ==============
        2023.12.15    장두석       최초생성
    -->
	<select id="selectNonMemberExcelList" parameterType="EBINonMemberDTO" resultType="EBINonMemberDTO">
		SELECT /*EBINonMemberMapper.selectNonMemberExcelList*/
		AA.EDCTN_SEQ
		, PRNT_CD_NM /* 과정분류1 */
		, CTGRY_CD_NM /* 과정분류2 */
		, NM /* 과정명 */
		, STDUY_TIME_CD_NM  /* 학습시간 */
		, STDUY_DD_CD_NM /*교육일*/
		, EDCTN_STRT_DTM /* 교육기간 시작일 */
		, EDCTN_END_DTM /* 교육기간 종료일 */
		, PLACE_NM /* 교육장소 */
		, CPRTN_INSTT_NM /* 협력기관 */
		, FXNUM_CNT /* 정원(명) */
		, EDCTN_STATUS_NM /*교육상태*/
		, ACCS_CNT /* 신청인원 */
		, COALESCE(SUM(CNT1), 0) AS T1 /* 부서별 인원 - 품질 */
		, COALESCE(SUM(CNT2), 0) AS T2 /* 부서별 인원 - RND */
		, COALESCE(SUM(CNT3), 0) AS T3 /* 부서별 인원 - 생산 */
		, COALESCE(SUM(CNT4), 0) AS T4 /* 부서별 인원 - 구매 */
		, COALESCE(SUM(CNT5), 0) AS T5 /* 부서별 인원 - 경영지원 */
		, COALESCE(SUM(CNT6), 0) AS T6 /* 부서별 인원 - 업체평가 */
		, COALESCE(SUM(CNT7), 0) AS T7 /* 부서별 인원 - 안전 */
		, COALESCE(SUM(CNT8), 0) AS T8 /* 부서별 인원 - ESG */
		, COALESCE(SUM(CNT9), 0) AS T9 /* 부서별 인원 - 기타 */
		, COALESCE(SUM(CNT01), 0) AS A1 /* 직급별 인원 - 대표 */
		, COALESCE(SUM(CNT02), 0) AS A2 /* 직급별 인원 - 임원 */
		, COALESCE(SUM(CNT03), 0) AS A3 /* 직급별 인원 - 부장 */
		, COALESCE(SUM(CNT04), 0) AS A4 /* 직급별 인원 - 과장/차장 */
		, COALESCE(SUM(CNT05), 0) AS A5 /* 직급별 인원 - 사원/대리 */
		, COALESCE(SUM(CNT06), 0) AS A6 /* 직급별 인원 - 조장/반창(계장) */
		, COALESCE(SUM(CNT07), 0) AS A7 /* 직급별 인원 - 기타 */
		, PMT_C1 /* 강사시간1 */
		, PMT_C2 /* 강사시간2 */
		, PMT_C3 /* 강사시간3 */
		, PMT_C4 /* 강사시간4 */
		, PMT_C5 /* 강사시간5 */
		, PMT_C6 /* 강사시간6 */
		, SUM(PMT_A1 + PMT_A2 + PMT_A3 + PMT_A4 + PMT_A5 + PMT_A6 + PMT_A7 + PMT_A8 + PMT_A9 + PMT_A10) AS PMT_A0
		, PMT_A1 /* 부담금/대관비(원) */
		, PMT_A2 /* 강사비(원) */
		, PMT_A3 /* 교재비(원) */
		, PMT_A4 /* 식대(원) */
		, PMT_A5 /* 다과비(원) */
		, PMT_A6 /* 소모품비(원) */
		, PMT_A7 /* 발송비(원) */
		, PMT_A8 /* 재료비(원) */
		, PMT_A9 /* 집행비(원) */
		, PMT_A10 /* 기타(원) */
		, PMT_A11 /* 비고 */
		, SUM(PMT_B1 + PMT_B2 + PMT_B3 + PMT_B4 + PMT_B5 + PMT_B6 + PMT_B7 + PMT_B8 + PMT_B9 + PMT_B10) AS PMT_B0
		, PMT_B1 /* 부담금/대관비(원) */
		, PMT_B2 /* 강사비(원) */
		, PMT_B3 /* 교재비(원) */
		, PMT_B4 /* 식대(원) */
		, PMT_B5 /* 다과비(원) */
		, PMT_B6 /* 소모품비(원) */
		, PMT_B7 /* 발송비(원) */
		, PMT_B8 /* 재료비(원) */
		, PMT_B9 /* 집행비(원) */
		, PMT_B10 /* 기타(원) */
		, PMT_B11 /* 비고(원) */
		, ISTTRNM1
		, ISTTRNM2
		, ISTTRNM3
		, ISTTRNM4
		, ISTTRNM5
		, ISTTRNM6
		, REG_DTM
		, REG_IP
		, REG_ID
		FROM (SELECT
			A.EDCTN_SEQ
			, (SELECT CD_NM FROM CO_CODE_MST WHERE CD = LEFT(A.CTGRY_CD, 7)) AS PRNT_CD_NM/* 과정분류1 */
			, (SELECT CD_NM FROM CO_CODE_MST WHERE CD = A.CTGRY_CD) AS CTGRY_CD_NM /* 과정분류2 */
			, A.NM /* 과정명 */
			, (SELECT CD_NM FROM CO_CODE_MST WHERE CD=A.STDUY_TIME_CD) AS STDUY_TIME_CD_NM /* 학습시간 */
			, (SELECT CD_NM FROM CO_CODE_MST WHERE CD=A.STDUY_DD_CD) AS STDUY_DD_CD_NM/*교육일*/
			, A.EDCTN_STRT_DTM/* 교육기간 시작일 */
			, A.EDCTN_END_DTM/* 교육기간 종료일 */
			, (SELECT NM FROM ED_EDCTN_PLACE_MST WHERE PLACE_SEQ = A.PLACE_SEQ) AS PLACE_NM/* 교육장소 */
			, (SELECT NM FROM ED_EDCTN_PLACE_MST WHERE PLACE_SEQ = A.CPRTN_INSTT_SEQ) AS CPRTN_INSTT_NM/* 협력기관 */
			, A.FXNUM_CNT/* 정원(명) */
			, CASE
				WHEN NOW() <![CDATA[<]]> EDCTN_STRT_DTM THEN '교육대기'
				WHEN NOW() <![CDATA[>]]> EDCTN_STRT_DTM AND NOW() <![CDATA[<]]> EDCTN_END_DTM THEN '교육중'
				WHEN NOW() <![CDATA[>]]> EDCTN_END_DTM THEN '교육완료'
			END  AS EDCTN_STATUS_NM /*교육상태*/
			, (SELECT COUNT(PTCPT_SEQ) FROM NMB_EDCTN_PTCPT_MST WHERE EDCTN_SEQ = A.EDCTN_SEQ  AND STTS_CD = 'EDU_STTS_CD01') AS ACCS_CNT /*신청인원*/

			, CNT1 /* 부서별 인원 - 품질 */
			, CNT2 /* 부서별 인원 - RND */
			, CNT3 /* 부서별 인원 - 생산 */
			, CNT4 /* 부서별 인원 - 구매 */
			, CNT5 /* 부서별 인원 - 경영지원 */
			, CNT6 /* 부서별 인원 - 업체평가 */
			, CNT7 /* 부서별 인원 - 안전 */
			, CNT8 /* 부서별 인원 - ESG */
			, CNT9 /* 부서별 인원 - 기타 */

			, CNT01 /* 직급별 인원 - 대표 */
			, CNT02 /* 직급별 인원 - 임원 */
			, CNT03 /* 직급별 인원 - 부장 */
			, CNT04 /* 직급별 인원 - 과장/차장 */
			, CNT05 /* 직급별 인원 - 사원/대리 */
			, CNT06 /* 직급별 인원 - 조장/반창(계장) */
			, CNT07 /* 직급별 인원 - 기타 */

			, MAX(CASE BD_CD WHEN 'ED_BDGET_CD03001' THEN PMT ELSE NULL END) AS PMT_C1/* 강사시간1 */
			, MAX(CASE BD_CD WHEN 'ED_BDGET_CD03002' THEN PMT ELSE NULL END) AS PMT_C2/* 강사시간2 */
			, MAX(CASE BD_CD WHEN 'ED_BDGET_CD03003' THEN PMT ELSE NULL END) AS PMT_C3/* 강사시간3 */
			, MAX(CASE BD_CD WHEN 'ED_BDGET_CD03004' THEN PMT ELSE NULL END) AS PMT_C4/* 강사시간4 */
			, MAX(CASE BD_CD WHEN 'ED_BDGET_CD03005' THEN PMT ELSE NULL END) AS PMT_C5/* 강사시간5 */
			, MAX(CASE BD_CD WHEN 'ED_BDGET_CD03006' THEN PMT ELSE NULL END) AS PMT_C6/* 강사시간6 */
			, MAX(CASE BD_CD WHEN 'ED_BDGET_CD01001' THEN PMT ELSE NULL END) AS PMT_A1 /* 부담금/대관비 */
			, MAX(CASE BD_CD WHEN 'ED_BDGET_CD01002' THEN PMT ELSE NULL END) AS PMT_A2 /* 강사비 */
			, MAX(CASE BD_CD WHEN 'ED_BDGET_CD01003' THEN PMT ELSE NULL END) AS PMT_A3 /* 교재비 */
			, MAX(CASE BD_CD WHEN 'ED_BDGET_CD01004' THEN PMT ELSE NULL END) AS PMT_A4 /* 식대 */
			, MAX(CASE BD_CD WHEN 'ED_BDGET_CD01005' THEN PMT ELSE NULL END) AS PMT_A5 /* 다과비 */
			, MAX(CASE BD_CD WHEN 'ED_BDGET_CD01006' THEN PMT ELSE NULL END) AS PMT_A6 /* 소모품비 */
			, MAX(CASE BD_CD WHEN 'ED_BDGET_CD01007' THEN PMT ELSE NULL END) AS PMT_A7 /* 발송비 */
			, MAX(CASE BD_CD WHEN 'ED_BDGET_CD01008' THEN PMT ELSE NULL END) AS PMT_A8 /* 재료비 */
			, MAX(CASE BD_CD WHEN 'ED_BDGET_CD01009' THEN PMT ELSE NULL END) AS PMT_A9 /* 집행비 */
			, MAX(CASE BD_CD WHEN 'ED_BDGET_CD01010' THEN PMT ELSE NULL END) AS PMT_A10 /* 기타(원) */
			, MAX(CASE BD_CD WHEN 'ED_BDGET_CD01011' THEN ETC_NM ELSE NULL END) AS PMT_A11 /* 비고 */
			, MAX(CASE BD_CD WHEN 'ED_BDGET_CD02001' THEN PMT ELSE NULL END) AS PMT_B1 /* 부담금/대관비 */
			, MAX(CASE BD_CD WHEN 'ED_BDGET_CD02002' THEN PMT ELSE NULL END) AS PMT_B2 /* 강사비 */
			, MAX(CASE BD_CD WHEN 'ED_BDGET_CD02003' THEN PMT ELSE NULL END) AS PMT_B3 /* 교재비 */
			, MAX(CASE BD_CD WHEN 'ED_BDGET_CD02004' THEN PMT ELSE NULL END) AS PMT_B4 /* 식대 */
			, MAX(CASE BD_CD WHEN 'ED_BDGET_CD02005' THEN PMT ELSE NULL END) AS PMT_B5 /* 다과비 */
			, MAX(CASE BD_CD WHEN 'ED_BDGET_CD02006' THEN PMT ELSE NULL END) AS PMT_B6 /* 소모품비 */
			, MAX(CASE BD_CD WHEN 'ED_BDGET_CD02007' THEN PMT ELSE NULL END) AS PMT_B7 /* 발송비 */
			, MAX(CASE BD_CD WHEN 'ED_BDGET_CD02008' THEN PMT ELSE NULL END) AS PMT_B8 /* 재료비 */
			, MAX(CASE BD_CD WHEN 'ED_BDGET_CD02009' THEN PMT ELSE NULL END) AS PMT_B9 /* 집행비 */
			, MAX(CASE BD_CD WHEN 'ED_BDGET_CD02010' THEN PMT ELSE NULL END) AS PMT_B10 /* 기타(원) */
			, MAX(CASE BD_CD WHEN 'ED_BDGET_CD02011' THEN ETC_NM ELSE NULL END) AS PMT_B11 /* 비고 */
			, (SELECT NAME FROM CP_ISTTR_MST WHERE ISTTR_SEQ = G.R1) AS ISTTRNM1
			, (SELECT NAME FROM CP_ISTTR_MST WHERE ISTTR_SEQ = G.R2) AS ISTTRNM2
			, (SELECT NAME FROM CP_ISTTR_MST WHERE ISTTR_SEQ = G.R3) AS ISTTRNM3
			, (SELECT NAME FROM CP_ISTTR_MST WHERE ISTTR_SEQ = G.R4) AS ISTTRNM4
			, (SELECT NAME FROM CP_ISTTR_MST WHERE ISTTR_SEQ = G.R5) AS ISTTRNM5
			, (SELECT NAME FROM CP_ISTTR_MST WHERE ISTTR_SEQ = G.R6) AS ISTTRNM6
			, A.REG_DTM
			, A.REG_IP
			, A.REG_ID
			FROM NMB_EDCTN_PRCS_MST A
			LEFT OUTER JOIN ( SELECT CD AS BD_CD, PMT, ETC_NM, EDCTN_SEQ FROM NMB_EDCTN_BDGET_EXPNS_DTL) C ON C.EDCTN_SEQ = A.EDCTN_SEQ
			LEFT OUTER JOIN (
			     SELECT
			     	EDCTN_SEQ
			     	, DEPT_CD
			     	, PSTN_CD
					, SUM(CASE WHEN DEPT_CD = 'MEM_CD02002' THEN 1 ELSE 0 END) AS CNT1 /* 부서별 인원 - 품질 */
					, SUM(CASE WHEN DEPT_CD = 'MEM_CD02003' THEN 1 ELSE 0 END) AS CNT2 /* 부서별 인원 - RND */
					, SUM(CASE WHEN DEPT_CD = 'MEM_CD02004' THEN 1 ELSE 0 END) AS CNT3 /* 부서별 인원 - 생산 */
					, SUM(CASE WHEN DEPT_CD = 'MEM_CD02005' THEN 1 ELSE 0 END) AS CNT4 /* 부서별 인원 - 구매 */
					, SUM(CASE WHEN DEPT_CD = 'MEM_CD02006' THEN 1 ELSE 0 END) AS CNT5 /* 부서별 인원 - 경영지원 */
					, SUM(CASE WHEN DEPT_CD = 'MEM_CD02007' THEN 1 ELSE 0 END) AS CNT6 /* 부서별 인원 - 업체평가 */
					, SUM(CASE WHEN DEPT_CD = 'MEM_CD02008' THEN 1 ELSE 0 END) AS CNT7 /* 부서별 인원 - 안전 */
					, SUM(CASE WHEN DEPT_CD = 'MEM_CD02009' THEN 1 ELSE 0 END) AS CNT8 /* 부서별 인원 - ESG */
					, SUM(CASE WHEN DEPT_CD = 'MEM_CD02010' THEN 1 ELSE 0 END) AS CNT9 /* 부서별 인원 - 기타 */

					, SUM(CASE WHEN PSTN_CD = 'MEM_CD01001' THEN 1 ELSE 0 END) AS CNT01 /* 직급별 인원 - 대표 */
					, SUM(CASE WHEN PSTN_CD = 'MEM_CD01002' THEN 1 ELSE 0 END) AS CNT02 /* 직급별 인원 - 임원 */
					, SUM(CASE WHEN PSTN_CD = 'MEM_CD01003' THEN 1 ELSE 0 END) AS CNT03 /* 직급별 인원 - 부장 */
					, SUM(CASE WHEN PSTN_CD = 'MEM_CD01004' THEN 1 ELSE 0 END) AS CNT04 /* 직급별 인원 - 과장/차장 */
					, SUM(CASE WHEN PSTN_CD = 'MEM_CD01005' THEN 1 ELSE 0 END) AS CNT05 /* 직급별 인원 - 사원/대리 */
					, SUM(CASE WHEN PSTN_CD = 'MEM_CD01006' THEN 1 ELSE 0 END) AS CNT06 /* 직급별 인원 - 조장/반창(계장) */
					, SUM(CASE WHEN PSTN_CD = 'MEM_CD01007' THEN 1 ELSE 0 END) AS CNT07 /* 직급별 인원 - 기타 */
			     FROM
			     	NMB_EDCTN_PTCPT_MST
			     WHERE
					STTS_CD = 'EDU_STTS_CD01'
			     GROUP BY
			     	EDCTN_SEQ) E ON E.EDCTN_SEQ = A.EDCTN_SEQ
			LEFT OUTER JOIN (
				SELECT CD FROM CO_CODE_MST
				WHERE PARNT_SEQ IN (
					SELECT CD_SEQ FROM CO_CODE_MST
					WHERE CD IN ('MEM_CD01', 'MEM_CD02')
				)
			) T2 ON E.DEPT_CD = T2.CD
			LEFT JOIN (
				SELECT
				ISTTR_TB.EDCTN_SEQ
				,ISTTR_TB.ISTTR_SEQ
				,MAX(CASE WHEN ORDERS = 1 THEN ISTTR_SEQ ELSE NULL END) AS R1
				,MAX(CASE WHEN ORDERS = 2 THEN ISTTR_SEQ ELSE NULL END) AS R2
				,MAX(CASE WHEN ORDERS = 3 THEN ISTTR_SEQ ELSE NULL END) AS R3
				,MAX(CASE WHEN ORDERS = 4 THEN ISTTR_SEQ ELSE NULL END) AS R4
				,MAX(CASE WHEN ORDERS = 5 THEN ISTTR_SEQ ELSE NULL END) AS R5
				,MAX(CASE WHEN ORDERS = 6 THEN ISTTR_SEQ ELSE NULL END) AS R6
				FROM (
					SELECT
					AAA.EDCTN_SEQ
					,B2.ISTTR_SEQ
					,(SELECT COUNT(*) FROM NMB_EDCTN_ISTTR_REL G2 WHERE G2.EDCTN_SEQ = AAA.EDCTN_SEQ  AND G2.ISTTR_SEQ <![CDATA[<=]]> B2.ISTTR_SEQ) AS ORDERS
					FROM NMB_EDCTN_PRCS_MST AAA
					LEFT JOIN NMB_EDCTN_ISTTR_REL B2 ON B2.EDCTN_SEQ = AAA.EDCTN_SEQ
				) AS ISTTR_TB
			GROUP BY ISTTR_TB.EDCTN_SEQ) G ON G.EDCTN_SEQ = A.EDCTN_SEQ
			LEFT JOIN (SELECT EDCTN_SEQ, PTCPT_SEQ, PTCPT_BSNM_NO, STTS_CD FROM NMB_EDCTN_PTCPT_MST WHERE STTS_CD = 'EDU_STTS_CD01' GROUP BY PTCPT_SEQ) H ON H.EDCTN_SEQ = A.EDCTN_SEQ


			GROUP BY A.EDCTN_SEQ
		) AA

		<include refid="selectNonMemberListwhereSql" />

		GROUP BY AA.EDCTN_SEQ
	</select>

	<!--
		쿼리명 : selectNonMemberListwhereSql
		설  명 : 비회원 교육 과정 where Sql
	      수정일      수정자       수정내용
        ==========   ========   ==============
        2023.12.15    장두석       최초생성
    -->
	<sql id="selectNonMemberListwhereSql">
		<where>
			<!--등록일/수정기간-->
			<if test="strtDt != null and strtDt != ''">
				<choose>
					<when test="srchDate == 1">
						AND REG_DTM <![CDATA[>=]]> DATE_FORMAT(#{strtDt}, '%Y-%m-%d 00:00:00')
						AND REG_DTM <![CDATA[<=]]> DATE_FORMAT(#{endDt}, '%Y-%m-%d 23:59:59')
					</when>
					<when test="srchDate == 2">
						AND MOD_DTM <![CDATA[>=]]> DATE_FORMAT(#{strtDt}, '%Y-%m-%d 00:00:00')
						AND MOD_DTM <![CDATA[<=]]> DATE_FORMAT(#{endDt}, '%Y-%m-%d 23:59:59')
					</when>
				</choose>
			</if>

			<!--과정분류-->
			<if test="ctgryCdList != null and ctgryCdList.size() > 0">
				and (
				<foreach collection="ctgryCdList" item="ctgryCdList" index="index" open="" close="" separator=" or ">
					CTGRY_CD = #{ctgryCdList}
				</foreach>
				)
			</if>

			<!-- 학습일 -->
			<if test="stduyDdCd != null and stduyDdCd != ''">
				AND STDUY_DD_CD = #{stduyDdCd}
			</if>
			<!-- 학습시간 -->
			<if test="stduyTimeCd != null and stduyTimeCd != ''">
				AND STDUY_TIME_CD = #{stduyTimeCd}
			</if>

			<!--접수상태-->
			<if test="accsStatusList != null and accsStatusList.size() > 0">
				and (
				<foreach collection="accsStatusList" item="accsStatusList" index="index" open="" close="" separator=" or ">
					<choose>
						<when test="accsStatusList != null">
							<if test="accsStatusList == 1"><!--접수대기-->
								NOW() <![CDATA[<]]> ACCS_STRT_DTM
							</if>
							<if test="accsStatusList == 2"><!--접수중-->
								NOW() <![CDATA[>]]> ACCS_STRT_DTM AND NOW() <![CDATA[<]]> ACCS_END_DTM
							</if>
							<if test="accsStatusList == 3"><!--마감-->
								(NOW() <![CDATA[>]]> ACCS_END_DTM OR (FXNUM_IMPSB_YN = 'N' AND ACCS_CNT <![CDATA[>=]]> FXNUM_CNT))
							</if>
						</when>
					</choose>
				</foreach>
				)
			</if>

			<if test='edctnSeq !=null and edctnSeq != "" '>
				AND AA.edctn_seq = #{edctnSeq}
			</if>

			<!--노출여부-->
			<if test="expsYnList != null and expsYnList.size() > 0">
				AND (
				<foreach collection="expsYnList" item="expsYn" index="index" open="" close="" separator=" OR ">
					EXPS_YN = #{expsYn}
				</foreach>
				)
			</if>

			<if test="q != null and q != ''.toString() ">
				<choose>
					<when test="f == 1"><!-- 과정명 -->
						and NM like CONCAT('%', #{q}, '%')
					</when>
					<when test="f == 2"><!--최초등록자-->
						AND (
						INSTR(#{q}, AA.REG_ID) <![CDATA[>]]> 0 OR
						EXISTS(SELECT 'x' FROM CO_ADM_MST WHERE ID = AA.REG_ID AND NAME LIKE CONCAT('%', #{q}, '%'))
						)
					</when>
					<when test="f == 3"><!--최종수정자-->
						AND (
						INSTR(#{q}, AA.MOD_ID) <![CDATA[>]]> 0 OR
						EXISTS(SELECT 'x' FROM CO_ADM_MST WHERE ID = AA.MOD_ID AND NAME LIKE CONCAT('%', #{q}, '%'))
						)
					</when>
					<otherwise><!--전체수정자-->
						AND (
						NM LIKE CONCAT('%', #{q}, '%') OR
						REG_ID LIKE CONCAT('%', #{q}, '%') OR
						EXISTS(SELECT 'x' FROM CO_ADM_MST WHERE ID = AA.REG_ID AND NAME LIKE CONCAT('%', #{q}, '%')) OR
						MOD_ID LIKE CONCAT('%', #{q}, '%') OR
						EXISTS(SELECT 'x' FROM CO_ADM_MST WHERE ID = AA.MOD_ID AND NAME LIKE CONCAT('%', #{q}, '%'))
						)
					</otherwise>
				</choose>
			</if>
		</where>
	</sql>

	<!--
		쿼리명 : selectLecturerNonMemberListSql
		설  명 : 강사 관리 상세에서 교육 사업 현황 조회 조인 Sql
	      수정일      수정자       수정내용
        ==========   ========   ==============
        2023.12.15    장두석       최초생성
    -->
	<sql id="selectLecturerNonMemberListSql">
		<if test="isttrSeq != null and isttrSeq != ''">
			INNER JOIN
			(
			SELECT
			EDCTN_SEQ
			, ISTTR_SEQ
			FROM NMB_EDCTN_ISTTR_REL
			) C
			ON 1 = 1
			AND A.EDCTN_SEQ = C.EDCTN_SEQ
			AND C.ISTTR_SEQ = #{isttrSeq}
		</if>
	</sql>


	<!--
      쿼리명 : EBINonMemberMapper.selectNonMemberDtl
      설  명 : 비회원 교육 과정 상세 조회
       수정일     수정자       수정내용
     ==========   ======    ==============
     2023.12.15   장두석       최초생성
 	-->
	<select id="selectNonMemberDtl" parameterType="EBINonMemberDTO" resultType="EBINonMemberDTO">
		SELECT /*EBINonMemberMapper.selectNonMemberDtl*/
			EDCTN_SEQ
			, PARNT_SEQ
			, (SELECT CD FROM CO_CODE_MST WHERE CD_SEQ = AA.PARNT_SEQ) AS PRNT_CD
			, (SELECT CD_NM FROM CO_CODE_MST WHERE CD_SEQ = AA.PARNT_SEQ) AS PRNT_CD_NM
			, CTGRY_CD
			, CTGRY_CD_NM
			, NM
			, SMMRY_NM
			, STDUY_DD_CD
			, STDUY_DD_CD_NM
			, STDUY_TIME_CD
			, STDUY_TIME_CD_NM
			, ACCS_STRT_DTM
			, ACCS_END_DTM
			, CASE
			WHEN NOW() <![CDATA[<]]> ACCS_STRT_DTM THEN '접수대기'
			WHEN NOW() <![CDATA[>]]> ACCS_STRT_DTM AND NOW() <![CDATA[<]]>  ACCS_END_DTM THEN '접수중'
			WHEN NOW() <![CDATA[>]]> ACCS_END_DTM OR (FXNUM_IMPSB_YN = 'Y' AND ACCS_CNT <![CDATA[>=]]> FXNUM_CNT) THEN '마감'
			END  AS ACCS_STATUS_NM
			, EDCTN_STRT_DTM
			, EDCTN_END_DTM
			, EDCTN_NTCTN_FILE_SEQ
			, (SELECT ORGN_FILE_NM FROM CO_FILE_DTL WHERE FILE_SEQ = EDCTN_NTCTN_FILE_SEQ ORDER BY FILE_ORD DESC LIMIT 1) ORGN_FILE_NM
			, THNL_FILE_SEQ
			,(SELECT WEB_PATH FROM CO_FILE_DTL WHERE FILE_SEQ = THNL_FILE_SEQ order by file_ord desc limit 1) WEB_PATH
			, CASE
			WHEN NOW() <![CDATA[<]]> EDCTN_STRT_DTM THEN '교육대기'
			WHEN NOW() <![CDATA[>]]> EDCTN_STRT_DTM AND NOW() <![CDATA[<]]> EDCTN_END_DTM THEN '교육중'
			WHEN NOW() <![CDATA[>]]> EDCTN_END_DTM THEN '교육종료'
			END  AS EDCTN_STATUS_NM
			, (SELECT NAME FROM CP_ISTTR_MST WHERE ISTTR_SEQ = AA.MIN_ISTTR_SEQ) AS ISTTR_NAME
			, (SELECT FFLTN_NM FROM CP_ISTTR_MST WHERE ISTTR_SEQ = AA.MIN_ISTTR_SEQ) AS FFLTN_NM
			, CASE WHEN ISTTR_CNT <![CDATA[<=]]>1 THEN ''
			WHEN ISTTR_CNT <![CDATA[>]]>  1 THEN ISTTR_CNT-1
			END ISTTR_OUT_CNT
			, FXNUM_CNT
			, FXNUM_IMPSB_YN
			, ACCS_CNT
			, PIC_NM
			, PIC_EMAIL
			, PIC_TEL_NO
			, PLACE_SEQ
			, CPRTN_INSTT_SEQ
			, CPRTN_INSTT_NM
			, PLACE_NM
			, ITRDC_CNTN
			, STDUY_TRGT_CNTN
			, STDUY_SUPLS_NM
			, PC_STDUY_CNTN
			, MBL_STDUY_CNTN
			, REG_ID
			, REG_NAME
			, REG_DTM
			, MOD_ID
			, MOD_NAME
			, MOD_DTM
			, BDGET_EXPNS_YN
			, EXPNS_CPRTN_INSTT_NM
			, EXPNS_CPRTN_INSTT_SEQ
			, EXPNS_PMT
			, EXPS_YN
		FROM (SELECT
			EDCTN_SEQ
			, CTGRY_CD
			, (SELECT CD_NM FROM CO_CODE_MST WHERE CD = CTGRY_CD) AS CTGRY_CD_NM
			, (SELECT PARNT_SEQ FROM CO_CODE_MST WHERE CD = CTGRY_CD) AS PARNT_SEQ
			, NM
			, SMMRY_NM
			, STDUY_DD_CD
			, (SELECT CD_NM FROM CO_CODE_MST WHERE CD = STDUY_DD_CD) AS STDUY_DD_CD_NM
			, STDUY_TIME_CD
			, (SELECT CD_NM FROM CO_CODE_MST WHERE CD = STDUY_TIME_CD) AS STDUY_TIME_CD_NM
			, ACCS_STRT_DTM
			, ACCS_END_DTM
			, EDCTN_STRT_DTM
			, EDCTN_END_DTM
			, EDCTN_NTCTN_FILE_SEQ
			, THNL_FILE_SEQ
			, (SELECT MIN(ISTTR_SEQ) FROM NMB_EDCTN_ISTTR_REL C WHERE A.EDCTN_SEQ = C.EDCTN_SEQ) AS MIN_ISTTR_SEQ
			, (SELECT COUNT(ISTTR_SEQ) FROM NMB_EDCTN_ISTTR_REL C WHERE A.EDCTN_SEQ = C.EDCTN_SEQ) AS ISTTR_CNT
			, FXNUM_CNT
			, FXNUM_IMPSB_YN
			, (SELECT COUNT(PTCPT_SEQ) FROM NMB_EDCTN_PTCPT_MST WHERE EDCTN_SEQ = A.EDCTN_SEQ) AS ACCS_CNT
			, PIC_NM
			, PIC_EMAIL
			, PIC_TEL_NO
			, PLACE_SEQ
			, CPRTN_INSTT_SEQ
			, (SELECT NM FROM ED_EDCTN_PLACE_MST WHERE PLACE_SEQ = A.CPRTN_INSTT_SEQ) AS CPRTN_INSTT_NM
			, (SELECT NM FROM ED_EDCTN_PLACE_MST WHERE PLACE_SEQ = A.PLACE_SEQ) AS PLACE_NM
			, ITRDC_CNTN
			, STDUY_TRGT_CNTN
			, STDUY_SUPLS_NM
			, PC_STDUY_CNTN
			, MBL_STDUY_CNTN
			, REG_ID
			, (SELECT NAME FROM CO_ADM_MST WHERE ID = A.REG_ID) AS REG_NAME
			, REG_DTM
			, MOD_ID
			, (SELECT NAME FROM CO_ADM_MST WHERE ID = A.MOD_ID) AS MOD_NAME
			, MOD_DTM
			, BDGET_EXPNS_YN
			, EXPNS_CPRTN_INSTT_SEQ
			, (SELECT NM FROM ED_EDCTN_PLACE_MST WHERE PLACE_SEQ = A.EXPNS_CPRTN_INSTT_SEQ) AS EXPNS_CPRTN_INSTT_NM
			, EXPNS_PMT
			, EXPS_YN
		FROM
		    NMB_EDCTN_PRCS_MST A) AA
		WHERE
			EDCTN_SEQ = #{detailsKey}
	</select>

	<!--
      쿼리명 : EBINonMemberMapper.selectNonMemberTrgtList
      설  명 : 교육 과정 대상 상세 조회
       수정일     수정자       수정내용
     ==========   ======    ==============
     2023.12.15   장두석       최초생성
 	-->
	<select id="selectNonMemberTrgtList" parameterType="EBINonMemberDTO" resultType="EBINonMemberDTO">
		SELECT /*EBINonMemberMapper.selectNonMemberTrgtList*/
			EDCTN_SEQ
			 , CD AS TARGET_CD
			 , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = A.CD) TARGET_CD_NM
			 , ETC_NM
		FROM NMB_EDCTN_TRGT_DTL A
		WHERE
			EDCTN_SEQ = #{detailsKey}
	</select>

	<!--
      쿼리명 : EBINonMemberMapper.selectNonMemberChk
      설  명 : 비회원 교육 과정 중복 체크
       수정일     수정자       수정내용
     ==========   ======    ==============
     2023.12.15   장두석       최초생성
 	-->
	<select id="selectNonMemberChk" parameterType="EBINonMemberDTO" resultType="EBINonMemberDTO">
		SELECT /* EBINonMemberMapper.selectNonMemberChk */
		    *
			, (SELECT CD_NM FROM CO_CODE_MST WHERE CD = CTGRY_CD) AS CTGRY_CD_NM
			, (SELECT CD_NM FROM CO_CODE_MST WHERE CD_SEQ = (SELECT PARNT_SEQ FROM CO_CODE_MST WHERE CD = CTGRY_CD)) AS PRNT_CD_NM
		FROM NMB_EDCTN_PRCS_MST
		WHERE
		EDCTN_SEQ = #{edctnSeq}
	</select>

	<!--
         쿼리명 : EBINonMemberMapper.insertNonMember
         설  명 : 비회원 교육 과정 등록
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.12.15   장두석       최초생성
    -->
	<insert id="insertNonMember" parameterType="EBINonMemberDTO">
		INSERT INTO /*EBINonMemberMapper.insertNonMember*/ NMB_EDCTN_PRCS_MST (
			EDCTN_SEQ
			, CTGRY_CD
			, NM
			, SMMRY_NM
			, ACCS_STRT_DTM
			, ACCS_END_DTM
			, EDCTN_STRT_DTM
			, EDCTN_END_DTM
			, FXNUM_CNT
			, FXNUM_IMPSB_YN
			, PIC_NM
			, PIC_EMAIL
			, PIC_TEL_NO
			, PLACE_SEQ
			, ITRDC_CNTN
			, STDUY_TRGT_CNTN
			, STDUY_DD_CD
			, STDUY_TIME_CD
			, STDUY_SUPLS_NM
			, CPRTN_INSTT_SEQ
			, PC_STDUY_CNTN
			, MBL_STDUY_CNTN
			, EDCTN_NTCTN_FILE_SEQ
			, THNL_FILE_SEQ
			, EXPS_YN
			, EXPNS_CPRTN_INSTT_SEQ
			, BDGET_EXPNS_YN
			, REG_ID
			, REG_IP
			, REG_DTM
			)
		VALUES
		    (
			#{edctnSeq}
			, #{ctgryCd}
			, #{nm}
			, #{smmryNm}
			, #{accsStrtDtm}
			, #{accsEndDtm}
			, #{edctnStrtDtm}
			, #{edctnEndDtm}
			, #{fxnumCnt}
			, #{fxnumImpsbYn}
			, #{picNm}
			, #{picEmail}
			, #{picTelNo}
			, #{placeSeq}
			, #{itrdcCntn}
			, #{stduyTrgtCntn}
			, #{stduyDdCd}
			, #{stduyTimeCd}
			, #{stduySuplsNm}
			, #{cprtnInsttSeq}
			, #{pcStduyCntn}
			, #{mblStduyCntn}
			, #{edctnNtctnFileSeq}
			, #{thnlFileSeq}
			, #{expsYn}
			, #{expnsCprtnInsttSeq}
			, #{bdgetExpnsYn}
			, #{regId}
			, #{regIp}
			, now()
			)
	</insert>

	<!--
		 쿼리명 : EBINonMemberMapper.insertNonMemberTrgt
		 설  명 : 비회원 교육 과정 대상 상세 등록
		  수정일     수정자       수정내용
		==========   ======    ==============
		2023.12.15   장두석       최초생성
	-->
	<insert id="insertNonMemberTrgt" parameterType="EBINonMemberDTO" >

		INSERT INTO /* EBINonMemberMapper.insertNonMemberTrgt */ NMB_EDCTN_TRGT_DTL
		(
		EDCTN_SEQ
		, CD
		, ETC_NM
		, REG_ID
		, REG_IP
		, REG_DTM
		, MOD_ID
		, MOD_IP
		, MOD_DTM
		)
		VALUES
		<foreach collection="trgtDtlList" item="trgtDtlList" index="index" separator=" , " open="" close=";">
			(
			#{trgtDtlList.edctnSeq}
			, #{trgtDtlList.targetCd}
			, #{trgtDtlList.etcNm}
			, #{regId}
			, #{regIp}
			,  now()
			, #{modId}
			, #{modIp}
			,  now()
			)
		</foreach>
	</insert>



	<!--
      쿼리명 : EBINonMemberMapper.selectIsttrList
      설  명 : 비회원 교육 과정 관리 - 강사 관계 호출
       수정일     수정자       수정내용
     ==========   ======    ==============
     2023.12.15   장두석       최초생성
 	-->
	<select id="selectIsttrList" parameterType="EBINonMemberDTO" resultType="EBBIsttrDTO">
		SELECT /*EBINonMemberMapper.selectIsttrList*/
			A.EDCTN_SEQ
			 , A.ISTTR_SEQ
		     , B.NAME
			 , B.FFLTN_NM
			 , B.PSTN_NM
			 , B.DEPT_NM
		     , B.SPCL_CNTN
			 , A.REG_ID
			 , A.REG_IP
			 , A.REG_DTM
			 , A.MOD_ID
			 , A.MOD_IP
			 , A.MOD_DTM
		FROM NMB_EDCTN_ISTTR_REL A, CP_ISTTR_MST B
		WHERE 1=1
		AND A.ISTTR_SEQ = B.ISTTR_SEQ
		AND EDCTN_SEQ = #{edctnSeq}
	</select>


	<!--
         쿼리명 : EBINonMemberMapper.deleteIsttrRel
         설  명 : 비회원 교육 과정 - 교육강사 관계 삭제
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.12.15   장두석       최초생성
    -->
	<delete id="deleteIsttrRel" parameterType="EBINonMemberDTO">
		DELETE FROM /* EBINonMemberMapper.deleteIsttrRel */ NMB_EDCTN_ISTTR_REL
		where 1=1
			AND EDCTN_SEQ = #{edctnSeq}
	</delete>

	<!--
		 쿼리명 : EBINonMemberMapper.insertIsttrRel
		 설  명 : 비회원 교육 과정 - 교육강사 관계 등록
		  수정일     수정자       수정내용
		==========   ======    ==============
		2023.12.15   장두석       최초생성
	-->
	<insert id="insertIsttrRel" parameterType="EBINonMemberDTO">
		INSERT INTO /*EBINonMemberMapper.insertNonMember*/ NMB_EDCTN_ISTTR_REL (
			EDCTN_SEQ
			, ISTTR_SEQ
			, REG_ID
			, REG_IP
			, REG_DTM
			, MOD_ID
			, MOD_IP
			, MOD_DTM
		) VALUES
		<foreach collection="isttrSeqList" item="isttrSeqList" index="index" separator=" , " open="" close=";">
			(
			#{edctnSeq}
			, #{isttrSeqList.isttrSeq}
			, #{regId}
			, #{regIp}
			, now()
			, #{modId}
			, #{modIp}
			, now()
			)
		</foreach>
	</insert>

	<!--
         쿼리명 : EBINonMemberMapper.updateNonMember
         설  명 : 비회원 교육 과정 수정
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.12.15   장두석       최초생성
    -->
	<update id="updateNonMember" parameterType="EBINonMemberDTO" >

		UPDATE NMB_EDCTN_PRCS_MST SET /* EBINonMemberMapper.updateNonMember */
			CTGRY_CD = #{ctgryCd}
			, NM = #{nm}
			, SMMRY_NM = #{smmryNm}
			, ACCS_STRT_DTM = #{accsStrtDtm}
			, ACCS_END_DTM = #{accsEndDtm}
			, EDCTN_STRT_DTM = #{edctnStrtDtm}
			, EDCTN_END_DTM = #{edctnEndDtm}
			, FXNUM_CNT = #{fxnumCnt}
			, FXNUM_IMPSB_YN = #{fxnumImpsbYn}
			, PIC_NM = #{picNm}
			, PIC_EMAIL = #{picEmail}
			, PIC_TEL_NO = #{picTelNo}
			, PLACE_SEQ = #{placeSeq}
			, ITRDC_CNTN = #{itrdcCntn}
			, STDUY_TRGT_CNTN = #{stduyTrgtCntn}
			, STDUY_DD_CD = #{stduyDdCd}
			, STDUY_TIME_CD = #{stduyTimeCd}
			, STDUY_SUPLS_NM = #{stduySuplsNm}
			, CPRTN_INSTT_SEQ = #{cprtnInsttSeq}
			, PC_STDUY_CNTN = #{pcStduyCntn}
			, MBL_STDUY_CNTN = #{mblStduyCntn}
			, EDCTN_NTCTN_FILE_SEQ = #{edctnNtctnFileSeq}
			, THNL_FILE_SEQ = #{thnlFileSeq}
			, EXPS_YN = #{expsYn}
			, EXPNS_CPRTN_INSTT_SEQ = #{expnsCprtnInsttSeq}
			, EXPNS_PMT = #{expnsPmt}
			, BDGET_EXPNS_YN = #{bdgetExpnsYn}
			, MOD_ID = #{modId}
			, MOD_IP = #{modIp}
			, MOD_DTM = now()
		WHERE 1=1
			AND EDCTN_SEQ = #{edctnSeq}
	</update>

	<!--
         쿼리명 : EBACouseMapper.deleteNonMemberTrgt
         설  명 : 비회원 교육 과정 대상 상세 삭제
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.11.08   장두석       최초생성
    -->
	<delete id="deleteNonMemberTrgt" parameterType="EBINonMemberDTO">
		DELETE FROM /* EBINonMemberMapper.deleteNonMemberTrgt */
			NMB_EDCTN_TRGT_DTL
		WHERE
			EDCTN_SEQ = #{edctnSeq}
	</delete>

	<!--
         쿼리명 : EBINonMemberMapper.deleteNonMember
         설  명 : 비회원 교육 과정 삭제
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.12.15   장두석       최초생성
    -->
	<delete id="deleteNonMember" parameterType="EBINonMemberDTO">
		DELETE FROM /* EBINonMemberMapper.deleteNonMember */
		   ED_EDCTN_PRCS_MST
		WHERE 1=1
			AND EDCTN_SEQ IN
		<foreach collection="delValueList" item="delValueList" index="index" separator=", " open="(" close=")">
			#{delValueList}
		</foreach>
	</delete>

	<!--
         쿼리명 : EBINonMemberMapper.deleteBdgetList
         설  명 : 비회원 교육 과정 - 예산/지출내역 삭제
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.12.15   장두석       최초생성
    -->
	<delete id="deleteBdgetList" parameterType="EBINonMemberDTO">
		DELETE FROM NMB_EDCTN_BDGET_EXPNS_DTL
	   	WHERE 1=1  /* EBINonMemberMapper.deleteBdgetList */
	   		AND EDCTN_SEQ = #{edctnSeq}
	</delete>

	<!--
             쿼리명 : EBINonMemberMapper.insertBdgetList
             설  명 : 비회원 교육 과정 - 예산지출내역 등록
              수정일     수정자       수정내용
            ==========   ======    ==============
            2023.12.15   장두석       최초생성
        -->
	<insert id="insertBdgetList" parameterType="EBINonMemberDTO">
		INSERT INTO /*EBINonMemberMapper.insertBdgetList*/ NMB_EDCTN_BDGET_EXPNS_DTL (
			EDCTN_SEQ
			, CD
			, PMT
			, ETC_NM
			, REG_ID
			, REG_IP
			, REG_DTM
			, MOD_ID
			, MOD_IP
			, MOD_DTM
		) VALUES
		<foreach collection="bdgetList" item="bdgetList" index="index" separator=" , " open="" close=";">
			(
			#{bdgetList.edctnSeq}
			, #{bdgetList.cd}
			, #{bdgetList.pmt}
			, #{bdgetList.etcNm}
			, #{regId}
			, #{regIp}
			, now()
			, #{modId}
			, #{modIp}
			, now()
			)
		</foreach>
	</insert>



	<!--
      쿼리명 : EBINonMemberMapper.selectBdgetDtlList
      설  명 : 비회원 교육 과정관리 - 예산지출 상세 호출
       수정일     수정자       수정내용
     ==========   ======    ==============
     2023.12.15   장두석       최초생성
 	-->
	<select id="selectBdgetDtlList" parameterType="EBBBdgetDTO" resultType="EBBBdgetDTO">
		SELECT /*EBINonMemberMapper.selectBdgetDtlList */
			EDCTN_SEQ
			, CD
            , PMT
			, ETC_NM
            , REG_ID
            , REG_IP
            , REG_DTM
            , MOD_ID
            , MOD_IP
            , MOD_DTM
		FROM
		    NMB_EDCTN_BDGET_EXPNS_DTL
		WHERE 1=1
		  AND EDCTN_SEQ = #{edctnSeq}
	</select>


	<!--
      쿼리명 : EBINonMemberMapper.selectNonMemberPtcptListCnt
      설  명 : 비회원 교육 과정 관리 - 신청자 목록 카운트
       수정일     수정자       수정내용
     ==========   ======    ==============
     2023.12.15   장두석       최초생성
 	-->
	<select id="selectNonMemberPtcptListCnt" parameterType="EBINonMemberDTO" resultType="java.lang.Integer">
		SELECT /* EBINonMemberMapper.selectNonMemberPtcptListCnt */
			COUNT(*)
		FROM
		    NMB_EDCTN_PTCPT_MST A
		WHERE 1=1
		  AND A.EDCTN_SEQ = #{edctnSeq}
		  AND STTS_CD = 'EDU_STTS_CD01'
	</select>

	<!--
      쿼리명 : EBINonMemberMapper.selectNonMemberPtcptList
      설  명 : 비회원 교육 과정관리 - 신청자 목록
       수정일     수정자       수정내용
     ==========   ======    ==============
     2023.12.15   장두석       최초생성
 	-->
	<select id="selectNonMemberPtcptList" parameterType="EBINonMemberDTO" resultType="EBINonMemberDTO">
		SELECT /* EBINonMemberMapper.selectNonMemberPtcptList */
			PTCPT_SEQ
		 	, PTCPT_BSNM_NO
			, PTCPT_CMPN_NM
			, NAME
			, EMAIL
			, DEPT_CD
			, (SELECT CD_NM FROM CO_CODE_MST WHERE CD = A.DEPT_CD) AS DEPT_CD_NM
		    , DEPT_DTL_NM
			, PSTN_CD
			, (SELECT CD_NM FROM CO_CODE_MST WHERE CD = A.PSTN_CD) AS PSTN_CD_NM
			, PSTN_NM
			, HP_NO
		    , STTS_CD
		    , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = A.STTS_CD) AS STTS_CD_NM
			, REG_DTM
		FROM
		    NMB_EDCTN_PTCPT_MST A
		WHERE
			EDCTN_SEQ = #{edctnSeq}
			AND STTS_CD = 'EDU_STTS_CD01'
		ORDER BY
			REG_DTM DESC
			limit #{firstIndex}, #{recordCountPerPage}
	</select>

	<!--
             쿼리명 : EBINonMemberMapper.updatePtcptList
             설  명 : 비회원 교육 과정관리 - 신청자 목록 수정(신청, 취소)
              수정일     수정자       수정내용
            ==========   ======    ==============
            2023.12.15   장두석       최초생성
        -->
	<update id="updatePtcptList" parameterType="EBINonMemberDTO" >
			UPDATE NMB_EDCTN_PTCPT_MST SET /* EBINonMemberMapper.updatePtcptList */
			    STTS_CD = 'EDU_STTS_CD02'
				, MOD_ID = #{modId}
				, MOD_IP = #{modIp}
				, MOD_DTM = NOW()
			WHERE 1=1
				AND EDCTN_SEQ = #{edctnSeq}
				AND PTCPT_SEQ IN
				<foreach collection="ptcptSeqList" item="ptcptSeq" index="index" separator=", " open="(" close=")">
					#{ptcptSeq}
				</foreach>
	</update>

	<!--
             쿼리명 : EBINonMemberMapper.updatePtcpt
             설  명 : 비회원 교육 과정관리 - 신청자 수정(신청, 취소)
              수정일     수정자       수정내용
            ==========   ======    ==============
            2023.12.15   장두석       최초생성
        -->
	<update id="updatePtcpt" parameterType="EBINonMemberDTO" >
		UPDATE NMB_EDCTN_PTCPT_MST SET /* EBINonMemberMapper.updatePtcpt */
		STTS_CD = 'EDU_STTS_CD02'
		, MOD_ID = #{modId}
		, MOD_IP = #{modIp}
		, MOD_DTM = NOW()
		WHERE 1=1
		AND EDCTN_SEQ = #{edctnSeq}
		AND PTCPT_SEQ = #{ptcptSeq}
	</update>

	<!--
      쿼리명 : EBINonMemberMapper.selectFxnumChk
      설  명 : 비회원 교육 과정관리 - 신청자 정원체크
       수정일     수정자       수정내용
     ==========   ======    ==============
     2023.12.15   장두석       최초생성
 	-->
	<select id="selectFxnumChk" parameterType="EBINonMemberDTO" resultType="EBINonMemberDTO">
		SELECT /* EBINonMemberMapper.selectFxnumChk */
				AA.EDCTN_SEQ
				, AA.FXNUM_IMPSB_YN
				, AA.FXNUM_CNT
				, CNT
				, CASE
				    WHEN AA.FXNUM_IMPSB_YN = 'N' THEN 'S'
					WHEN AA.FXNUM_IMPSB_YN = 'Y' THEN
					CASE
						WHEN AA.CNT <![CDATA[<]]> AA.FXNUM_CNT THEN 'S'
						ELSE 'F'
					END
				END FXNUM_STTA
			FROM (SELECT
						EDCTN_SEQ
						, FXNUM_IMPSB_YN
						, FXNUM_CNT
						, (SELECT COUNT(*) FROM NMB_EDCTN_PTCPT_MST WHERE EDCTN_SEQ = A.EDCTN_SEQ AND STTS_CD = 'EDU_STTS_CD01' ) AS CNT
			FROM NMB_EDCTN_PRCS_MST A
			WHERE 1=1
				AND EDCTN_SEQ = #{edctnSeq}
			) AA
	</select>

	<!--
      쿼리명 : EBINonMemberMapper.selectPtcptDtl
      설  명 : 비회원 교육 과정 - 신청자 등록 전 확인
       수정일     수정자       수정내용
     ==========   ======    ==============
     2023.12.15   장두석       최초생성
 	-->
	<select id="selectPtcptDtl" parameterType="EBINonMemberDTO" resultType="EBINonMemberDTO">
		SELECT /* EBINonMemberMapper.selectPtcptDtl */
			STTS_CD
			, REG_DTM
		FROM
		    NMB_EDCTN_PTCPT_MST
		WHERE 1=1
			AND EDCTN_SEQ = #{edctnSeq}
			AND PTCPT_BSNM_NO = #{ptcptBsnmNo}
			AND NAME = #{name}
			AND EMAIL = #{email}
			AND HP_NO = #{hpNo}
	</select>

	<!--
             쿼리명 : EBINonMemberMapper.insertPtcptDtl
             설  명 : 비회원 교육 과정 - 신청자 등록
              수정일     수정자       수정내용
            ==========   ======    ==============
            2023.12.15   장두석       최초생성
        -->
	<insert id="insertPtcptDtl" parameterType="EBINonMemberDTO">
		INSERT /* EBINonMemberMapper.insertPtcptDtl */ INTO NMB_EDCTN_PTCPT_MST (
			PTCPT_SEQ
			, EDCTN_SEQ
			, PTCPT_BSNM_NO
			, PTCPT_CMPN_NM
			, NAME
			, EMAIL
			, DEPT_CD
			, DEPT_DTL_NM
			, PSTN_CD
			, PSTN_NM
			, HP_NO
			, STTS_CD
			, REG_ID
			, REG_IP
			, REG_DTM
		) VALUES(
				#{ptcptSeq}
				, #{edctnSeq}
				, #{ptcptBsnmNo}
				, #{ptcptCmpnNm}
				, #{name}
				, #{email}
				, #{deptCd}
				, #{deptDtlNm}
				, #{pstnCd}
				, #{pstnNm}
				, #{hpNo}
				, 'EDU_STTS_CD01'
				, #{regId}
				, #{regIp}
				, now()
			)
	</insert>






	<!--
      쿼리명 : EBINonMemberMapper.searchPtcptCnt
      설  명 : 사용자 - 비회원 교육 과정 신청 개수 조회
       수정일     수정자       수정내용
     ==========   ======    ==============
     2024.01.23   장두석       최초생성
 	-->
	<select id="searchPtcptCnt" parameterType="EBINonMemberDTO" resultType="java.lang.Integer">
		SELECT /* EBINonMemberMapper.searchPtcptCnt */
			COUNT(*)
		FROM
			(
				SELECT
					EDCTN_SEQ
					 , CTGRY_CD
					 , (SELECT PARNT_SEQ FROM CO_CODE_MST WHERE CD = A.CTGRY_CD) AS PRNT_SEQ
					 , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = A.CTGRY_CD) AS CTGRY_CD_NM
					 , NM
					 , "집체교육" AS STDUY_MTHD_CD_NM
					 , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = A.STDUY_DD_CD) AS STDUY_DD_CD_NM
					 , STDUY_TIME_CD
					 , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = A.STDUY_TIME_CD) AS STDUY_TIME_CD_NM
					 , (SELECT NM FROM ED_EDCTN_PLACE_MST WHERE PLACE_SEQ = A.PLACE_SEQ) AS PLACE_NM
					 , ACCS_STRT_DTM
					 , ACCS_END_DTM
					 , EDCTN_STRT_DTM
					 , EDCTN_END_DTM
					 , CASE
						   WHEN NOW() <![CDATA[<]]> EDCTN_STRT_DTM THEN '교육대기'
						   WHEN NOW() <![CDATA[>]]> EDCTN_STRT_DTM AND NOW() <![CDATA[<]]> EDCTN_END_DTM THEN '교육중'
						   WHEN NOW() <![CDATA[>]]> EDCTN_END_DTM THEN '교육종료'
					END  AS EDCTN_STATUS_NM
					 , EXPS_YN
					 , (SELECT REG_DTM FROM NMB_EDCTN_PTCPT_MST WHERE EDCTN_SEQ = A.EDCTN_SEQ AND NAME = #{name} AND EMAIL = #{email} AND HP_NO = #{hpNo}) REG_DTM
					 , (SELECT PTCPT_SEQ FROM NMB_EDCTN_PTCPT_MST WHERE EDCTN_SEQ = A.EDCTN_SEQ AND NAME = #{name} AND EMAIL = #{email} AND HP_NO = #{hpNo}) PTCPT_SEQ
					 , (SELECT STTS_CD FROM NMB_EDCTN_PTCPT_MST WHERE EDCTN_SEQ = A.EDCTN_SEQ AND NAME = #{name} AND EMAIL = #{email} AND HP_NO = #{hpNo}) STTS_CD
					 , (SELECT WEB_PATH FROM CO_FILE_DTL WHERE FILE_SEQ = THNL_FILE_SEQ order by file_ord desc limit 1) WEB_PATH
			FROM
				NMB_EDCTN_PRCS_MST A
		WHERE
			EDCTN_SEQ IN (SELECT EDCTN_SEQ FROM NMB_EDCTN_PTCPT_MST WHERE NAME = #{name} AND EMAIL = #{email} AND HP_NO = #{hpNo})
			) AA
	</select>

	<!--
		쿼리명 : EBINonMemberMapper.selectNonMemberApplyList
		설  명 : 사용자 - 비회원 교육 과정 신청 목록 조회
	      수정일      수정자       수정내용
        ==========   ========   ==============
        2024.01.23   장두석       최초생성
    -->
	<select id="selectNonMemberApplyList" parameterType="EBINonMemberDTO" resultType="EBINonMemberDTO">
		SELECT /*EBINonMemberMapper.selectNonMemberApplyList*/
			EDCTN_SEQ
			, CTGRY_CD
			, (SELECT CD_NM FROM CO_CODE_MST WHERE CD_SEQ = AA.PRNT_SEQ) AS PRNT_CD_NM
			, CTGRY_CD_NM
			, NM
			, STDUY_MTHD_CD_NM
			, STDUY_DD_CD_NM
			, STDUY_TIME_CD
			, STDUY_TIME_CD_NM
			, PLACE_NM
			, ACCS_STRT_DTM
			, ACCS_END_DTM
			, EDCTN_STRT_DTM
			, EDCTN_END_DTM
			, EDCTN_STATUS_NM
			, EXPS_YN
			, PTCPT_SEQ
			, REG_DTM
			, STTS_CD
			, WEB_PATH
		FROM
			(
			SELECT
				EDCTN_SEQ
				, CTGRY_CD
				, (SELECT PARNT_SEQ FROM CO_CODE_MST WHERE CD = A.CTGRY_CD) AS PRNT_SEQ
				, (SELECT CD_NM FROM CO_CODE_MST WHERE CD = A.CTGRY_CD) AS CTGRY_CD_NM
				, NM
				, "집체교육" AS STDUY_MTHD_CD_NM
				, (SELECT CD_NM FROM CO_CODE_MST WHERE CD = A.STDUY_DD_CD) AS STDUY_DD_CD_NM
				, STDUY_TIME_CD
				, (SELECT CD_NM FROM CO_CODE_MST WHERE CD = A.STDUY_TIME_CD) AS STDUY_TIME_CD_NM
				, (SELECT NM FROM ED_EDCTN_PLACE_MST WHERE PLACE_SEQ = A.PLACE_SEQ) AS PLACE_NM
				, ACCS_STRT_DTM
				, ACCS_END_DTM
				, EDCTN_STRT_DTM
				, EDCTN_END_DTM
				, CASE
				WHEN NOW() <![CDATA[<]]> EDCTN_STRT_DTM THEN '교육대기'
				WHEN NOW() <![CDATA[>]]> EDCTN_STRT_DTM AND NOW() <![CDATA[<]]> EDCTN_END_DTM THEN '교육중'
				WHEN NOW() <![CDATA[>]]> EDCTN_END_DTM THEN '교육종료'
				END  AS EDCTN_STATUS_NM
				, EXPS_YN
				, (SELECT REG_DTM FROM NMB_EDCTN_PTCPT_MST WHERE EDCTN_SEQ = A.EDCTN_SEQ AND NAME = #{name} AND EMAIL = #{email} AND HP_NO = #{hpNo}) REG_DTM
				, (SELECT PTCPT_SEQ FROM NMB_EDCTN_PTCPT_MST WHERE EDCTN_SEQ = A.EDCTN_SEQ AND NAME = #{name} AND EMAIL = #{email} AND HP_NO = #{hpNo}) PTCPT_SEQ
				, (SELECT STTS_CD FROM NMB_EDCTN_PTCPT_MST WHERE EDCTN_SEQ = A.EDCTN_SEQ AND NAME = #{name} AND EMAIL = #{email} AND HP_NO = #{hpNo}) STTS_CD
				, (SELECT WEB_PATH FROM CO_FILE_DTL WHERE FILE_SEQ = THNL_FILE_SEQ order by file_ord desc limit 1) WEB_PATH
			FROM
				NMB_EDCTN_PRCS_MST A
			WHERE
				EDCTN_SEQ IN (SELECT EDCTN_SEQ FROM NMB_EDCTN_PTCPT_MST WHERE NAME = #{name} AND EMAIL = #{email} AND HP_NO = #{hpNo})
		) AA
		ORDER BY
		<include refid="selectNonMemberApplyListOrderBySql" />
		limit #{firstIndex}, #{recordCountPerPage}
	</select>

	<sql id="selectNonMemberApplyListOrderBySql">
		<choose>
			<when test="ordData == '1'.toString()">
				/*B.REG_DTM DESC, A.EDCTN_STRT_DTM ASC*/
				AA.REG_DTM DESC
			</when>
			<when test="ordData == '2'.toString()">
				CASE
					WHEN AA.EDCTN_STRT_DTM <![CDATA[>]]> NOW() THEN 1
					WHEN AA.EDCTN_STRT_DTM <![CDATA[<]]> NOW() THEN 2
				END,
				AA.EDCTN_STRT_DTM ASC,
				AA.EDCTN_END_DTM ASC,
				AA.REG_DTM DESC
			</when>
			<when test="ordData == '3'.toString()">
				CAST(AA.STDUY_TIME_CD_NM AS SIGNED) ASC,
				AA.REG_DTM DESC
			</when>
			<when test="ordData == '4'.toString()">
				CAST(AA.STDUY_TIME_CD_NM AS SIGNED) DESC,
				AA.REG_DTM DESC
			</when>
			<otherwise>
				A.REG_DTM DESC
			</otherwise>
		</choose>
		, CASE
			WHEN AA.STTS_CD = 'EDU_STTS_CD01' THEN 1
			WHEN NOW() <![CDATA[<]]> AA.EDCTN_STRT_DTM THEN 2
			WHEN NOW() <![CDATA[>]]> AA.EDCTN_STRT_DTM AND NOW() <![CDATA[<]]> AA.EDCTN_END_DTM THEN 3
		END
		, CASE
			WHEN NOW() <![CDATA[>]]> AA.EDCTN_END_DTM THEN 1
			WHEN AA.STTS_CD = 'EDU_STTS_CD02'THEN 2
		END
	</sql>

	<!--
      쿼리명 : EBINonMemberMapper.selectNonMemberApplyPtcptDtl
      설  명 : 사용자 - 비회원 교육 과정 신청자 상세
       수정일     수정자       수정내용
     ==========   ======    ==============
     2024.01.26   장두석       최초생성
 	-->
	<select id="selectNonMemberApplyPtcptDtl" parameterType="EBINonMemberDTO" resultType="EBINonMemberDTO">
		SELECT /* EBINonMemberMapper.selectNonMemberApplyPtcptDtl */
			A.*
			, (SELECT CD_NM FROM CO_CODE_MST WHERE CD = DEPT_CD) DEPT_CD_NM
			, (SELECT CD_NM FROM CO_CODE_MST WHERE CD = PSTN_CD) PSTN_CD_NM
		FROM
			NMB_EDCTN_PTCPT_MST A
		WHERE 1=1
		  AND EDCTN_SEQ = #{edctnSeq}
		  AND PTCPT_SEQ = #{ptcptSeq}
	</select>

</mapper>


