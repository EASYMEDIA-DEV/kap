<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kap.service.dao.eb.EBCVisitEduMapper">
	<!--
		쿼리명 : EBCVisitEduMapper.selectVisitEduList
		설  명 : 방문교육 목록을 조회한다.
	      수정일      수정자       수정내용
        ==========   ========   ==============
        2023.11.30    구은희       최초생성
    -->
	<select id="selectVisitEduList" parameterType="EBCVisitEduDTO" resultType="EBCVisitEduDTO">
		SELECT /*EBCVisitEduMapper.selectVisitEduList*/
			A.vst_seq -- 방문순번
			 , A.mem_seq -- 회원순번
			 , A.appctn_bsnm_no -- 신청당시 사업자등록번호
			 , A.appctn_fld_cd -- 신청분야 코드
			 , (SELECT CD_NM FROM CO_CODE_MST WHERE CD_ID = 'EBC_VISIT_CD' AND CD = A.appctn_fld_cd) AS appctn_fld_name -- 신청분야명
			 , A.hope_dt -- 교육희망일
			 , A.ptcpt_cnt -- 교육인원
			 , A.ptcpt_hh -- 교육시간
			 , (SELECT CD_NM FROM CO_CODE_MST WHERE CD_ID = 'EBC_VISIT_CD' AND CD = A.ptcpt_hh) AS ptcpt_hh_num
			 , A.edctn_place AS edctn_place_addr -- 교육장소 hidden값
			 , A.reg_dtm AS visit_reg_dtm -- 방문교육신청일시
			 , A.mod_id AS visit_mod_id -- 최종수정자
			 , A.mod_dtm  AS visit_mod_dtm-- 최종수정일시
			 , B.name-- 신청자이름
			 , B.id -- 신청자 아이디
			 , B.hp_no -- 신청자 핸드폰번호
			 , B.email -- 신청자이메일
			 , C.cmpn_nm -- 부품사명
			 , C.ctgry_cd -- 부품사구분코드
			 , (SELECT CD_NM FROM CO_CODE_MST WHERE CD_ID = 'COMPANY_TYPE' AND CD = C.ctgry_cd) AS ctgry_name
			 , C.size_cd -- 부품사규모
			 , (SELECT CD_NM FROM CO_CODE_MST WHERE CD_ID = 'COMPANY_TYPE' AND CD = C.size_cd) AS size_name
			 , D.vst_rslt_seq -- 방문결과순번
			 , D.cnfrmd_theme -- 확정주제
			 , (SELECT CD_NM FROM CO_CODE_MST WHERE CD_ID = 'EBC_VISIT_CD' AND CD = D.edctn_stts_cd) AS edctn_stts_name -- 교육상태명
			 , D.edctn_dtm -- 교육일시
			 , D.cmptn_cnt -- 수료인원

		FROM
			(
				SELECT vst_seq
					 , mem_seq
					 , appctn_bsnm_no
					 , appctn_fld_cd
					 , hope_dt
					 , ptcpt_cnt
					 , ptcpt_hh
					 , edctn_place
					 , reg_dtm
					 , mod_id
					 , mod_dtm
				FROM ev_edctn_vst_mst
			)A
				LEFT JOIN
			(
				SELECT mem_seq
					 , name
					 , id
					 , hp_no
					 , email
				FROM co_mem_mst
			)B
			ON A.mem_seq = B.mem_seq
				LEFT JOIN
			(
				SELECT bsnm_no
					 , cmpn_nm
					 , ctgry_cd
					 , size_cd
				FROM cp_cmpn_mst
			)C
			ON A.appctn_bsnm_no = C.bsnm_no
				LEFT JOIN
			(
				SELECT vst_rslt_seq
					 , vst_seq
					 , mem_seq
					 , cnfrmd_theme
					 , edctn_stts_cd
					 , edctn_dtm
					 , cmptn_cnt
				FROM ev_edctn_vst_rslt_dtl
			)D
			ON A.vst_seq = D.vst_seq
				AND A.mem_seq = D.mem_seq
		<include refid="selectVisitEduListwhereSql" />
		ORDER BY
			A.reg_dtm DESC
			LIMIT #{firstIndex}, #{recordCountPerPage}
	</select>

	<!--
         쿼리명 : EBCVisitEduMapper.selectVisitEduCnt
         설  명 : 방문교육 개수를 조회한다.
          수정일      수정자       수정내용
        ==========   ========   ==============
        2023.11.30    구은희       최초생성
    -->
	<select id="selectVisitEduCnt" parameterType="EBCVisitEduDTO" resultType="java.lang.Integer">
		SELECT /*EBCVisitEduMapper.selectVisitEduCnt*/
			count(A.vst_seq)
		FROM ev_edctn_vst_mst A
		LEFT JOIN co_mem_mst B
		ON A.mem_seq = B.mem_seq
		LEFT JOIN cp_cmpn_mst C
		ON A.appctn_bsnm_no = C.bsnm_no
		LEFT JOIN ev_edctn_vst_rslt_dtl D
		ON A.vst_seq = D.vst_seq
		AND A.mem_seq = D.mem_seq
	</select>

	<!--
		쿼리명 : EBCVisitEduMapper.selectVisitEduDtl
		설  명 : 방문교육 상세를 조회한다.
	      수정일      수정자       수정내용
        ==========   ========   ==============
        2023.11.30    구은희       최초생성
    -->
	<select id="selectVisitEduDtl" parameterType="EBCVisitEduDTO" resultType="EBCVisitEduDTO">
		SELECT /*EBCVisitEduMapper.selectVisitEduDtl*/
			A.vst_seq -- 방문순번
			 , A.mem_seq -- 회원순번
			 , A.appctn_bsnm_no -- 신청당시 사업자등록번호
			 , A.appctn_fld_cd -- 신청분야 코드
			 , (SELECT CD_NM FROM CO_CODE_MST WHERE CD_ID = 'EBC_VISIT_CD' AND CD = A.appctn_fld_cd) AS appctn_fld_name -- 신청분야명
			 , A.hope_dt -- 교육희망일
			 , A.ptcpt_cnt -- 교육인원
			 , A.ptcpt_hh -- 교육시간
			 , (SELECT CD_NM FROM CO_CODE_MST WHERE CD_ID = 'EBC_VISIT_CD' AND CD = A.ptcpt_hh) AS ptcpt_hh_num
			 , A.appctn_theme_cntn -- 신청주제내용
			 , A.appctn_rsn -- 신청사유
			 , A.place_zipcode -- 방문교육 우편주소
			 , A.place_bsc_addr -- 방문교육 기본주소
			 , A.place_dtl_addr -- 방문교육 상세주소
			 , A.edctn_place AS edctn_place_addr -- 교육장소 hidden값
			 , A.ptcpt_trgt_cntn -- 참여대상내용
			 , A.itrdc_file_seq -- 소개파일순번
			 , A.reg_dtm AS visit_reg_dtm -- 방문교육신청일시
			 , A.mod_id AS visit_mod_id -- 최종수정자
			 , A.mod_dtm  AS visit_mod_dtm-- 최종수정일시
			 , B.name-- 신청자이름
			 , B.id -- 신청자 아이디
			 , B.hp_no -- 신청자 핸드폰번호
			 , B.email -- 신청자이메일
			 , B.tel_no
			 , B.dept_cd
			 , B.dept_dtl_nm
			 , B.pstn_cd
			 , B.pstn_nm AS dept_cd_nm
			 , C.cmpn_nm
			 , C.rprsnt_nm
			 , C.cmpn_cd
			 , C.ctgry_cd
			 , C.size_cd
			 , C.stbsm_dt
			 , C.tel_no
			 , C.zipcode
			 , C.bsc_addr
			 , C.dtl_addr
			 , C.sls_pmt
			 , C.sls_year
			 , C.mple_cnt
			 , C.mjr_prdct_1
			 , C.mjr_prdct_2
			 , C.mjr_prdct_3
			 , C.qlty_5_star_cd
			 , C.qlty_5_star_year
			 , C.pay_5_star_cd
			 , C.pay_5_star_year
			 , C.tchlg_5_star_cd
			 , C.tchlg_5_star_year
			 , D.vst_rslt_seq -- 방문결과순번
			 , D.cnfrmd_theme -- 확정주제
			 , D.edctn_stts_cd -- 교육상태코드
			 , D.edctn_dtm -- 교육일시
			 , D.cmptn_cnt -- 수료인원
			 , D.edctn_year -- 교육년도
			 , D.edctn_place -- 교육장소
			 , D.ptcpt_rate -- 참석률
			 , D.lctr_file_seq -- 강의파일순번
			 , D.etc_matls_file_seq -- 기타자료파일순번

		FROM
			(
				SELECT vst_seq
					 , mem_seq
					 , appctn_bsnm_no
					 , appctn_fld_cd
					 , appctn_theme_cntn -- 신청주제내용
					 , appctn_rsn -- 신청사유
					 , hope_dt
					 , place_zipcode
					 , place_bsc_addr
					 , place_dtl_addr
					 , edctn_place -- 교육장소 hidden값
					 , ptcpt_trgt_cntn -- 참여대상내용
					 , ptcpt_cnt
					 , ptcpt_hh
					 , itrdc_file_seq -- 소개파일순번
					 , reg_dtm
					 , mod_id
					 , mod_dtm
				FROM ev_edctn_vst_mst
			)A
				INNER JOIN
			(
				SELECT mem_seq
					 , name
					 , id
					 , hp_no
					 , tel_no
					 , email
					 , dept_cd
					 , dept_dtl_nm
					 , pstn_cd
					 , pstn_nm
				FROM co_mem_mst
			)B
			ON A.mem_seq = B.mem_seq
				INNER JOIN
			(
				SELECT  bsnm_no
					 , cmpn_nm
					 , rprsnt_nm
					 , cmpn_cd
					 , ctgry_cd
					 , size_cd
					 , stbsm_dt
					 , tel_no
					 , zipcode
					 , bsc_addr
					 , dtl_addr
					 , sls_pmt
					 , sls_year
					 , mple_cnt
					 , mjr_prdct_1
					 , mjr_prdct_2
					 , mjr_prdct_3
					 , qlty_5_star_cd
					 , qlty_5_star_year
					 , pay_5_star_cd
					 , pay_5_star_year
					 , tchlg_5_star_cd
					 , tchlg_5_star_year
					 , reg_id
					 , reg_ip
					 , reg_dtm
				FROM cp_cmpn_mst
			)C
			ON A.appctn_bsnm_no = C.bsnm_no
				LEFT JOIN
			(
				SELECT vst_rslt_seq
					 , vst_seq
					 , mem_seq
					 , cnfrmd_theme
					 , edctn_stts_cd
					 , edctn_year -- 교육년도
					 , edctn_dtm
					 , edctn_place -- 교육장소
					 , cmptn_cnt
					 , ptcpt_rate -- 참석률
					 , lctr_file_seq
					 , etc_matls_file_seq
				FROM ev_edctn_vst_rslt_dtl
			)D
			ON A.vst_seq = D.vst_seq
				AND A.mem_seq = D.mem_seq
		where A.vst_seq = #{vstSeq}

	</select>

	<!--
		쿼리명 : EBCVisitEduMapper.selectAppctnTypeList
		설  명 : 방문교육 신청분야 상세코드 목록을 조회한다.
	      수정일      수정자       수정내용
        ==========   ========   ==============
        2023.12.04    구은희       최초생성
    -->
	<select id="selectAppctnTypeList" parameterType="EBCVisitEduDTO" resultType="EBCVisitEduDTO">
		SELECT /*EBCVisitEduMapper.selectAppctnTypeList*/
			cd
			 , vst_seq
			 , mem_seq
		from ev_edctn_appctn_type_dtl
		where 1=1
		  and vst_seq = #{vstSeq}
		  and mem_seq = #{memSeq}
	</select>

	<!--
          쿼리명 : EBCVisitEduMapper.selectIsttrList
          설  명 : 방문교육 강사를 조회한다.
           수정일     수정자       수정내용
         ==========   ======    ==============
         2023.12.05   구은희       최초생성
         -->
	<select id="selectIsttrList" parameterType="EBCVisitEduDTO" resultType="EBCVisitEduDTO">
		select /*EBCVisitEduMapper.selectIsttrList*/
			a.vst_seq
			 , a.vst_rslt_seq
			 , a.isttr_seq
			 , a.mem_seq
			 , b.name
			 , a.reg_id
			 , a.reg_ip
			 , a.reg_dtm
			 , a.mod_id
			 , a.mod_ip
			 , a.mod_dtm
		from ev_edctn_isttr_rel a, cp_isttr_mst b
		where 1=1
		  and a.isttr_seq = b.isttr_seq
		  and vst_seq = #{vstSeq}
		  and vst_rslt_seq = #{vstRsltSeq}
		  and mem_seq = #{memSeq}
	</select>

	<!--
		 쿼리명 : EBCVisitEduMapper.insertIsttrRel
		 설  명 : 방문교육 강사관계를 등록한다.
		  수정일     수정자       수정내용
		==========   ======    ==============
		2023.12.04   구은희       최초생성
    -->
	<insert id="insertIsttrRel" parameterType="EBCVisitEduDTO">
		insert into /*EBCVisitEduMapper.insertIsttrRel*/ ev_edctn_isttr_rel (
		vst_seq
		, mem_seq
		, vst_rslt_seq
		, isttr_seq
		, reg_id
		, reg_ip
		, reg_dtm
		, mod_id
		, mod_ip
		, mod_dtm
		) VALUES
		<foreach collection="isttrSeqList" item="isttrSeqList" index="index" separator=" , " open="" close=";">
			(
			#{isttrSeqList.vstSeq}
			, #{isttrSeqList.memSeq}
			, #{isttrSeqList.vstRsltSeq}
			, #{isttrSeqList.isttrSeq}
			, #{regId}
			, #{regIp}
			, now()
			, #{modId}
			, #{modIp}
			, now()
			)
		</foreach>
	</insert>

	<!--
         쿼리명 : EBCVisitEduMapper.deleteIsttrRel
         설  명 : 방문교육 강사관계를 삭제한다.
		  수정일     수정자       수정내용
		==========   ======    ==============
		2023.12.04   구은희       최초생성
    -->
	<delete id="deleteIsttrRel" parameterType="EBCVisitEduDTO">
		delete from /*EBCVisitEduMapper.deleteIsttrRel*/ ev_edctn_isttr_rel
		where 1=1
		  and vst_seq = #{vstSeq}
		  and mem_seq = #{memSeq}
		  and vst_rslt_seq = #{vstRsltSeq}
	</delete>

	<!--
		 쿼리명 : EBCVisitEduMapper.insertAppctnType
		 설  명 : 방문교육 신청분야 상세를 등록한다.
		  수정일     수정자       수정내용
		==========   ======    ==============
		2023.12.04   구은희       최초생성
    -->
	<insert id="insertAppctnType" parameterType="EBCVisitEduDTO">
		insert into /*EBCVisitEduMapper.insertAppctnType*/ ev_edctn_appctn_type_dtl (
		vst_seq
		, mem_seq
		, cd
		, reg_id
		, reg_ip
		, reg_dtm
		, mod_id
		, mod_ip
		, mod_dtm
		) VALUES
		<foreach collection="appctnTypeCdList" item="appctnTypeCdList" index="index" separator=" , " open="" close=";">
			(
			#{vstSeq}
			, #{memSeq}
			, #{appctnTypeCdList}
			, #{regId}
			, #{regIp}
			, now()
			, #{modId}
			, #{modIp}
			, now()
			)
		</foreach>
	</insert>

	<!--
         쿼리명 : EBCVisitEduMapper.deleteAppctnType
         설  명 : 방문교육 신청분야 상세를 삭제한다.
		  수정일     수정자       수정내용
		==========   ======    ==============
		2023.12.04   구은희       최초생성
    -->
	<delete id="deleteAppctnType" parameterType="EBCVisitEduDTO">
		delete from /*EBCVisitEduMapper.deleteAppctnType*/ ev_edctn_appctn_type_dtl
		where 1=1
		  and vst_seq = #{vstSeq}
		  and mem_seq = #{memSeq}
	</delete>

	<!--
         쿼리명 : EBCVisitEduMapper.updateEdctnVst
         설  명 : 방문교육 신청내용을 수정한다.
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.12.04   구은희       최초생성
    -->
	<update id="updateEdctnVst" parameterType="EBCVisitEduDTO">
		update /* EBCVisitEduMapper.updateEdctnVst */ ev_edctn_vst_mst
		set
			mem_seq = #{memSeq}
		  , appctn_fld_cd = #{appctnFldCd}
		  , appctn_theme_cntn = #{appctnThemeCntn}
		  , appctn_rsn = #{appctnRsn}
		  , hope_dt = #{hopeDt}
		  , place_zipcode = #{placeZipcode}
		  , place_bsc_addr = #{placeBscAddr}
		  , place_dtl_addr = #{placeDtlAddr}
		  , ptcpt_trgt_cntn = #{ptcptTrgtCntn}
		  , ptcpt_cnt = #{ptcptCnt}
		  , ptcpt_hh = #{ptcptHh}
		<if test="itrdcFileSeq != null and itrdcFileSeq != ''.toString() ">
			, itrdc_file_seq = #{itrdcFileSeq}
		</if>
		  , mod_id = #{modId}
		  , mod_ip = #{modIp}
		  , mod_dtm = now()
		where 1=1
		  and vst_seq = #{vstSeq}
		  and mem_seq = #{memSeq}
	</update>

	<!--
		 쿼리명 : EBCVisitEduMapper.insertEdctnVstRslt
		 설  명 : 방문교육 결과상세를 등록한다.
		  수정일     수정자       수정내용
		==========   ======    ==============
		2023.12.05   구은희       최초생성
    -->
	<insert id="insertEdctnVstRslt" parameterType="EBCVisitEduDTO">
		insert into /*EBCVisitEduMapper.insertEdctnVstRslt*/ ev_edctn_vst_rslt_dtl (
			 vst_rslt_seq
		   , vst_seq
		   , mem_seq
		   , cnfrmd_theme
		   , edctn_stts_cd
		   , edctn_year
		   , edctn_dtm
		   , edctn_place
		   , cmptn_cnt
		   , ptcpt_rate
		   , lctr_file_seq
		   , etc_matls_file_seq
		   , reg_id
		   , reg_ip
		   , reg_dtm
		) VALUES
		(
			#{vstRsltSeq}
			, #{vstSeq}
			, #{memSeq}
			, #{cnfrmdTheme}
			, #{edctnSttsCd}
			, #{edctnYear}
			, #{edctnDtm}
			, #{edctnPlace}
			, #{cmptnCnt}
			, #{ptcptRate}
			, #{lctrFileSeq}
			, #{etcMatlsFileSeq}
			, #{regId}
			, #{regIp}
			, now()
		)
	</insert>

	<!--
         쿼리명 : EBCVisitEduMapper.updateEdctnVstRslt
         설  명 : 방문교육 결과상세를 수정한다.
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.12.04   구은희       최초생성
    -->
	<update id="updateEdctnVstRslt" parameterType="EBCVisitEduDTO">
		update /* EBCVisitEduMapper.updateEdctnVstRslt */ ev_edctn_vst_rslt_dtl
		set
			mem_seq = #{memSeq}
		  , cnfrmd_theme = #{cnfrmdTheme}
		  , edctn_stts_cd = #{edctnSttsCd}
		  , edctn_year = #{edctnYear}
		  , edctn_dtm = #{edctnDtm}
		  , edctn_place = #{edctnPlace}
		  , cmptn_cnt = #{cmptnCnt}
		  , ptcpt_rate = #{ptcptRate}
		  , lctr_file_seq = #{lctrFileSeq}
		  , etc_matls_file_seq = #{etcMatlsFileSeq}
		  , mod_id = #{modId}
		  , mod_ip = #{modIp}
		  , mod_dtm = now()
		where 1=1
		  and vst_seq = #{vstSeq}
		  and mem_seq = #{memSeq}
		  and vst_rslt_seq = #{vstRsltSeq}
	</update>

	<!--
         쿼리명 : EBCVisitEduMapper.selectResultOpList
         설  명 : 방문교육 결과옵션 상세를 조회한다.
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.12.05   구은희       최초생성
    -->
	<select id="selectResultOpList" parameterType="EBCVisitEduDTO" resultType="EBCVisitEduDTO">
		select /*EBCVisitEduMapper.selectResultOpList*/
			rslt_optn_seq
			 , vst_seq
			 , mem_seq
			 , vst_rslt_seq
			 , rslt_type_cd
			 , optn_cd
			 , rslt_val
			 , reg_id
			 , reg_ip
			 , reg_dtm
			 , mod_id
			 , mod_ip
			 , mod_dtm
		from ev_edctn_vst_optn_dtl
		where 1=1
		  and vst_seq = #{vstSeq}
		  and vst_rslt_seq = #{vstRsltSeq}
		  and mem_seq = #{memSeq}
	</select>

	<!--
         쿼리명 : EBCVisitEduMapper.insertResultOp
         설  명 : 방문교육 결과옵션 상세를 등록한다.
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.12.04   구은희       최초생성
    -->
	<insert id="insertResultOp" parameterType="EBCVisitEduDTO">
		insert into /*EBCVisitEduMapper.insertResultOp*/ ev_edctn_vst_optn_dtl (
		rslt_optn_seq
		, vst_seq
		, mem_seq
		, vst_rslt_seq
		, rslt_type_cd
		, optn_cd
		, rslt_val
		, reg_id
		, reg_ip
		, reg_dtm
		, mod_id
		, mod_ip
		, mod_dtm
		) VALUES
		(
			#{rsltOptnSeq}
			, #{vstSeq}
			, #{memSeq}
			, #{vstRsltSeq}
			, #{rsltTypeCd}
			, #{optnCd}
			, #{rsltVal}
			, #{regId}
			, #{regIp}
			, now()
			, #{modId}
			, #{modIp}
			, now()
			)

	</insert>

	<!--
         쿼리명 : EBCVisitEduMapper.deleteResultOp
         설  명 : 방문교육 결과옵션 상세를 삭제한다.
		  수정일     수정자       수정내용
		==========   ======    ==============
		2023.12.04   구은희       최초생성
    -->
	<delete id="deleteResultOp" parameterType="EBCVisitEduDTO">
		delete from /*EBCVisitEduMapper.deleteResultOp*/ ev_edctn_vst_optn_dtl
		where 1=1
		  and vst_seq = #{vstSeq}
		  and mem_seq = #{memSeq}
		  and vst_rslt_seq = #{vstRsltSeq}
	</delete>

	<!--
		쿼리명 : selectVisitEduListwhereSql
		설  명 : 방문교육 관리 where Sql
		  수정일      수정자       수정내용
		==========   ========   ==============
		2023.12.04  구은희       최초생성
	-->
	<sql id="selectVisitEduListwhereSql">
		<where>
			<if test="srchDate != null and srchDate != ''.toString() ">
				<choose>
					<when test="srchDate == 1">
						<if test="dStrDt != null and dStrDt != ''.toString() ">
							AND REG_DTM <![CDATA[ > ]]> str_to_date(#{dStrDt}, '%Y-%m-%d')
							AND REG_DTM <![CDATA[ < ]]> date_add(str_to_date(#{dEndDt}, '%Y-%m-%d'), INTERVAL 1 DAY)
						</if>
					</when>
					<when test="srchDate == 2">
						<if test="dEndDt != null and dEndDt != ''.toString() ">
							AND MOD_DTM <![CDATA[ > ]]> STR_TO_DATE(#{dStrDt}, '%Y-%m-%d')
							AND MOD_DTM <![CDATA[ < ]]> DATE_ADD(STR_TO_DATE(#{dEndDt}, '%Y-%m-%d'), INTERVAL 1 DAY)
						</if>
					</when>
					<otherwise>

					</otherwise>
				</choose>
			</if>
			<if test="ctgryCdList != null and ctgryCdList.size() > 0">
				and (
				<foreach collection="ctgryCdList" item="ctgryCdList" index="index" open="" close="" separator=" or ">
					CTGRY_CD = #{ctgryCdList}
				</foreach>
				)
			</if>
			<if test="appctnFldList != null and appctnFldList.size() > 0">
				and (
				<foreach collection="appctnFldList" item="appctnFldList" index="index" open="" close="" separator=" or ">
					A.appctn_fld_cd = #{appctnFldList}
				</foreach>
				)
			</if>
			<if test="firstRgnsCd != null and firstRgnsCd != ''.toString()">
				AND A.edctn_place LIKE CONCAT('%', (SELECT CD_NM FROM CO_CODE_MST WHERE CD_ID = 'ADDR_CD' AND CD = #{firstRgnsCd}), '%')
				OR A.edctn_place LIKE CONCAT('%', (SELECT CD_NM FROM CO_CODE_MST WHERE CD_ID = 'ADDR_CD' AND CD = #{scndRgnsCd}), '%')
			</if>
			<if test="q != null and q != ''">
				<choose>
					<when test="f == 1">
						AND C.cmpn_nm LIKE CONCAT('%', #{q}, '%')
					</when>
					<when test="f == 2">
						AND A.appctn_bsnm_no LIKE CONCAT('%', #{q}, '%')
					</when>
					<when test="f == 3">
						AND (
						INSTR(#{q}, MOD_ID) <![CDATA[>]]> 0 OR
						EXISTS(SELECT 'x' FROM CO_ADM_MST WHERE ID = A.MOD_ID AND INSTR(#{q}, NAME) <![CDATA[>]]> 0)
						)
					</when>
					<when test="f == 4">
						AND B.name LIKE CONCAT('%', #{q}, '%')
					</when>
					<when test="f == 5">
						AND B.hp_no LIKE CONCAT('%', #{q}, '%')
					</when>
					<when test="f == 6">
						AND B.email LIKE CONCAT('%', #{q}, '%')
					</when>
					<when test="f == 7">
						AND (
						INSTR(#{q}, MOD_ID) <![CDATA[>]]> 0 OR
						EXISTS(SELECT 'x' FROM CO_ADM_MST WHERE ID = A.MOD_ID AND INSTR(#{q}, NAME) <![CDATA[>]]> 0)
						)
					</when>
					<otherwise>
						AND (
						C.cmpn_nm LIKE CONCAT('%', #{q}, '%') OR
						A.appctn_bsnm_no LIKE CONCAT('%', #{q}, '%') OR
						B.name LIKE CONCAT('%', #{q}, '%') OR
						B.hp_no LIKE CONCAT('%', #{q}, '%') OR
						B.email LIKE CONCAT('%', #{q}, '%') OR
						INSTR(#{q}, MOD_ID) <![CDATA[>]]> 0 OR
						EXISTS(SELECT 'x' FROM CO_ADM_MST WHERE ID = A.MOD_ID AND INSTR(#{q}, NAME) <![CDATA[>]]> 0)
						)
					</otherwise>
				</choose>
			</if>
		</where>
	</sql>
</mapper>


