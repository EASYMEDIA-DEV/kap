<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kap.service.dao.eb.EBBEpisdMapper">
	<!--
		쿼리명 : EBACouseMapper.selectEpisdList
		설  명 : 교육차수 목록을 조회한다.
	      수정일      수정자       수정내용
        ==========   ========   ==============
        2023.11.15    김학규       최초생성
    -->
	<select id="selectEpisdList" parameterType="EBBEpisdDTO" resultType="EBBEpisdDTO">
		SELECT /*EBBEpisdMapper.selectEpisdList*/
				edctn_seq
				, episd_seq
				, episd_year
				, episd_ord
				, parnt_seq
				, (select cd_nm from co_code_mst WHERE cd_seq = aa.parnt_seq) AS prnt_cd_nm
				, ctgry_cd
				, ctgry_cd_nm
		     	, cbsn_cd
				, (select cd_nm from co_code_mst WHERE cd = aa.cbsn_cd) as cbsn_cd_nm
				, nm
				, stduy_mthd_cd
				, stduy_mthd_cd_nm
				, stduy_dd_cd
				, stduy_dd_cd_nm
				, stduy_time_cd
				, stduy_time_cd_nm
				, episd_year
				, episd_ord
				, DATEDIFF(accs_end_dtm, NOW()) AS accs_order_day
				, DATEDIFF(accs_end_dtm, NOW()) AS accs_order_day
		     <if test="siteGubun == 'front'">
				, CASE WHEN DATEDIFF(accs_end_dtm, NOW()) <![CDATA[>]]> 0
					THEN DATEDIFF(accs_end_dtm, NOW())
					ELSE 0
					END AS order_plus
				, CASE WHEN DATEDIFF(accs_end_dtm, NOW()) <![CDATA[<]]> 0
					THEN DATEDIFF(NOW(), accs_end_dtm)
					ELSE 0
					END AS order_minus
			 </if>
				, accs_strt_dtm
				, accs_end_dtm
				, case
					when NOW() <![CDATA[<]]> accs_strt_dtm then '접수대기'
					when NOW() <![CDATA[>]]> accs_strt_dtm AND NOW() <![CDATA[<]]>  accs_end_dtm then '접수중'
					when NOW() <![CDATA[>]]> accs_end_dtm OR (fxnum_impsb_yn = 'N' AND accs_cnt <![CDATA[>=]]> fxnum_cnt) then '마감'
					END  AS accs_status_nm
				, case
				when NOW()  <![CDATA[<]]>  accs_strt_dtm then '2'
				when NOW()  <![CDATA[>]]>  accs_strt_dtm AND NOW()  <![CDATA[<]]>   accs_end_dtm then '1'
				when NOW()  <![CDATA[>]]>  accs_end_dtm OR (fxnum_impsb_yn = 'N' AND accs_cnt  <![CDATA[>=]]>  fxnum_cnt) then '3'
				END  AS accs_status_order
				, edctn_strt_dtm
						, edctn_end_dtm
						, case when edctn_stts_cd = 'EDCTN_STTS_CD01' then /*개강일 경우*/
								case when NOW() <![CDATA[<]]> edctn_strt_dtm then '교육대기'
										when NOW() <![CDATA[>]]> edctn_strt_dtm AND NOW() <![CDATA[<]]> edctn_end_dtm then '교육중'
										when NOW() <![CDATA[>]]> edctn_end_dtm then '교육완료'
								end
								when edctn_stts_cd = 'EDCTN_STTS_CD02' then '교육취소'  /*폐강일 경우*/
				END  AS edctn_status_nm
				, (SELECT NAME FROM cp_isttr_mst WHERE isttr_seq = aa.min_isttr_seq) AS isttr_name
				, (SELECT GROUP_CONCAT(name SEPARATOR ', ') from cp_isttr_mst WHERE isttr_seq in (SELECT isttr_seq FROM ed_edctn_isttr_rel WHERE edctn_seq = aa.edctn_seq AND episd_ord = aa.episd_ord AND episd_year = aa.episd_year )) AS isttr_group_name
				, (SELECT ffltn_nm FROM cp_isttr_mst WHERE isttr_seq = aa.min_isttr_seq) AS ffltn_nm
				, case when isttr_cnt <![CDATA[<=]]>1 then ''
					when isttr_cnt <![CDATA[>]]>  1 then isttr_cnt-1
					END isttr_out_cnt
				, fxnum_cnt
				, fxnum_impsb_yn
		     	, edctn_stts_cd
				, accs_cnt
				, rcrmt_mthd_cd
				, rcrmt_mthd_cd_nm
				, pic_nm
				, pic_email
				, pic_tel_no
		     	, edctn_ntctn_file_seq
				, (select orgn_file_nm from co_file_dtl where USE_YN = 'Y' AND file_seq = edctn_ntctn_file_seq) edctn_ntctn_file_nm
				, (SELECT MAX(FILE_ORD) FROM CO_FILE_DTL WHERE USE_YN = 'Y' AND FILE_SEQ = aa.edctn_ntctn_file_seq) AS file_ord
				, place_seq
				, place_nm
				, bsc_addr
				, dtl_addr
				, zipcode
				, rprsnt_tel_no
		     	, bdget_expns_yn
		     	, case bdget_expns_yn
		     	    when 'Y' then '마감'
					when 'N' then '미마감'
					when 'C' then '교육취소'
				end bdget_expns_nm
				, reg_id
				, reg_name
				, reg_dtm
				, mod_id
				, mod_name
		     	, mod_dtm
				, exps_yn
				, edctn_cmpltn_yn
				<if test=' mypageYn == "Y".toString() '>
					, stts_cd
					, CASE STTS_CD
						WHEN 'EDU_STTS_CD01' THEN '선발'
						WHEN 'EDU_STTS_CD02' THEN '신청취소'
						WHEN 'EDU_STTS_CD03' THEN '신청양도'
						WHEN 'EDU_STTS_CD04' THEN '선발대기'
						WHEN 'EDU_STTS_CD05' THEN '미선발'
						WHEN 'EDU_STTS_CD06' THEN '교육취소'
						ELSE '알 수 없음'
					END AS stts_cd_nm
					, cmptn_yn
					, cmptn_dtm
					, mem_seq
					, case when edctn_stts_cd = 'EDCTN_STTS_CD01' then /*개강일 경우*/
								case when stts_cd = 'EDU_STTS_CD01' then /*참여자 상태 : 신청*/
								case when NOW()  <![CDATA[<]]> edctn_strt_dtm then '교육대기'
								when edctn_strt_dtm <![CDATA[<]]> NOW() AND NOW() <![CDATA[<]]>  edctn_end_dtm  then '교육중'
								when edctn_end_dtm <![CDATA[<]]> NOW()  then '교육완료'
								end
								when stts_cd = 'EDU_STTS_CD02' then '신청취소'
								when stts_cd = 'EDU_STTS_CD06' then '교육취소'
								end

								when edctn_stts_cd = 'EDCTN_STTS_CD02' then '교육취소'  /*폐강일 경우*/
								end edu_stat
					, ptcpt_dtm
					, web_path
					, ptcpt_seq
				</if>
			FROM (SELECT
				b.edctn_seq
				, a.episd_seq
				, b.ctgry_cd
				, a.cbsn_cd
				, (select cd_nm from co_code_mst WHERE cd = b.ctgry_cd) as ctgry_cd_nm
				, (select parnt_seq from co_code_mst WHERE cd = b.ctgry_cd) as parnt_seq
				, b.nm
				, b.stduy_mthd_cd
				, (select cd_nm from co_code_mst where cd=b.stduy_mthd_cd) as stduy_mthd_cd_nm
				, b.stduy_dd_cd
				, (select cd_nm from co_code_mst where cd=b.stduy_dd_cd) as stduy_dd_cd_nm
				, b.stduy_time_cd
				, (select cd_nm from co_code_mst where cd=b.stduy_time_cd) as stduy_time_cd_nm
				, a.episd_year
				, a.episd_ord
				, a.accs_strt_dtm
				, a.accs_end_dtm
				, a.edctn_strt_dtm
				, a.edctn_end_dtm
			   	, a.edctn_stts_cd
				, (SELECT min(isttr_seq) FROM ed_edctn_isttr_rel c WHERE a.edctn_seq = c.edctn_seq AND a.episd_year = c.episd_year AND a.episd_ord = c.episd_ord) AS min_isttr_seq
				, (SELECT COUNT(isttr_seq) FROM ed_edctn_isttr_rel c WHERE a.edctn_seq = c.edctn_seq AND a.episd_year = c.episd_year AND a.episd_ord = c.episd_ord) AS isttr_cnt
				, a.fxnum_cnt
				, a.fxnum_impsb_yn
				, (SELECT count(mem_seq) FROM ep_edctn_ptcpt_mst WHERE edctn_seq = a.edctn_seq AND episd_year = a.episd_year AND episd_ord = a.episd_ord AND stts_cd = 'EDU_STTS_CD01') AS accs_cnt
				, a.rcrmt_mthd_cd
				, (select cd_nm from co_code_mst where cd=a.rcrmt_mthd_cd) as rcrmt_mthd_cd_nm
				, a.pic_nm
				, a.pic_email
				, a.pic_tel_no
			   	, a.edctn_ntctn_file_seq
				, a.place_seq
				/*, (SELECT NM FROM ed_edctn_place_mst WHERE PLACE_SEQ = A.place_seq) as place_nm
				, (SELECT bsc_addr FROM ed_edctn_place_mst WHERE PLACE_SEQ = A.place_seq) as bsc_addr
				, (SELECT dtl_addr FROM ed_edctn_place_mst WHERE PLACE_SEQ = A.place_seq) as dtl_addr
				, (SELECT dtl_addr FROM ed_edctn_place_mst WHERE PLACE_SEQ = A.place_seq) as zipcode
				, (SELECT dtl_addr FROM ed_edctn_place_mst WHERE PLACE_SEQ = A.place_seq) as rprsnt_tel_no*/
				, c.nm as place_nm
			    , c.bsc_addr
			    , c.dtl_addr
			    , c.zipcode
			    , c.rprsnt_tel_no
			   	, a.bdget_expns_yn
				, a.reg_id
				, (select name from co_adm_mst where id = a.reg_id) as reg_name
				, a.reg_dtm
				, a.mod_id
				, (select name from co_adm_mst where id = a.mod_id) as mod_name
				, a.mod_dtm
			    , a.exps_yn
				, a.edctn_cmpltn_yn
				<if test=' mypageYn == "Y".toString() '>
				, stts_cd
				, (select cd_nm from co_code_mst where cd=d.stts_cd) as stts_cd_nm
				, cmptn_yn
				, cmptn_dtm
			  	, mem_seq
			    , ptcpt_dtm
				, (SELECT web_path FROM co_file_dtl WHERE file_seq = b.thnl_file_seq order by file_ord desc limit 1) AS web_path
				, ptcpt_seq
				</if>
				FROM ed_edctn_episd_mst a
				LEFT JOIN ed_edctn_prcs_mst b ON a.edctn_seq = b.edctn_seq
				LEFT JOIN (SELECT place_seq, nm, bsc_addr, dtl_addr, zipcode, rprsnt_tel_no FROM ed_edctn_place_mst ) c ON a.place_seq = c.place_seq
				<if test=' mypageYn == "Y".toString() '>
					LEFT JOIN (SELECT
					episd_seq
				    , ptcpt_seq
					, mem_seq
					, stts_cd
					, cmptn_yn
					, cmptn_dtm
				    , reg_dtm as ptcpt_dtm
					FROM ep_edctn_ptcpt_mst) d ON d.episd_seq = a.episd_seq
				</if>

			<include refid="selectLecturerEpisdListSql" />
		) AA

		<include refid="selectEpisdListwhereSql" />

		<if test="siteGubun == 'front'.toString() ">

			<choose>
				<when test="srchOrder == 1">
					<!-- 신청 마감순-->
					ORDER BY accs_status_order ASC, accs_order_day asc
				</when>
				<when test="srchOrder == 2">
					<!-- 교육일자순 -->
					ORDER BY edctn_strt_dtm asc
				</when>
				<when test="srchOrder == 3">
					<!--학습시간 짧은순-->
					ORDER BY stduy_dd_cd_nm asc
				</when>
				<when test="srchOrder == 4">
					<!--학습시간 긴순-->
					ORDER BY stduy_dd_cd_nm desc
				</when>
				<when test="srchOrder == 5">
					<!-- 교육신청 상세 페이지 -->
					ORDER BY accs_status_order is null asc, accs_status_order ASC, order_plus asc, order_minus asc, accs_end_dtm desc
				</when>
				<otherwise>
					<!-- 신청 마감순-->
					ORDER BY accs_status_order ASC, accs_order_day asc
				</otherwise>
			</choose>
		</if>

		<if test="siteGubun == 'admin'.toString() ">
			order by reg_dtm desc
		</if>



		<if test="excelYn != 'Y'.toString() ">
			limit #{firstIndex}, #{recordCountPerPage}
		</if>
	</select>

	<!--
		쿼리명 : EBACouseMapper.selectCouseListCnt
		설  명 : 교육차수 목록을 조회한다. (카운트)
	      수정일      수정자       수정내용
        ==========   ========   ==============
        2023.11.15    김학규       최초생성
    -->
	<select id="selectEpisdListCnt" parameterType="EBBEpisdDTO" resultType="java.lang.Integer">
		SELECT /*EBACouseMapper.selectEpisdListCnt*/
			count(*)
		FROM (SELECT
		b.edctn_seq
		, a.episd_seq
		, b.ctgry_cd
		, a.cbsn_cd
		, (select cd_nm from co_code_mst WHERE cd = b.ctgry_cd) as ctgry_cd_nm
		, (select parnt_seq from co_code_mst WHERE cd = b.ctgry_cd) as parnt_seq
		, b.nm
		, b.stduy_mthd_cd
		, (select cd_nm from co_code_mst where cd=b.stduy_mthd_cd) as stduy_mthd_cd_nm
		, b.stduy_dd_cd
		, (select cd_nm from co_code_mst where cd=b.stduy_dd_cd) as stduy_dd_cd_nm
		, b.stduy_time_cd
		, (select cd_nm from co_code_mst where cd=b.stduy_time_cd) as stduy_time_cd_nm
		, a.episd_year
		, a.episd_ord
		, a.accs_strt_dtm
		, a.accs_end_dtm
		, a.edctn_strt_dtm
		, a.edctn_end_dtm
		, a.edctn_stts_cd
		, (SELECT min(isttr_seq) FROM ed_edctn_isttr_rel c WHERE a.edctn_seq = c.edctn_seq AND a.episd_year = c.episd_year AND a.episd_ord = c.episd_ord) AS min_isttr_seq
		, (SELECT COUNT(isttr_seq) FROM ed_edctn_isttr_rel c WHERE a.edctn_seq = c.edctn_seq AND a.episd_year = c.episd_year AND a.episd_ord = c.episd_ord) AS isttr_cnt
		, a.fxnum_cnt
		, a.fxnum_impsb_yn
		, (SELECT count(mem_seq) FROM ep_edctn_ptcpt_mst WHERE edctn_seq = a.edctn_seq AND episd_year = a.episd_year AND episd_ord = a.episd_ord AND stts_cd = 'EDU_STTS_CD01') AS accs_cnt
		, a.rcrmt_mthd_cd
		, (select cd_nm from co_code_mst where cd=a.rcrmt_mthd_cd) as rcrmt_mthd_cd_nm
		, a.pic_nm
		, a.pic_email
		, a.pic_tel_no
		, a.place_seq
		, (SELECT NM FROM ed_edctn_place_mst WHERE PLACE_SEQ = A.place_seq) as place_nm
		, a.reg_id
		, (select name from co_adm_mst where id = a.reg_id) as reg_name
		, a.reg_dtm
		, a.mod_id
		, (select name from co_adm_mst where id = a.reg_id) as mod_name
		, a.mod_dtm
		, a.exps_yn
		, a.edctn_cmpltn_yn
		<if test=' mypageYn == "Y".toString() '>
			, stts_cd
			, CASE STTS_CD
			WHEN 'EDU_STTS_CD01' THEN '선발'
			WHEN 'EDU_STTS_CD02' THEN '신청취소'
			WHEN 'EDU_STTS_CD03' THEN '신청양도'
			WHEN 'EDU_STTS_CD04' THEN '선발대기'
			WHEN 'EDU_STTS_CD05' THEN '미선발'
			WHEN 'EDU_STTS_CD06' THEN '교육취소'
			ELSE '알 수 없음'
			END AS stts_cd_nm
			, cmptn_yn
			, cmptn_dtm
			, mem_seq
		   	, ptcpt_seq
			, (SELECT web_path FROM co_file_dtl WHERE file_seq = b.thnl_file_seq order by file_ord desc limit 1) AS web_path
		</if>
		FROM ed_edctn_episd_mst a
		LEFT JOIN ed_edctn_prcs_mst b ON a.edctn_seq = b.edctn_seq
		LEFT JOIN (SELECT place_seq, nm, bsc_addr, dtl_addr, zipcode, rprsnt_tel_no FROM ed_edctn_place_mst ) c ON a.place_seq = c.place_seq
		<if test=' mypageYn == "Y".toString() '>
			LEFT JOIN (SELECT
			episd_seq
		    , ptcpt_seq
			, mem_seq
			, stts_cd
			, cmptn_yn
			, cmptn_dtm
			FROM ep_edctn_ptcpt_mst) d ON d.episd_seq = a.episd_seq
		</if>

		<include refid="selectLecturerEpisdListSql" />
		) AA
		<include refid="selectEpisdListwhereSql" />
	</select>

	<!--
		쿼리명 : selectEpisdListwhereSql
		설  명 : 교육차수 where Sql
	      수정일      수정자       수정내용
        ==========   ========   ==============
        2023.11.15    김학규       최초생성
    -->
	<sql id="selectEpisdListwhereSql">
		<where>
			1=1

			<if test="siteGubun == 'front'.toString() ">
				AND EXPS_YN = 'Y'
				<!--사용자는 교육 시작일 이전만 출력-->
				/*AND NOW()  <![CDATA[<]]>  edctn_strt_dtm*/
			</if>

			<if test='mypageYn == "Y".toString() '>
				AND (edctn_strt_dtm  <![CDATA[<]]>  NOW() AND NOW()  <![CDATA[<]]>   edctn_end_dtm)
				AND MEM_SEQ = #{memSeq}
			</if>

			<if test='mypageMainYn == "Y".toString() '>
				<!--신청한 내역중 교육중인것만 호출 -->
				AND STTS_CD = 'EDU_STTS_CD01'
				AND (edctn_strt_dtm <![CDATA[<]]> NOW() AND NOW() <![CDATA[<]]>  edctn_end_dtm)

			</if>


			<!-- -->
			<if test="edctnSeq != null and edctnSeq != ''">
				AND edctn_seq = #{edctnSeq}
			</if>
			<if test="edctnSeq == null and edctnSeq == ''">
				AND edctn_seq = null
			</if>


			<!--등록일/수정기간-->
			<if test="strtDt != null and strtDt != ''">
				<choose>
					<!--교육기간-->
					<when test="srchDate == 1">
						<if test="strtDt != null and strtDt != ''">
							AND EDCTN_STRT_DTM <![CDATA[>=]]> DATE_FORMAT(#{strtDt}, '%Y-%m-%d 00:00:00')
						</if>
						<if test="endDt != null and endDt != ''">
							AND EDCTN_END_DTM <![CDATA[<=]]> DATE_FORMAT(#{endDt}, '%Y-%m-%d 23:59:59')
						</if>
					</when>

					<!--접수기간-->
					<when test="srchDate == 2">
						<if test="strtDt != null and strtDt != ''">
							AND ACCS_STRT_DTM <![CDATA[>=]]> DATE_FORMAT(#{strtDt}, '%Y-%m-%d 00:00:00')
						</if>
						<if test="endDt != null and endDt != ''">
							AND ACCS_END_DTM <![CDATA[<=]]> DATE_FORMAT(#{endDt}, '%Y-%m-%d 23:59:59')
						</if>
					</when>

					<!--등록일-->
					<when test="srchDate == 3">
						<if test="strtDt != null and strtDt != ''">
							AND REG_DTM <![CDATA[>=]]> DATE_FORMAT(#{strtDt}, '%Y-%m-%d 00:00:00')
						</if>
						<if test="endDt != null and endDt != ''">
							AND REG_DTM <![CDATA[<=]]> DATE_FORMAT(#{endDt}, '%Y-%m-%d 23:59:59')
						</if>
					</when>

					<!--수정일-->
					<when test="srchDate == 4">
						<if test="strtDt != null and strtDt != ''">
							AND MOD_DTM <![CDATA[>=]]> DATE_FORMAT(#{strtDt}, '%Y-%m-%d 00:00:00')
						</if>
						<if test="endDt != null and endDt != ''">
							AND MOD_DTM <![CDATA[<=]]> DATE_FORMAT(#{endDt}, '%Y-%m-%d 23:59:59')
						</if>
					</when>
				</choose>
			</if>

			<!--과정분류-->
			<if test="ctgryCdList != null and ctgryCdList.size() > 0">
				and (
				<foreach collection="ctgryCdList" item="ctgryCdList" index="index" open="" close="" separator=" or ">
					ctgry_cd = #{ctgryCdList}
				</foreach>
				)
			</if>
			<!--학습방식 -->
			<if test="stduyMthdCdList != null and stduyMthdCdList.size() > 0">
				and (
				<foreach collection="stduyMthdCdList" item="stduyMthdCdList" index="index" open="" close="" separator=" or ">
					stduy_mthd_cd = #{stduyMthdCdList}
				</foreach>
				)
			</if>

			<!-- 학습일 -->
			<if test="stduyDdCd != null and stduyDdCd != ''">
				AND stduy_dd_cd = #{stduyDdCd}
			</if>
			<!-- 학습시간 -->
			<if test="stduyTimeCd != null and stduyTimeCd != ''">
				AND stduy_time_cd = #{stduyTimeCd}
			</if>

			<!-- 모집방식 -->
			<if test="rcrmtMthdCdList != null and rcrmtMthdCdList.size() > 0">
				and (
				<foreach collection="rcrmtMthdCdList" item="rcrmtMthdCdList" index="index" open="" close="" separator=" or ">
					rcrmt_mthd_cd = #{rcrmtMthdCdList}
				</foreach>
				)
			</if>

			<!--접수상태-->
			<if test="accsStatusList != null and accsStatusList.size() > 0">
				and (
				<foreach collection="accsStatusList" item="accsStatusList" index="index" open="" close="" separator=" or ">
					<choose>
						<when test="accsStatusList != null">
							<if test="accsStatusList == 1"><!--접수대기-->
								edctn_stts_cd = 'EDCTN_STTS_CD01' AND NOW() <![CDATA[<]]> accs_strt_dtm
							</if>
							<if test="accsStatusList == 2"><!--접수중-->
								edctn_stts_cd = 'EDCTN_STTS_CD01' AND NOW() <![CDATA[>]]> accs_strt_dtm AND NOW() <![CDATA[<]]>  accs_end_dtm
							</if>
							<if test="accsStatusList == 3"><!--마감-->
								edctn_stts_cd = 'EDCTN_STTS_CD01' AND (NOW() <![CDATA[>]]> accs_end_dtm OR (fxnum_impsb_yn = 'N' AND accs_cnt <![CDATA[>=]]> fxnum_cnt))
							</if>
						</when>

					</choose>
				</foreach>
				)
			</if>

			<!--교육상태-->
			<if test="edctnStatusList != null and edctnStatusList.size() > 0">
				and (
				<foreach collection="edctnStatusList" item="edctnStatusList" index="index" open="" close="" separator=" or ">
					<choose>
						<when test="edctnStatusList != null">
							<if test="edctnStatusList == 1"><!--접수대기-->
								edctn_stts_cd = 'EDCTN_STTS_CD01' AND (NOW() <![CDATA[<]]> edctn_strt_dtm)
							</if>
							<if test="edctnStatusList == 2"><!--접수중-->
								edctn_stts_cd = 'EDCTN_STTS_CD01' AND (NOW() <![CDATA[>]]> edctn_strt_dtm AND NOW() <![CDATA[<]]> edctn_end_dtm)
							</if>
							<if test="edctnStatusList == 3"><!--교육완료-->
								edctn_stts_cd = 'EDCTN_STTS_CD01' AND (NOW() <![CDATA[>]]> edctn_end_dtm)
							</if>
							<if test="edctnStatusList == 4"><!--교육취소-->
								(edctn_stts_cd = 'EDCTN_STTS_CD02')
							</if>
						</when>
					</choose>
				</foreach>
				)
			</if>

			<if test='edctnSeq !=null and edctnSeq != "" '>
			AND 	edctn_seq = #{edctnSeq}
			</if>

			<!--차수변경일때만 사용-->
			<if test='changeListYn == "Y" '>
				and edctn_stts_cd = 'EDCTN_STTS_CD01'
				and NOW() <![CDATA[<]]>  edctn_strt_dtm
				and edctn_seq =#{edctnSeq}
				and episd_seq != #{episdSeq}
			</if>

			<!--노출여부-->
			<if test="expsYnList != null and expsYnList.size() > 0">
				AND (
				<foreach collection="expsYnList" item="expsYn" index="index" open="" close="" separator=" OR ">
					EXPS_YN = #{expsYn}
				</foreach>
				)
			</if>

			<if test="q != null and q != ''.toString() ">
				<choose>
					<when test="f == 1"><!-- 과정명 -->
						and nm like concat('%', #{q}, '%')
					</when>
					<when test="f == 2"><!--최초수정자-->
						AND (
						INSTR(aa.REG_ID, #{q}) <![CDATA[>]]> 0 OR
						EXISTS(SELECT 'x' FROM CO_ADM_MST WHERE ID = aa.REG_ID AND INSTR(NAME, #{q}) <![CDATA[>]]> 0)
						)
					</when>
					<when test="f == 3"><!--최종수정자-->
						AND (
						INSTR(aa.MOD_ID, #{q}) <![CDATA[>]]> 0 OR
						EXISTS(SELECT 'x' FROM CO_ADM_MST WHERE ID = aa.MOD_ID AND INSTR(#{q}, NAME) <![CDATA[>]]> 0)
						)
					</when>
					<otherwise><!--전체수정자-->
						AND (
						INSTR(nm, #{q}) <![CDATA[>]]> 0 OR
						INSTR(REG_ID, #{q}) <![CDATA[>]]> 0 OR
						EXISTS(SELECT 'x' FROM CO_ADM_MST WHERE ID = aa.REG_ID AND INSTR(NAME, #{q}) <![CDATA[>]]> 0) OR
						INSTR(MOD_ID, #{q}) <![CDATA[>]]> 0 OR
						EXISTS(SELECT 'x' FROM CO_ADM_MST WHERE ID = aa.MOD_ID AND INSTR(NAME, #{q}) <![CDATA[>]]> 0)
						)
					</otherwise>
				</choose>
			</if>
		</where>
	</sql>

	<!--
		쿼리명 : selectLecturerEpisdListSql
		설  명 : 강사 관리 상세에서 교육 사업 현황 조회 조인 Sql
	      수정일      수정자       수정내용
        ==========   ========   ==============
        2023.11.23    구은희       최초생성
    -->
	<sql id="selectLecturerEpisdListSql">
		<if test="isttrSeq != null and isttrSeq != ''">
			INNER JOIN
			(
			SELECT
			edctn_seq
			, episd_year
			, episd_ord
			, isttr_seq
			FROM ed_edctn_isttr_rel
			) d
			ON 1 = 1
			AND a.edctn_seq = d.edctn_seq
			AND a.episd_year = d.episd_year
			AND a.episd_ord = d.episd_ord
			AND d.isttr_seq = #{isttrSeq}
		</if>
	</sql>

	<!--
      쿼리명 : EBBEpisdMapper.selectLctrDtlList
      설  명 : 교육강의상세목록를 출력한다
       수정일     수정자       수정내용
     ==========   ======    ==============
     2023.11.02   김학규       최초생성
 	-->
	<select id="selectLctrDtlList" parameterType="EBBLctrDTO" resultType="EBBLctrDTO">
		select /* EBBEpisdMapper.selectLctrDtlList */
			a.edctn_seq
			, a.episd_ord
			, a.lctr_seq
			, a.episd_year
			, nm
			, url
			, time
			, thnl_file_seq
			, (SELECT web_path FROM co_file_dtl WHERE file_seq = a.thnl_file_seq order by file_ord desc limit 1) AS web_path
			, reg_id
			, reg_ip
			, a.reg_dtm
			, mod_id
			, mod_ip
			, mod_dtm
			<if test='mypageYn == "Y".toString() '>
			, b.reg_dtm AS lctr_dtm
			</if>
		from ed_edctn_lctr_dtl a
		<if test='mypageYn == "Y".toString() '>
			LEFT JOIN (select
				ptcpt_seq
				, lctr_seq
				, edctn_seq
				, episd_ord
				, episd_year
				, reg_dtm
			from ep_edctn_lctr_dtl) b ON b.ptcpt_seq = #{ptcptSeq}
			AND b.lctr_seq = a.lctr_seq
			AND b.edctn_seq = a.edctn_seq
			AND b.episd_ord = a.episd_ord
			AND b.episd_year = a.episd_year
		 </if>

		where 1=1
		and a.edctn_seq = #{edctnSeq}
		and a.episd_ord = #{episdOrd}
		and a.episd_year = #{episdYear}

		order by lctr_seq asc

		<if test="siteGubun == 'front'.toString() ">
			limit #{firstIndex}, #{recordCountPerPage}
		</if>
	</select>

	<!--
      쿼리명 : EBBEpisdMapper.selectLctrDtlList
      설  명 : 교육강의상세목록 갯수 호출
       수정일     수정자       수정내용
     ==========   ======    ==============
     2023.11.02   김학규       최초생성
 	-->
	<select id="selectLctrDtlListCnt" parameterType="EBBLctrDTO" resultType="java.lang.Integer">
		select /* EBBEpisdMapper.selectLctrDtlListCnt */
			count(*)
		from ed_edctn_lctr_dtl where 1=1
		and edctn_seq = #{edctnSeq}
		and episd_ord = #{episdOrd}
		and episd_year = #{episdYear}
	</select>


	<!--
      쿼리명 : EBBEpisdMapper.selectEpisdDtl
      설  명 : 교육차수 상세를 조회한다.
       수정일     수정자       수정내용
     ==========   ======    ==============
     2023.11.02   김학규       최초생성
 	-->
	<select id="selectEpisdDtl" parameterType="EBBEpisdDTO" resultType="EBBEpisdDTO">
		SELECT /*EBBEpisdMapper.selectEpisdDtl*/
			edctn_seq
			 , episd_year
			 , episd_ord
			 , episd_seq
			 , parnt_seq
			 , (select cd_nm from co_code_mst WHERE cd_seq = aa.parnt_seq) AS prnt_cd_nm
		     , jdgmt_yn
		     , gpc_yn
			 , ctgry_cd
			 , ctgry_cd_nm
		     , cbsn_cd
			 , (select cd_nm from co_code_mst WHERE cd = aa.cbsn_cd) AS cbsn_cd_nm
			 , nm
		     , smmry_nm
			 , stduy_mthd_cd
			 , stduy_mthd_cd_nm
			 , stduy_dd_cd
			 , stduy_dd_cd_nm
			 , stduy_time_cd
			 , stduy_time_cd_nm
			 , episd_year
			 , episd_ord
			 , accs_strt_dtm
			 , accs_end_dtm
			 , case
				   when NOW() <![CDATA[<]]> accs_strt_dtm then '접수대기'
				   when NOW() <![CDATA[>]]> accs_strt_dtm AND NOW() <![CDATA[<]]>  accs_end_dtm then '접수중'
				   when NOW() <![CDATA[>]]> accs_end_dtm OR (fxnum_impsb_yn = 'N' AND accs_cnt <![CDATA[>=]]> fxnum_cnt) then '마감'
			END  AS accs_status_nm
			 , edctn_strt_dtm
			 , edctn_end_dtm
		     , edctn_stts_cd
			 , edctn_ntctn_file_seq
			 , (SELECT MAX(FILE_ORD) FROM CO_FILE_DTL WHERE USE_YN = 'Y' AND FILE_SEQ = aa.edctn_ntctn_file_seq) AS file_ord
			 , case
				   when NOW() <![CDATA[<]]> edctn_strt_dtm then '교육대기'
				   when NOW() <![CDATA[>]]> edctn_strt_dtm AND NOW() <![CDATA[<]]> edctn_end_dtm then '교육중'
				   when NOW() <![CDATA[>]]> edctn_end_dtm then '교육완료'
			END  AS edctn_status_nm
			 , (SELECT NAME FROM cp_isttr_mst WHERE isttr_seq = aa.min_isttr_seq) AS isttr_name
			 , (SELECT GROUP_CONCAT(name SEPARATOR ', ') from cp_isttr_mst WHERE isttr_seq in (SELECT isttr_seq FROM ed_edctn_isttr_rel WHERE edctn_seq = aa.edctn_seq AND episd_ord = aa.episd_ord AND episd_year = aa.episd_year )) AS isttr_group_name
			 , (SELECT ffltn_nm FROM cp_isttr_mst WHERE isttr_seq = aa.min_isttr_seq) AS ffltn_nm
			 , case when isttr_cnt <![CDATA[<=]]>1 then ''
					when isttr_cnt <![CDATA[>]]>  1 then isttr_cnt-1
			END isttr_out_cnt
			 , fxnum_cnt
		     , fxnum_impsb_yn
			 , accs_cnt
			 , rcrmt_mthd_cd
			 , rcrmt_mthd_cd_nm
			 , pic_nm
			 , pic_email
			 , pic_tel_no
			 , place_seq
			 , srv_seq
		     , srv_strt_dtm
		     , srv_end_dtm
		     , srv_nm
		     , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = AA.type_cd) AS TYPE_NM
		     , srv_mem_cnt
		     , edctn_mem_cnt
			 , exam_seq
		     , exam_nm
			 , exam_strt_dtm
			 , exam_end_dtm
		     , otsd_exam_ptcpt_yn
		     , cprtn_instt_seq
		     , cprtn_instt_nm
			 , place_nm
			 , bsc_addr
			 , dtl_addr
			 , zipcode
			 , rprsnt_tel_no
			 , reg_id
			 , reg_name
			 , reg_dtm
			 , mod_id
			 , mod_name
		     , mod_dtm
		     , bdget_expns_yn
		     , cmptn_auto_yn
		     , expns_cprtn_instt_nm
		     , expns_cprtn_instt_seq
		     , expns_pmt
			 , exps_yn
			 , edctn_cmpltn_yn
		     , episd_gpc_yn
			<if test=' mypageYn == "Y".toString() '>
				, stts_cd
				, gpc_id
				, CASE STTS_CD
						WHEN 'EDU_STTS_CD01' THEN '선발'
						WHEN 'EDU_STTS_CD02' THEN '신청취소'
						WHEN 'EDU_STTS_CD03' THEN '신청양도'
						WHEN 'EDU_STTS_CD04' THEN '선발대기'
						WHEN 'EDU_STTS_CD05' THEN '미선발'
						WHEN 'EDU_STTS_CD06' THEN '교육취소'
					ELSE '알 수 없음'
				END AS stts_cd_nm
				, cmptn_yn
				, cmptn_dtm
		     	, crtfct_no
				, ptcpt_seq
				, mem_seq
				, case when edctn_stts_cd = 'EDCTN_STTS_CD01' then /*개강일 경우*/
				case when stts_cd = 'EDU_STTS_CD01' then /*참여자 상태 : 신청*/
				case when NOW()  <![CDATA[<]]> edctn_strt_dtm then '교육대기'
				when edctn_strt_dtm <![CDATA[<]]> NOW() AND NOW() <![CDATA[<]]>  edctn_end_dtm  then '교육중'
				when edctn_end_dtm <![CDATA[<]]> NOW()  then '교육완료'
				end
				when stts_cd = 'EDU_STTS_CD02' then '신청취소'
				when stts_cd = 'EDU_STTS_CD06' then '교육취소'
				end

				when edctn_stts_cd = 'EDCTN_STTS_CD02' then '교육취소'  /*폐강일 경우*/
				end edu_stat
				, ptcpt_dtm
				, web_path
				, bfre_mem_seq
				, trnsf_yn
				, exam_score
				, case when srv_cnt = 0 then 'N' ELSE 'Y' END srv_yn
				, srv_dtm
				, exam_ptcpt_seq
		     	, case when otsd_exam_ptcpt_yn = 'Y' then ofln_exam_dtm else exam_ptcpt_dtm end as exam_ptcpt_dtm /* 오프라인평가인경우 별도의 컬럼값으로 출력 */
			</if>
		FROM (SELECT
				  b.edctn_seq
		           , a.episd_seq
		           , b.gpc_yn
				   , b.ctgry_cd
		           , a.cbsn_cd
				   , (select cd_nm from co_code_mst WHERE cd = b.ctgry_cd) as ctgry_cd_nm
				   , (select parnt_seq from co_code_mst WHERE cd = b.ctgry_cd) as parnt_seq
		           , b.jdgmt_yn
				   , b.nm
				   , b.smmry_nm
				   , b.stduy_mthd_cd
				   , (select cd_nm from co_code_mst where cd=b.stduy_mthd_cd) as stduy_mthd_cd_nm
				   , b.stduy_dd_cd
				   , (select cd_nm from co_code_mst where cd=b.stduy_dd_cd) as stduy_dd_cd_nm
				   , b.stduy_time_cd
				   , (select cd_nm from co_code_mst where cd=b.stduy_time_cd) as stduy_time_cd_nm
				   , a.episd_year
				   , a.episd_ord
				   , a.accs_strt_dtm
				   , a.accs_end_dtm
				   , a.edctn_strt_dtm
				   , a.edctn_end_dtm
		           , a.edctn_stts_cd
		           , a.edctn_ntctn_file_seq
				   , (SELECT min(isttr_seq) FROM ed_edctn_isttr_rel c WHERE a.edctn_seq = c.edctn_seq AND a.episd_year = c.episd_year AND a.episd_ord = c.episd_ord) AS min_isttr_seq
				   , (SELECT COUNT(isttr_seq) FROM ed_edctn_isttr_rel c WHERE a.edctn_seq = c.edctn_seq AND a.episd_year = c.episd_year AND a.episd_ord = c.episd_ord) AS isttr_cnt
				   , a.fxnum_cnt
				   , a.fxnum_impsb_yn
				   , (SELECT count(mem_seq) FROM ep_edctn_ptcpt_mst WHERE edctn_seq = a.edctn_seq AND episd_year = a.episd_year AND episd_ord = a.episd_ord) AS accs_cnt
				   , a.rcrmt_mthd_cd
				   , (select cd_nm from co_code_mst where cd=a.rcrmt_mthd_cd) as rcrmt_mthd_cd_nm
				   , a.pic_nm
				   , a.pic_email
				   , a.pic_tel_no
				   , a.place_seq
					, c.nm as place_nm
					, c.bsc_addr
					, c.dtl_addr
					, c.zipcode
					, c.rprsnt_tel_no
				   , a.srv_seq
		           , (select type_cd from sv_mst where srv_seq = a.srv_seq) as type_cd
				   , a.srv_strt_dtm
				   , a.srv_end_dtm
		           , (select titl from sv_mst where srv_seq = a.srv_seq) as srv_nm
				   , (select COUNT(mem_seq) from sv_rspn_mst WHERE srv_seq = a.srv_seq and rfnc_seq = a.episd_seq) AS srv_mem_cnt /*설문 참여자수*/
				   , (SELECT COUNT(mem_seq) FROM ep_edctn_ptcpt_mst WHERE edctn_seq = a.edctn_seq AND episd_year = a.episd_year AND episd_ord = a.episd_ord AND stts_cd = 'EDU_STTS_CD01') AS edctn_mem_cnt
				   , a.exam_seq
		           , a.exam_strt_dtm
		           , a.exam_end_dtm
		           , a.otsd_exam_ptcpt_yn
				   , (SELECT titl FROM ex_exam_mst WHERE exam_seq = A.exam_seq) as exam_nm
		           , cprtn_instt_seq
				   , (SELECT NM FROM ed_edctn_place_mst WHERE PLACE_SEQ = A.cprtn_instt_seq) as cprtn_instt_nm
				   , a.reg_id
				   , (select name from co_adm_mst where id = a.reg_id) as reg_name
				   , a.reg_dtm
				   , a.mod_id
				   , (select name from co_adm_mst where id = a.mod_id) as mod_name
				   , a.mod_dtm
		           , a.bdget_expns_yn
		           , a.cmptn_auto_yn
				   , a.expns_cprtn_instt_seq
				   , (SELECT NM FROM ed_edctn_place_mst WHERE PLACE_SEQ = A.expns_cprtn_instt_seq) as expns_cprtn_instt_nm
		           , a.expns_pmt
				   , a.exps_yn
				   , a.edctn_cmpltn_yn
		           , a.episd_gpc_yn
					<if test=' mypageYn == "Y".toString() '>
		           		, ptcpt_seq
						, stts_cd
						, gpc_id
						, (select cd_nm from co_code_mst where cd=d.stts_cd) as stts_cd_nm
						, cmptn_yn
						, cmptn_dtm
						, crtfct_no
						, mem_seq
						, ptcpt_dtm
						, (SELECT web_path FROM co_file_dtl WHERE file_seq = b.thnl_file_seq order by file_ord desc limit 1) AS web_path
		      			, bfre_mem_seq
						, CASE WHEN MEM_SEQ != #{memSeq} THEN 'Y' ELSE 'N' END AS trnsf_yn
		      			, exam_score
		      		    , (SELECT COUNT(srv_rspn_seq) AS cnt FROM sv_rspn_mst WHERE rfnc_cd = 'EDU' AND mem_seq = ${memSeq} AND rfnc_seq = a.episd_seq) as srv_cnt
						, (SELECT reg_dtm FROM sv_rspn_mst WHERE rfnc_cd = 'EDU' AND mem_seq = ${memSeq} AND rfnc_seq = a.episd_seq) as srv_dtm
		      			, (SELECT EXAM_PTCPT_SEQ FROM ep_edctn_exam_ptcpt_mst WHERE PTCPT_SEQ = d.ptcpt_seq AND MEM_SEQ = ${memSeq}) as exam_ptcpt_seq
						, (SELECT reg_dtm FROM ep_edctn_exam_ptcpt_mst WHERE PTCPT_SEQ = d.ptcpt_seq AND MEM_SEQ = ${memSeq}) as exam_ptcpt_dtm
						, ofln_exam_dtm
					</if>
			  FROM ed_edctn_episd_mst a
			  LEFT JOIN ed_edctn_prcs_mst b ON a.edctn_seq = b.edctn_seq
			  LEFT JOIN (SELECT place_seq, nm, bsc_addr, dtl_addr, zipcode, rprsnt_tel_no FROM ed_edctn_place_mst ) c ON a.place_seq = c.place_seq
				<if test=' mypageYn == "Y".toString() '>
					LEFT JOIN (SELECT
					episd_seq
					, mem_seq
					, ptcpt_seq
					, ifnull((SELECT max(bfre_mem_seq)  FROM ep_edctn_trnsf_dtl WHERE PTCPT_SEQ= tbl.PTCPT_SEQ ORDER BY TRNSF_SEQ DESC ),0) AS bfre_mem_seq
					, gpc_id
					, stts_cd
					, cmptn_yn
					, cmptn_dtm
			      	, ofln_exam_dtm
			      	, crtfct_no
					, exam_score
					, reg_dtm as ptcpt_dtm
					FROM ep_edctn_ptcpt_mst tbl) d ON d.episd_seq = a.episd_seq
				</if>
			  ) AA

		where
			edctn_seq = #{detailsKey}
			and episd_year = #{episdYear}
		    and episd_ord = #{episdOrd}

			<if test="siteGubun == 'front'.toString() ">
				<choose>
					<when test="expsYn != 'N'.toString()">
						and exps_yn = 'Y'
					</when>
					<otherwise>

					</otherwise>
				</choose>
			</if>

			<if test='mypageYn == "Y".toString() '>
				AND (MEM_SEQ = #{memSeq} OR bfre_mem_seq = #{memSeq})

				AND ptcpt_seq = #{ptcptSeq}
			</if>

	</select>

	<!--
      쿼리명 : EBBEpisdMapper.selectEpisdChk
      설  명 : 교육과정 상세를 조회한다.
       수정일     수정자       수정내용
     ==========   ======    ==============
     2023.11.02   김학규       최초생성
 	-->
	<select id="selectEpisdChk" parameterType="EBBEpisdDTO" resultType="EBBEpisdDTO">
		select * /* EBBEpisdMapper.selectEpisdChk */
		from ed_edctn_episd_mst
		where
		edctn_seq = #{edctnSeq}
		and episd_year = #{episdYear}
		and episd_ord = #{episdOrd}
		<if test="siteGubun == 'front'.toString() ">
			and exps_yn = 'Y'
		</if>
	</select>

	<!--
      쿼리명 : EBBEpisdMapper.updatePtcptStatus
      설  명 : 교육차수 참여자 교육취소처리 - 전체
       수정일     수정자       수정내용
     ==========   ======    ==============
     2023.12.11   김학규       최초생성
 	-->
	<update id="updatePtcptStatus" parameterType="EBBEpisdDTO" >

		UPDATE ep_edctn_ptcpt_mst SET /* EBBEpisdMapper.updatePtcptStatus */
			stts_cd = 'EDU_STTS_CD06'
			, mod_id = #{modId}
			, mod_ip = #{modIp}
			, mod_dtm = now()
		WHERE 1=1
		  and edctn_seq = #{edctnSeq}
		  and episd_year = #{episdYear}
		  and episd_ord = #{episdOrd}
	</update>
	<!--
	쿼리명 : EBBEpisdMapper.updatePtcptStatus
	설  명 : 교육차수 참여자 차수변경을 통한 교육취소처리 - 개인
	수정일     수정자       수정내용
	==========   ======    ==============
	2023.12.11   김학규       최초생성
	-->
	<update id="updatePtcptStatusInfo" parameterType="EBBPtcptDTO" >

		UPDATE ep_edctn_ptcpt_mst SET /* EBBEpisdMapper.updatePtcptStatus */
			stts_cd = 'EDU_STTS_CD06'
			, mod_id = #{modId}
			, mod_ip = #{modIp}
			, mod_dtm = now()
		WHERE 1=1
			and edctn_seq = #{edctnSeq}
			and episd_year = #{episdYear}
			and episd_ord = #{episdOrd}
			and ptcpt_seq = #{ptcptSeq}
	</update>

	<!--
      쿼리명 : EBBEpisdMapper.updateEpisdStatus
      설  명 : 교육차수 차수 종강(폐강처리)
       수정일     수정자       수정내용
     ==========   ======    ==============
     2023.12.11   김학규       최초생성
 	-->
	<update id="updateEpisdStatus" parameterType="EBBEpisdDTO" >

		UPDATE ed_edctn_episd_mst SET /* EBBEpisdMapper.updateEpisdStatus */
			edctn_stts_cd = 'EDCTN_STTS_CD02'
			, bdget_expns_yn = 'C'
			, mod_id = #{modId}
			, mod_ip = #{modIp}
			, mod_dtm = now()
			WHERE 1=1
				and edctn_seq = #{edctnSeq}
				and episd_year = #{episdYear}
				and episd_ord = #{episdOrd}
	</update>

	<!--
         쿼리명 : EBBEpisdMapper.insertEpisd
         설  명 : 교육차수를 등록한다.
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.11.02   김학규       최초생성
    -->
	<insert id="insertEpisd" parameterType="EBBEpisdDTO">
		insert into /*EBBEpisdMapper.insertEpisd*/ ed_edctn_episd_mst (
			edctn_seq
			, episd_year
			, episd_ord
			, episd_seq
			, cbsn_cd
			, accs_strt_dtm
			, accs_end_dtm
			, edctn_strt_dtm
			, edctn_end_dtm
			, fxnum_cnt
			, fxnum_impsb_yn
			, rcrmt_mthd_cd
			, pic_nm
			, pic_email
			, pic_tel_no
			, edctn_ntctn_file_seq
			, place_seq
			, srv_seq
			, srv_strt_dtm
			, srv_end_dtm
			, exam_seq
		  	, exam_strt_dtm
		  	, exam_end_dtm
			, otsd_exam_ptcpt_yn
			, cprtn_instt_seq
			, cmptn_auto_yn
			, edctn_stts_cd
			, expns_cprtn_instt_seq
			, expns_pmt
			, bdget_expns_yn
			, exps_yn
			, edctn_cmpltn_yn
			, reg_id
			, reg_ip
			, reg_dtm
			, mod_id
			, mod_ip
			, mod_dtm
			, episd_gpc_yn
			) VALUES(
				#{edctnSeq}
				, #{episdYear}
				, #{episdOrd}
				, #{episdSeq}
				, #{cbsnCd}
				, #{accsStrtDtm}
				, #{accsEndDtm}
				, #{edctnStrtDtm}
				, #{edctnEndDtm}
				, #{fxnumCnt}
				, #{fxnumImpsbYn}
				, #{rcrmtMthdCd}
				, #{picNm}
				, #{picEmail}
				, #{picTelNo}
				, #{edctnNtctnFileSeq}
				, #{placeSeq}
				, #{srvSeq}
				, #{srvStrtDtm}
				, #{srvEndDtm}
				, #{examSeq}
				, if(#{examStrtDtm}='', null , #{examStrtDtm})
				, if(#{examEndDtm}='', null , #{examEndDtm})
				, #{otsdExamPtcptYn}
				, #{cprtnInsttSeq}
				, #{cmptnAutoYn}
				, #{edctnSttsCd}
				, #{expnsCprtnInsttSeq}
				, #{expnsPmt}
				, #{bdgetExpnsYn}
				, #{expsYn}
				, #{edctnCmpltnYn}
				, #{regId}
				, #{regIp}
				, now()
				, #{modId}
				, #{modIp}
				, now()
				, #{episdGpcYn}
			)
	</insert>

	<!--
         쿼리명 : EBBEpisdMapper.insertEpisd
         설  명 : 교육 차수별 만족도 결과 상세
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.12.19   김학규       최초생성
    -->
	<insert id="insertEpisdSrvRsltDtl" parameterType="EBBEpisdDTO">
		insert into /*EBBEpisdMapper.insertEpisdSrvRsltDtl*/ ed_edctn_srv_rslt_dtl (
			rslt_seq
			, edctn_seq
			, episd_year
			, episd_ord
			, episd_seq
			, vrll_avrg
			, ttl_co_score
			, edctn_envrnmt_score
			, edctn_spprt_score
			, edctn_cntn_score
			, isttr_score
			, ttl_ptcpt_cnt
		  	, reg_id
		  	, reg_ip
		  	, reg_dtm
		  	, mod_id
		  	, mod_ip
		  	, mod_dtm
		) VALUES(
				#{rsltSeq}
				, #{edctnSeq}
				, #{episdYear}
				, #{episdOrd}
				, #{episdSeq}
				, 0
				, 0
				, 0
				, 0
				, 0
				, 0
				, 0
				, #{regId}
				, #{regIp}
				, now()
				, #{modId}
				, #{modIp}
				, now()
				)
	</insert>


	<!--
          쿼리명 : EBBEpisdMapper.selectIsttrList
          설  명 : 교육차수관리 - 삭제 전 참여자 체크, 참여자 상태와 무관하게 있는지만 체크
           수정일     수정자       수정내용
         ==========   ======    ==============
         2023.12.14   김학규       최초생성
         -->
	<select id="selectEpisdDeletePrevChk" parameterType="EBBEpisdDTO" resultType="java.lang.Integer">
		SELECT /*EBBEpisdMapper.selectEpisdDeletePrevChk*/
			SUM((select COUNT(ptcpt_seq) from ep_edctn_ptcpt_mst WHERE episd_seq = a.episd_seq)) as ptcpt_cnt
		from ed_edctn_episd_mst a
		where episd_seq IN
		<foreach collection="episdSeqList" item="episdSeqList" index="index" separator=", " open="(" close=")">
			#{episdSeqList}
		</foreach>
	</select>





	<!--
      쿼리명 : EBBEpisdMapper.selectIsttrList
      설  명 : 교육차수관리 - 강사관계를 호출한다.
       수정일     수정자       수정내용
     ==========   ======    ==============
     2023.11.24   김학규       최초생성
 	-->
	<select id="selectIsttrList" parameterType="EBBEpisdDTO" resultType="EBBIsttrDTO">
		select /*EBBEpisdMapper.selectIsttrList*/
			a.edctn_seq
			 , a.episd_ord
			 , a.isttr_seq
			 , a.episd_year
		     , b.name
			 , b.ffltn_nm
			 , b.pstn_nm
			 , b.dept_nm
		     , b.spcl_cntn
			 , a.reg_id
			 , a.reg_ip
			 , a.reg_dtm
			 , a.mod_id
			 , a.mod_ip
			 , a.mod_dtm
		from ed_edctn_isttr_rel a, cp_isttr_mst b
		where 1=1
		and a.isttr_seq = b.isttr_seq
		and edctn_seq = #{edctnSeq}
		and episd_year = #{episdYear}
		and episd_ord = #{episdOrd}
	</select>


	<!--
         쿼리명 : EBBEpisdMapper.deleteIsttrRel
         설  명 : 교육차수 - 교육강세 관계를 삭제한다.
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.11.23   김학규       최초생성
    -->
	<delete id="deleteIsttrRel" parameterType="EBBEpisdDTO">
		delete from ed_edctn_isttr_rel where 1=1 /* EBBEpisdMapper.deleteIsttrRel */
										and edctn_seq = #{edctnSeq}
										and episd_ord = #{episdOrd}
										and episd_year = #{episdYear}
	</delete>

	<!--
             쿼리명 : EBBEpisdMapper.insertIsttrRel
             설  명 : 교육차수 - 교육강사관계를 등록한다
              수정일     수정자       수정내용
            ==========   ======    ==============
            2023.11.02   김학규       최초생성
        -->
	<insert id="insertIsttrRel" parameterType="EBBEpisdDTO">
		insert into /*EBBEpisdMapper.insertEpisd*/ ed_edctn_isttr_rel (
			edctn_seq
			, episd_ord
			, isttr_seq
			, episd_year
			, episd_seq
			, reg_id
			, reg_ip
			, reg_dtm
			, mod_id
			, mod_ip
			, mod_dtm
		) VALUES
		<foreach collection="isttrSeqList" item="isttrSeqList" index="index" separator=" , " open="" close=";">
		      (
			#{isttrSeqList.edctnSeq}
			, #{isttrSeqList.episdOrd}
			, #{isttrSeqList.isttrSeq}
			, #{isttrSeqList.episdYear}
			, #{episdSeq}
			, #{regId}
			, #{regIp}
			, now()
			, #{modId}
			, #{modIp}
			, now()
		)
		</foreach>
	</insert>

	<!--
             쿼리명 : EBBEpisdMapper.insertLctrDtl
             설  명 : 교육차수 - 교육강의 상세를 등록한다
              수정일     수정자       수정내용
            ==========   ======    ==============
            2023.11.02   김학규       최초생성
        -->
	<insert id="insertLctrDtl" parameterType="EBBLctrDTO">
		insert into /*EBBEpisdMapper.insertLctrDtl*/ ed_edctn_lctr_dtl (
			edctn_seq
			, episd_ord
			, lctr_seq
			, episd_year
			, nm
			, url
			, time
			, thnl_file_seq
			, reg_id
			, reg_ip
			, reg_dtm
			, mod_id
			, mod_ip
			, mod_dtm
		) VALUES(
			#{edctnSeq}
			, #{episdOrd}
			, #{lctrSeq}
			, #{episdYear}
			, #{nm}
			, #{url}
			, #{time}
			, #{thnlFileSeq}
			, #{regId}
			, #{regIp}
			, now()
			, #{modId}
			, #{modIp}
			, now()
		)
	</insert>

	<!--
         쿼리명 : EBBEpisdMapper.deleteLctrDtl
         설  명 : 교육차수 - 교육강의 상세를 삭제한다
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.11.23   김학규       최초생성
    -->
	<delete id="deleteLctrDtl" parameterType="EBBEpisdDTO">
		delete from ed_edctn_lctr_dtl where 1=1
		and edctn_seq = #{edctnSeq}
		and episd_ord = #{episdOrd}
		and episd_year = #{episdYear}
	</delete>

	<!--
         쿼리명 : EBBEpisdMapper.updateEpisd
         설  명 : 교육차수를 수정한다.
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.11.02   김학규       최초생성
    -->
	<update id="updateEpisd" parameterType="EBBEpisdDTO" >

		UPDATE ed_edctn_episd_mst SET /* EBBEpisdMapper.updateEpisd */
			episd_year = #{episdYear}
			, episd_ord = #{episdOrd}
			, cbsn_cd = #{cbsnCd}
			, accs_strt_dtm = #{accsStrtDtm}
			, accs_end_dtm = #{accsEndDtm}
			, edctn_strt_dtm = #{edctnStrtDtm}
			, edctn_end_dtm = #{edctnEndDtm}
			, fxnum_cnt = #{fxnumCnt}
			, fxnum_impsb_yn = #{fxnumImpsbYn}
			, rcrmt_mthd_cd = #{rcrmtMthdCd}
			, pic_nm = #{picNm}
			, pic_email = #{picEmail}
			, pic_tel_no = #{picTelNo}
			, cprtn_instt_seq = #{cprtnInsttSeq}
			, edctn_ntctn_file_seq = #{edctnNtctnFileSeq}
			, place_seq = #{placeSeq}
			, srv_seq = #{srvSeq}
			, exam_seq = #{examSeq}
			, srv_strt_dtm = #{srvStrtDtm}
			, srv_end_dtm = #{srvEndDtm}
			, exam_strt_dtm = if(#{examStrtDtm}='', null , #{examStrtDtm})
			, exam_end_dtm = if(#{examEndDtm}='', null , #{examEndDtm})
			, cmptn_auto_yn = #{cmptnAutoYn}
			, otsd_exam_ptcpt_yn = #{otsdExamPtcptYn}
			, bdget_expns_yn = #{bdgetExpnsYn}
			, expns_cprtn_instt_seq = #{expnsCprtnInsttSeq}
			, expns_pmt = #{expnsPmt}
			, exps_yn = #{expsYn}
			, edctn_cmpltn_yn = #{edctnCmpltnYn}
			, mod_id = #{modId}
			, mod_ip = #{modIp}
			, mod_dtm = now()
		  	, episd_gpc_yn = #{episdGpcYn}
		where 1=1
			and edctn_seq = #{edctnSeq}
			and episd_year = #{orgEpisdYear}
			and episd_ord = #{orgEpisdOrd}
	</update>

	<!--
         쿼리명 : EBBEpisdMapper.deleteEpisd
         설  명 : 교육차수 삭제
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.11.15   김학규       최초생성
    -->
	<delete id="deleteEpisdDtl" parameterType="EBBEpisdDTO">
		DELETE /* EBBEpisdMapper.deleteEpisdDtl */
			ed_edctn_episd_mst, ed_edctn_isttr_rel, ed_edctn_lctr_dtl, ed_edctn_bdget_expns_dtl
		FROM ed_edctn_episd_mst
		LEFT JOIN ed_edctn_isttr_rel ON ed_edctn_isttr_rel.edctn_seq = ed_edctn_episd_mst.edctn_seq AND ed_edctn_isttr_rel.episd_ord = ed_edctn_episd_mst.episd_ord AND ed_edctn_isttr_rel.episd_year = ed_edctn_episd_mst.episd_year
		LEFT JOIN ed_edctn_lctr_dtl ON ed_edctn_lctr_dtl.edctn_seq = ed_edctn_episd_mst.edctn_seq AND ed_edctn_lctr_dtl.episd_ord = ed_edctn_episd_mst.episd_ord AND ed_edctn_lctr_dtl.episd_year = ed_edctn_episd_mst.episd_year
		LEFT JOIN ed_edctn_bdget_expns_dtl ON ed_edctn_bdget_expns_dtl.edctn_seq = ed_edctn_episd_mst.edctn_seq AND ed_edctn_bdget_expns_dtl.episd_ord = ed_edctn_episd_mst.episd_ord AND ed_edctn_bdget_expns_dtl.episd_year = ed_edctn_episd_mst.episd_year
		WHERE ed_edctn_episd_mst.episd_seq IN
		<foreach collection="episdSeqList" item="episdSeqList" index="index" separator=", " open="(" close=")">
			#{episdSeqList}
		</foreach>
	</delete>

	<!--
         쿼리명 : EBBEpisdMapper.deleteBdgetList
         설  명 : 교육차수 - 예산/지출내역 삭제
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.11.15   김학규       최초생성
    -->
	<delete id="deleteBdgetList" parameterType="EBBEpisdDTO">
		delete from ed_edctn_bdget_expns_dtl
	   	where 1=1  /* EBBEpisdMapper.deleteBdgetList */
	   		and edctn_seq = #{edctnSeq}
	   		and episd_ord = #{episdOrd}
	   		and episd_year = #{episdYear}
	</delete>

	<!--
             쿼리명 : EBBEpisdMapper.insertIsttrRel
             설  명 : 교육차수 - 교육강사관계를 등록한다
              수정일     수정자       수정내용
            ==========   ======    ==============
            2023.11.02   김학규       최초생성
        -->
	<insert id="insertBdgetList" parameterType="EBBEpisdDTO">
		insert into /*EBBEpisdMapper.insertEpisd*/ ed_edctn_bdget_expns_dtl (
			edctn_seq
			, episd_ord
			, cd
			, episd_year
			, pmt
			, etc_nm
			, reg_id
			, reg_ip
			, reg_dtm
			, mod_id
			, mod_ip
			, mod_dtm
		) VALUES
		<foreach collection="bdgetList" item="bdgetList" index="index" separator=" , " open="" close=";">
			(
			#{bdgetList.edctnSeq}
			, #{bdgetList.episdOrd}
			, #{bdgetList.cd}
			, #{bdgetList.episdYear}
			, #{bdgetList.pmt}
			, #{bdgetList.etcNm}
			, #{regId}
			, #{regIp}
			, now()
			, #{modId}
			, #{modIp}
			, now()
			)
		</foreach>
	</insert>



	<!--
      쿼리명 : EBBEpisdMapper.selectBdgetDtlList
      설  명 : 교육차수관리 - 강사관계를 호출한다.
       수정일     수정자       수정내용
     ==========   ======    ==============
     2023.11.24   김학규       최초생성
 	-->
	<select id="selectBdgetDtlList" parameterType="EBBBdgetDTO" resultType="EBBBdgetDTO">
		select /*EBBEpisdMapper.selectBdgetDtlList */
			edctn_seq
			, episd_ord
			, cd
            , episd_year
            , pmt
		     , etc_nm
            , reg_id
            , reg_ip
            , reg_dtm
            , mod_id
            , mod_ip
            , mod_dtm
		from ed_edctn_bdget_expns_dtl
		where 1=1
		  and edctn_seq = #{edctnSeq}
		  and episd_year = #{episdYear}
		  and episd_ord = #{episdOrd}
	</select>

	<!--
	  쿼리명 : EBBEpisdMapper.selectEpisdSrvScoreDtl
	  설  명 : 교육차수관리 - 만족도 결과 평균 점수 호출
	   수정일     수정자       수정내용
	 ==========   ======    ==============
	 2023.11.28   김학규       최초생성
	 -->
	<select id="selectEpisdSrvScoreDtl" parameterType="EBBEpisdDTO" resultType="EBBSrvRstDTO">
		SELECT
			rslt_seq
			 , edctn_seq
			 , episd_year
			 , episd_ord
			 , episd_seq
			 , vrll_avrg
			 , ttl_co_score
			 , edctn_envrnmt_score
			 , edctn_spprt_score
			 , edctn_cntn_score
			 , isttr_score
			 , ttl_ptcpt_cnt
		FROM ed_edctn_srv_rslt_dtl
		WHERE 1=1
		  AND episd_seq = #{episdSeq}
	</select>

	<!--
      쿼리명 : EBBEpisdMapper.selectEpisdSrvRstDtl
      설  명 : 교육차수관리 - 만족도 결과 통계 호출
       수정일     수정자       수정내용
     ==========   ======    ==============
     2023.11.28   김학규       최초생성
 	-->
	<select id="selectEpisdSrvRstDtl" parameterType="EBBEpisdDTO" resultType="EBBSrvRstDTO">
		SELECT /* EBBEpisdMapper.selectEpisdSrvRstDtl */
			EDCTN_SEQ
			 , EPISD_YEAR
			 , EPISD_ORD
			 , SRV_SEQ
			 ,SUM(CNT1) AS T1
			 ,SUM(CNT2) AS T2
			 ,SUM(CNT3) AS T3
			 ,SUM(CNT4) AS T4
			 ,SUM(CNT5) AS T5
			 ,SUM(CNT6) AS T6
			 ,SUM(CNT7) AS T7
			 ,SUM(CNT8) AS T8
			 ,SUM(CNT9) AS T9

			 ,SUM(CNT01) AS A1
			 ,SUM(CNT02) AS A2
			 ,SUM(CNT03) AS A3
			 ,SUM(CNT04) AS A4
			 ,SUM(CNT05) AS A5
			 ,SUM(CNT06) AS A6
			 ,SUM(CNT07) AS A7
		FROM
			(
				SELECT

					EDCTN_SEQ
					 , EPISD_YEAR
					 , EPISD_ORD
					 , A.SRV_SEQ
					 , CASE WHEN DEPT_CD = 'MEM_CD02002' THEN COUNT(C.DEPT_CD) ELSE 0 END AS CNT1
					 , CASE WHEN DEPT_CD = 'MEM_CD02003' THEN COUNT(C.DEPT_CD) ELSE 0 END AS CNT2
					 , CASE WHEN DEPT_CD = 'MEM_CD02004' THEN COUNT(C.DEPT_CD) ELSE 0 END AS CNT3
					 , CASE WHEN DEPT_CD = 'MEM_CD02005' THEN COUNT(C.DEPT_CD) ELSE 0 END AS CNT4
					 , CASE WHEN DEPT_CD = 'MEM_CD02006' THEN COUNT(C.DEPT_CD) ELSE 0 END AS CNT5
					 , CASE WHEN DEPT_CD = 'MEM_CD02007' THEN COUNT(C.DEPT_CD) ELSE 0 END AS CNT6
					 , CASE WHEN DEPT_CD = 'MEM_CD02008' THEN COUNT(C.DEPT_CD) ELSE 0 END AS CNT7
					 , CASE WHEN DEPT_CD = 'MEM_CD02009' THEN COUNT(C.DEPT_CD) ELSE 0 END AS CNT8
					 , CASE WHEN DEPT_CD = 'MEM_CD02010' THEN COUNT(C.DEPT_CD) ELSE 0 END AS CNT9

					 , CASE WHEN PSTN_CD = 'MEM_CD01001' THEN COUNT(C.PSTN_CD) ELSE 0 END AS CNT01
					 , CASE WHEN PSTN_CD = 'MEM_CD01002' THEN COUNT(C.PSTN_CD) ELSE 0 END AS CNT02
					 , CASE WHEN PSTN_CD = 'MEM_CD01003' THEN COUNT(C.PSTN_CD) ELSE 0 END AS CNT03
					 , CASE WHEN PSTN_CD = 'MEM_CD01004' THEN COUNT(C.PSTN_CD) ELSE 0 END AS CNT04
					 , CASE WHEN PSTN_CD = 'MEM_CD01005' THEN COUNT(C.PSTN_CD) ELSE 0 END AS CNT05
					 , CASE WHEN PSTN_CD = 'MEM_CD01006' THEN COUNT(C.PSTN_CD) ELSE 0 END AS CNT06
					 , CASE WHEN PSTN_CD = 'MEM_CD01007' THEN COUNT(C.PSTN_CD) ELSE 0 END AS CNT07

				FROM ED_EDCTN_EPISD_MST A
						 LEFT JOIN (
					SELECT MEM_SEQ, srv_seq, rfnc_seq, rfnc_cd FROM SV_RSPN_MST
				) B ON A.srv_seq = B.srv_seq AND b.rfnc_seq = A.episd_seq

						 LEFT JOIN
					 (
						 SELECT MEM_SEQ, MEM_CD, DEPT_CD, PSTN_CD FROM co_mem_mst where mem_cd = 'CP'
					 ) C ON B.mem_seq = C.mem_seq
						 LEFT JOIN
					 (
						 SELECT CD
						 FROM CO_CODE_MST
						 WHERE PARNT_SEQ IN
							   (SELECT CD_SEQ
								FROM CO_CODE_MST
								WHERE CD IN ('MEM_CD01', 'MEM_CD02'))
					 ) T2 ON C.DEPT_CD = T2.CD
				WHERE C.MEM_CD = 'CP' AND B.rfnc_cd = 'EDU'
				GROUP BY EDCTN_SEQ, EPISD_YEAR, EPISD_ORD, B.SRV_SEQ, DEPT_CD, PSTN_CD
			) T
		WHERE 1=1
		  and edctn_seq = #{edctnSeq}
		  and episd_year = #{episdYear}
		  and episd_ord = #{episdOrd}

		GROUP BY EDCTN_SEQ, EPISD_YEAR, EPISD_ORD, SRV_SEQ


	</select>


	<!--
      쿼리명 : EBBEpisdMapper.selectEpisdPtcptListCnt
      설  명 : 교육차수관리 - 참여자 목록 카운트
       수정일     수정자       수정내용
     ==========   ======    ==============
     2023.11.28   김학규       최초생성
 	-->
	<select id="selectEpisdPtcptListCnt" parameterType="EBBEpisdDTO" resultType="java.lang.Integer">
		SELECT /* EBBEpisdMapper.selectEpisdPtcptListCnt */
			count(*)
		FROM (
			SELECT /* EBBEpisdMapper.selectEpisdPtcptListCnt */
			a.ptcpt_seq
			, a.mem_seq
			, b.id
			, b.name
			, (select cmpn_nm from cp_cmpn_mst where bsnm_no = a.ptcpt_bsnm_no) as cmpn_nm
			, (select cd_nm from co_code_mst where cd = c.ctgry_cd) as ctgry_nm
			, a.ptcpt_bsnm_no /*사업자등록번호*/
			, b.hp_no
			, b.email
			, b.dept_cd
			, case when b.dept_cd = null or  b.dept_cd = '' then null else (select cd_nm from co_code_mst where  cd=b.dept_cd ) end as dept_cd_nm
			, b.dept_dtl_nm
			, b.pstn_cd
			, case when b.pstn_cd = null or  b.pstn_cd = '' then null else (select cd_nm from co_code_mst where  cd=b.pstn_cd ) end as pstn_cd_nm
			, b.pstn_nm
			, a.stts_cd
			, case when a.stts_cd = null or  a.stts_cd = '' then null else (select cd_nm from co_code_mst where  cd=a.stts_cd ) end as stts_cd_nm
			, a.reg_dtm as edu_dtm
			, b.reg_dtm
			, a.cmptn_yn
			, a.exam_score
			, e.exam_ptcpt_seq
			, otsd_exam_ptcpt_yn
			, case when d.edctn_stts_cd = 'EDCTN_STTS_CD01' then /*개강일 경우*/
			case when a.stts_cd = 'EDU_STTS_CD01' then /*참여자 상태 : 신청*/
			case when NOW()   <![CDATA[<]]>  d.edctn_strt_dtm then '교육대기'
			when d.edctn_strt_dtm  <![CDATA[<]]>  NOW() AND NOW()  <![CDATA[<]]>   d.edctn_end_dtm  then '교육중'
			when d.edctn_end_dtm  <![CDATA[<]]>  NOW()  then '교육완료'
			end
			when a.stts_cd = 'EDU_STTS_CD02' then '신청취소'
			when a.stts_cd = 'EDU_STTS_CD06' then '교육취소'
			end

			when d.edctn_stts_cd = 'EDCTN_STTS_CD02' then '교육취소'  /*폐강일 경우*/
			end edu_stat

			, ifnull(ROUND(((SELECT COUNT(atndc_dtm) FROM ep_edctn_atndc_dtl WHERE ptcpt_seq = a.ptcpt_seq AND atndc_dtm IS NOT NULL) / (select COUNT(edctn_dt) FROM ep_edctn_atndc_dtl WHERE ptcpt_seq = a.ptcpt_seq))*100), '0') as  edu_atndc/*출석률*/
			, (SELECT COUNT(*) from ep_edctn_lctr_dtl WHERE PTCPT_SEQ = A.PTCPT_SEQ AND EDCTN_SEQ = A.EDCTN_SEQ AND EPISD_YEAR = A.EPISD_YEAR AND A.EPISD_ORD) AS PTCPT_INFO
			, (SELECT COUNT(*) from ed_edctn_lctr_dtl WHERE EDCTN_SEQ = A.EDCTN_SEQ AND EPISD_YEAR = A.EPISD_YEAR AND EPISD_ORD = A.EPISD_ORD) AS LCRT_INFO
			, (SELECT stduy_mthd_cd FROM ed_edctn_prcs_mst WHERE EDCTN_SEQ = A.EDCTN_SEQ) AS stduy_mthd_cd
		from ep_edctn_ptcpt_mst a
		left join(select mem_seq, id, name, hp_no, email, dept_cd, dept_dtl_nm, pstn_cd, pstn_nm, reg_dtm from co_mem_mst where 1=1 and mem_cd = 'CP') b on a.mem_seq = b.mem_seq
		left join(select cmpn_nm, ctgry_cd, bsnm_no from cp_cmpn_mst where 1=1) c on c.bsnm_no = a.ptcpt_bsnm_no
		left join(SELECT edctn_seq, episd_year, episd_ord, edctn_strt_dtm, edctn_end_dtm, otsd_exam_ptcpt_yn, edctn_stts_cd FROM ed_edctn_episd_mst) d ON d.edctn_seq = a.edctn_seq AND d.episd_year = a.episd_year AND d.episd_ord = a.episd_ord
		left join(select ptcpt_seq, exam_ptcpt_seq from ep_edctn_exam_ptcpt_mst) e on e.ptcpt_seq = a.ptcpt_seq
		where 1=1
		and a.edctn_seq = #{edctnSeq}
		and a.episd_year = #{episdYear}
		and a.episd_ord = #{episdOrd}

		and a.stts_cd != 'EDU_STTS_CD04'
		and a.stts_cd != 'EDU_STTS_CD05'
		<if test='atndcYn == "Y" '>
		and a.stts_cd != 'EDU_STTS_CD02'
		</if>

		<if test='atndcYn == "N" '>

			UNION ALL

			SELECT
			a.ptcpt_seq
			, c.mem_seq
			, c.id
			, c.name
			, (select cmpn_nm from cp_cmpn_mst where bsnm_no = b.ptcpt_bsnm_no) as cmpn_nm
			, (select cd_nm from co_code_mst where cd = d.ctgry_cd) as ctgry_nm
			, b.ptcpt_bsnm_no /*사업자등록번호*/
			, c.hp_no
			, c.email
			, c.dept_cd
			, (select cd_nm from co_code_mst where  cd = c.dept_cd ) as dept_cd_nm
			, c.dept_dtl_nm
			, c.pstn_cd
			, (select cd_nm from co_code_mst where  cd = c.pstn_cd ) as pstn_cd_nm
			, c.pstn_nm
			, "" as stts_cd
			, "" as stts_cd_nm
			, c.reg_dtm as edu_dtm
			, c.reg_dtm
			, "N" as cmptn_yn
			, 0 as exam_score
			, f.exam_ptcpt_seq
			, otsd_exam_ptcpt_yn
			, '교육양도' as edu_stat
			, 0 as  edu_atndc/*출석률*/
			, 0 AS PTCPT_INFO
			, 0 AS LCRT_INFO
			, (SELECT stduy_mthd_cd FROM ed_edctn_prcs_mst WHERE EDCTN_SEQ = B.EDCTN_SEQ) AS stduy_mthd_cd
			from ep_edctn_trnsf_dtl a
			LEFT JOIN (
			SELECT ptcpt_seq, edctn_seq, episd_year, episd_ord, ptcpt_bsnm_no, reg_dtm from ep_edctn_ptcpt_mst
			)b ON b.ptcpt_seq = a.ptcpt_seq

			LEFT JOIN(select mem_seq, id, name, hp_no, email, dept_cd, dept_dtl_nm, pstn_cd, pstn_nm, reg_dtm from co_mem_mst where 1=1 and mem_cd = 'CP') c on c.mem_seq = a.bfre_mem_seq
			LEFT JOIN(select cmpn_nm, ctgry_cd, bsnm_no from cp_cmpn_mst where 1=1) d on d.bsnm_no = b.ptcpt_bsnm_no
			LEFT JOIN(SELECT edctn_seq, episd_year, episd_ord, edctn_strt_dtm, edctn_end_dtm, otsd_exam_ptcpt_yn, edctn_stts_cd FROM ed_edctn_episd_mst) e ON e.edctn_seq = b.edctn_seq AND e.episd_year = b.episd_year AND e.episd_ord = b.episd_ord
			LEFT JOIN(select ptcpt_seq, exam_ptcpt_seq from ep_edctn_exam_ptcpt_mst) f on f.ptcpt_seq = a.ptcpt_seq
			WHERE 1=1
			AND B.edctn_seq = #{edctnSeq}
			AND B.episd_year = #{episdYear}
			AND B.episd_ord = #{episdOrd}
			/*and a.stts_cd != 'EDU_STTS_CD04'*/
		</if>

		) AA
	</select>

	<!--
      쿼리명 : EBBEpisdMapper.selectEpisdPtcptListTypeBCnt
      설  명 : 교육차수관리 - 참여자 목록 카운트 (신청 취소만)
       수정일     수정자       수정내용
     ==========   ======    ==============
     2023.11.28   김학규       최초생성
 	-->
	<select id="selectEpisdPtcptListTypeACnt" parameterType="EBBEpisdDTO" resultType="java.lang.Integer">
		SELECT /* EBBEpisdMapper.selectEpisdPtcptListTypeACnt */
			count(*)
		FROM (
				 SELECT
					 a.ptcpt_seq
					  , a.mem_seq
					  , b.id
					  , b.name
					  , (select cmpn_nm from cp_cmpn_mst where bsnm_no = a.ptcpt_bsnm_no) as cmpn_nm
					  , (select cd_nm from co_code_mst where cd = c.ctgry_cd) as ctgry_nm
					  , a.ptcpt_bsnm_no /*사업자등록번호*/
					  , b.hp_no
					  , b.email
					  , b.dept_cd
					  , case when b.dept_cd = null or  b.dept_cd = '' then null else (select cd_nm from co_code_mst where  cd=b.dept_cd ) end as dept_cd_nm
					  , b.dept_dtl_nm
					  , b.pstn_cd
					  , case when b.pstn_cd = null or  b.pstn_cd = '' then null else (select cd_nm from co_code_mst where  cd=b.pstn_cd ) end as pstn_cd_nm
					  , b.pstn_nm
					  , a.stts_cd
					  , case when a.stts_cd = null or  a.stts_cd = '' then null else (select cd_nm from co_code_mst where  cd=a.stts_cd ) end as stts_cd_nm
					  , a.reg_dtm as edu_dtm
					  , b.reg_dtm
					  , a.cmptn_yn
					  , a.exam_score
					  , e.exam_ptcpt_seq
					  , otsd_exam_ptcpt_yn
					  , case when d.edctn_stts_cd = 'EDCTN_STTS_CD01' then /*개강일 경우*/
								 case when a.stts_cd = 'EDU_STTS_CD01' then /*참여자 상태 : 신청*/
										  case when NOW()   <![CDATA[<]]>  d.edctn_strt_dtm then '교육대기'
											   when d.edctn_strt_dtm  <![CDATA[<]]>  NOW() AND NOW()  <![CDATA[<]]>   d.edctn_end_dtm  then '교육중'
											   when d.edctn_end_dtm  <![CDATA[<]]>  NOW()  then '교육완료'
											  end
									  when a.stts_cd = 'EDU_STTS_CD02' then '신청취소'
									  when a.stts_cd = 'EDU_STTS_CD06' then '교육취소'
									 end

							 when d.edctn_stts_cd = 'EDCTN_STTS_CD02' then '교육취소'  /*폐강일 경우*/
					 end edu_stat

					  , ifnull(ROUND(((SELECT COUNT(atndc_dtm) FROM ep_edctn_atndc_dtl WHERE ptcpt_seq = a.ptcpt_seq AND atndc_dtm IS NOT NULL) / (select COUNT(edctn_dt) FROM ep_edctn_atndc_dtl WHERE ptcpt_seq = a.ptcpt_seq))*100), '0') as  edu_atndc/*출석률*/
					  , (SELECT COUNT(*) from ep_edctn_lctr_dtl WHERE PTCPT_SEQ = A.PTCPT_SEQ AND EDCTN_SEQ = A.EDCTN_SEQ AND EPISD_YEAR = A.EPISD_YEAR AND A.EPISD_ORD) AS PTCPT_INFO
					  , (SELECT COUNT(*) from ed_edctn_lctr_dtl WHERE EDCTN_SEQ = A.EDCTN_SEQ AND EPISD_YEAR = A.EPISD_YEAR AND EPISD_ORD = A.EPISD_ORD) AS LCRT_INFO
					  , (SELECT stduy_mthd_cd FROM ed_edctn_prcs_mst WHERE EDCTN_SEQ = A.EDCTN_SEQ) AS stduy_mthd_cd
				 from ep_edctn_ptcpt_mst a
						  left join(select mem_seq, id, name, hp_no, email, dept_cd, dept_dtl_nm, pstn_cd, pstn_nm, reg_dtm from co_mem_mst where 1=1 and mem_cd = 'CP') b on a.mem_seq = b.mem_seq
						  left join(select cmpn_nm, ctgry_cd, bsnm_no from cp_cmpn_mst where 1=1) c on c.bsnm_no = a.ptcpt_bsnm_no
						  left join(SELECT edctn_seq, episd_year, episd_ord, edctn_strt_dtm, edctn_end_dtm, otsd_exam_ptcpt_yn, edctn_stts_cd FROM ed_edctn_episd_mst) d ON d.edctn_seq = a.edctn_seq AND d.episd_year = a.episd_year AND d.episd_ord = a.episd_ord
						  left join(select ptcpt_seq, exam_ptcpt_seq from ep_edctn_exam_ptcpt_mst) e on e.ptcpt_seq = a.ptcpt_seq
				 where 1=1
				   and a.edctn_seq = #{edctnSeq}
				   and a.episd_year = #{episdYear}
				   and a.episd_ord = #{episdOrd}

				   and a.stts_cd = 'EDU_STTS_CD01'

			 ) AA
	</select>

	<!--
      쿼리명 : EBBEpisdMapper.selectEpisdPtcptListTypeBCnt
      설  명 : 교육차수관리 - 참여자 목록 카운트 (신청 취소만)
       수정일     수정자       수정내용
     ==========   ======    ==============
     2023.11.28   김학규       최초생성
 	-->
	<select id="selectEpisdPtcptListTypeBCnt" parameterType="EBBEpisdDTO" resultType="java.lang.Integer">
		SELECT /* EBBEpisdMapper.selectEpisdPtcptListTypeBCnt */
			count(*)
		FROM (
		SELECT
		a.ptcpt_seq
		, a.mem_seq
		, b.id
		, b.name
		, (select cmpn_nm from cp_cmpn_mst where bsnm_no = a.ptcpt_bsnm_no) as cmpn_nm
		, (select cd_nm from co_code_mst where cd = c.ctgry_cd) as ctgry_nm
		, a.ptcpt_bsnm_no /*사업자등록번호*/
		, b.hp_no
		, b.email
		, b.dept_cd
		, case when b.dept_cd = null or  b.dept_cd = '' then null else (select cd_nm from co_code_mst where  cd=b.dept_cd ) end as dept_cd_nm
		, b.dept_dtl_nm
		, b.pstn_cd
		, case when b.pstn_cd = null or  b.pstn_cd = '' then null else (select cd_nm from co_code_mst where  cd=b.pstn_cd ) end as pstn_cd_nm
		, b.pstn_nm
		, a.stts_cd
		, case when a.stts_cd = null or  a.stts_cd = '' then null else (select cd_nm from co_code_mst where  cd=a.stts_cd ) end as stts_cd_nm
		, a.reg_dtm as edu_dtm
		, b.reg_dtm
		, a.cmptn_yn
		, a.exam_score
		, e.exam_ptcpt_seq
		, otsd_exam_ptcpt_yn
		, case when d.edctn_stts_cd = 'EDCTN_STTS_CD01' then /*개강일 경우*/
		case when a.stts_cd = 'EDU_STTS_CD01' then /*참여자 상태 : 신청*/
		case when NOW()   <![CDATA[<]]>  d.edctn_strt_dtm then '교육대기'
		when d.edctn_strt_dtm  <![CDATA[<]]>  NOW() AND NOW()  <![CDATA[<]]>   d.edctn_end_dtm  then '교육중'
		when d.edctn_end_dtm  <![CDATA[<]]>  NOW()  then '교육완료'
		end
		when a.stts_cd = 'EDU_STTS_CD02' then '신청취소'
		when a.stts_cd = 'EDU_STTS_CD06' then '교육취소'
		end

		when d.edctn_stts_cd = 'EDCTN_STTS_CD02' then '교육취소'  /*폐강일 경우*/
		end edu_stat

		, ifnull(ROUND(((SELECT COUNT(atndc_dtm) FROM ep_edctn_atndc_dtl WHERE ptcpt_seq = a.ptcpt_seq AND atndc_dtm IS NOT NULL) / (select COUNT(edctn_dt) FROM ep_edctn_atndc_dtl WHERE ptcpt_seq = a.ptcpt_seq))*100), '0') as  edu_atndc/*출석률*/
		, (SELECT COUNT(*) from ep_edctn_lctr_dtl WHERE PTCPT_SEQ = A.PTCPT_SEQ AND EDCTN_SEQ = A.EDCTN_SEQ AND EPISD_YEAR = A.EPISD_YEAR AND A.EPISD_ORD) AS PTCPT_INFO
		, (SELECT COUNT(*) from ed_edctn_lctr_dtl WHERE EDCTN_SEQ = A.EDCTN_SEQ AND EPISD_YEAR = A.EPISD_YEAR AND EPISD_ORD = A.EPISD_ORD) AS LCRT_INFO
		, (SELECT stduy_mthd_cd FROM ed_edctn_prcs_mst WHERE EDCTN_SEQ = A.EDCTN_SEQ) AS stduy_mthd_cd
		from ep_edctn_ptcpt_mst a
		left join(select mem_seq, id, name, hp_no, email, dept_cd, dept_dtl_nm, pstn_cd, pstn_nm, reg_dtm from co_mem_mst where 1=1 and mem_cd = 'CP') b on a.mem_seq = b.mem_seq
		left join(select cmpn_nm, ctgry_cd, bsnm_no from cp_cmpn_mst where 1=1) c on c.bsnm_no = a.ptcpt_bsnm_no
		left join(SELECT edctn_seq, episd_year, episd_ord, edctn_strt_dtm, edctn_end_dtm, otsd_exam_ptcpt_yn, edctn_stts_cd FROM ed_edctn_episd_mst) d ON d.edctn_seq = a.edctn_seq AND d.episd_year = a.episd_year AND d.episd_ord = a.episd_ord
		left join(select ptcpt_seq, exam_ptcpt_seq from ep_edctn_exam_ptcpt_mst) e on e.ptcpt_seq = a.ptcpt_seq
		where 1=1
		and a.edctn_seq = #{edctnSeq}
		and a.episd_year = #{episdYear}
		and a.episd_ord = #{episdOrd}

		and a.stts_cd = 'EDU_STTS_CD02'

		) AA
	</select>

	<!--
      쿼리명 : EBBEpisdMapper.selectEpisdPtcptListTypeCCnt
      설  명 : 교육차수관리 - 참여자 목록 카운트 (교육 양도만)
       수정일     수정자       수정내용
     ==========   ======    ==============
     2023.11.28   김학규       최초생성
 	-->
	<select id="selectEpisdPtcptListTypeCCnt" parameterType="EBBEpisdDTO" resultType="java.lang.Integer">
		SELECT /* EBBEpisdMapper.selectEpisdPtcptListTypeCCnt */
			count(*)
		FROM (
				 SELECT
					 a.ptcpt_seq
					  , c.mem_seq
					  , c.id
					  , c.name
					  , (select cmpn_nm from cp_cmpn_mst where bsnm_no = b.ptcpt_bsnm_no) as cmpn_nm
					  , (select cd_nm from co_code_mst where cd = d.ctgry_cd) as ctgry_nm
					  , b.ptcpt_bsnm_no /*사업자등록번호*/
					  , c.hp_no
					  , c.email
					  , c.dept_cd
					  , (select cd_nm from co_code_mst where  cd = c.dept_cd ) as dept_cd_nm
					  , c.dept_dtl_nm
					  , c.pstn_cd
					  , (select cd_nm from co_code_mst where  cd = c.pstn_cd ) as pstn_cd_nm
					  , c.pstn_nm
					  , "" as stts_cd
					  , "" as stts_cd_nm
					  , c.reg_dtm as edu_dtm
					  , c.reg_dtm
					  , "N" as cmptn_yn
					  , 0 as exam_score
					  , f.exam_ptcpt_seq
					  , otsd_exam_ptcpt_yn
					  , '교육양도' as edu_stat
					  , 0 as  edu_atndc/*출석률*/
					  , 0 AS PTCPT_INFO
					  , 0 AS LCRT_INFO
					  , (SELECT stduy_mthd_cd FROM ed_edctn_prcs_mst WHERE EDCTN_SEQ = B.EDCTN_SEQ) AS stduy_mthd_cd
				 from ep_edctn_trnsf_dtl a
						  LEFT JOIN (
					 SELECT ptcpt_seq, edctn_seq, episd_year, episd_ord, ptcpt_bsnm_no, reg_dtm from ep_edctn_ptcpt_mst
				 )b ON b.ptcpt_seq = a.ptcpt_seq

						  LEFT JOIN(select mem_seq, id, name, hp_no, email, dept_cd, dept_dtl_nm, pstn_cd, pstn_nm, reg_dtm from co_mem_mst where 1=1 and mem_cd = 'CP') c on c.mem_seq = a.bfre_mem_seq
						  LEFT JOIN(select cmpn_nm, ctgry_cd, bsnm_no from cp_cmpn_mst where 1=1) d on d.bsnm_no = b.ptcpt_bsnm_no
						  LEFT JOIN(SELECT edctn_seq, episd_year, episd_ord, edctn_strt_dtm, edctn_end_dtm, otsd_exam_ptcpt_yn, edctn_stts_cd FROM ed_edctn_episd_mst) e ON e.edctn_seq = b.edctn_seq AND e.episd_year = b.episd_year AND e.episd_ord = b.episd_ord
						  LEFT JOIN(select ptcpt_seq, exam_ptcpt_seq from ep_edctn_exam_ptcpt_mst) f on f.ptcpt_seq = a.ptcpt_seq
				 WHERE 1=1
				   AND B.edctn_seq = #{edctnSeq}
				   AND B.episd_year = #{episdYear}
				   AND B.episd_ord = #{episdOrd}

			 ) AA
	</select>

	<!--
      쿼리명 : EBBEpisdMapper.selectEpisdPtcptList
      설  명 : 교육차수관리 - 참여자 목록
       수정일     수정자       수정내용
     ==========   ======    ==============
     2023.11.28   김학규       최초생성
 	-->
	<select id="selectEpisdPtcptList" parameterType="EBBEpisdDTO" resultType="EBBPtcptDTO">
		SELECT /* EBBEpisdMapper.selectEpisdPtcptList */
			ptcpt_seq
			, mem_seq
			, id
			, name
			, cmpn_nm
			, ctgry_nm
			, ptcpt_bsnm_no
			, hp_no
			, email
			, dept_cd
			, dept_cd_nm
			, dept_dtl_nm
			, pstn_cd
			, pstn_cd_nm
			, pstn_nm
			, stts_cd
			, stts_cd_nm
			, edu_dtm
			, reg_dtm
			, cmptn_yn
			, exam_score
			, exam_ptcpt_seq
			, otsd_exam_ptcpt_yn
			, ofln_exam_dtm
			, edu_stat
			, CASE WHEN stduy_mthd_cd = 'STDUY_MTHD02'
					THEN
						IFNULL(ROUND((PTCPT_INFO/LCRT_INFO)*100, 0), 0)
					ELSE
						edu_atndc
				END
			AS edu_atndc
			, PTCPT_INFO
			, LCRT_INFO
			, stduy_mthd_cd
		FROM (
			SELECT /* EBBEpisdMapper.selectEpisdPtcptList */
				a.ptcpt_seq
				, a.mem_seq
				, b.id
				, b.name
				, (select cmpn_nm from cp_cmpn_mst where bsnm_no = a.ptcpt_bsnm_no) as cmpn_nm
				, (select cd_nm from co_code_mst where cd = c.ctgry_cd) as ctgry_nm
				, a.ptcpt_bsnm_no /*사업자등록번호*/
				, b.hp_no
				, b.email
				, b.dept_cd
				, case when b.dept_cd = null or  b.dept_cd = '' then null else (select cd_nm from co_code_mst where  cd=b.dept_cd ) end as dept_cd_nm
				, b.dept_dtl_nm
				, b.pstn_cd
				, case when b.pstn_cd = null or  b.pstn_cd = '' then null else (select cd_nm from co_code_mst where  cd=b.pstn_cd ) end as pstn_cd_nm
				, b.pstn_nm
				, a.stts_cd
				, case when a.stts_cd = null or  a.stts_cd = '' then null else (select cd_nm from co_code_mst where  cd=a.stts_cd ) end as stts_cd_nm
				, a.reg_dtm as edu_dtm
				, b.reg_dtm
				, a.cmptn_yn
				, a.exam_score
				, e.exam_ptcpt_seq
				, otsd_exam_ptcpt_yn
				, ofln_exam_dtm
				, case when d.edctn_stts_cd = 'EDCTN_STTS_CD01' then /*개강일 경우*/
				case when a.stts_cd = 'EDU_STTS_CD01' then /*참여자 상태 : 신청*/
				case when NOW()   <![CDATA[<]]>  d.edctn_strt_dtm then '교육대기'
				when d.edctn_strt_dtm  <![CDATA[<]]>  NOW() AND NOW()  <![CDATA[<]]>   d.edctn_end_dtm  then '교육중'
				when d.edctn_end_dtm  <![CDATA[<]]>  NOW()  then '교육완료'
				end
				when a.stts_cd = 'EDU_STTS_CD02' then '신청취소'
				when a.stts_cd = 'EDU_STTS_CD06' then '교육취소'
				end

				when d.edctn_stts_cd = 'EDCTN_STTS_CD02' then '교육취소'  /*폐강일 경우*/
				end edu_stat

				, ifnull(ROUND(((SELECT COUNT(atndc_dtm) FROM ep_edctn_atndc_dtl WHERE ptcpt_seq = a.ptcpt_seq AND atndc_dtm IS NOT NULL) / (select COUNT(edctn_dt) FROM ep_edctn_atndc_dtl WHERE ptcpt_seq = a.ptcpt_seq))*100), '0') as  edu_atndc/*출석률*/
				, (SELECT COUNT(*) from ep_edctn_lctr_dtl WHERE PTCPT_SEQ = A.PTCPT_SEQ AND EDCTN_SEQ = A.EDCTN_SEQ AND EPISD_YEAR = A.EPISD_YEAR AND A.EPISD_ORD) AS PTCPT_INFO
				, (SELECT COUNT(*) from ed_edctn_lctr_dtl WHERE EDCTN_SEQ = A.EDCTN_SEQ AND EPISD_YEAR = A.EPISD_YEAR AND EPISD_ORD = A.EPISD_ORD) AS LCRT_INFO
				, (SELECT stduy_mthd_cd FROM ed_edctn_prcs_mst WHERE EDCTN_SEQ = A.EDCTN_SEQ) AS stduy_mthd_cd
			from ep_edctn_ptcpt_mst a
			left join(select mem_seq, id, name, hp_no, email, dept_cd, dept_dtl_nm, pstn_cd, pstn_nm, reg_dtm from co_mem_mst where 1=1 and mem_cd = 'CP') b on a.mem_seq = b.mem_seq
			left join(select cmpn_nm, ctgry_cd, bsnm_no from cp_cmpn_mst where 1=1) c on c.bsnm_no = a.ptcpt_bsnm_no
			left join(SELECT edctn_seq, episd_year, episd_ord, edctn_strt_dtm, edctn_end_dtm, otsd_exam_ptcpt_yn, edctn_stts_cd FROM ed_edctn_episd_mst) d ON d.edctn_seq = a.edctn_seq AND d.episd_year = a.episd_year AND d.episd_ord = a.episd_ord
			left join(select ptcpt_seq, exam_ptcpt_seq from ep_edctn_exam_ptcpt_mst) e on e.ptcpt_seq = a.ptcpt_seq
			where 1=1
			and a.edctn_seq = #{edctnSeq}
			and a.episd_year = #{episdYear}
			and a.episd_ord = #{episdOrd}
			and a.stts_cd != 'EDU_STTS_CD04'
			and a.stts_cd != 'EDU_STTS_CD05'

		<if test='atndcYn == "Y" '>
			and a.stts_cd != 'EDU_STTS_CD02'
		</if>

		<if test='atndcYn == "N" '>
			UNION ALL

			SELECT
			a.ptcpt_seq
			, c.mem_seq
			, c.id
			, c.name
			, (select cmpn_nm from cp_cmpn_mst where bsnm_no = b.ptcpt_bsnm_no) as cmpn_nm
			, (select cd_nm from co_code_mst where cd = d.ctgry_cd) as ctgry_nm
			, b.ptcpt_bsnm_no /*사업자등록번호*/
			, c.hp_no
			, c.email
			, c.dept_cd
			, (select cd_nm from co_code_mst where  cd = c.dept_cd ) as dept_cd_nm
			, c.dept_dtl_nm
			, c.pstn_cd
			, (select cd_nm from co_code_mst where  cd = c.pstn_cd ) as pstn_cd_nm
			, c.pstn_nm
			, "" as stts_cd
			, "" as stts_cd_nm
			, c.reg_dtm as edu_dtm
			, c.reg_dtm
			, "N" as cmptn_yn
			, 0 as exam_score
			, f.exam_ptcpt_seq
			, otsd_exam_ptcpt_yn
			, ofln_exam_dtm
			, '교육양도' as edu_stat
			, 0 as  edu_atndc/*출석률*/
			, 0 AS PTCPT_INFO
			, 0 AS LCRT_INFO
			, (SELECT stduy_mthd_cd FROM ed_edctn_prcs_mst WHERE EDCTN_SEQ = B.EDCTN_SEQ) AS stduy_mthd_cd
			from ep_edctn_trnsf_dtl a
			LEFT JOIN (
			SELECT ptcpt_seq, edctn_seq, episd_year, episd_ord, ptcpt_bsnm_no, reg_dtm, ofln_exam_dtm from ep_edctn_ptcpt_mst
			)b ON b.ptcpt_seq = a.ptcpt_seq

			LEFT JOIN(select mem_seq, id, name, hp_no, email, dept_cd, dept_dtl_nm, pstn_cd, pstn_nm, reg_dtm from co_mem_mst where 1=1 and mem_cd = 'CP') c on c.mem_seq = a.bfre_mem_seq
			LEFT JOIN(select cmpn_nm, ctgry_cd, bsnm_no from cp_cmpn_mst where 1=1) d on d.bsnm_no = b.ptcpt_bsnm_no
			LEFT JOIN(SELECT edctn_seq, episd_year, episd_ord, edctn_strt_dtm, edctn_end_dtm, otsd_exam_ptcpt_yn, edctn_stts_cd FROM ed_edctn_episd_mst) e ON e.edctn_seq = b.edctn_seq AND e.episd_year = b.episd_year AND e.episd_ord = b.episd_ord
			LEFT JOIN(select ptcpt_seq, exam_ptcpt_seq from ep_edctn_exam_ptcpt_mst) f on f.ptcpt_seq = a.ptcpt_seq
			WHERE 1=1
			AND B.edctn_seq = #{edctnSeq}
			AND B.episd_year = #{episdYear}
			AND B.episd_ord = #{episdOrd}
			/*and a.stts_cd != 'EDU_STTS_CD04'*/
		</if>
		) AA

		order by edu_dtm desc

		<if test="excelYn != 'Y'.toString() ">
			limit #{firstIndex}, #{recordCountPerPage}
		</if>

	</select>

	<!--
      쿼리명 : EBBEpisdMapper.selectPtcptAtndcList
      설  명 : 교육차수관리 - 참여자 목록 개인별 출석부 목록
       수정일     수정자       수정내용
     ==========   ======    ==============
     2023.11.28   김학규       최초생성
 	-->
	<select id="selectPtcptAtndcList" parameterType="EBBPtcptDTO" resultType="EBBPtcptDTO">

		SELECT /*EBBEpisdMapper.selectPtcptAtndcList*/
		ptcpt_seq
		, edctn_dt
		, atndc_dtm
		, lvgrm_dtm
		, etc_nm
		FROM ep_edctn_atndc_dtl
		WHERE ptcpt_seq IN
		<foreach collection="ptcptList" item="ptcptList" index="index" separator=", " open="(" close=")">
			#{ptcptList.ptcptSeq}
		</foreach>
	</select>

	<!--
             쿼리명 : EBBEpisdMapper.updateEpisdPtcpt
             설  명 : 교육차수관리 - 참여자 목록 수정(평가점수, 수료상태 변경)
              수정일     수정자       수정내용
            ==========   ======    ==============
            2023.11.02   김학규       최초생성
        -->
	<update id="updateEpisdPtcpt" parameterType="EBBEpisdDTO" >
		<foreach collection="ptcptList" item="ptcptList" index="index" separator=";" open="" close=";">
			update ep_edctn_ptcpt_mst set /* EBBEpisdMapper.updateEpisdPtcpt */

				mod_id = #{ptcptList.modId}
				, mod_ip = #{ptcptList.modIp}
				, mod_dtm = now()
				<if test='ptcptList.orgCmptnYn =="Y" and ptcptList.cmptnYn =="N" '>
					/*변경됐을때만*/
					, cmptn_yn = #{ptcptList.cmptnYn}
					, cmptn_dtm = now()
				</if>

				/*오프라인평가인경우에만 입력*/
				 <if test='ptcptList.otsdExamPtcptYn =="Y" '>
					, exam_score = #{ptcptList.examScore}
					<if test='ptcptList.oflnExamDtm =="" or ptcptList.oflnExamDtm == null '>
				  	, ofln_exam_dtm = now()
					</if>
				</if>

			where 1=1
				and edctn_seq = #{ptcptList.edctnSeq}
				and episd_year = #{ptcptList.episdYear}
				and episd_ord = #{ptcptList.episdOrd}
				and ptcpt_seq = #{ptcptList.ptcptSeq}
		</foreach>
	</update>


	<!--
      쿼리명 : EBBEpisdMapper.selectFxnumChk
      설  명 : 교육차수관리 - 참여자 정원체크
       수정일     수정자       수정내용
     ==========   ======    ==============
     2023.11.28   김학규       최초생성
 	-->
	<select id="selectFxnumChk" parameterType="EBBEpisdDTO" resultType="EBBEpisdDTO">
		select /* EBBEpisdMapper.selectFxnumChk */
				aa.edctn_seq
				, aa.episd_year
				, aa.episd_ord
				, aa.fxnum_impsb_yn
				, aa.fxnum_cnt
				, cnt
				, case when aa.fxnum_impsb_yn = 'N' then 'S'
						when aa.fxnum_impsb_yn = 'Y' then
						case when aa.cnt <![CDATA[<]]> aa.fxnum_cnt then 'S'
								else 'F'
						end
				end fxnum_stta
			FROM (SELECT
						edctn_seq
						, episd_year
						, episd_ord
						, fxnum_impsb_yn
						, fxnum_cnt
						, (SELECT COUNT(*) FROM ep_edctn_ptcpt_mst WHERE edctn_seq = a.edctn_seq AND episd_year = a.episd_year AND episd_ord = a.episd_ord AND stts_cd = 'EDU_STTS_CD01' ) AS cnt
			from ed_edctn_episd_mst a
			WHERE 1=1
				and edctn_seq = #{edctnSeq}
				and episd_year = #{episdYear}
				and episd_ord = #{episdOrd}
			) aa
	</select>

	<!--
      쿼리명 : EBBEpisdMapper.selectPtcptDtl
      설  명 : 교육차수 - 신청자 등록 전 확인
       수정일     수정자       수정내용
     ==========   ======    ==============
     2023.11.28   김학규       최초생성
 	-->
	<select id="selectPtcptDtl" parameterType="EBBPtcptDTO" resultType="EBBPtcptDTO">
			select
			ptcpt_seq
			, edctn_seq
			, episd_year
			, episd_ord
			, mem_seq
			, ptcpt_bsnm_no
			, gpc_id
			, reg_dtm
			from ep_edctn_ptcpt_mst
			  WHERE 1=1
				and edctn_seq = #{edctnSeq}
				and episd_year = #{episdYear}
				and episd_ord = #{episdOrd}
				AND stts_cd != 'EDU_STTS_CD02'
			    <choose>
					<when test="memSeq != null and  memSeq != ''">
						and mem_seq = #{memSeq}
					</when>
					<otherwise>
						and ptcpt_seq = #{ptcptSeq}
					</otherwise>
				</choose>

	</select>

	<!--
      쿼리명 : EBBEpisdMapper.selectMemAtndcDtl
      설  명 : 교육차수 - 개인별 출석부
       수정일     수정자       수정내용
     ==========   ======    ==============
     2023.12.08   김학규       최초생성
 	-->
	<select id="selectMemAtndcDtl" parameterType="EBBPtcptDTO" resultType="EBBPtcptDTO">
		SELECT /*EBBEpisdMapper.selectMemAtndcDtl*/
			a.ptcpt_seq
			 , a.mem_seq
			 , (SELECT id FROM co_mem_mst WHERE mem_seq = a.mem_seq ) AS id
			 , (SELECT name FROM co_mem_mst WHERE mem_seq = a.mem_seq ) AS name
			 , b.edctn_dt
			 , b.atndc_dtm
			 , b.lvgrm_dtm
			 , b.etc_nm
		FROM ep_edctn_ptcpt_mst a, ep_edctn_atndc_dtl b
		WHERE a.ptcpt_seq = #{ptcptSeq}
		  AND a.ptcpt_seq = b.ptcpt_seq

		<if test="siteGubun == 'front'.toString() ">
			order by edctn_dt desc
		</if>
	</select>

	<!--
             쿼리명 : EBBEpisdMapper.insertPtcptDtl
             설  명 : 교육차수 - 신청자 등록
              수정일     수정자       수정내용
            ==========   ======    ==============
            2023.11.02   김학규       최초생성
        -->
	<insert id="insertPtcptDtl" parameterType="EBBPtcptDTO">
		INSERT INTO ep_edctn_ptcpt_mst (
			ptcpt_seq
			, edctn_seq
			, episd_year
			, episd_ord
			, mem_seq
			, ptcpt_bsnm_no
			, stts_cd
			, gpc_id
			, cmptn_yn
			, cmptn_dtm
			, exam_score
			, reg_id
			, reg_ip
			, reg_dtm
			, mod_id
			, mod_ip
			, mod_dtm
			, episd_seq
		) VALUES(
				#{ptcptSeq}
				, #{edctnSeq}
				, #{episdYear}
				, #{episdOrd}
				, #{memSeq}
				, #{ptcptBsnmNo}
				, #{sttsCd}
				, #{gpcId}
				, 'N'
				, null
				, null
				, #{regId}
				, #{regIp}
				, now()
				, #{modId}
				, #{modIp}
				, now()
				, #{episdSeq}
			)

	</insert>

	<!--
             쿼리명 : EBBEpisdMapper.insertAtndcList
             설  명 : 교육차수 - 신청자 출석 목록 등록
              수정일     수정자       수정내용
            ==========   ======    ==============
            2023.12.05   김학규       최초생성
        -->
	<insert id="insertAtndcList" parameterType="EBBEpisdDTO">
		insert into /*EBBEpisdMapper.insertAtndcList*/ ep_edctn_atndc_dtl (
			ptcpt_seq
			, edctn_dt
			, atndc_dtm
			, lvgrm_dtm
			, etc_nm
			, reg_id
			, reg_ip
			, reg_dtm
			, mod_id
			, mod_ip
			, mod_dtm
		) VALUES
		<foreach collection="ptcptList" item="ptcptList" index="index" separator=" , " open="" close=";">
			(
			#{ptcptList.ptcptSeq}
			, #{ptcptList.edctnDt}
			, #{ptcptList.atndcDtm}
			, #{ptcptList.lvgrmDtm}
			, #{ptcptList.etcNm}
			, #{ptcptList.regId}
			, #{ptcptList.regIp}
			, now()
			, #{ptcptList.modId}
			, #{ptcptList.modIp}
			, now()
			)
		</foreach>
	</insert>

	<!--
		 쿼리명 : EBBEpisdMapper.insertEdctnLctrDtl
		 설  명 : 교육차수 - 신청자  참여강의 상세 등록(온라인 강의)
		  수정일     수정자       수정내용
		==========   ======    ==============
		2023.12.11   김학규       최초생성
	-->

	<insert id="insertEdctnLctrDtl" parameterType="EBBEpisdDTO">
		insert into /*EBBEpisdMapper.insertEdctnLctrDtl*/ ep_edctn_lctr_dtl (
			ptcpt_seq
			, lctr_seq
			, edctn_seq
			, episd_ord
			, episd_year
			, episd_seq
			, reg_id
			, reg_ip
			, reg_dtm
			, mod_id
			, mod_ip
			, mod_dtm
		) VALUES
			(
			#{ptcptList.ptcptSeq}
			, #{ptcptList.lctrSeq}
			, #{ptcptList.edctnSeq}
			, #{ptcptList.episdOrd}
			, #{ptcptList.episdYear}
			, #{ptcptList.episdSeq}
			, #{ptcptList.regId}
			, #{ptcptList.regIp}
			, now()
			, #{ptcptList.modId}
			, #{ptcptList.modIp}
			, now()
			)
	</insert>



	<!--
             쿼리명 : EBBEpisdMapper.updateAtndcList
             설  명 : 교육차수관리 - 참여자 목록 출석부 수정
              수정일     수정자       수정내용
            ==========   ======    ==============
            2023.11.02   김학규       최초생성
        -->
	<update id="updateAtndcList" parameterType="EBBEpisdDTO" >
		<foreach collection="ptcptList" item="ptcptList" index="index" separator=";" open="" close=";">
			<choose>
				<when test='ptcptList.deleteYn =="N"  '>
					update ep_edctn_atndc_dtl set /* EBBEpisdMapper.updateAtndcList */

					mod_id = #{ptcptList.modId}
					, mod_ip = #{ptcptList.modIp}
					, mod_dtm = now()

					<if test="ptcptList.atndcDtm != null and ptcptList.atndcDtm != ''">
						, atndc_dtm = #{ptcptList.atndcDtm}
					</if>
					<if test="ptcptList.lvgrmDtm != null and ptcptList.lvgrmDtm != ''">
						, lvgrm_dtm = #{ptcptList.lvgrmDtm}
					</if>

					, etc_nm = #{ptcptList.etcNm}


					where 1=1
					and ptcpt_seq = #{ptcptList.ptcptSeq}
					and edctn_dt = #{ptcptList.edctnDt}
				</when>
				<otherwise>

				</otherwise>

			</choose>

		</foreach>
	</update>


	<!--
         쿼리명 : EBBEpisdMapper.deleteSurveyRspn
         설  명 : 응답 삭제(초기화)
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.12.11   박준희       최초생성
    -->
	<delete id="deleteSurveyRspn" parameterType="EBBEpisdDTO">
		delete /* EBBEpisdMapper.deleteSurveyRspn */
		sv_rspn_mst , sv_sbjct_rspn_dtl , sv_mtlcc_rspn_dtl
		from sv_rspn_mst
		left join sv_sbjct_rspn_dtl on sv_rspn_mst.srv_rspn_seq = sv_sbjct_rspn_dtl.srv_rspn_seq
		left join sv_mtlcc_rspn_dtl on sv_rspn_mst.srv_rspn_seq = sv_mtlcc_rspn_dtl.srv_rspn_seq
		where sv_rspn_mst.srv_seq = #{srvSeq}
	</delete>

	<!--
         쿼리명 : EBBEpisdMapper.checkSurveyCnt
         설  명 : 설문 개수 조회
          수정일     수정자       수정내용
        ==========   ======    ==============
        2024.02.01   장두석       최초생성
    -->
	<select id="checkSurveyCnt" parameterType="EBBEpisdDTO" resultType="java.lang.Integer">
		select /* EBBEpisdMapper.checkSurveyCnt */
			COUNT(*)
		from
			sv_rspn_mst a
		where
			srv_seq = #{srvSeq}
			AND rfnc_seq = #{episdSeq}
	</select>

	<!--
         쿼리명 : EBBEpisdMapper.selectEpisdExelList
         설  명 : 교육차수관리 목록 출력(엑셀용)
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.12.18   김학규       최초생성
    -->
	<select id="selectEpisdExcelList" parameterType="EBBEpisdDTO" resultType="EBBEpisdExcelDTO">
		SELECT /* EBBEpisdMapper.selectEpisdExelList */
		episd_seq
		, prnt_cd_nm /* 과정분류1 */
		, ctgry_cd
		, ctgry_cd_nm /* 과정분류2 */
		, nm /* 과정명 */
		, stduy_mthd_cd/* 학습방식 */
		, rcrmt_mthd_cd/* 모집방식*/
		, stduy_mthd_cd_nm /* 학습방식 */
		, stduy_time_cd_nm  /* 학습시간 */
		, cbsn_cd_nm /*업종*/
		, episd_year /*년도*/
		, episd_ord /* 차수 */
		, stduy_dd_cd /*학습일*/
		, stduy_time_cd /*학습시간*/
		, stduy_dd_cd_nm /*교육일*/
		, edctn_strt_dtm /* 교육기간 시작일 */
		, edctn_end_dtm /* 교육기간 종료일 */
		, place_nm /* 교육장소 */
		, cprtn_instt_nm /* 협력기관 */
		, fxnum_cnt /* 정원(명) */
		, edctn_status_nm /*교육상태*/
		, accs_cnt /* 신청인원 */
		, cmptn_cnt /*수료인원*/
		, ROUND((cmptn_cnt/accs_cnt)*100, 2) as atted_per /*참석률*/
		, c1 /*완성차*/
		, c2 /* 1차사 */
		, c3 /* 2차사 */
		, c4 /* 기타 */
		, SUM(CNT1) AS T1 /* 부서별 인원 - 품질 */
		, SUM(CNT2) AS T2 /* 부서별 인원 - RnD */
		, SUM(CNT3) AS T3 /* 부서별 인원 - 생산 */
		, SUM(CNT4) AS T4 /* 부서별 인원 - 구매 */
		, SUM(CNT5) AS T5 /* 부서별 인원 - 경영지원 */
		, SUM(CNT6) AS T6 /* 부서별 인원 - 업체평가 */
		, SUM(CNT7) AS T7 /* 부서별 인원 - 안전 */
		, SUM(CNT8) AS T8 /* 부서별 인원 - ESG */
		, SUM(CNT9) AS T9 /* 부서별 인원 - 기타 */

		, SUM(CNT01) AS A1 /* 직급별 인원 - 대표 */
		, SUM(CNT02) AS A2 /* 직급별 인원 - 임원 */
		, SUM(CNT03) AS A3 /* 직급별 인원 - 부장 */
		, SUM(CNT04) AS A4 /* 직급별 인원 - 과장/차장 */
		, SUM(CNT05) AS A5 /* 직급별 인원 - 사원/대리 */
		, SUM(CNT06) AS A6 /* 직급별 인원 - 조장/반창(계장) */
		, SUM(CNT07) AS A7 /* 직급별 인원 - 기타 */
		, atndc_cnt
		, ptcpt_cnt
		, edu_day
		, ifnull(ROUND(   (atndc_cnt / (edu_day*ptcpt_cnt)   )*100,1), 0) AS A11/*출석률*/
		<!--, A11--> /*출석률*/
		, AVG_score /*평가점수(점)*/
		, ifnull(A_12, 0.0) AS A_12/* 종합 평균 */
		, ifnull(A_13, 0.0) AS A_13/* 전체(공통) */
		, ifnull(A_14, 0.0) AS A_14/* 교육환경 */
		, ifnull(A_15, 0.0) AS A_15/* 교육지원 */
		, ifnull(A_16, 0.0) AS A_16/* 교육내용 */
		, ifnull(A_17, 0.0) AS A_17 /* 강사 */
		, pmt_c1 /* 강사시간1 */
		, pmt_c2 /* 강사시간2 */
		, pmt_c3 /* 강사시간3 */
		, pmt_c4 /* 강사시간4 */
		, pmt_c5 /* 강사시간5 */
		, pmt_c6 /* 강사시간6 */
		, SUM(pmt_a1 + pmt_a2 + pmt_a3 + pmt_a4 + pmt_a5 + pmt_a6 + pmt_a7 + pmt_a8 + pmt_a9 + pmt_a10) AS pmt_a0
		, pmt_a1 /* 부담금/대관비(원) */
		, pmt_a2 /* 강사비(원) */
		, pmt_a3 /* 교재비(원) */
		, pmt_a4 /* 식대(원) */
		, pmt_a5 /* 다과비(원) */
		, pmt_a6 /* 소모품비(원) */
		, pmt_a7 /* 발송비(원) */
		, pmt_a8 /* 재료비(원) */
		, pmt_a9 /* 집행비(원) */
		, pmt_a10 /* 기타(원) */
		, pmt_a11 /* 비고 */
		, SUM(pmt_b1 + pmt_b2 + pmt_b3 + pmt_b4 + pmt_b5 + pmt_b6 + pmt_b7 + pmt_b8 + pmt_b9 + pmt_b10) AS pmt_b0
		, pmt_b1 /* 부담금/대관비(원) */
		, pmt_b2 /* 강사비(원) */
		, pmt_b3 /* 교재비(원) */
		, pmt_b4 /* 식대(원) */
		, pmt_b5 /* 다과비(원) */
		, pmt_b6 /* 소모품비(원) */
		, pmt_b7 /* 발송비(원) */
		, pmt_b8 /* 재료비(원) */
		, pmt_b9 /* 집행비(원) */
		, pmt_b10 /* 기타(원) */
		, pmt_b11 /* 비고(원) */
		, isttrNm1
		, isttrNm2
		, isttrNm3
		, isttrNm4
		, isttrNm5
		, isttrNm6
		, reg_dtm
		, reg_ip
		, reg_id
		, exps_yn
		FROM (SELECT /*EBBEpisdMapper.selectEpisdList*/
		a.episd_seq
		, (select cd_nm from co_code_mst WHERE cd = LEFT(b.ctgry_cd, 7)) AS prnt_cd_nm/* 과정분류1 */
	    , b.ctgry_cd
		, (select cd_nm from co_code_mst WHERE cd = b.ctgry_cd) AS ctgry_cd_nm /* 과정분류2 */
		, b.nm /* 과정명 */
	   	, b.stduy_mthd_cd/* 학습방식 */
		, a.rcrmt_mthd_cd/* 모집방식*/
		, (select cd_nm from co_code_mst where cd=b.stduy_mthd_cd) as stduy_mthd_cd_nm/* 학습방식 */
		, (select cd_nm from co_code_mst where cd=b.stduy_time_cd) as stduy_time_cd_nm /* 학습시간 */
		, (select cd_nm from co_code_mst where cd=a.cbsn_cd) AS cbsn_cd_nm/*업종*/
		, a.episd_year /*년도*/
		, a.episd_ord/*차수*/
	   , b.stduy_dd_cd /*학습일*/
	   , b.stduy_time_cd /*학습시간*/
		, (select cd_nm from co_code_mst where cd=b.stduy_dd_cd) AS stduy_dd_cd_nm/*교육일*/
		, a.edctn_strt_dtm/* 교육기간 시작일 */
		, a.edctn_end_dtm/* 교육기간 종료일 */
		, (SELECT nm FROM ed_edctn_place_mst WHERE place_seq = a.place_seq) as place_nm/* 교육장소 */
		, (SELECT nm FROM ed_edctn_place_mst WHERE place_seq = a.cprtn_instt_seq) as cprtn_instt_nm/* 협력기관 */
		, a.fxnum_cnt/* 정원(명) */
		, case when edctn_stts_cd = 'EDCTN_STTS_CD01' then /*개강일 경우*/
		case when NOW() <![CDATA[<]]> edctn_strt_dtm then '교육대기'
		when NOW() <![CDATA[>]]> edctn_strt_dtm AND NOW() <![CDATA[<]]> edctn_end_dtm then '교육중'
		when NOW() <![CDATA[>]]> edctn_end_dtm then '교육완료'
		end
		when edctn_stts_cd = 'EDCTN_STTS_CD02' then '교육취소'  /*폐강일 경우*/
		END  AS edctn_status_nm /*교육상태*/
		, (SELECT count(mem_seq) FROM ep_edctn_ptcpt_mst WHERE edctn_seq = a.edctn_seq AND episd_year = a.episd_year AND episd_ord = a.episd_ord AND stts_cd = 'EDU_STTS_CD01') AS accs_cnt /*신청인원*/
		, (SELECT COUNT(ptcpt_seq) FROM ep_edctn_ptcpt_mst WHERE edctn_seq = a.edctn_seq AND episd_year = a.episd_year AND episd_ord = a.episd_ord AND stts_cd = 'EDU_STTS_CD01' AND cmptn_yn = 'Y') AS cmptn_cnt/*수료인원(명)*/
		, ''AS A_10 /*참석율(%) = 수료인원/신청인원 */
		, CASE WHEN j.ctgry_cd = 'COMPANY01003' THEN j.ct_cnt ELSE 0 END AS c1 /*완성차*/
		, CASE WHEN j.ctgry_cd = 'COMPANY01001' THEN j.ct_cnt ELSE 0 END AS c2 /* 1차사 */
		, CASE WHEN j.ctgry_cd = 'COMPANY01002' THEN j.ct_cnt ELSE 0 END AS c3 /* 2차사 */
		, CASE WHEN j.ctgry_cd = 'COMPANY01004' THEN j.ct_cnt ELSE 0 END AS c4 /* 기타 */

		, CASE WHEN DEPT_CD = 'MEM_CD02002' THEN COUNT(e.DEPT_CD) ELSE 0 END AS CNT1 /* 부서별 인원 - 품질 */
		, CASE WHEN DEPT_CD = 'MEM_CD02003' THEN COUNT(e.DEPT_CD) ELSE 0 END AS CNT2 /* 부서별 인원 - RnD */
		, CASE WHEN DEPT_CD = 'MEM_CD02004' THEN COUNT(e.DEPT_CD) ELSE 0 END AS CNT3 /* 부서별 인원 - 생산 */
		, CASE WHEN DEPT_CD = 'MEM_CD02005' THEN COUNT(e.DEPT_CD) ELSE 0 END AS CNT4 /* 부서별 인원 - 구매 */
		, CASE WHEN DEPT_CD = 'MEM_CD02006' THEN COUNT(e.DEPT_CD) ELSE 0 END AS CNT5 /* 부서별 인원 - 경영지원 */
		, CASE WHEN DEPT_CD = 'MEM_CD02007' THEN COUNT(e.DEPT_CD) ELSE 0 END AS CNT6 /* 부서별 인원 - 업체평가 */
		, CASE WHEN DEPT_CD = 'MEM_CD02008' THEN COUNT(e.DEPT_CD) ELSE 0 END AS CNT7 /* 부서별 인원 - 안전 */
		, CASE WHEN DEPT_CD = 'MEM_CD02009' THEN COUNT(e.DEPT_CD) ELSE 0 END AS CNT8 /* 부서별 인원 - ESG */
		, CASE WHEN DEPT_CD = 'MEM_CD02010' THEN COUNT(e.DEPT_CD) ELSE 0 END AS CNT9 /* 부서별 인원 - 기타 */

		, CASE WHEN PSTN_CD = 'MEM_CD01001' THEN COUNT(e.PSTN_CD) ELSE 0 END AS CNT01 /* 직급별 인원 - 대표 */
		, CASE WHEN PSTN_CD = 'MEM_CD01002' THEN COUNT(e.PSTN_CD) ELSE 0 END AS CNT02 /* 직급별 인원 - 임원 */
		, CASE WHEN PSTN_CD = 'MEM_CD01003' THEN COUNT(e.PSTN_CD) ELSE 0 END AS CNT03 /* 직급별 인원 - 부장 */
		, CASE WHEN PSTN_CD = 'MEM_CD01004' THEN COUNT(e.PSTN_CD) ELSE 0 END AS CNT04 /* 직급별 인원 - 과장/차장 */
		, CASE WHEN PSTN_CD = 'MEM_CD01005' THEN COUNT(e.PSTN_CD) ELSE 0 END AS CNT05 /* 직급별 인원 - 사원/대리 */
		, CASE WHEN PSTN_CD = 'MEM_CD01006' THEN COUNT(e.PSTN_CD) ELSE 0 END AS CNT06 /* 직급별 인원 - 조장/반창(계장) */
		, CASE WHEN PSTN_CD = 'MEM_CD01007' THEN COUNT(e.PSTN_CD) ELSE 0 END AS CNT07 /* 직급별 인원 - 기타 */

		, case TIMESTAMPDIFF(DAY, edctn_strt_dtm, edctn_end_dtm) when 0 then 1
		ELSE TIMESTAMPDIFF(DAY, edctn_strt_dtm, edctn_end_dtm)
		END AS edu_day
		, m.atndc_cnt
		, (SELECT COUNT(ptcpt_seq) FROM ep_edctn_ptcpt_mst  WHERE episd_seq = a.episd_seq ) AS ptcpt_cnt
		, '' AS A11
		<!-- , ifnull(round((COUNT(i.atndc_dtm) / COUNT(i.edctn_dt))*100,1), 0) AS A11 -->/*출석률*/
		, ROUND(avg(exam_score), 2) AS AVG_score /*평가 점수*/
		, vrll_avrg AS A_12 /* 종합 평균 */
		, ttl_co_score AS A_13 /* 전체(공통) */
		, edctn_envrnmt_score AS A_14 /* 교육환경 */
		, edctn_spprt_score AS A_15 /* 교육지원 */
		, edctn_cntn_score AS A_16 /* 교육내용 */
		, isttr_score AS A_17 /* 강사 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD03001' THEN pmt ELSE NULL END) AS pmt_c1/* 강사시간1 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD03002' THEN pmt ELSE NULL END) AS pmt_c2/* 강사시간2 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD03003' THEN pmt ELSE NULL END) AS pmt_c3/* 강사시간3 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD03004' THEN pmt ELSE NULL END) AS pmt_c4/* 강사시간4 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD03005' THEN pmt ELSE NULL END) AS pmt_c5/* 강사시간5 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD03006' THEN pmt ELSE NULL END) AS pmt_c6/* 강사시간6 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD01001' THEN pmt ELSE NULL END) AS pmt_a1 /* 부담금/대관비 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD01002' THEN pmt ELSE NULL END) AS pmt_a2 /* 강사비 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD01003' THEN pmt ELSE NULL END) AS pmt_a3 /* 교재비 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD01004' THEN pmt ELSE NULL END) AS pmt_a4 /* 식대 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD01005' THEN pmt ELSE NULL END) AS pmt_a5 /* 다과비 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD01006' THEN pmt ELSE NULL END) AS pmt_a6 /* 소모품비 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD01007' THEN pmt ELSE NULL END) AS pmt_a7 /* 발송비 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD01008' THEN pmt ELSE NULL END) AS pmt_a8 /* 재료비 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD01009' THEN pmt ELSE NULL END) AS pmt_a9 /* 집행비 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD01010' THEN pmt ELSE NULL END) AS pmt_a10 /* 기타(원) */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD01011' THEN etc_nm ELSE NULL END) AS pmt_a11 /* 비고 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD02001' THEN pmt ELSE NULL END) AS pmt_b1 /* 부담금/대관비 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD02002' THEN pmt ELSE NULL END) AS pmt_b2 /* 강사비 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD02003' THEN pmt ELSE NULL END) AS pmt_b3 /* 교재비 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD02004' THEN pmt ELSE NULL END) AS pmt_b4 /* 식대 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD02005' THEN pmt ELSE NULL END) AS pmt_b5 /* 다과비 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD02006' THEN pmt ELSE NULL END) AS pmt_b6 /* 소모품비 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD02007' THEN pmt ELSE NULL END) AS pmt_b7 /* 발송비 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD02008' THEN pmt ELSE NULL END) AS pmt_b8 /* 재료비 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD02009' THEN pmt ELSE NULL END) AS pmt_b9 /* 집행비 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD02010' THEN pmt ELSE NULL END) AS pmt_b10 /* 기타(원) */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD02011' THEN etc_nm ELSE NULL END) AS pmt_b11 /* 비고 */
		, (SELECT name from cp_isttr_mst WHERE isttr_seq = g.r1) AS isttrNm1
		, (SELECT name from cp_isttr_mst WHERE isttr_seq = g.r2) AS isttrNm2
		, (SELECT name from cp_isttr_mst WHERE isttr_seq = g.r3) AS isttrNm3
		, (SELECT name from cp_isttr_mst WHERE isttr_seq = g.r4) AS isttrNm4
		, (SELECT name from cp_isttr_mst WHERE isttr_seq = g.r5) AS isttrNm5
		, (SELECT name from cp_isttr_mst WHERE isttr_seq = g.r6) AS isttrNm6
		, a.reg_dtm
		, a.reg_ip
		, a.reg_id
		, a.exps_yn
		FROM (
			SELECT * FROM ed_edctn_episd_mst AA WHERE 1=1
			AND edctn_strt_dtm <![CDATA[>=]]> DATE_FORMAT(#{strtDt}, '%Y-%m-%d 00:00:00')
			AND edctn_end_dtm <![CDATA[<=]]> DATE_FORMAT(#{endDt}, '%Y-%m-%d 23:59:59')
			ORDER BY EPISD_SEQ DESC,EPISD_YEAR DESC, EPISD_ORD DESC
		) a
		LEFT JOIN ed_edctn_prcs_mst b ON b.edctn_seq = a.edctn_seq
		LEFT OUTER JOIN ( SELECT CD AS bd_cd, PMT, ETC_NM, EDCTN_SEQ, EPISD_ORD, EPISD_YEAR FROM ed_edctn_bdget_expns_dtl) C ON c.EDCTN_SEQ = a.EDCTN_SEQ AND c.EPISD_ORD = a.EPISD_ORD AND c.EPISD_YEAR = a.EPISD_YEAR

		LEFT OUTER JOIN ( SELECT MEM_SEQ, srv_seq, rfnc_seq, rfnc_cd FROM sv_rspn_mst ) d ON A.srv_seq = d.srv_seq AND d.rfnc_seq = A.episd_seq AND d.rfnc_cd = 'EDU'
		LEFT OUTER JOIN ( SELECT MEM_SEQ, MEM_CD, DEPT_CD, PSTN_CD FROM co_mem_mst where mem_cd = 'CP' ) e ON d.mem_seq = e.mem_seq
		LEFT OUTER JOIN (
		SELECT CD FROM co_code_mst
		WHERE PARNT_SEQ IN (
			SELECT CD_SEQ FROM CO_CODE_MST
			WHERE CD IN ('MEM_CD01', 'MEM_CD02')
		)
		) T2 ON e.DEPT_CD = T2.CD
		LEFT OUTER JOIN( SELECT exam_score, edctn_seq, episd_year, episd_ord FROM ep_edctn_ptcpt_mst) f ON f.edctn_seq = a.edctn_seq AND f.episd_year = a.episd_year AND f.episd_ord = a.episd_ord
		LEFT JOIN (SELECT
							isttr_tb.edctn_seq
							,isttr_tb.episd_seq
							,isttr_tb.episd_year
							,isttr_tb.episd_ord
							,isttr_tb.isttr_seq
							,MAX(CASE WHEN orders = 1 THEN isttr_seq ELSE NULL END) AS r1
							,MAX(CASE WHEN orders = 2 THEN isttr_seq ELSE NULL END) AS r2
							,MAX(CASE WHEN orders = 3 THEN isttr_seq ELSE NULL END) AS r3
							,MAX(CASE WHEN orders = 4 THEN isttr_seq ELSE NULL END) AS r4
							,MAX(CASE WHEN orders = 5 THEN isttr_seq ELSE NULL END) AS r5
							,MAX(CASE WHEN orders = 6 THEN isttr_seq ELSE NULL END) AS r6
						FROM (
							SELECT
								aaa.edctn_seq
								,aaa.episd_year
								,aaa.episd_ord
								,aaa.episd_seq
								,b2.isttr_seq
								,(SELECT COUNT(*) FROM ed_edctn_isttr_rel g2 WHERE g2.edctn_seq = aaa.edctn_seq AND g2.episd_year = aaa.episd_year AND g2.episd_ord = aaa.episd_ord AND g2.isttr_seq <![CDATA[<=]]> b2.isttr_seq) AS orders
							FROM ed_edctn_episd_mst aaa
							LEFT JOIN ed_edctn_isttr_rel b2 ON b2.edctn_seq = aaa.edctn_seq AND b2.episd_year = aaa.episd_year AND b2.episd_ord = aaa.episd_ord
						) AS isttr_tb
					GROUP BY isttr_tb.episd_seq) g ON g.edctn_seq = a.edctn_seq AND g.episd_year = a.episd_year AND g.episd_ord = a.episd_ord
		LEFT JOIN (SELECT ptcpt_seq, ptcpt_bsnm_no, edctn_seq, episd_year, episd_ord, stts_cd from ep_edctn_ptcpt_mst WHERE stts_cd = 'EDU_STTS_CD01' GROUP BY ptcpt_seq) h ON h.edctn_seq = a.edctn_seq AND h.episd_year = a.episd_year AND h.episd_ord = a.episd_ord
		LEFT JOIN (SELECT ptcpt_seq AS at_ptcpt_seq, edctn_dt, atndc_dtm FROM ep_edctn_atndc_dtl) i ON i.at_ptcpt_seq = h.ptcpt_seq
		LEFT JOIN(
			SELECT
				ctgry_cd
				, COUNT(ctgry_cd) AS ct_cnt
				, episdmst.episd_seq
			FROM cp_cmpn_mst cmpn
				inner JOIN ep_edctn_ptcpt_mst ptcpt on cmpn.BSNM_NO = ptcpt.ptcpt_bsnm_no
				inner JOIN ed_edctn_episd_mst episdmst ON episdmst.episd_seq = ptcpt.episd_seq
			GROUP BY episd_seq, ctgry_cd
		) j ON j.episd_seq = a.episd_seq
		LEFT JOIN(
			SELECT
				rslt_seq
				, edctn_seq
				, episd_year
				, episd_ord
				, episd_seq
				, vrll_avrg
				, ttl_co_score
				, edctn_envrnmt_score
				, edctn_spprt_score
				, edctn_cntn_score
				, isttr_score
				, ttl_ptcpt_cnt
			FROM ed_edctn_srv_rslt_dtl
		) k ON k.episd_seq = a.episd_seq

		LEFT JOIN(

		SELECT
		episd_seq
		, SUM((SELECT COUNT(atndc_dtm) FROM ep_edctn_atndc_dtl WHERE ptcpt_seq = a.ptcpt_seq)) AS atndc_cnt
		from ep_edctn_ptcpt_mst a
		GROUP BY a.episd_seq

		) m ON m.episd_seq = a.episd_seq

		GROUP BY a.episd_seq, a.episd_ord




		) AA

		<include refid="selectEpisdListwhereSql" />

		GROUP BY episd_seq
	</select>

	<!--
         쿼리명 : EBBEpisdMapper.selectEpisdExelListCnt
         설  명 : 교육차수관리 엑셀 출력 카운트
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.12.18   김학규       최초생성
    -->
	<select id="selectEpisdExcelListCnt" parameterType="EBBEpisdDTO" resultType="java.lang.Integer">
		SELECT
			count(*)
		FROM (SELECT /*EBBEpisdMapper.selectEpisdList*/
		a.episd_seq
		, (select cd_nm from co_code_mst WHERE cd = LEFT(b.ctgry_cd, 7)) AS prnt_cd_nm/* 과정분류1 */
		, b.ctgry_cd
		, (select cd_nm from co_code_mst WHERE cd = b.ctgry_cd) AS ctgry_cd_nm /* 과정분류2 */
		, b.nm /* 과정명 */
		, (select cd_nm from co_code_mst where cd=b.stduy_mthd_cd) as stduy_mthd_cd_nm/* 학습방식 */
		, (select cd_nm from co_code_mst where cd=b.stduy_time_cd) as stduy_time_cd_nm /* 학습시간 */
		, (select cd_nm from co_code_mst where cd=a.cbsn_cd) AS cbsn_cd_nm/*업종*/
		, a.episd_year /*년도*/
		, a.episd_ord/*차수*/
		, (select cd_nm from co_code_mst where cd=b.stduy_dd_cd) AS stduy_dd_cd_nm/*교육일*/
		, a.edctn_strt_dtm/* 교육기간 시작일 */
		, a.edctn_end_dtm/* 교육기간 종료일 */
		, (SELECT nm FROM ed_edctn_place_mst WHERE place_seq = a.place_seq) as place_nm/* 교육장소 */
		, (SELECT nm FROM ed_edctn_place_mst WHERE place_seq = a.cprtn_instt_seq) as cprtn_instt_nm/* 협력기관 */
		, a.fxnum_cnt/* 정원(명) */
		, case when edctn_stts_cd = 'EDCTN_STTS_CD01' then /*개강일 경우*/
		case when NOW() <![CDATA[<]]> edctn_strt_dtm then '교육대기'
		when NOW() <![CDATA[>]]> edctn_strt_dtm AND NOW() <![CDATA[<]]> edctn_end_dtm then '교육중'
		when NOW() <![CDATA[>]]> edctn_end_dtm then '교육완료'
		end
		when edctn_stts_cd = 'EDCTN_STTS_CD02' then '교육취소'  /*폐강일 경우*/
		END  AS edctn_status_nm /*교육상태*/
		, (SELECT count(mem_seq) FROM ep_edctn_ptcpt_mst WHERE edctn_seq = a.edctn_seq AND episd_year = a.episd_year AND episd_ord = a.episd_ord AND stts_cd = 'EDU_STTS_CD01') AS accs_cnt /*신청인원*/
		, (SELECT COUNT(ptcpt_seq) FROM ep_edctn_ptcpt_mst WHERE edctn_seq = a.edctn_seq AND episd_year = a.episd_year AND episd_ord = a.episd_ord AND stts_cd = 'EDU_STTS_CD01' AND cmptn_yn = 'Y') AS cmptn_cnt/*수료인원(명)*/
		, ''AS A_10 /*참석율(%) = 수료인원/신청인원 */
		, CASE WHEN j.ctgry_cd = 'COMPANY01003' THEN j.ct_cnt ELSE 0 END AS c1 /*완성차*/
		, CASE WHEN j.ctgry_cd = 'COMPANY01001' THEN j.ct_cnt ELSE 0 END AS c2 /* 1차사 */
		, CASE WHEN j.ctgry_cd = 'COMPANY01002' THEN j.ct_cnt ELSE 0 END AS c3 /* 2차사 */
		, CASE WHEN j.ctgry_cd = 'COMPANY01004' THEN j.ct_cnt ELSE 0 END AS c4 /* 기타 */

		, CASE WHEN DEPT_CD = 'MEM_CD02002' THEN COUNT(e.DEPT_CD) ELSE 0 END AS CNT1 /* 부서별 인원 - 품질 */
		, CASE WHEN DEPT_CD = 'MEM_CD02003' THEN COUNT(e.DEPT_CD) ELSE 0 END AS CNT2 /* 부서별 인원 - RnD */
		, CASE WHEN DEPT_CD = 'MEM_CD02004' THEN COUNT(e.DEPT_CD) ELSE 0 END AS CNT3 /* 부서별 인원 - 생산 */
		, CASE WHEN DEPT_CD = 'MEM_CD02005' THEN COUNT(e.DEPT_CD) ELSE 0 END AS CNT4 /* 부서별 인원 - 구매 */
		, CASE WHEN DEPT_CD = 'MEM_CD02006' THEN COUNT(e.DEPT_CD) ELSE 0 END AS CNT5 /* 부서별 인원 - 경영지원 */
		, CASE WHEN DEPT_CD = 'MEM_CD02007' THEN COUNT(e.DEPT_CD) ELSE 0 END AS CNT6 /* 부서별 인원 - 업체평가 */
		, CASE WHEN DEPT_CD = 'MEM_CD02008' THEN COUNT(e.DEPT_CD) ELSE 0 END AS CNT7 /* 부서별 인원 - 안전 */
		, CASE WHEN DEPT_CD = 'MEM_CD02009' THEN COUNT(e.DEPT_CD) ELSE 0 END AS CNT8 /* 부서별 인원 - ESG */
		, CASE WHEN DEPT_CD = 'MEM_CD02010' THEN COUNT(e.DEPT_CD) ELSE 0 END AS CNT9 /* 부서별 인원 - 기타 */

		, CASE WHEN PSTN_CD = 'MEM_CD01001' THEN COUNT(e.PSTN_CD) ELSE 0 END AS CNT01 /* 직급별 인원 - 대표 */
		, CASE WHEN PSTN_CD = 'MEM_CD01002' THEN COUNT(e.PSTN_CD) ELSE 0 END AS CNT02 /* 직급별 인원 - 임원 */
		, CASE WHEN PSTN_CD = 'MEM_CD01003' THEN COUNT(e.PSTN_CD) ELSE 0 END AS CNT03 /* 직급별 인원 - 부장 */
		, CASE WHEN PSTN_CD = 'MEM_CD01004' THEN COUNT(e.PSTN_CD) ELSE 0 END AS CNT04 /* 직급별 인원 - 과장/차장 */
		, CASE WHEN PSTN_CD = 'MEM_CD01005' THEN COUNT(e.PSTN_CD) ELSE 0 END AS CNT05 /* 직급별 인원 - 사원/대리 */
		, CASE WHEN PSTN_CD = 'MEM_CD01006' THEN COUNT(e.PSTN_CD) ELSE 0 END AS CNT06 /* 직급별 인원 - 조장/반창(계장) */
		, CASE WHEN PSTN_CD = 'MEM_CD01007' THEN COUNT(e.PSTN_CD) ELSE 0 END AS CNT07 /* 직급별 인원 - 기타 */

		, case TIMESTAMPDIFF(DAY, edctn_strt_dtm, edctn_end_dtm) when 0 then 1
		ELSE TIMESTAMPDIFF(DAY, edctn_strt_dtm, edctn_end_dtm)
		END AS edu_day
		, m.atndc_cnt
		, (SELECT COUNT(ptcpt_seq) FROM ep_edctn_ptcpt_mst  WHERE episd_seq = a.episd_seq ) AS ptcpt_cnt
		, '' AS A11
		<!-- , ifnull(round((COUNT(i.atndc_dtm) / COUNT(i.edctn_dt))*100,1), 0) AS A11 -->/*출석률*/
		, ROUND(avg(exam_score), 2) AS AVG_score /*평가 점수*/
		, vrll_avrg AS A_12 /* 종합 평균 */
		, ttl_co_score AS A_13 /* 전체(공통) */
		, edctn_envrnmt_score AS A_14 /* 교육환경 */
		, edctn_spprt_score AS A_15 /* 교육지원 */
		, edctn_cntn_score AS A_16 /* 교육내용 */
		, isttr_score AS A_17 /* 강사 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD03001' THEN pmt ELSE NULL END) AS pmt_c1/* 강사시간1 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD03002' THEN pmt ELSE NULL END) AS pmt_c2/* 강사시간2 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD03003' THEN pmt ELSE NULL END) AS pmt_c3/* 강사시간3 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD03004' THEN pmt ELSE NULL END) AS pmt_c4/* 강사시간4 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD03005' THEN pmt ELSE NULL END) AS pmt_c5/* 강사시간5 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD03006' THEN pmt ELSE NULL END) AS pmt_c6/* 강사시간6 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD01001' THEN pmt ELSE NULL END) AS pmt_a1 /* 부담금/대관비 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD01002' THEN pmt ELSE NULL END) AS pmt_a2 /* 강사비 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD01003' THEN pmt ELSE NULL END) AS pmt_a3 /* 교재비 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD01004' THEN pmt ELSE NULL END) AS pmt_a4 /* 식대 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD01005' THEN pmt ELSE NULL END) AS pmt_a5 /* 다과비 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD01006' THEN pmt ELSE NULL END) AS pmt_a6 /* 소모품비 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD01007' THEN pmt ELSE NULL END) AS pmt_a7 /* 발송비 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD01008' THEN pmt ELSE NULL END) AS pmt_a8 /* 재료비 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD01009' THEN pmt ELSE NULL END) AS pmt_a9 /* 집행비 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD01010' THEN pmt ELSE NULL END) AS pmt_a10 /* 기타(원) */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD01011' THEN etc_nm ELSE NULL END) AS pmt_a11 /* 비고 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD02001' THEN pmt ELSE NULL END) AS pmt_b1 /* 부담금/대관비 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD02002' THEN pmt ELSE NULL END) AS pmt_b2 /* 강사비 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD02003' THEN pmt ELSE NULL END) AS pmt_b3 /* 교재비 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD02004' THEN pmt ELSE NULL END) AS pmt_b4 /* 식대 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD02005' THEN pmt ELSE NULL END) AS pmt_b5 /* 다과비 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD02006' THEN pmt ELSE NULL END) AS pmt_b6 /* 소모품비 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD02007' THEN pmt ELSE NULL END) AS pmt_b7 /* 발송비 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD02008' THEN pmt ELSE NULL END) AS pmt_b8 /* 재료비 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD02009' THEN pmt ELSE NULL END) AS pmt_b9 /* 집행비 */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD02010' THEN pmt ELSE NULL END) AS pmt_b10 /* 기타(원) */
		, MAX(CASE bd_cd WHEN 'ED_BDGET_CD02011' THEN etc_nm ELSE NULL END) AS pmt_b11 /* 비고 */
		, (SELECT name from cp_isttr_mst WHERE isttr_seq = g.r1) AS isttrNm1
		, (SELECT name from cp_isttr_mst WHERE isttr_seq = g.r2) AS isttrNm2
		, (SELECT name from cp_isttr_mst WHERE isttr_seq = g.r3) AS isttrNm3
		, (SELECT name from cp_isttr_mst WHERE isttr_seq = g.r4) AS isttrNm4
		, (SELECT name from cp_isttr_mst WHERE isttr_seq = g.r5) AS isttrNm5
		, (SELECT name from cp_isttr_mst WHERE isttr_seq = g.r6) AS isttrNm6
		, a.reg_dtm
		, a.reg_ip
		, a.reg_id
		FROM (
			SELECT * FROM ed_edctn_episd_mst AA WHERE 1=1
			AND edctn_strt_dtm <![CDATA[>=]]> DATE_FORMAT(#{strtDt}, '%Y-%m-%d 00:00:00')
			AND edctn_end_dtm <![CDATA[<=]]> DATE_FORMAT(#{endDt}, '%Y-%m-%d 23:59:59')
			ORDER BY EPISD_SEQ DESC,EPISD_YEAR DESC, EPISD_ORD DESC
		) a
		LEFT JOIN ed_edctn_prcs_mst b ON b.edctn_seq = a.edctn_seq
		LEFT OUTER JOIN ( SELECT CD AS bd_cd, PMT, ETC_NM, EDCTN_SEQ, EPISD_ORD, EPISD_YEAR FROM ed_edctn_bdget_expns_dtl) C ON c.EDCTN_SEQ = a.EDCTN_SEQ AND c.EPISD_ORD = a.EPISD_ORD AND c.EPISD_YEAR = a.EPISD_YEAR

		LEFT OUTER JOIN ( SELECT MEM_SEQ, srv_seq, rfnc_seq, rfnc_cd FROM sv_rspn_mst ) d ON A.srv_seq = d.srv_seq AND d.rfnc_seq = A.episd_seq AND d.rfnc_cd = 'EDU'
		LEFT OUTER JOIN ( SELECT MEM_SEQ, MEM_CD, DEPT_CD, PSTN_CD FROM co_mem_mst where mem_cd = 'CP' ) e ON d.mem_seq = e.mem_seq
		LEFT OUTER JOIN (
		SELECT CD FROM co_code_mst
		WHERE PARNT_SEQ IN (
		SELECT CD_SEQ FROM CO_CODE_MST
		WHERE CD IN ('MEM_CD01', 'MEM_CD02')
		)
		) T2 ON e.DEPT_CD = T2.CD
		LEFT OUTER JOIN( SELECT exam_score, edctn_seq, episd_year, episd_ord FROM ep_edctn_ptcpt_mst) f ON f.edctn_seq = a.edctn_seq AND f.episd_year = a.episd_year AND f.episd_ord = a.episd_ord
		LEFT JOIN (SELECT
		isttr_tb.edctn_seq
		,isttr_tb.episd_seq
		,isttr_tb.episd_year
		,isttr_tb.episd_ord
		,isttr_tb.isttr_seq
		,MAX(CASE WHEN orders = 1 THEN isttr_seq ELSE NULL END) AS r1
		,MAX(CASE WHEN orders = 2 THEN isttr_seq ELSE NULL END) AS r2
		,MAX(CASE WHEN orders = 3 THEN isttr_seq ELSE NULL END) AS r3
		,MAX(CASE WHEN orders = 4 THEN isttr_seq ELSE NULL END) AS r4
		,MAX(CASE WHEN orders = 5 THEN isttr_seq ELSE NULL END) AS r5
		,MAX(CASE WHEN orders = 6 THEN isttr_seq ELSE NULL END) AS r6
		FROM (
		SELECT
		aaa.edctn_seq
		,aaa.episd_year
		,aaa.episd_ord
		,aaa.episd_seq
		,b2.isttr_seq
		,(SELECT COUNT(*) FROM ed_edctn_isttr_rel g2 WHERE g2.edctn_seq = aaa.edctn_seq AND g2.episd_year = aaa.episd_year AND g2.episd_ord = aaa.episd_ord AND g2.isttr_seq <![CDATA[<=]]> b2.isttr_seq) AS orders
		FROM ed_edctn_episd_mst aaa
		LEFT JOIN ed_edctn_isttr_rel b2 ON b2.edctn_seq = aaa.edctn_seq AND b2.episd_year = aaa.episd_year AND b2.episd_ord = aaa.episd_ord
		) AS isttr_tb
		GROUP BY isttr_tb.episd_seq) g ON g.edctn_seq = a.edctn_seq AND g.episd_year = a.episd_year AND g.episd_ord = a.episd_ord
		LEFT JOIN (SELECT ptcpt_seq, ptcpt_bsnm_no, edctn_seq, episd_year, episd_ord, stts_cd from ep_edctn_ptcpt_mst WHERE stts_cd = 'EDU_STTS_CD01' GROUP BY ptcpt_seq) h ON h.edctn_seq = a.edctn_seq AND h.episd_year = a.episd_year AND h.episd_ord = a.episd_ord
		LEFT JOIN (SELECT ptcpt_seq AS at_ptcpt_seq, edctn_dt, atndc_dtm FROM ep_edctn_atndc_dtl) i ON i.at_ptcpt_seq = h.ptcpt_seq
		LEFT JOIN(
		SELECT
		ctgry_cd
		, COUNT(ctgry_cd) AS ct_cnt
		, episdmst.episd_seq
		FROM cp_cmpn_mst cmpn
		inner JOIN ep_edctn_ptcpt_mst ptcpt on cmpn.BSNM_NO = ptcpt.ptcpt_bsnm_no
		inner JOIN ed_edctn_episd_mst episdmst ON episdmst.episd_seq = ptcpt.episd_seq
		GROUP BY episd_seq, ctgry_cd
		) j ON j.episd_seq = a.episd_seq
		LEFT JOIN(
		SELECT
		rslt_seq
		, edctn_seq
		, episd_year
		, episd_ord
		, episd_seq
		, vrll_avrg
		, ttl_co_score
		, edctn_envrnmt_score
		, edctn_spprt_score
		, edctn_cntn_score
		, isttr_score
		, ttl_ptcpt_cnt
		FROM ed_edctn_srv_rslt_dtl
		) k ON k.episd_seq = a.episd_seq

		LEFT JOIN(

		SELECT
		episd_seq
		, SUM((SELECT COUNT(atndc_dtm) FROM ep_edctn_atndc_dtl WHERE ptcpt_seq = a.ptcpt_seq)) AS atndc_cnt
		from ep_edctn_ptcpt_mst a
		GROUP BY a.episd_seq

		) m ON m.episd_seq = a.episd_seq

		GROUP BY a.episd_seq, a.episd_ord



		) AA

		<include refid="selectEpisdListwhereSql" />

		GROUP BY a.episd_ord

	</select>



	<!--
  쿼리명 : EBBEpisdMapper.selectEpisdDtlCheck
  설  명 : 교육차수 상세를 조회한다.
   수정일     수정자       수정내용
 ==========   ======    ==============
 2024.01.15   박준희       최초생성
 -->
	<select id="selectEpisdDtlCheck" parameterType="EBBEpisdDTO" resultType="EBBEpisdSurveyDTO">
		SELECT /*EBBEpisdMapper.selectEpisdDtlCheck*/
		    DISTINCT
			A.EDCTN_SEQ
			, A.EPISD_YEAR
			, A.EPISD_ORD
			, A.EPISD_SEQ
		    , A.SRV_SEQ
			, (SELECT NM FROM ED_EDCTN_PRCS_MST WHERE EDCTN_SEQ = A.EDCTN_SEQ) AS NM
			, (SELECT COUNT(SRV_SEQ) FROM SV_QSTN_DTL WHERE SRV_SEQ = B.SRV_SEQ) AS QSTN_CNT
			, (SELECT COUNT(SRV_RSPN_SEQ) FROM SV_RSPN_MST WHERE SRV_SEQ = B.SRV_SEQ AND RFNC_SEQ = A.EPISD_SEQ AND RFNC_CD = 'EDU' AND MEM_SEQ = C.MEM_SEQ) AS RSPN_CNT
			, B.RSPN_MM
			, B.CNTN
			, C.MEM_SEQ
			, C.PTCPT_SEQ
		    , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = D.CTGRY_CD) AS CTGRY_CD_NM
			, (SELECT CD_NM FROM CO_CODE_MST WHERE CD_SEQ = (SELECT PARNT_SEQ FROM CO_CODE_MST WHERE CD = D.CTGRY_CD)) AS PRNT_CD_NM
			, (SELECT GROUP_CONCAT(name SEPARATOR ', ') from cp_isttr_mst WHERE isttr_seq in (SELECT isttr_seq FROM ed_edctn_isttr_rel WHERE edctn_seq = A.edctn_seq AND episd_ord = A.episd_ord AND episd_year = A.episd_year )) AS isttr_group_name
			, (select cd_nm from co_code_mst WHERE cd = A.cbsn_cd) as cbsn_cd_nm
		FROM  ED_EDCTN_EPISD_MST A
    	LEFT JOIN SV_MST B ON A.SRV_SEQ = B.SRV_SEQ
		LEFT JOIN EP_EDCTN_PTCPT_MST C ON A.EPISD_SEQ = C.EPISD_SEQ
		LEFT JOIN ED_EDCTN_PRCS_MST D ON A.EDCTN_SEQ = D.EDCTN_SEQ
		WHERE
			A.EDCTN_SEQ = #{detailsKey}
			AND A.EPISD_YEAR = #{episdYear}
			AND A.EPISD_ORD = #{episdOrd}
			AND C.MEM_SEQ = #{memSeq}
	</select>


	<!--
	  쿼리명 : EBBEpisdMapper.setOnlinePtcptInfo
	  설  명 : 교육차수 상세를 조회한다.
	   수정일     수정자       수정내용
	 ==========   ======    ==============
	 2024.01.15   박준희       최초생성
	 -->
	<insert id="setOnlinePtcptInfo" parameterType="EBBPtcptDTO">
		INSERT INTO ep_edctn_lctr_dtl ( /* EBBEpisdMapper.setOnlinePtcptInfo */
			ptcpt_seq,
			lctr_seq,
			edctn_seq,
			episd_ord,
			episd_year,
			episd_seq,
			reg_id,
			reg_ip,
			reg_dtm,
			mod_id,
			mod_ip,
			mod_dtm
		) VALUES (
			 #{ptcptSeq}
			 , #{lctrSeq}
			 , #{edctnSeq}
			 , #{episdOrd}
			 , #{episdYear}
			 , #{episdSeq}
			 , #{regId}
			 , #{regIp}
			 , NOW()
			 , #{modId}
			 , #{modIp}
			 , NOW()
				 ) ON DUPLICATE KEY UPDATE
			mod_id = VALUES(mod_id)
			, mod_ip = VALUES(mod_ip)
			, mod_dtm = now();
	</insert>


	<!--
      쿼리명 : EBBEpisdMapper.updateAtndcInfo
      설  명 : 마이페이지 - 출석체크를 진행한다.
       수정일     수정자       수정내용
     ==========   ======    ==============
     2024.01.17   김학규       최초생성
 	-->
	<update id="updateAtndcInfo" parameterType="EBBEpisdDTO" >

		UPDATE ep_edctn_atndc_dtl /* EBBEpisdMapper.updateAtndcInfo */
			SET atndc_dtm = NOW()
				  , mod_id = #{modId}
				  , mod_ip = #{modIp}
				  , mod_dtm = now()

			WHERE ptcpt_seq = #{ptcptSeq}
			  AND edctn_dt =  DATE_FORMAT(NOW(), '%Y-%m-%d')

	</update>

	<!--
      쿼리명 : EBBEpisdMapper.updateLvgrmInfo
      설  명 : 마이페이지 - 출석체크를 진행한다.
       수정일     수정자       수정내용
     ==========   ======    ==============
     2024.01.17   김학규       최초생성
 	-->
	<update id="updateLvgrmInfo" parameterType="EBBEpisdDTO" >

		UPDATE ep_edctn_atndc_dtl /* EBBEpisdMapper.updateLvgrmInfo */
		SET lvgrm_dtm = NOW()
		  , mod_id = #{modId}
		  , mod_ip = #{modIp}
		  , mod_dtm = now()

		WHERE ptcpt_seq = #{ptcptSeq}
		  AND edctn_dt =  DATE_FORMAT(NOW(), '%Y-%m-%d')

	</update>

	<!--
      쿼리명 : EBBEpisdMapper.updateApplyCancel
      설  명 : 마이페이지 - 교육신청을 취소한다
       수정일     수정자       수정내용
     ==========   ======    ==============
     2024.01.17   김학규       최초생성
 	-->
	<update id="updateApplyCancel" parameterType="EBBEpisdDTO" >
		UPDATE ep_edctn_ptcpt_mst SET /* EBBEpisdMapper.updateApplyCancel */
			stts_cd = 'EDU_STTS_CD02'
			, mod_id = #{modId}
			, mod_ip = #{modIp}
			, mod_dtm = now()
		WHERE 1=1
		  and ptcpt_seq = #{ptcptSeq}
	</update>

	<!--
      쿼리명 : EBBEpisdMapper.selectTrnsfLog
      설  명 : 교육차수 - 신청자 등록 전 확인
       수정일     수정자       수정내용
     ==========   ======    ==============
     2024.01.23   김학규       최초생성
 	-->
	<select id="selectTrnsfLog" parameterType="EBBPtcptDTO" resultType="EBBPtcptDTO">
		SELECT /* EBBEpisdMapper.selectTrnsfLog */
			*
		FROM ep_edctn_trnsf_dtl
		WHERE 1=1
			AND ptcpt_seq = #{ptcptSeq}
		  	AND bfre_mem_seq = #{aftrMemSeq}
	</select>

	<!--
      쿼리명 : EBBEpisdMapper.updatePtcptInfo
      설  명 : 마이페이지 - 교육양도 진행
       수정일     수정자       수정내용
     ==========   ======    ==============
     2024.01.23   김학규       최초생성
 	-->
	<update  id="updatePtcptInfo" parameterType="EBBPtcptDTO">
		UPDATE ep_edctn_ptcpt_mst /* EBBEpisdMapper.updatePtcptInfo */
		SET mem_seq = #{aftrMemSeq}
		  , gpc_id = #{gpcId}
		  , mod_id = #{modId}
		  , mod_ip = #{modIp}
		  , mod_dtm = NOW()
		WHERE ptcpt_seq = #{ptcptSeq}

	</update>





	<!--
      쿼리명 : EBBEpisdMapper.insertTrnsfLog
      설  명 : 마이페이지 - 교육양도 로그 등록
       수정일     수정자       수정내용
     ==========   ======    ==============
     2024.01.23   김학규       최초생성
 	-->
	<insert id="insertTrnsfLog" parameterType="EBBPtcptDTO">
		insert into /*EBBEpisdMapper.insertTrnsfLog*/ ep_edctn_trnsf_dtl
		(
			trnsf_seq
			, ptcpt_seq
			, bfre_mem_seq
			, aftr_mem_seq
			, reg_id
			, reg_ip
			, reg_dtm
			, mod_id
			, mod_ip
			, mod_dtm
		)
		VALUES(
			#{trnsfSeq}
			, #{ptcptSeq}
			, #{bfreMemSeq}
			, #{aftrMemSeq}
			, #{regId}
			, #{regIp}
			, now()
			, #{modId}
			, #{modIp}
			, now()
		)
	</insert>

	<!--
      쿼리명 : EBBEpisdMapper.selectRelCmptnInfo
      설  명 : 교육 신청시 신청자의 교육과정연계 과정 수료여부 확인
       수정일     수정자       수정내용
     ==========   ======    ==============
     2024.01.25   김학규       최초생성
 	-->
	<select id="selectRelCmptnInfo" parameterType="EBBPtcptDTO" resultType="EBBPtcptDTO">
		SELECT /* EBBEpisdMapper.selectRelCmptnInfo */
			SUM(REL_CNT) AS REL_CNT
			 , CASE WHEN sum(REL_CMPTN_YN) <![CDATA[>=]]> SUM(REL_CNT) THEN 'Y' ELSE 'N' END AS REL_CMPTN_YN
		FROM (SELECT
				  A.EDCTN_SEQ
				   , B.CNNCT_EDCTN_SEQ
				   , COUNT(CNNCT_EDCTN_SEQ) AS REL_CNT
				   , (SELECT COUNT(CMPTN_YN) FROM ep_edctn_ptcpt_mst WHERE EDCTN_SEQ = B.CNNCT_EDCTN_SEQ AND MEM_SEQ = #{memSeq} AND CMPTN_YN = 'Y' ) AS REL_CMPTN_YN
			  FROM ed_edctn_prcs_mst A
					   LEFT JOIN(
				  SELECT
					  CNNCT_EDCTN_SEQ
					   , EDCTN_SEQ
					   , CNNCT_CD
				  FROM ed_edctn_rel_dtl
				  WHERE CNNCT_CD = 'EDCTN_REL03'
			  ) B ON B.EDCTN_SEQ = A.EDCTN_SEQ

			  WHERE 1=1
				AND A.EDCTN_SEQ = #{edctnSeq}
			  GROUP BY CNNCT_EDCTN_SEQ
			 ) AA
	</select>


	<!--
      쿼리명 : EBBEpisdMapper.selectPtcptCmptnChk
      설  명 : 마이페이지 - 참여자의 수료가능여부 체크
       수정일     수정자       수정내용
     ==========   ======    ==============
     2024.01.24   김학규       최초생성
 	-->
	<select id="selectPtcptCmptnChk" parameterType="EBBEpisdDTO" resultType="EBBEpisdDTO">
		SELECT /* EBBEpisdMapper.selectPtcptCmptnChk */
			ptcpt_seq
			 , edctn_seq
			 , episd_year
			 , episd_ord
			 , episd_seq
			 , exam_score
		     , cmptn_yn
		     , cmptn_auto_yn
			 , cmptn_stnd_cd_nm
			 , cmptn_jdgmt_cd_nm
		     , lcns_cnnct_cd
			 , jdgmt_yn
			 , atndc_info
			 , ptcpt_info
			 , lcrt_info
			 , CASE WHEN stduy_mthd_cd = 'STDUY_MTHD02'
						THEN
						CASE WHEN IFNULL(ROUND((PTCPT_INFO/LCRT_INFO)*100, 0), 0) <![CDATA[>=]]> cmptn_stnd_cd_nm
								 THEN
								 /*시험여부가 Y면 시험점수 비교하여 수료여부 판단*/
								 CASE WHEN jdgmt_yn = 'Y'
										  THEN
										  CASE WHEN exam_score <![CDATA[>=]]>  cmptn_jdgmt_cd_nm THEN 'Y' ELSE 'N' END
									  ELSE
										  /*시험여부 N이면 시험점수 비교없이 바로 수료처리*/
										  CASE WHEN jdgmt_yn = 'N' THEN 'Y' END
									 END
							 ELSE	'N'

							END
					ELSE
						CASE WHEN ATNDC_INFO <![CDATA[>=]]>  cmptn_stnd_cd_nm
								 THEN
								 CASE WHEN jdgmt_yn = 'Y'
										  THEN
										  /*시험여부가 Y면 시험점수 비교하여 수료여부 판단*/
										  CASE WHEN exam_score <![CDATA[>=]]>  cmptn_jdgmt_cd_nm THEN 'Y' ELSE 'N'END
									  ELSE
										  /*시험여부 N이면 시험점수 비교없이 바로 수료처리*/
										  CASE WHEN jdgmt_yn = 'N' THEN 'Y' END
									 END
							 ELSE 'N'
							END
			END

			AS PTCPT_CMTN_YN

		FROM (SELECT
				A.PTCPT_SEQ
				, B.EDCTN_SEQ
				, B.EPISD_YEAR
				, B.EPISD_ORD
				, B.EPISD_SEQ
				, c.cmptn_stnd_cd_nm
				, c.cmptn_jdgmt_cd_nm
				, c.jdgmt_yn
				, c.stduy_mthd_cd
				, c.lcns_cnnct_cd
				, a.exam_score
		        , cmptn_yn
		    	, b.cmptn_auto_yn
				, (SELECT IFNULL(ROUND((count(atndc_dtm) / COUNT(edctn_dt))*100, 0), 0) AS atndc_avg FROM ep_edctn_atndc_dtl WHERE ptcpt_Seq = A.PTCPT_SEQ) AS ATNDC_INFO
				, (SELECT COUNT(*) from ep_edctn_lctr_dtl WHERE PTCPT_SEQ = A.PTCPT_SEQ AND EDCTN_SEQ = B.EDCTN_SEQ AND EPISD_YEAR = B.EPISD_YEAR AND B.EPISD_ORD) AS PTCPT_INFO
				, (SELECT COUNT(*) from ed_edctn_lctr_dtl WHERE EDCTN_SEQ = #{edctnSeq} AND EPISD_YEAR = #{episdYear} AND EPISD_ORD = #{episdOrd}) AS LCRT_INFO
		FROM ep_edctn_ptcpt_mst A
		LEFT JOIN (
			SELECT
				EDCTN_SEQ
				, EPISD_SEQ
				, EPISD_YEAR
				, EPISD_ORD
				, cmptn_auto_yn
			FROM ed_edctn_episd_mst
			where 1=1

		) B ON B.EPISD_SEQ = A.EPISD_SEQ

		LEFT JOIN(
			SELECT
				edctn_seq
				, (select cd_nm from co_code_mst where cd = tbl.cmptn_stnd_cd) as cmptn_stnd_cd_nm
				, (select cd_nm from co_code_mst where cd = tbl.cmptn_jdgmt_cd) as cmptn_jdgmt_cd_nm
				, jdgmt_yn
				, stduy_mthd_cd
				, lcns_cnnct_cd
			from ed_edctn_prcs_mst tbl
			where 1=1



		) c ON c.edctn_seq = b.edctn_seq

		WHERE MEM_SEQ = #{memSeq}
		AND PTCPT_SEQ = #{ptcptSeq}

		) A
	</select>

	<!--
          쿼리명 : EBBEpisdMapper.selectCmptnNo
          설  명 : 마이페이지 - 수료번호 추출
           수정일     수정자       수정내용
         ==========   ======    ==============
         2024.01.24   김학규       최초생성
	 -->
	<select id="selectCmptnNo" parameterType="EBBEpisdDTO" resultType="EBBEpisdDTO">
		SELECT
			GROUP_CONCAT('KAP-', AA.CTGRY_CD, AA.EPISD_YEAR, AA.cmptn_no) AS crtfct_no
		FROM (SELECT
				  C.CTGRY_CD
				   , MAX(A.EPISD_YEAR) AS EPISD_YEAR
				   , (SELECT
						  LPAD(COUNT(*)+1, '5' , '0') AS cmptn_no
					  FROM ep_edctn_ptcpt_mst
					  WHERE CMPTN_YN = 'Y'
						AND EDCTN_SEQ = #{edctnSeq} AND EPISD_YEAR = #{episdYear}) AS cmptn_no
			  FROM ed_edctn_episd_mst A
					   LEFT JOIN(
				  SELECT EDCTN_SEQ, CTGRY_CD FROM ed_edctn_prcs_mst
			  ) C ON C.EDCTN_SEQ = A.EDCTN_SEQ

			  WHERE 1=1
				AND A.EDCTN_SEQ = #{edctnSeq} AND A.EPISD_YEAR = #{episdYear}
			 ) AA
	</select>


	<!--
          쿼리명 : EBBEpisdMapper.updatePtcptCmptnInfo
          설  명 : 마이페이지 - 수료진행
           수정일     수정자       수정내용
         ==========   ======    ==============
         2024.01.24   김학규       최초생성
	 -->
	<update id="updatePtcptCmptnInfo" parameterType="EBBEpisdDTO">
		UPDATE /* EBBEpisdMapper.updatePtcptCmptnInfo */ ep_edctn_ptcpt_mst
			SET cmptn_yn = 'Y'
		  	, cmptn_dtm = now()
			, crtfct_no = #{crtfctNo}
			, mod_id = #{modId}
			, mod_ip = #{modIp}
			, mod_dtm = now()
		where ptcpt_seq = #{ptcptSeq}
	</update>

	<!--
          쿼리명 : EBBEpisdMapper.selectPtcptDtl
          설  명 : 마이페이지 - 수료진행
           수정일     수정자       수정내용
         ==========   ======    ==============
         2024.01.24   김학규       최초생성
	 -->
	<select id="selectPtcptExamDtl" parameterType="EBBPtcptDTO" resultType="EBBPtcptDTO">
		SELECT
		    EDCTN_SEQ
			, EPISD_SEQ
			, EPISD_YEAR
			, EPISD_ORD
			, MEM_SEQ
			, PTCPT_SEQ
			, CMPTN_YN
			, CMPTN_DTM
			, crtfct_no
		FROM ep_edctn_ptcpt_mst
		where ptcpt_seq = #{ptcptSeq}
	</select>



	<!--
          쿼리명 : EBBEpisdMapper.selectPtcptDupleChk
          설  명 : 차수관리 > 차수변경 진행중 이미 등록된 회원인지 중복체크
           수정일     수정자       수정내용
         ==========   ======    ==============
         2024.01.24   김학규       최초생성
	 -->
	<select id="selectPtcptDupleChk" parameterType="EBBEpisdDTO" resultType="java.lang.Integer">
		SELECT /* EBBEpisdMapper.selectPtcptDupleChk */
			COUNT(*)
		from ep_edctn_ptcpt_mst
		WHERE 1=1

		AND edctn_Seq = #{edctnSeq}
		AND episd_Year = #{episdYear}
		AND episd_Ord = #{episdOrd}
		AND mem_SEQ IN (
										SELECT MEM_SEQ FROM ep_edctn_ptcpt_mst WHERE PTCPT_SEQ IN
																												<foreach collection="ptcptList" item="ptcptList" index="index" separator=", " open="(" close=")">
																													#{ptcptList.ptcptSeq}
																												</foreach>
									)
	</select>
</mapper>


