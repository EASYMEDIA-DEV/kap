<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kap.service.dao.mp.MPEPartsCompanyMapper">
    <!--
         쿼리명 : MPEPartsCompanyMapper.selectPartsCompanyList
         설  명 : 부품사 목록을 조회한다.
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.11.09   구은희       최초생성
    -->
    <select id="selectPartsCompanyList" parameterType="MPEPartsCompanyDTO">
        SELECT /* MPEPartsCompanyMapper.selectPartsCompanyList */
            BSNM_NO
            , RPRSNT_NM
            , CMPN_NM
            , CMPN_CD
            , CTGRY_CD
            , (SELECT CD_NM FROM CO_CODE_MST WHERE CD_ID = 'COMPANY_TYPE' AND CD = A.CTGRY_CD) AS CTGRY_NM
            , SIZE_CD
            , (SELECT CD_NM FROM CO_CODE_MST WHERE CD_ID = 'COMPANY_TYPE' AND CD = A.SIZE_CD) AS SIZE_NM
            , BSNM_NO
            , BSC_ADDR
            , DTL_ADDR
            , SLS_PMT
            , MPLE_CNT
            , TEL_NO
            , STBSM_DT
            , ZIPCODE
            , TEL_NO
            , MJR_PRDCT_1
            , MJR_PRDCT_2
            , MJR_PRDCT_3
            , QLTY_5_STAR_CD
            , (SELECT CD_NM FROM CO_CODE_MST WHERE CD_ID = 'COMPANY_TYPE' AND CD = A.QLTY_5_STAR_CD) AS QLTY_5_STAR_CD_NM
            , QLTY_5_STAR_YEAR
            , PAY_5_STAR_CD
            , (SELECT CD_NM FROM CO_CODE_MST WHERE CD_ID = 'COMPANY_TYPE' AND CD = A.PAY_5_STAR_CD) AS PAY_5_STAR_CD_NM
            , PAY_5_STAR_YEAR
            , TCHLG_5_STAR_CD
            , (SELECT CD_NM FROM CO_CODE_MST WHERE CD_ID = 'COMPANY_TYPE' AND CD = A.TCHLG_5_STAR_CD) AS TCHLG_5_STAR_CD_NM
            , TCHLG_5_STAR_YEAR
            , REG_ID
            , (SELECT NAME FROM CO_MEM_MST WHERE ID = A.REG_ID) AS REG_USER_NAME -- 사용자이름
            , (SELECT NAME FROM CO_ADM_MST WHERE ID = A.REG_ID) AS REG_NAME -- 관리자이름
            , REG_IP
            , REG_DTM
            , MOD_ID
            , (SELECT NAME FROM CO_MEM_MST WHERE ID = A.MOD_ID) MOD_USER_NAME -- 사용자이름
            , (SELECT NAME FROM CO_ADM_MST WHERE ID = A.MOD_ID) AS MOD_NAME -- 관리자이름
            , MOD_IP
            , MOD_DTM
        <if test="srchDate != null and srchDate != ''.toString() ">
            , #{srchDate} AS 'srchDate'
        </if>
        <if test="dStrDt != null and dStrDt != ''.toString() ">
            , #{dStrDt} AS 'dStrDt'
        </if>
        <if test="dEndDt != null and dEndDt != ''.toString() ">
            , #{dEndDt} AS 'dEndDt'
        </if>
        FROM CP_CMPN_MST A
        <include refid="selectPartsComListwhereSql" />
        ORDER BY
            REG_DTM DESC
        <if test="excelYn != 'Y'.toString() ">
            LIMIT #{firstIndex}, #{recordCountPerPage}
        </if>
    </select>

    <!--
         쿼리명 : MPEPartsCompanyMapper.selectPartsCompanyCnt
         설  명 : 부품사 개수를 조회한다.
          수정일      수정자       수정내용
        ==========   ========   ==============
        2023.11.09    구은희       최초생성
    -->
    <select id="selectPartsCompanyCnt" parameterType="MPEPartsCompanyDTO" resultType="java.lang.Integer">
        SELECT /* MPEPartsCompanyMapper.selectPartsCompanyCnt*/
            COUNT(BSNM_NO)
        FROM
        CP_CMPN_MST A
        <include refid="selectPartsComListwhereSql" />
    </select>

    <!--
         쿼리명 : MPEPartsCompanyMapper.selectPartsCompanyDtl
         설  명 : 부품사 상세를 조회한다.
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.11.09   구은희       최초생성
    -->
    <select id="selectPartsCompanyDtl" parameterType="MPEPartsCompanyDTO">
        SELECT /* MPEPartsCompanyMapper.selectPartsCompanyDtl */
             A.BSNM_NO
             , A.CMPN_NM
             , A.RPRSNT_NM
             , A.CMPN_NFRML_NM
             , A.CMPN_CD
             , A.CTGRY_CD
             , (select cd_nm from co_code_mst where cd = A.CTGRY_CD) as CTGRY_NM
             , A.SIZE_CD
             , (select cd_nm from co_code_mst where cd = A.SIZE_CD) as SIZE_NM
             , A.STBSM_DT
             , A.TEL_NO
             , A.ZIPCODE
             , A.BSC_ADDR
             , A.DTL_ADDR
             , A.SLS_PMT
             , A.SLS_YEAR
             , A.MPLE_CNT
             , A.MJR_PRDCT_1
             , A.MJR_PRDCT_2
             , A.MJR_PRDCT_3
             , QLTY_5_STAR_CD
             , (SELECT CD_NM FROM CO_CODE_MST WHERE CD_ID = 'COMPANY_TYPE' AND CD = A.QLTY_5_STAR_CD) AS QLTY_5_STAR_CD_NM
             , A.QLTY_5_STAR_YEAR
             , (SELECT CD_NM FROM CO_CODE_MST WHERE CD_ID = 'COMPANY_TYPE' AND CD = A.QLTY_5_STAR_CD) AS QLTY_5_STAR_CD_NM
             , A.PAY_5_STAR_CD
             , (SELECT CD_NM FROM CO_CODE_MST WHERE CD_ID = 'COMPANY_TYPE' AND CD = A.PAY_5_STAR_CD) AS PAY_5_STAR_CD_NM
             , A.PAY_5_STAR_YEAR
             , (SELECT CD_NM FROM CO_CODE_MST WHERE CD_ID = 'COMPANY_TYPE' AND CD = A.PAY_5_STAR_CD) AS PAY_5_STAR_CD_NM
             , A.TCHLG_5_STAR_CD
             , (SELECT CD_NM FROM CO_CODE_MST WHERE CD_ID = 'COMPANY_TYPE' AND CD = A.TCHLG_5_STAR_CD) AS TCHLG_5_STAR_CD_NM
             , A.TCHLG_5_STAR_YEAR
             , (SELECT CD_NM FROM CO_CODE_MST WHERE CD_ID = 'COMPANY_TYPE' AND CD = A.TCHLG_5_STAR_CD) AS TCHLG_5_STAR_CD_NM
             , A.ADM_MEMO
             , (SELECT NAME FROM CO_ADM_MST WHERE ID = A.REG_ID) AS REG_NAME
             , A.REG_ID
             , (SELECT NAME FROM CO_MEM_MST WHERE ID = A.REG_ID) AS REG_USER_NAME -- 사용자이름
             , (SELECT NAME FROM CO_ADM_MST WHERE ID = A.REG_ID) AS REG_NAME -- 관리자이름
             , A.REG_IP
             , A.REG_DTM
             , A.MOD_ID
             , (SELECT NAME FROM CO_MEM_MST WHERE ID = A.MOD_ID) MOD_USER_NAME -- 사용자이름
             , (SELECT NAME FROM CO_ADM_MST WHERE ID = A.MOD_ID) AS MOD_NAME -- 관리자이름
             , A.MOD_IP
             , A.MOD_DTM
             , B.cbsn_seq
             , B.nm
             , B.score
             , B.year
             , B.crtfn_cmpn_nm
        FROM cp_cmpn_mst A
        LEFT JOIN cp_cmpn_cbsn_dtl B
        ON A.bsnm_no = B.bsnm_no
        WHERE 1=1
          AND A.BSNM_NO = #{bsnmNo}
    </select>

    <!--
         쿼리명 : MPEPartsCompanyMapper.selectPartsComSQInfo
         설  명 : 엑셀 다운로드에 사용할 SQ정보 리스트를 조회한다.
          수정일      수정자       수정내용
        ==========   ========   ==============
        2023.12.15    구은희       최초생성
    -->
    <select id="selectPartsComSQInfo" parameterType="MPEPartsCompanyDTO">
        SELECT /* MPEPartsCompanyMapper.selectPartsComSQInfo*/
            nm
            , score
            , YEAR
            , crtfn_cmpn_nm
        from cp_cmpn_cbsn_dtl
        where bsnm_no = #{bsnmNo}
    </select>

    <!--
         쿼리명 : MPEPartsCompanyMapper.checkBsnmNo
         설  명 : 부품사의 사업자번호 등록여부를 확인한다.
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.11.09   구은희       최초생성
        2023.12.26   양현우       구분 추가
    -->
    <select id="checkBsnmNo" parameterType="MPEPartsCompanyDTO">
        SELECT /* MPEPartsCompanyMapper.checkBsnmNo */
            BSNM_NO
             , CMPN_NM
             , RPRSNT_NM
             , CTGRY_CD
             , (SELECT CD_NM FROM CO_CODE_MST WHERE CD_ID = 'COMPANY_TYPE' AND CD = CTGRY_CD) AS CTGRY_CD_NM
        FROM CP_CMPN_MST
        WHERE BSNM_NO = #{bsnmNo}
    </select>

    <!--
         쿼리명 : MPEPartsCompanyMapper.insertPartsCompany
         설  명 : 부품사를 등록한다.
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.11.09   구은희       최초생성
    -->
    <insert id="insertPartsCompany" parameterType="MPEPartsCompanyDTO">
        INSERT /* MPEPartsCompanyMapper.insertPartsCompany */ INTO CP_CMPN_MST
        (
            BSNM_NO
            , CMPN_NM
            , RPRSNT_NM
            , CMPN_NFRML_NM
            , CMPN_CD
            , CTGRY_CD
            , SIZE_CD
            , STBSM_DT
            , TEL_NO
            , ZIPCODE
            , BSC_ADDR
            , DTL_ADDR
            , SLS_PMT
            , SLS_YEAR
            , MPLE_CNT
            , MJR_PRDCT_1
            , MJR_PRDCT_2
            , MJR_PRDCT_3
            , QLTY_5_STAR_CD
            , QLTY_5_STAR_YEAR
            , PAY_5_STAR_CD
            , PAY_5_STAR_YEAR
            , TCHLG_5_STAR_CD
            , TCHLG_5_STAR_YEAR
            , ADM_MEMO
            , REG_ID
            , REG_IP
            , REG_DTM
        )
        VALUES
            (
            #{bsnmNo}
            , #{cmpnNm}
            , #{rprsntNm}
            , #{cmpnNfrmlNm}
            , #{cmpnCd}
            , #{ctgryCd}
            , #{sizeCd}
            , #{stbsmDt}
            , #{telNo}
            , #{zipcode}
            , #{bscAddr}
            , #{dtlAddr}
            , #{slsPmt}
            , #{slsYear}
            , #{mpleCnt}
            , #{mjrPrdct1}
            , #{mjrPrdct2}
            , #{mjrPrdct3}
            , #{qlty5StarCd}
            , #{qlty5StarYear}
            , #{pay5StarCd}
            , #{pay5StarYear}
            , #{tchlg5StarCd}
            , #{tchlg5StarYear}
            , #{admMemo}
            , #{regId}
            , #{regIp}
            , NOW()
            )
    </insert>

    <!--
         쿼리명 : MPEPartsCompanyMapper.insertPartsComSQInfo
         설  명 : 부품사의 SQ 정보를 등록한다.
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.11.09   구은희       최초생성
    -->
    <insert id="insertPartsComSQInfo" parameterType="MPEPartsCompanyDTO">
        INSERT /* MPEPartsCompanyMapper.insertPartsComSQInfo */ INTO CP_CMPN_CBSN_DTL
        (
            BSNM_NO
            , CBSN_SEQ
            , NM
            , SCORE
            , YEAR
            , CRTFN_CMPN_NM
            , REG_ID
            , REG_IP
            , REG_DTM
        )
        VALUES
        (
            #{bsnmNo}
            , #{cbsnSeq}
            , #{nm}
            , #{score}
            , #{year}
            , #{crtfnCmpnNm}
            , #{regId}
            , #{regIp}
            , NOW()
        )
    </insert>

    <!--
         쿼리명 : MPEPartsCompanyMapper.updatePartsCompany
         설  명 : 부품사를 수정한다.
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.11.09   구은희       최초생성
    -->
    <update id="updatePartsCompany" parameterType="MPEPartsCompanyDTO">
        UPDATE /* MPEPartsCompanyMapper.updatePartsCompany */ CP_CMPN_MST
        SET
            CTGRY_CD = #{ctgryCd}
        <if test="cmpnNm != null and cmpnNm != ''.toString() ">
           , CMPN_NM = #{cmpnNm}
        </if>
        <if test="rprsntNm != null and rprsntNm != ''.toString() ">
          , RPRSNT_NM = #{rprsntNm}
        </if>
        <if test="cmpnNfrmlNm != null and cmpnNfrmlNm != ''.toString() ">
          , CMPN_NFRML_NM = #{cmpnNfrmlNm}
        </if>
        <if test="cmpnCd != null and cmpnCd != ''.toString() ">
            , CMPN_CD = #{cmpnCd}
        </if>
          , SIZE_CD = #{sizeCd}
          , STBSM_DT = #{stbsmDt}
        <if test="telNo != null and telNo != ''.toString() ">
            , TEL_NO = #{telNo}
        </if>
          , ZIPCODE = #{zipcode}
          , BSC_ADDR = #{bscAddr}
          , DTL_ADDR = #{dtlAddr}
        <if test="slsPmt != null and slsPmt != ''.toString() ">
           , SLS_PMT = #{slsPmt}
        </if>
        <if test="slsYear != null and slsYear != ''.toString() ">
          , SLS_YEAR = #{slsYear}
        </if>
        <if test="mpleCnt != null and mpleCnt != ''.toString() ">
          , MPLE_CNT = #{mpleCnt}
        </if>
          , MJR_PRDCT_1 = #{mjrPrdct1}
          , MJR_PRDCT_2 = #{mjrPrdct2}
          , MJR_PRDCT_3 = #{mjrPrdct3}
          , QLTY_5_STAR_CD = #{qlty5StarCd}
          , QLTY_5_STAR_YEAR = #{qlty5StarYear}
          , PAY_5_STAR_CD = #{pay5StarCd}
          , PAY_5_STAR_YEAR = #{pay5StarYear}
          , TCHLG_5_STAR_CD = #{tchlg5StarCd}
          , TCHLG_5_STAR_YEAR = #{tchlg5StarYear}
        <if test="admMemo != null and admMemo != ''.toString() ">
            , ADM_MEMO = #{admMemo}
        </if>
          , MOD_ID = #{modId}
          , MOD_IP = #{modIp}
          , MOD_DTM = NOW()
        WHERE 1=1
          AND BSNM_NO = #{bsnmNo}
    </update>

    <!--
         쿼리명 : MPEPartsCompanyMapper.updatePartsComSQInfo
         설  명 : 부품사의 SQ 정보를 수정한다.
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.11.09   구은희       최초생성
    -->
    <update id="updatePartsComSQInfo" parameterType="MPEPartsCompanyDTO">
        UPDATE /* MPEPartsCompanyMapper.updatePartsComSQInfo */ CP_CMPN_CBSN_DTL
        SET
            NM = #{nm}
          , SCORE = #{score}
          , YEAR = #{year}
          , CRTFN_CMPN_NM = #{crtfnCmpnNm}
          , MOD_ID = #{modId}
          , MOD_IP = #{modIp}
          , MOD_DTM = NOW()
        WHERE 1=1
          AND CBSN_SEQ = #{cbsnSeq}
    </update>

    <!--
         쿼리명 : MPEPartsCompanyMapper.deletePartsCompany
         설  명 : 부품사를 삭제한다.
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.11.08   구은희       최초생성
    -->
    <delete id="deletePartsCompany" parameterType="MPEPartsCompanyDTO">
        DELETE /* MPEPartsCompanyMapper.deletePartsCompany */
        FROM
        CP_CMPN_MST
        <where>
            <choose>
                <when test="delValueList != null">
                    BSNM_NO IN
                    <foreach collection="delValueList" item="item" index="index" separator=", " open="(" close=")">
                        #{item}
                    </foreach>
                </when>
                <otherwise>
                    BSNM_NO = #{detailsKey}
                </otherwise>
            </choose>
        </where>
    </delete>


    <!--
         쿼리명 : MPEPartsCompanyMapper.deletePartsComSQInfo
         설  명 : SQ 정보를 삭제한다.
		  수정일     수정자       수정내용
		==========   ======    ==============
		2023.12.06   구은희       최초생성
    -->
    <delete id="deletePartsComSQInfo" parameterType="MPEPartsCompanyDTO">
        delete from /*MPEPartsCompanyMapper.deletePartsComSQInfo*/ cp_cmpn_cbsn_dtl
        WHERE bsnm_no = #{bsnmNo}
    </delete>


    <!--
         쿼리명 : MPEPartsCompanyMapper.selectEduCnt
         설  명 : 실적정보 종합현황에서 교육사업 개수를 조회한다.
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.12.11   구은희       최초생성
    -->
    <select id="selectEduCnt" parameterType="MPEPartsCompanyDTO" resultType="java.lang.Integer">
        SELECT /* MPEPartsCompanyMapper.selectEduCnt */
            SUM(total_cnt) AS edu_total_cnt
        FROM
            (
                SELECT
                    COUNT(B.ptcpt_seq) AS total_cnt
                FROM
                    (
                        SELECT
                            edctn_seq
                             , episd_year
                             , episd_ord
                             , episd_seq
                        FROM ed_edctn_episd_mst
                        WHERE 1=1
                          AND edctn_stts_cd = 'EDCTN_STTS_CD01' -- 교육코드가 개강인 경우
                    )A
                        INNER JOIN
                    (
                        SELECT
                            ptcpt_seq
                             , edctn_seq
                             , episd_year
                             , episd_ord
                             , episd_seq
                             , mem_seq
                        FROM ep_edctn_ptcpt_mst
                        WHERE 1=1
                          AND stts_cd = 'EDU_STTS_CD01' -- 상태코드가 신청인 경우
                    )B
                    ON A.edctn_seq = B.edctn_seq
                        AND A.episd_year = B.episd_year
                        AND A.episd_ord = B.episd_ord
                        AND A.episd_seq = B.episd_seq
                        INNER JOIN
                    (
                        SELECT mem_seq, work_bsnm_no
                        FROM co_mem_mst
                        WHERE 1=1
                          AND mem_cd = 'CP'
                          AND work_bsnm_no = #{bsnmNo}
                    ) C
                    ON B.mem_seq = C.mem_seq
                UNION ALL
                SELECT COUNT(vst_seq) AS total_cnt FROM ev_edctn_vst_mst
                WHERE 1=1
                 AND appctn_bsnm_no = #{bsnmNo}
            ) AA
    </select>

    <!--
         쿼리명 : MPEPartsCompanyMapper.selectConsultingCnt
         설  명 : 실적정보 종합현황에서 컨설팅사업 개수를 조회한다.
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.12.11   구은희       최초생성
    -->
    <select id="selectConsultingCnt" parameterType="MPEPartsCompanyDTO" resultType="java.lang.Integer">
        SELECT /* MPEPartsCompanyMapper.selectConsultingCnt */
            COUNT(*)
        FROM
            CP_CNSTG_APPCTN_MST CP_MST
                JOIN CO_MEM_MST MEM_MST
                     ON MEM_MST.MEM_SEQ = CP_MST.APPCTN_MEM_SEQ
                LEFT JOIN CP_CMPN_MST CMPN_MST
                          ON CMPN_MST.BSNM_NO = CP_MST.APPCTN_BSNM_NO
                LEFT JOIN CP_CNSTG_RSUME_MST CPR_MST
                          ON CP_MST.CNSTG_SEQ = CPR_MST.CNSTG_SEQ
        WHERE 1=1
          AND APPCTN_BSNM_NO = #{bsnmNo}
    </select>

    <!--
         쿼리명 : MPEPartsCompanyMapper.selectWinBusinessCnt
         설  명 : 실적정보 종합현황에서 상생사업 개수를 조회한다.
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.12.11   구은희       최초생성
    -->
    <select id="selectWinBusinessCnt" parameterType="MPEPartsCompanyDTO" resultType="java.lang.Integer">
        SELECT /* MPEPartsCompanyMapper.selectWinBusinessCnt */
            COUNT(*)
        FROM (
                 SELECT A.* FROM CX_EPISD_MST A
                 JOIN CX_APPCTN_MST B ON A.EPISD_SEQ = B.EPISD_SEQ
                 JOIN CX_APPCTN_RSUME_DTL C ON B.APPCTN_SEQ = C.APPCTN_SEQ
                 JOIN CO_MEM_MST D ON B.MEM_SEQ = D.MEM_SEQ
                 JOIN CP_CMPN_MST F ON  D.WORK_BSNM_NO = F.BSNM_NO
                 LEFT JOIN CX_APPCTN_RSUME_TCHLG_DTL V ON C.RSUME_SEQ = V.RSUME_SEQ
                 INNER JOIN (
                     SELECT C.APPCTN_SEQ, MAX(C.RSUME_ORD) AS RSUME_ORD
                     FROM CX_EPISD_MST A
                              JOIN CX_APPCTN_MST B ON A.EPISD_SEQ = B.EPISD_SEQ
                              JOIN CX_APPCTN_RSUME_DTL C ON B.APPCTN_SEQ = C.APPCTN_SEQ
                     GROUP BY APPCTN_SEQ
                 ) ORD ON C.RSUME_ORD = ORD.RSUME_ORD AND C.APPCTN_SEQ = ORD.APPCTN_SEQ
                 WHERE 1=1
                  AND appctn_bsnm_no = #{bsnmNo}
             ) A
    </select>

    <!--
         쿼리명 : MPEPartsCompanyMapper.selectEduStatisticsCntList
         설  명 : 실적정보 교육사업 연도별 개수 목록을 조회한다.
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.12.26   구은희       최초생성
    -->
    <select id="selectEduStatisticsCntList" parameterType="MPEPartsCompanyDTO">
        SELECT /* MPEPartsCompanyMapper.selectEduStatisticsCntList */
            cmpn_nm
             , TA.ctgry_cd
             , BSNM_NO
             , (SELECT cd_nm FROM co_code_mst WHERE CD = TA.ctgry_cd) AS cd_nm
             , TA.YEAR_2024
             , TA.YEAR_2023
             , TA.YEAR_2022
             , TA.YEAR_2021
             , TA.YEAR_2020
             , TA.YEAR_else
        FROM
            (SELECT
                 SUM(YEAR_2024) AS YEAR_2024
                  , SUM(YEAR_2023) AS YEAR_2023
                  , SUM(YEAR_2022) AS YEAR_2022
                  , SUM(YEAR_2021) AS YEAR_2021
                  , SUM(YEAR_2020) AS YEAR_2020
                  , SUM(YEAR_else) AS YEAR_else
                  , IFNULL(T.ctgry_cd, CD) AS ctgry_cd
                  , IFNULL(work_bsnm_no, 0) AS WORK_BSNM_NO
                  , CD
             FROM(
                     SELECT
                         SUM(CASE EPISD_YEAR WHEN '2024' THEN 1 ELSE 0 END) AS YEAR_2024
                          , SUM(CASE EPISD_YEAR WHEN '2023' THEN 1 ELSE 0 END) AS YEAR_2023
                          , SUM(CASE EPISD_YEAR WHEN '2022' THEN 1 ELSE 0 END) AS YEAR_2022
                          , SUM(CASE EPISD_YEAR WHEN '2021' THEN 1 ELSE 0 END) AS YEAR_2021
                          , SUM(CASE EPISD_YEAR WHEN '2020' THEN 1 ELSE 0 END) AS YEAR_2020
                          , SUM(CASE WHEN EPISD_YEAR <![CDATA[<=]]> '2019' THEN 1 ELSE 0 END) AS YEAR_else
                          , TB.ctgry_cd
                          , episd_seq
                          , work_bsnm_no
                          , TB.CD
                     FROM (
                              SELECT * FROM
                              ( SELECT LEFT(cd, 7) CD
                                FROM CO_CODE_MST
                                WHERE CD_ID = 'CLASS_TYPE' AND DPTH = 2
                              ) TT
                              LEFT JOIN
                              (
                                  SELECT
                                      D.work_bsnm_no
                                       , A.episd_seq
                                       , A.episd_year
                                       , LEFT(C.ctgry_cd, 7) as ctgry_cd
                                  FROM
                                  (
                                      SELECT edctn_seq, episd_year, episd_ord, episd_seq
                                      FROM ed_edctn_episd_mst
                                      WHERE edctn_stts_cd = 'EDCTN_STTS_CD01' -- 교육코드가 개강인 경우
                                  )A
                                  INNER JOIN
                                  (
                                      SELECT ptcpt_seq, edctn_seq, episd_year, episd_ord, episd_seq, mem_seq
                                      FROM ep_edctn_ptcpt_mst
                                      WHERE stts_cd = 'EDU_STTS_CD01' -- 상태코드가 신청인 경우
                                  )B
                                  ON A.edctn_seq = B.edctn_seq
                                      AND A.episd_year = B.episd_year
                                      AND A.episd_ord = B.episd_ord
                                      AND A.episd_seq = B.episd_seq
                                  INNER JOIN
                                  (
                                      SELECT edctn_seq, ctgry_cd
                                      FROM ED_EDCTN_PRCS_MST
                                  ) C
                                  ON C.edctn_seq = A.edctn_seq
                                  INNER JOIN
                                  (
                                      SELECT mem_seq, work_bsnm_no
                                      FROM co_mem_mst
                                      WHERE mem_cd = 'CP' AND work_bsnm_no = #{bsnmNo}
                                  ) D
                                  ON B.mem_seq = D.mem_seq
                      ) TTT ON TT.CD = TTT.CTGRY_CD
                 ) TB
             GROUP BY CD, LEFT(TB.ctgry_cd, 7), EPISD_YEAR
            ) T
        GROUP BY CD, T.ctgry_cd
            ) TA
        LEFT JOIN cp_cmpn_mst T3 ON TA.WORK_BSNM_NO = T3.BSNM_NO
        UNION ALL
        SELECT
                (SELECT cmpn_nm FROM cp_cmpn_mst WHERE bsnm_no = tt.appctn_bsnm_no) as cmpn_nm
             , '' as ctgry_cd
             , appctn_bsnm_no AS bsnm_no
             , '방문교육' cd_nm
             , IFNULL(SUM(CASE DATE_FORMAT(reg_dtm, '%Y') WHEN '2024' THEN 1 ELSE 0 END), 0) AS YEAR_2024
             , IFNULL(SUM(CASE DATE_FORMAT(reg_dtm, '%Y') WHEN '2023' THEN 1 ELSE 0 END), 0) AS YEAR_2023
             , IFNULL(SUM(CASE DATE_FORMAT(reg_dtm, '%Y') WHEN '2022' THEN 1 ELSE 0 END), 0) AS YEAR_2022
             , IFNULL(SUM(CASE DATE_FORMAT(reg_dtm, '%Y') WHEN '2021' THEN 1 ELSE 0 END), 0) AS YEAR_2021
             , IFNULL(SUM(CASE DATE_FORMAT(reg_dtm, '%Y') WHEN '2020' THEN 1 ELSE 0 END), 0) AS YEAR_2020
             , IFNULL(SUM(CASE WHEN DATE_FORMAT(reg_dtm, '%Y') <![CDATA[<=]]> '2019' THEN 1 ELSE 0 END), 0) AS YEAR_else
        FROM ev_edctn_vst_mst tt
        WHERE tt.appctn_bsnm_no = #{bsnmNo};
    </select>

    <!--
         쿼리명 : MPEPartsCompanyMapper.selectTechGuidanceList
         설  명 : 실적정보 컨설팅 - 지도기술 목록을 조회한다.
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.01.22   구은희       최초생성
    -->
    <select id="selectTechGuidanceList" parameterType="CBATechGuidanceInsertDTO" resultType="CBATechGuidanceInsertDTO">
        SELECT /* MPEPartsCompanyMapper.selectTechGuidanceList */
            CNSTG_SEQ					/* 컨설팅순번 */
             , CNSTG_CD                  /* 컨설팅코드 */
             , APPCTN_BSNM_NO			/* 신청당시 사업자번호 */
             , CBSN_NM                  /* 신청 업종 */
             , CBSN_CD                  /* 신청 업종 코드 */
             , CMSSR_SEQ				/* 위원순번 */
             , CMSSR_NM					/* 위원이름 */
             , GUIDE_KICKF_DT			/* 킥오프시작일 */
             , KICKF_FILE_SEQ			/* 킥오프파일순번 */
             , KICKF_FILE_ORD           /* 킥오프파일ORD */
             , GUIDE_BGN_DT             /* 지도착수일 */
             , LVLUP_FILE_SEQ			/* 렙업파일순번 */
             , LVLUP_FILE_ORD			/* 렙업파일ORD */
             , INIT_VST_FILE_SEQ        /* 초도방문자료순번 */
             , INIT_VST_FILE_ORD        /* 초도방문자료ORD */
             , ITRDC_FILE_SEQ           /* 회사소개서파일일순번 */
             , ITRDC_FILE_ORD           /* 회사소개서ORD */
             , FLTY_IMPVM_RATE          /* 개선율 */
             , RSUME_STTS_CD			/* 진행상태코드 */
             , RSUME_STTS_NM			/* 진행상태코드명 */
             , GUIDE_PSCND_DT           /* 지도완료일 */
        FROM(
            SELECT
                CP_MST.CNSTG_SEQ
                 , CP_MST.CNSTG_CD
                 , (CASE WHEN CP_MST.RSUME_STTS_CD = 'MNGTECH_STATUS_06'
                    AND ((SELECT IFNULL(GUIDE_BGN_DT, CURDATE() + INTERVAL 1 DAY) FROM cp_cnstg_rsume_mst WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ ) <![CDATA[ <= ]]> CURDATE()
                    AND (SELECT IFNULL(guide_kickf_dt, CURDATE() + INTERVAL 1 DAY) FROM cp_cnstg_rsume_mst WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ ) <![CDATA[ > ]]> CURDATE())	then 'MNGTECH_STATUS_08'
                         WHEN (CP_MST.RSUME_STTS_CD = 'MNGTECH_STATUS_06' OR CP_MST.RSUME_STTS_CD = 'MNGTECH_STATUS_08' )
                             AND ((SELECT IFNULL(guide_kickf_dt, CURDATE() + INTERVAL 1 DAY) FROM cp_cnstg_rsume_mst WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ ) <![CDATA[ <= ]]> CURDATE()) then 'MNGTECH_STATUS_09'
                         ELSE CP_MST.RSUME_STTS_CD END) RSUME_STTS_CD
                 , (SELECT CD_NM FROM CO_CODE_MST WHERE CD =  (CASE WHEN CP_MST.RSUME_STTS_CD = 'MNGTECH_STATUS_06'
                    AND ((SELECT IFNULL(GUIDE_BGN_DT, CURDATE() + INTERVAL 1 DAY) FROM cp_cnstg_rsume_mst WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ ) <![CDATA[ <= ]]> CURDATE()
                    AND (SELECT IFNULL(guide_kickf_dt, CURDATE() + INTERVAL 1 DAY) FROM cp_cnstg_rsume_mst WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ ) <![CDATA[ > ]]> CURDATE())	then 'MNGTECH_STATUS_08'
                                                                    WHEN (CP_MST.RSUME_STTS_CD = 'MNGTECH_STATUS_06' OR CP_MST.RSUME_STTS_CD = 'MNGTECH_STATUS_08' )
                                                                        AND ((SELECT IFNULL(guide_kickf_dt, CURDATE() + INTERVAL 1 DAY) FROM cp_cnstg_rsume_mst WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ ) <![CDATA[ <= ]]> CURDATE()) then 'MNGTECH_STATUS_09'
                                                                    ELSE CP_MST.RSUME_STTS_CD END) AND CD_ID = 'MNGTECH_STATUS') RSUME_STTS_NM
                 , CMPN_MST.CMPN_NM
                 , CMPN_MST.CTGRY_CD
                 , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = CMPN_MST.CTGRY_CD AND CD_ID = 'COMPANY_TYPE') CTGRY_NM
                 , CMPN_MST.SIZE_CD
                 , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = CMPN_MST.SIZE_CD AND CD_ID = 'COMPANY_TYPE') SIZE_NM
                 , CP_MST.APPCTN_BSNM_NO
                 , CP_MST.APPCTN_MEM_SEQ
                 , CMPN_MST.SLS_PMT
                 , CMPN_MST.MPLE_CNT
                 , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = (SELECT CD FROM CP_CNSTG_CBSN_DTL WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ)) CBSN_NM
                 , (SELECT CD FROM CO_CODE_MST WHERE CD = (SELECT CD FROM CP_CNSTG_CBSN_DTL WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ)) CBSN_CD
                 , CP_MST.FIRST_RGNS_CD
                 , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = CP_MST.FIRST_RGNS_CD AND CD_ID = 'ADDR_CD') FIRST_RGNS_NM
                 , CP_MST.SCND_RGNS_CD
                 , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = CP_MST.SCND_RGNS_CD AND CD_ID = 'ADDR_CD') SCND_RGNS_NM
                 , (SELECT CRTFN_CMPN_NM FROM CP_CMPN_CBSN_DTL CMPNDTL WHERE BSNM_NO = CP_MST.APPCTN_BSNM_NO ORDER BY CMPNDTL.YEAR DESC, CMPNDTL.REG_DTM DESC LIMIT 1) CRTFN_CMPN_NM
                 , (SELECT CMPN_NM FROM CP_CNSTG_DLVRY_DTL WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ ORDER BY RATE DESC LIMIT 1) MN_CMPN_NM
                 , CPR_MST.CMSSR_SEQ
                 , (SELECT NAME FROM CO_MEM_MST WHERE MEM_CD = 'CS' AND MEM_SEQ = (SELECT CMSSR_SEQ FROM CP_CNSTG_RSUME_MST WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ)) CMSSR_NM
                 , (SELECT COUNT(*) FROM CO_CMSSR_ATNDC_MST WHERE CNSTG_SEQ_1 = CP_MST.CNSTG_SEQ OR CNSTG_SEQ_2 = CP_MST.CNSTG_SEQ) VST_CNT
                 , (SELECT CMSSR_CBSN_CD FROM CO_MEM_MST WHERE MEM_CD = 'CS' AND MEM_SEQ = (SELECT CMSSR_SEQ FROM CP_CNSTG_RSUME_MST WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ)) CMSSR_CBSN_CD
                 , (SELECT CD_NM FROM CO_CODE_MST WHERE CD_ID = 'MEM_CD' AND CD = (SELECT CMSSR_CBSN_CD FROM CO_MEM_MST WHERE MEM_CD = 'CS' AND MEM_SEQ = (SELECT CMSSR_SEQ FROM CP_CNSTG_RSUME_MST WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ))) CMSSR_CBSN_NM
                 , CPR_MST.GUIDE_KICKF_DT
                 , CPR_MST.KICKF_FILE_SEQ
                 , (SELECT FILE_ORD FROM CO_FILE_DTL WHERE FILE_SEQ = CPR_MST.KICKF_FILE_SEQ AND USE_YN = 'Y') KICKF_FILE_ORD
                 , CPR_MST.GUIDE_BGN_DT
                 , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = CPR_MST.CNSTG_PSCND_CD AND CD_ID = 'CNSTG_PSCND') CNSTG_PSCND_NM
                 , CPR_MST.LVLUP_FILE_SEQ
                 , (SELECT FILE_ORD FROM CO_FILE_DTL WHERE FILE_SEQ = CPR_MST.LVLUP_FILE_SEQ AND USE_YN = 'Y') LVLUP_FILE_ORD
                 , CPR_MST.init_vst_file_seq
                 , (SELECT FILE_ORD FROM CO_FILE_DTL WHERE FILE_SEQ = CPR_MST.init_vst_file_seq AND USE_YN = 'Y') init_vst_file_ORD
                 , CP_MST.itrdc_file_seq
                 , (SELECT FILE_ORD FROM CO_FILE_DTL WHERE FILE_SEQ = CP_MST.itrdc_file_seq AND USE_YN = 'Y') itrdc_file_ORD
                 , CP_MST.APPCTN_DT
                 , CPR_MST.FLTY_IMPVM_RATE
                 , CPR_MST.GUIDE_PSCND_DT
                 , CP_MST.REG_ID
                 , (SELECT NAME FROM CO_MEM_MST WHERE ID = CP_MST.REG_ID) REG_NAME
                 , CP_MST.REG_DTM
                 , CP_MST.MOD_ID
                 , (SELECT NAME FROM CO_ADM_MST WHERE ID = CP_MST.MOD_ID) MOD_NAME
                 , CP_MST.MOD_DTM
            FROM
                CP_CNSTG_APPCTN_MST CP_MST
            JOIN CO_MEM_MST MEM_MST
        ON MEM_MST.MEM_SEQ = CP_MST.APPCTN_MEM_SEQ
            LEFT JOIN CP_CMPN_MST CMPN_MST
            ON CMPN_MST.BSNM_NO = CP_MST.APPCTN_BSNM_NO
            LEFT JOIN CP_CNSTG_RSUME_MST CPR_MST
            ON CP_MST.CNSTG_SEQ = CPR_MST.CNSTG_SEQ
            ) MST
        WHERE 1=1
          AND CNSTG_CD = 'CONSULT_GB01'
          AND APPCTN_BSNM_NO = #{bsnmNo}
        ORDER BY
            REG_DTM DESC
    </select>

    <!--
         쿼리명 : MPEPartsCompanyMapper.selectManageConsultList
         설  명 : 실적정보 컨설팅 - 경영컨설팅 목록을 조회한다.
          수정일     수정자       수정내용
        ==========   ======    ==============
        2024.02.01   구은희       최초생성
    -->
    <select id="selectManageConsultList" parameterType="CBBManageConsultListDTO" resultType="CBBManageConsultListDTO">
        SELECT /* MPEPartsCompanyMapper.selectManageConsultList */
            CNSTG_SEQ					/* 컨설팅순번 */
             , CNSTG_CD                 /* 컨설팅코드 */
             , APPCTN_BSNM_NO			/* 신청당시 사업자번호 */
             , CMSSR_CBSN_NM            /* 신청 업종 */
             , CMSSR_CBSN_CD            /* 신청 업종 코드 */
             , CMSSR_SEQ				/* 위원순번 */
             , CMSSR_NM					/* 위원이름 */
             , CNSTG_KICKF_DT			/* 킥오프일자 */
             , KICKF_FILE_SEQ			/* 킥오프파일순번 */
             , KICKF_FILE_ORD           /* 킥오프파일ORD */
             , LVLUP_FILE_SEQ			/* 렙업파일순번 */
             , LVLUP_FILE_ORD			/* 렙업파일ORD */
             , INIT_VST_FILE_SEQ        /* 초도방문자료순번 */
             , INIT_VST_FILE_ORD        /* 초도방문자료ORD */
             , ITRDC_FILE_SEQ           /* 회사소개서파일일순번 */
             , ITRDC_FILE_ORD           /* 회사소개서ORD */
             , RSUME_STTS_CD			/* 진행상태코드 */
             , RSUME_STTS_NM			/* 진행상태코드명 */
             , CNSTG_PSCND_DT           /* 지도완료일 */
        FROM(
            SELECT
                CP_MST.CNSTG_SEQ
                 , CP_MST.CNSTG_CD
                 , CP_MST.BSN_YEAR
                 , CMPN_MST.CMPN_NM
                 , CMPN_MST.CTGRY_CD
                 , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = CMPN_MST.CTGRY_CD AND CD_ID = 'COMPANY_TYPE') CTGRY_NM
                 , CMPN_MST.SIZE_CD
                 , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = CMPN_MST.SIZE_CD AND CD_ID = 'COMPANY_TYPE') SIZE_NM
                 , CP_MST.APPCTN_BSNM_NO
                 , CMPN_MST.SLS_PMT
                 , CMPN_MST.MPLE_CNT
                 , CP_MST.APPCTN_FLD_CD
                 , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = CP_MST.APPCTN_FLD_CD AND CD_ID = 'MNGCNSLT_APP_AREA') APPCTN_FLD_NM
                 , CP_MST.FIRST_RGNS_CD
                 , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = CP_MST.FIRST_RGNS_CD AND CD_ID = 'ADDR_CD') FIRST_RGNS_NM
                 , CP_MST.SCND_RGNS_CD
                 , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = CP_MST.SCND_RGNS_CD AND CD_ID = 'ADDR_CD') SCND_RGNS_NM
                 , (SELECT CRTFN_CMPN_NM FROM CP_CMPN_CBSN_DTL CMPNDTL WHERE BSNM_NO = CP_MST.APPCTN_BSNM_NO ORDER BY CMPNDTL.YEAR DESC, CMPNDTL.REG_DTM DESC LIMIT 1) CRTFN_CMPN_NM
           , (SELECT CMPN_NM FROM CP_CNSTG_DLVRY_DTL WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ ORDER BY RATE DESC LIMIT 1) MN_CMPN_NM
           , CPR_MST.VST_DT
           , CPR_MST.CMSSR_SEQ
           , (SELECT NAME FROM CO_MEM_MST WHERE MEM_CD = 'CS' AND MEM_SEQ = (SELECT CMSSR_SEQ FROM CP_CNSTG_RSUME_MST WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ)) CMSSR_NM
           , (SELECT CMSSR_CBSN_CD FROM CO_MEM_MST WHERE MEM_CD = 'CS' AND MEM_SEQ = (SELECT CMSSR_SEQ FROM CP_CNSTG_RSUME_MST WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ)) CMSSR_CBSN_CD
           , (SELECT CD_NM FROM CO_CODE_MST WHERE CD_ID = 'MEM_CD' AND CD = (SELECT CMSSR_CBSN_CD FROM CO_MEM_MST WHERE MEM_CD = 'CS' AND MEM_SEQ = (SELECT CMSSR_SEQ FROM CP_CNSTG_RSUME_MST WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ))) CMSSR_CBSN_NM
           , CPR_MST.CNSTG_KICKF_DT
           , CPR_MST.KICKF_FILE_SEQ
           , (SELECT FILE_ORD FROM CO_FILE_DTL WHERE FILE_SEQ = CPR_MST.KICKF_FILE_SEQ AND USE_YN = 'Y') KICKF_FILE_ORD
           , CPR_MST.CNSTG_PSCND_CD
           , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = CPR_MST.CNSTG_PSCND_CD AND CD_ID = 'CNSTG_PSCND') CNSTG_PSCND_NM
           , CPR_MST.CNSTG_PSCND_DT
           , (SELECT CNSTG_KICKF_DT FROM CP_CNSTG_RSUME_MST WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ AND CNSTG_PSCND_CD = 'CNSTG_PSCND03') LVLUP_DT
           , CPR_MST.LVLUP_FILE_SEQ
           , (SELECT FILE_ORD FROM CO_FILE_DTL WHERE FILE_SEQ = CPR_MST.LVLUP_FILE_SEQ AND USE_YN = 'Y') LVLUP_FILE_ORD
           , CPR_MST.init_vst_file_seq
           , (SELECT FILE_ORD FROM CO_FILE_DTL WHERE FILE_SEQ = CPR_MST.init_vst_file_seq AND USE_YN = 'Y') init_vst_file_ORD
           , CP_MST.itrdc_file_seq
           , (SELECT FILE_ORD FROM CO_FILE_DTL WHERE FILE_SEQ = CP_MST.itrdc_file_seq AND USE_YN = 'Y') itrdc_file_ORD
           , CP_MST.APPCTN_DT
           , (CASE WHEN CP_MST.RSUME_STTS_CD = 'MNGCNSLT_STATUS03'
                    AND (SELECT IFNULL(vst_dt, CURDATE() + INTERVAL 1 DAY) FROM cp_cnstg_rsume_mst WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ ) <![CDATA[ <= ]]> CURDATE() then 'MNGCNSLT_STATUS06'
                    WHEN (CP_MST.RSUME_STTS_CD = 'MNGCNSLT_STATUS07')
                    AND ((SELECT IFNULL(cnstg_kickf_dt, CURDATE() + INTERVAL 1 DAY) FROM cp_cnstg_rsume_mst WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ ) <![CDATA[ <= ]]> CURDATE()) then 'MNGCNSLT_STATUS09'
                    ELSE CP_MST.RSUME_STTS_CD END) RSUME_STTS_CD
           , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = (CASE WHEN CP_MST.RSUME_STTS_CD = 'MNGCNSLT_STATUS03'
            AND (SELECT IFNULL(vst_dt, CURDATE() + INTERVAL 1 DAY) FROM cp_cnstg_rsume_mst WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ ) <![CDATA[ <= ]]> CURDATE() then 'MNGCNSLT_STATUS06'
                                                             WHEN (CP_MST.RSUME_STTS_CD = 'MNGCNSLT_STATUS07')
                                                                 AND ((SELECT IFNULL(cnstg_kickf_dt, CURDATE() + INTERVAL 1 DAY) FROM cp_cnstg_rsume_mst WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ ) <![CDATA[ <= ]]> CURDATE()) then 'MNGCNSLT_STATUS09'
                                                             ELSE CP_MST.RSUME_STTS_CD END) AND CD_ID = 'MNGCNSLT_STATUS') RSUME_STTS_NM
           , CP_MST.REG_ID
           , (SELECT NAME FROM CO_MEM_MST WHERE ID = CP_MST.REG_ID) REG_NAME
           , (SELECT NAME FROM CO_ADM_MST WHERE ID = CP_MST.REG_ID) REG_ADM_NAME
           , CP_MST.REG_DTM
           , CP_MST.MOD_ID
           , (SELECT NAME FROM CO_ADM_MST WHERE ID = CP_MST.MOD_ID) MOD_NAME
           , CP_MST.MOD_DTM
            FROM
         CP_CNSTG_APPCTN_MST CP_MST
        JOIN CO_MEM_MST MEM_MST
        ON MEM_MST.MEM_SEQ = CP_MST.APPCTN_MEM_SEQ
            LEFT JOIN CP_CMPN_MST CMPN_MST
            ON CMPN_MST.BSNM_NO = CP_MST.APPCTN_BSNM_NO
            LEFT JOIN CP_CNSTG_RSUME_MST CPR_MST
            ON CP_MST.CNSTG_SEQ = CPR_MST.CNSTG_SEQ
            ) MST
        WHERE 1=1
          AND CNSTG_CD = 'CONSULT_GB02'
          AND APPCTN_BSNM_NO = #{bsnmNo}
        ORDER BY
            REG_DTM DESC
    </select>


    <!--
         쿼리명 : MPEPartsCompanyMapper.selectConsultingListCnt
         설  명 :  컨설팅 목록 개수
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.01.22   구은희      최초 생성
    -->
    <select id="selectConsultingListCnt" parameterType="CBATechGuidanceInsertDTO" resultType="java.lang.Integer">
        SELECT /* MPEPartsCompanyMapper.selectConsultingListCnt */
            COUNT(*)
        FROM
            (
                SELECT
                    CNSTG_SEQ					/* 컨설팅순번 */
                     , CNSTG_CD                  /* 컨설팅코드 */
                     , APPCTN_BSNM_NO			/* 신청당시 사업자번호 */
                     , CBSN_NM                   /* 신청 업종 */
                     , CBSN_CD                   /* 신청 업종 코드 */
                     , CMSSR_SEQ					/* 위원순번 */
                     , CMSSR_NM					/* 위원이름 */
                     , GUIDE_KICKF_DT			/* 킥오프시작일 */
                     , KICKF_FILE_SEQ			/* 킥오프파일순번 */
                     , KICKF_FILE_ORD            /* 킥오프파일ORD */
                     , GUIDE_BGN_DT              /* 지도착수일 */
                     , LVLUP_FILE_SEQ			/* 렙업파일순번 */
                     , LVLUP_FILE_ORD			/* 렙업파일ORD */
                     , init_vst_file_seq         /* 초도방문자료순번 */
                     , init_vst_file_ORD         /* 초도방문자료ORD */
                     , itrdc_file_seq            /* 회사소개서파일일순번 */
                     , itrdc_file_ORD            /* 회사소개서ORD */
                     , flty_impvm_rate           /* 개선율 */
                     , RSUME_STTS_CD			    /* 진행상태코드 */
                     , RSUME_STTS_NM			    /* 진행상태코드명 */
                FROM(
                    SELECT
                        CP_MST.CNSTG_SEQ
                         , CP_MST.CNSTG_CD
                         , CP_MST.BSN_YEAR
                         , (CASE WHEN CP_MST.RSUME_STTS_CD = 'MNGTECH_STATUS_06'
                        AND ((SELECT IFNULL(GUIDE_BGN_DT, 0) FROM cp_cnstg_rsume_mst WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ ) <![CDATA[ <= ]]> CURDATE()
                            AND (SELECT IFNULL(guide_kickf_dt, CURDATE() + INTERVAL 1 DAY) FROM cp_cnstg_rsume_mst WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ ) <![CDATA[ > ]]> CURDATE())	then 'MNGTECH_STATUS_08'
                                 WHEN (CP_MST.RSUME_STTS_CD = 'MNGTECH_STATUS_06' OR CP_MST.RSUME_STTS_CD = 'MNGTECH_STATUS_08' )
                                     AND ((SELECT IFNULL(guide_kickf_dt, 0) FROM cp_cnstg_rsume_mst WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ ) <![CDATA[ <= ]]> CURDATE()) then 'MNGTECH_STATUS_09'
                                 ELSE CP_MST.RSUME_STTS_CD END) RSUME_STTS_CD
                         , (SELECT CD_NM FROM CO_CODE_MST WHERE CD =  (CASE WHEN CP_MST.RSUME_STTS_CD = 'MNGTECH_STATUS_06'
                        AND ((SELECT IFNULL(GUIDE_BGN_DT, 0) FROM cp_cnstg_rsume_mst WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ ) <![CDATA[ <= ]]> CURDATE()
                            AND (SELECT IFNULL(guide_kickf_dt, CURDATE() + INTERVAL 1 DAY) FROM cp_cnstg_rsume_mst WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ ) <![CDATA[ > ]]> CURDATE())	then 'MNGTECH_STATUS_08'
                                                                            WHEN (CP_MST.RSUME_STTS_CD = 'MNGTECH_STATUS_06' OR CP_MST.RSUME_STTS_CD = 'MNGTECH_STATUS_08' )
                                                                                AND ((SELECT IFNULL(guide_kickf_dt, 0) FROM cp_cnstg_rsume_mst WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ ) <![CDATA[ <= ]]> CURDATE()) then 'MNGTECH_STATUS_09'
                                                                            ELSE CP_MST.RSUME_STTS_CD END) AND CD_ID = 'MNGTECH_STATUS') RSUME_STTS_NM
                         , CMPN_MST.CMPN_NM
                         , CMPN_MST.CTGRY_CD
                         , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = CMPN_MST.CTGRY_CD AND CD_ID = 'COMPANY_TYPE') CTGRY_NM
                         , CMPN_MST.SIZE_CD
                         , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = CMPN_MST.SIZE_CD AND CD_ID = 'COMPANY_TYPE') SIZE_NM
                         , CP_MST.APPCTN_BSNM_NO
                         , CP_MST.APPCTN_MEM_SEQ
                         , CMPN_MST.SLS_PMT
                         , CMPN_MST.MPLE_CNT
                         , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = (SELECT CD FROM CP_CNSTG_CBSN_DTL WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ)) CBSN_NM
                         , (SELECT CD FROM CO_CODE_MST WHERE CD = (SELECT CD FROM CP_CNSTG_CBSN_DTL WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ)) CBSN_CD
                         , CP_MST.FIRST_RGNS_CD
                         , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = CP_MST.FIRST_RGNS_CD AND CD_ID = 'ADDR_CD') FIRST_RGNS_NM
                         , CP_MST.SCND_RGNS_CD
                         , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = CP_MST.SCND_RGNS_CD AND CD_ID = 'ADDR_CD') SCND_RGNS_NM
                         , (SELECT CRTFN_CMPN_NM FROM CP_CMPN_CBSN_DTL CMPNDTL WHERE BSNM_NO = CP_MST.APPCTN_BSNM_NO ORDER BY CMPNDTL.YEAR DESC, CMPNDTL.REG_DTM DESC LIMIT 1) CRTFN_CMPN_NM
                   , (SELECT CMPN_NM FROM CP_CNSTG_DLVRY_DTL WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ ORDER BY RATE DESC LIMIT 1) MN_CMPN_NM
                   , CPR_MST.VST_DT
                   , CPR_MST.CMSSR_SEQ
                   , (SELECT NAME FROM CO_MEM_MST WHERE MEM_CD = 'CS' AND MEM_SEQ = (SELECT CMSSR_SEQ FROM CP_CNSTG_RSUME_MST WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ)) CMSSR_NM
                   , (SELECT COUNT(*) FROM CO_CMSSR_ATNDC_MST WHERE CNSTG_SEQ_1 = CP_MST.CNSTG_SEQ OR CNSTG_SEQ_2 = CP_MST.CNSTG_SEQ) VST_CNT
                   , (SELECT CMSSR_CBSN_CD FROM CO_MEM_MST WHERE MEM_CD = 'CS' AND MEM_SEQ = (SELECT CMSSR_SEQ FROM CP_CNSTG_RSUME_MST WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ)) CMSSR_CBSN_CD
                   , (SELECT CD_NM FROM CO_CODE_MST WHERE CD_ID = 'MEM_CD' AND CD = (SELECT CMSSR_CBSN_CD FROM CO_MEM_MST WHERE MEM_CD = 'CS' AND MEM_SEQ = (SELECT CMSSR_SEQ FROM CP_CNSTG_RSUME_MST WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ))) CMSSR_CBSN_NM
                   , CPR_MST.GUIDE_KICKF_DT
                   , CPR_MST.KICKF_FILE_SEQ
                   , (SELECT FILE_ORD FROM CO_FILE_DTL WHERE FILE_SEQ = CPR_MST.KICKF_FILE_SEQ AND USE_YN = 'Y') KICKF_FILE_ORD
                   , CPR_MST.CNSTG_PSCND_CD
                   , CPR_MST.GUIDE_PSCND_DT
                   , CPR_MST.GUIDE_BGN_DT
                   , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = CPR_MST.CNSTG_PSCND_CD AND CD_ID = 'CNSTG_PSCND') CNSTG_PSCND_NM
                   , CPR_MST.CNSTG_PSCND_DT
                   , CPR_MST.LVLUP_FILE_SEQ
                   , (SELECT FILE_ORD FROM CO_FILE_DTL WHERE FILE_SEQ = CPR_MST.LVLUP_FILE_SEQ AND USE_YN = 'Y') LVLUP_FILE_ORD
                   , CPR_MST.init_vst_file_seq
                   , (SELECT FILE_ORD FROM CO_FILE_DTL WHERE FILE_SEQ = CPR_MST.init_vst_file_seq AND USE_YN = 'Y') init_vst_file_ORD
                   , CP_MST.itrdc_file_seq
                   , (SELECT FILE_ORD FROM CO_FILE_DTL WHERE FILE_SEQ = CP_MST.itrdc_file_seq AND USE_YN = 'Y') itrdc_file_ORD
                   , CP_MST.APPCTN_DT
                   , CPR_MST.flty_impvm_rate
                   , CP_MST.REG_ID
                   , (SELECT NAME FROM CO_MEM_MST WHERE ID = CP_MST.REG_ID) REG_NAME
                   , CP_MST.REG_DTM
                   , CP_MST.MOD_ID
                   , (SELECT NAME FROM CO_ADM_MST WHERE ID = CP_MST.MOD_ID) MOD_NAME
                   , CPR_MST.MOD_DTM
                    FROM
                CP_CNSTG_APPCTN_MST CP_MST
            JOIN CO_MEM_MST MEM_MST
                ON MEM_MST.MEM_SEQ = CP_MST.APPCTN_MEM_SEQ
                    LEFT JOIN CP_CMPN_MST CMPN_MST
                    ON CMPN_MST.BSNM_NO = CP_MST.APPCTN_BSNM_NO
                    LEFT JOIN CP_CNSTG_RSUME_MST CPR_MST
                    ON CP_MST.CNSTG_SEQ = CPR_MST.CNSTG_SEQ
            ) MST
        WHERE 1=1
          AND CNSTG_CD = #{cnstgCd}
          AND APPCTN_BSNM_NO = #{bsnmNo}
            ) TB
    </select>

    <!--
         쿼리명 : MPEPartsCompanyMapper.selectFundingList
         설  명 : 자금지원 목록 조회
         수정일     수정자     수정내용
        ==========  ======  ==============
        2024.01.22  구은희     최초 생성
    -->
    <select id="selectFundingList" parameterType="wBGAExamSearchDTO" resultType="wBGAExamSearchDTO">
        SELECT /* MPEPartsCompanyMapper.selectFundingList */
            B.APPCTN_SEQ
             ,(SELECT cd_nm FROM CO_CODE_MST WHERE cd = A.BSN_CD) AS BSN_NM -- 사업명구분
             ,F.BSNM_NO
             ,(SELECT NAME FROM CO_MEM_MST WHERE MEM_SEQ = PIC_CMSSR_SEQ) AS PIC_CMSSR_NM -- 담당위원
             ,(SELECT TCHLG_NM FROM CX_APPCTN_TCHLG_DTL WHERE APPCTN_SEQ = C.APPCTN_SEQ AND TCHLG_ORD = 1) AS TCHLG_NM -- 장비명
             ,(SELECT SUM(TCHLG_CNT) FROM CX_APPCTN_TCHLG_DTL WHERE APPCTN_SEQ = C.APPCTN_SEQ) AS  TCHLG_CNT_SUM -- 장비수량
             ,(SELECT MAX(TCHLG_ORD) FROM CX_APPCTN_TCHLG_DTL WHERE APPCTN_SEQ = C.APPCTN_SEQ) AS  TCHLG_ORD_MAX -- 장비 리스트 수
             ,V.NVSTM_PMT -- 총투자비
             ,V.FNDN_SPPRT_PMT -- 재단지원금
             ,V.REAL_GIVE_DT -- 실지급일

        FROM CX_EPISD_MST A
                 JOIN CX_APPCTN_MST B ON A.EPISD_SEQ = B.EPISD_SEQ
                 JOIN CX_APPCTN_RSUME_DTL C ON B.APPCTN_SEQ = C.APPCTN_SEQ
                 JOIN CO_MEM_MST D ON B.MEM_SEQ = D.MEM_SEQ
                 JOIN CP_CMPN_MST F ON  D.WORK_BSNM_NO = F.BSNM_NO
                 LEFT JOIN CX_APPCTN_RSUME_TCHLG_DTL V ON C.RSUME_SEQ = V.RSUME_SEQ
                 INNER JOIN (
            SELECT C.APPCTN_SEQ, MAX(C.RSUME_ORD) AS RSUME_ORD
            FROM CX_EPISD_MST A
                     JOIN CX_APPCTN_MST B ON A.EPISD_SEQ = B.EPISD_SEQ
                     JOIN CX_APPCTN_RSUME_DTL C ON B.APPCTN_SEQ = C.APPCTN_SEQ
            WHERE BSN_CD IN('BSN07', 'BSN08', 'BSN09')
            GROUP BY APPCTN_SEQ
        ) ORD ON C.RSUME_ORD = ORD.RSUME_ORD AND C.APPCTN_SEQ = ORD.APPCTN_SEQ
        WHERE 1 = 1
          AND BSN_CD IN('BSN07', 'BSN08', 'BSN09')
          AND BSNM_NO = #{bsnmNo}
        ORDER BY B.APPCTN_SEQ DESC
    </select>

    <!--
         쿼리명 : MPEPartsCompanyMapper.selectFundingCnt
         설  명 : 자금지원 목록 개수 조회
         수정일     수정자     수정내용
        ==========  ======  ==============
        2024.01.22  구은희     최초 생성
    -->
    <select id="selectFundingCnt" parameterType="wBGAExamSearchDTO" resultType="java.lang.Integer">
        SELECT /* MPEPartsCompanyMapper.selectFundingCnt */
            COUNT(*)
        FROM
            (
                SELECT
                    B.APPCTN_SEQ
                     ,(SELECT cd_nm FROM CO_CODE_MST WHERE cd = A.BSN_CD) AS BSN_NM -- 사업명구분
                     ,F.BSNM_NO
                     ,(SELECT NAME FROM CO_MEM_MST WHERE MEM_SEQ = PIC_CMSSR_SEQ) AS PIC_CMSSR_NM -- 담당위원
                     ,(SELECT TCHLG_NM FROM CX_APPCTN_TCHLG_DTL WHERE APPCTN_SEQ = C.APPCTN_SEQ AND TCHLG_ORD = 1) AS TCHLG_N -- 장비명
                     ,(SELECT SUM(TCHLG_CNT) FROM CX_APPCTN_TCHLG_DTL WHERE APPCTN_SEQ = C.APPCTN_SEQ) AS  TCHLG_CNT_SUM -- 장비수량
                     ,(SELECT MAX(TCHLG_ORD) FROM CX_APPCTN_TCHLG_DTL WHERE APPCTN_SEQ = C.APPCTN_SEQ) AS  TCHLG_ORD_MAX -- 장비 리스트 수
                     ,V.NVSTM_PMT -- 총투자비
                     ,V.FNDN_SPPRT_PMT -- 재단지원금
                     ,V.REAL_GIVE_DT -- 실지급일

                FROM CX_EPISD_MST A
                         JOIN CX_APPCTN_MST B ON A.EPISD_SEQ = B.EPISD_SEQ
                         JOIN CX_APPCTN_RSUME_DTL C ON B.APPCTN_SEQ = C.APPCTN_SEQ
                         JOIN CO_MEM_MST D ON B.MEM_SEQ = D.MEM_SEQ
                         JOIN CP_CMPN_MST F ON  D.WORK_BSNM_NO = F.BSNM_NO
                         LEFT JOIN CX_APPCTN_RSUME_TCHLG_DTL V ON C.RSUME_SEQ = V.RSUME_SEQ
                         INNER JOIN (
                    SELECT C.APPCTN_SEQ, MAX(C.RSUME_ORD) AS RSUME_ORD
                    FROM CX_EPISD_MST A
                             JOIN CX_APPCTN_MST B ON A.EPISD_SEQ = B.EPISD_SEQ
                             JOIN CX_APPCTN_RSUME_DTL C ON B.APPCTN_SEQ = C.APPCTN_SEQ
                    WHERE BSN_CD IN('BSN07', 'BSN08', 'BSN09')
                    GROUP BY APPCTN_SEQ
                ) ORD ON C.RSUME_ORD = ORD.RSUME_ORD AND C.APPCTN_SEQ = ORD.APPCTN_SEQ
                WHERE 1 = 1
                  AND BSN_CD IN('BSN07', 'BSN08', 'BSN09')
                  AND BSNM_NO = #{bsnmNo}
                ORDER BY B.APPCTN_SEQ DESC
            ) TB
    </select>

    <!--
         쿼리명 : MPEPartsCompanyMapper.selectCarTargetList
         설  명 : 자동차부품산업대상 정보를 조회한다.
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.12.07   구은희       최초생성
    -->
    <select id="selectCarTargetList" parameterType="WBJAcomSearchDTO">
        SELECT /* MPEPartsCompanyMapper.selectCarTargetList */
            DISTINCT A.year as year -- 사업연도
        , B.appctn_seq
        , B.reg_dtm
        , (SELECT cd_nm FROM co_code_mst WHERE cd = F.PRIZE_CD) as PRIZE_CD_NM -- 포상부문명
        , (SELECT cd_nm FROM co_code_mst WHERE cd = F.mrts_cd) as mrts_cd_nm -- 훈격명
        , D.PRIZE_PMT -- 포상금액
        , (SELECT cd_nm FROM co_code_mst WHERE cd = G.MNG_STTS_CD) as MNG_STTS_CD_NM -- 최종결과
        , (SELECT cmpn_nm FROM cp_cmpn_mst WHERE bsnm_no = B.appctn_bsnm_no) as cmpn_nm -- 부품사명
        , F.pstn_nm -- 직급명
		  , F.NAME -- 수상자명
        FROM
            (
            SELECT *
            FROM cx_episd_mst
            WHERE bsn_cd = 'BSN10'
            ) A INNER JOIN cx_appctn_mst B ON B.episd_seq = A.episd_seq
            INNER JOIN
            (
            SELECT a.mem_seq, a.pstn_cd, b.cmpn_nm, b.bsnm_no
            FROM co_mem_mst a INNER JOIN cp_cmpn_mst b ON a.work_bsnm_no = b.bsnm_no
            ) C
            ON C.mem_seq = B.mem_seq
            INNER JOIN
            (
            SELECT EPISD_SEQ, MRTS_CD, PRIZE_CD, PRIZE_PMT
            FROM CX_EPISD_PRIZE_DTL
            )D
            ON A.EPISD_SEQ = D.EPISD_SEQ
            INNER JOIN
            (
            SELECT APPCTN_SEQ, RSUME_SEQ, RSUME_STTS_CD, APPCTN_STTS_CD, MNG_STTS_CD, RSUME_ORD
            FROM CX_APPCTN_RSUME_DTL
            WHERE RSUME_STTS_CD = 'PRO_TYPE05001'
            )E
            ON B.APPCTN_SEQ = E.APPCTN_SEQ
            INNER JOIN
            (
            SELECT RSUME_SEQ, NAME, DEPT_NM, PSTN_CD, MRTS_CD, PRIZE_CD, pstn_nm, cmpn_seq
            FROM CX_APPCTN_RSUME_PRIZE_PART_DTL
            )F
            ON E.RSUME_SEQ = F.RSUME_SEQ AND D.PRIZE_CD = F.PRIZE_CD
            LEFT JOIN
            (
            SELECT APPCTN_SEQ, RSUME_SEQ, RSUME_STTS_CD, APPCTN_STTS_CD, MNG_STTS_CD, RSUME_ORD
            FROM CX_APPCTN_RSUME_DTL
            WHERE RSUME_STTS_CD = 'PRO_TYPE05002'
            )G
            ON B.APPCTN_SEQ = G.APPCTN_SEQ
        WHERE F.cmpn_seq = #{bsnmNo}
        GROUP BY APPCTN_SEQ
        ORDER BY year DESC, episd DESC, reg_dtm desc
    </select>

    <!--
        쿼리명 : MPEPartsCompanyMapper.selectMemberPartsSocietyExistsCheck
        설  명 : 등록된 부품사 회원이 있는지 체크
          수정일      수정자       수정내용
        ==========   ========   ==============
        2024.01.22    구은희       최초생성
    -->
    <select id="selectMemberPartsSocietyExistsCheck" parameterType="MPEPartsCompanyDTO" resultType="java.lang.Integer">
        SELECT /* MPEPartsCompanyMapper.selectMemberPartsSocietyExistsCheck */
            COUNT(*)
        FROM co_mem_mst
        <where>
            AND mem_cd = 'CP'
            <choose>
                <when test="delValueList != null">
                    AND work_bsnm_no IN
                    <foreach collection="delValueList" item="item" index="index" separator=", " open="(" close=")">
                        #{item}
                    </foreach>
                </when>
                <otherwise>
                    AND work_bsnm_no = #{detailsKey}
                </otherwise>
            </choose>
        </where>
    </select>

    <!--
		쿼리명 : selectPartsComListwhereSql
		설  명 : 부품사 관리 where Sql
	      수정일      수정자       수정내용
        ==========   ========   ==============
        2023.11.09    구은희       최초생성
    -->
    <sql id="selectPartsComListwhereSql">
        <where>
            <if test="srchDate != null and srchDate != ''.toString() ">
                <choose>
                    <when test="srchDate == 1">
                        <if test="strtDt != null and strtDt != ''.toString() and endDt != null and endDt != ''.toString()">
                            AND REG_DTM <![CDATA[ > ]]> str_to_date(#{strtDt}, '%Y-%m-%d')
                            AND REG_DTM <![CDATA[ < ]]> date_add(str_to_date(#{endDt}, '%Y-%m-%d'), INTERVAL 1 DAY)
                        </if>
                    </when>
                    <when test="srchDate == 2">
                        <if test="strtDt != null and strtDt != ''.toString() and endDt != null and endDt != ''.toString()">
                            AND MOD_DTM <![CDATA[ > ]]> STR_TO_DATE(#{strtDt}, '%Y-%m-%d')
                            AND MOD_DTM <![CDATA[ < ]]> DATE_ADD(STR_TO_DATE(#{endDt}, '%Y-%m-%d'), INTERVAL 1 DAY)
                        </if>
                    </when>
                    <otherwise>

                    </otherwise>
                </choose>
            </if>
            <if test="ctgryCdList != null and ctgryCdList.size() > 0">
                and (
                <foreach collection="ctgryCdList" item="ctgryCdList" index="index" open="" close="" separator=" or ">
                    CTGRY_CD = #{ctgryCdList}
                </foreach>
                )
            </if>
            <if test="sizeCdList != null and sizeCdList.size() > 0">
                and (
                <foreach collection="sizeCdList" item="sizeCdList" index="index" open="" close="" separator=" or ">
                    SIZE_CD = #{sizeCdList}
                </foreach>
                )
            </if>
            <if test="q != null and q != ''">
                <choose>
                    <when test="f == 1">
                        AND RPRSNT_NM LIKE CONCAT('%', #{q}, '%')
                    </when>
                    <when test="f == 2">
                        AND CMPN_NM LIKE CONCAT('%', #{q}, '%')
                    </when>
                    <when test="f == 3">
                        AND BSC_ADDR LIKE CONCAT('%', #{q}, '%')
                    </when>
                    <when test="f == 4">
                        AND CMPN_CD LIKE CONCAT('%', #{q}, '%')
                    </when>
                    <when test="f == 5">
                        AND BSNM_NO LIKE CONCAT('%', replace(#{q},'-',''), '%')
                    </when>
                    <when test="f == 6">
                        AND TEL_NO LIKE CONCAT('%', #{q}, '%')
                    </when>
                    <when test="f == 7">
                        AND (
                        A.REG_ID LIKE CONCAT('%', #{q}, '%') OR
                        EXISTS(SELECT 'x' FROM CO_ADM_MST WHERE ID = A.REG_ID AND NAME LIKE CONCAT('%', #{q}, '%') <![CDATA[>]]> 0)
                        )
                    </when>
                    <when test="f == 8">
                        AND (
                        A.MOD_ID LIKE CONCAT('%', #{q}, '%') OR
                        EXISTS(SELECT 'x' FROM CO_ADM_MST WHERE ID = A.MOD_ID AND NAME LIKE CONCAT('%', #{q}, '%') <![CDATA[>]]> 0)
                        )
                    </when>
                    <otherwise>
                        AND (
                        RPRSNT_NM LIKE CONCAT('%', #{q}, '%') OR
                        CMPN_NM LIKE CONCAT('%', #{q}, '%') OR
                        BSC_ADDR LIKE CONCAT('%', #{q}, '%') OR
                        CMPN_CD LIKE CONCAT('%', #{q}, '%') OR
                        BSNM_NO LIKE CONCAT('%', replace(#{q},'-',''), '%') OR
                        TEL_NO LIKE CONCAT('%', #{q}, '%') OR
                        A.REG_ID LIKE CONCAT('%', #{q}, '%') OR
                        EXISTS(SELECT 'x' FROM CO_ADM_MST WHERE ID = A.REG_ID AND NAME LIKE CONCAT('%', #{q}, '%') <![CDATA[>]]> 0) OR
                        A.MOD_ID LIKE CONCAT('%', #{q}, '%') OR
                        EXISTS(SELECT 'x' FROM CO_ADM_MST WHERE ID = A.MOD_ID AND NAME LIKE CONCAT('%', #{q}, '%') <![CDATA[>]]> 0)
                        )
                    </otherwise>
                </choose>
            </if>
        </where>
    </sql>
</mapper>