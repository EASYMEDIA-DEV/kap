<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"><mapper namespace="com.kap.service.dao.sm.SMBMnVslMapper">    <!--         쿼리명 : SMBMnVslMapper.selectMnVslList         설  명 :  메인 비주얼 목록 조회.          수정일     수정자       수정내용        ==========   ======    ==============        2023.10.23   임서화      최초생성    -->    <select id="selectMnVslList" parameterType="SMBMainVslDTO" resultType="SMBMainVslDTO">        SELECT /* SMBMnVslMapper.selectMnVslList */            SEQ,            TITL,            DATE_FORMAT(STRT_DTM, '%Y-%m-%d %H:%i:%s') AS STRT_DTM,            DATE_FORMAT(END_DTM, '%Y-%m-%d %H:%i:%s') AS END_DTM,            #{srchDate} AS 'srchDate',            #{dStrDt} AS 'dStrDt',            #{dEndDt} AS 'dEndDt',            ODTM_YN,            MAIN_YN,            REG_ID,            (SELECT NAME FROM CO_ADM_MST WHERE ID = A.REG_ID) AS REG_NAME,            (SELECT NAME FROM CO_ADM_MST WHERE ID = A.MOD_ID) AS MOD_NAME,            REG_DTM,            MOD_ID,            MOD_DTM,            ORD,            MD_CD,            CATEGORY        FROM SM_MAIN_VSL_MST A        <include refid="selectMnVslwhereSql" />        ORDER BY            ORD DESC        LIMIT #{firstIndex}, #{recordCountPerPage}    </select>    <!--         쿼리명 : SMBMnVslMapper.selectMnVsldTotCnt         설  명 :  메인 비주얼 목록 카운트.          수정일     수정자       수정내용        ==========   ======    ==============        2023.10.23   임서화      최초생성    -->    <select id="selectMnVsldTotCnt" parameterType="SMBMainVslDTO" resultType="java.lang.Integer">        SELECT            count(*)        FROM            SM_MAIN_VSL_MST A        <include refid="selectMnVslwhereSql" />    </select>    <!--         쿼리명 : SMBMnVslMapper.selectMnVsldTotCnt         설  명 :  메인 비주얼 상세 조회          수정일     수정자       수정내용        ==========   ======    ==============        2023.10.23   임서화      최초생성    -->    <select id="selectMnVslDtl" parameterType="SMBMainVslDTO" resultType="SMBMainVslDTO">        SELECT /* SMBMnVslMapper.selectMnVslDtl */            SEQ             , TITL             , STRT_DTM             , END_DTM             , ODTM_YN             , PC_ATCH_FILE_SEQ             , MBL_ATCH_FILE_SEQ             , MN_COPY             , MN_HEX_CD             , SUB_COPY             , SUB_HEX_CD             , LINK_URL             , NEW_WNDW_YN             , MAIN_YN             , REG_ID             , (SELECT NAME FROM CO_ADM_MST WHERE ID = A.REG_ID) AS REG_NM             , REG_DTM             , MOD_ID             , (SELECT NAME FROM CO_ADM_MST WHERE ID = A.MOD_ID) AS MOD_NM             , MOD_DTM             , CATEGORY        FROM            SM_MAIN_VSL_MST A        WHERE 1=1          AND SEQ = #{detailsKey}          AND MD_CD = #{mdCd}    </select>    <!--     쿼리명 : SMBMnVslMapper.insertMnVsl     설  명 :  메인 비주얼 등록      수정일     수정자       수정내용    ==========   ======    ==============    2023.10.23   임서화      최초생성    -->    <insert id="insertMnVsl" parameterType="SMBMainVslDTO">        <selectKey keyProperty="ord" resultType="java.lang.Integer" order="BEFORE">            SELECT IFNULL(MAX(ORD), 0) + 1 FROM SM_MAIN_VSL_MST WHERE MD_CD = #{mdCd}        </selectKey>        INSERT /* SMBMnVslMapper.insertMnVsl */ INTO SM_MAIN_VSL_MST        ( SEQ        , MD_CD        , TITL        , STRT_DTM        , END_DTM        , ODTM_YN        , PC_ATCH_FILE_SEQ        , MBL_ATCH_FILE_SEQ        , MN_COPY        , MN_HEX_CD        , SUB_COPY        , SUB_HEX_CD        , LINK_URL        , NEW_WNDW_YN        , ORD        , MAIN_YN        , REG_ID        , REG_IP        , REG_DTM        , CATEGORY        )        VALUES        ( #{seq}        , #{mdCd}        , #{titl}        <choose>            <when test="odtmYn == 'Y'.toString()">                , NULL                , NULL            </when>            <otherwise>                , #{strtDtm}                , #{endDtm}            </otherwise>        </choose>        , #{odtmYn}        <choose>            <when test="mdCd eq 'pc'.toString()">                , #{pcAtchFileSeq}                , NULL            </when>            <when test="mdCd eq 'mobile'.toString()">                , NULL                , #{mblAtchFileSeq}            </when>        </choose>        , #{mnCopy}        , #{mnHexCd}        , #{subCopy}        , #{subHexCd}        , #{linkUrl}        , #{newWndwYn}        , #{ord}        , #{mainYn}        , #{regId}        , #{regIp}        , NOW()        , #{category}        )    </insert>    <!--     쿼리명 : SMBMnVslMapper.updateMnVsl     설  명 :  메인 비주얼 수정      수정일     수정자       수정내용    ==========   ======    ==============    2023.10.23   임서화      최초생성    -->    <update id="updateMnVsl" parameterType="SMBMainVslDTO">        UPDATE /* SMBMnVslMapper.updateMnVsl */ SM_MAIN_VSL_MST        SET        TITL = #{titl}        <choose>            <when test="odtmYn == 'Y'.toString()">                , STRT_DTM = NULL                , END_DTM = NULL            </when>            <otherwise>                , STRT_DTM = #{strtDtm}                , END_DTM = #{endDtm}            </otherwise>        </choose>        , ODTM_YN = #{odtmYn}        <choose>            <when test="mdCd eq 'pc'.toString()">                , PC_ATCH_FILE_SEQ = #{pcAtchFileSeq}                , MBL_ATCH_FILE_SEQ = NULL            </when>            <when test="mdCd eq 'mobile'.toString()">                , PC_ATCH_FILE_SEQ = NULL                , MBL_ATCH_FILE_SEQ = #{mblAtchFileSeq}            </when>        </choose>        , MN_COPY = #{mnCopy}        , MN_HEX_CD = #{mnHexCd}        , SUB_COPY = #{subCopy}        , SUB_HEX_CD = #{subHexCd}        , LINK_URL = #{linkUrl}        , NEW_WNDW_YN = #{newWndwYn}        , MAIN_YN = #{mainYn}        , MOD_ID = #{regId}        , MOD_IP = #{regIp}        , MOD_DTM = NOW()        , CATEGORY = #{category}        WHERE 1=1        AND SEQ = #{detailsKey}        AND MD_CD = #{mdCd}    </update>    <!--     쿼리명 : SMBMnVslMapper.deleteMnVsl     설  명 :  메인 비주얼 삭제      수정일     수정자       수정내용    ==========   ======    ==============    2023.10.23   임서화      최초생성    -->    <delete id="deleteMnVsl" parameterType="SMBMainVslDTO">        DELETE /* SMBMnVslMapper.deleteMnVsl */        FROM        SM_MAIN_VSL_MST        <where>            <choose>                <when test="delValueList != null and delValueList.size() > 0">                    SEQ IN                    <foreach collection="delValueList" item="delValueList" index="index" separator=", " open="(" close=")">                        #{delValueList}                    </foreach>                </when>                <otherwise>                    SEQ = #{detailsKey}                </otherwise>            </choose>            AND MD_CD = #{mdCd}        </where>    </delete>    <!--     쿼리명 : SMBMnVslMapper.updateOrder     설  명 :  메인 비주얼 정렬 수정      수정일     수정자       수정내용    ==========   ======    ==============    2023.10.23   임서화      최초생성    -->    <update id="updateOrder" parameterType="SMBMainVslDTO">        UPDATE /* SMBMnVslMapper.updateOrder */ SM_MAIN_VSL_MST        SET            ORD = #{ord}          , MOD_ID = #{modId}          , MOD_IP = #{modIp}          , MOD_DTM = NOW()        WHERE 1=1          AND SEQ = #{seq}          AND MD_CD = #{mdCd}    </update>    <!--     쿼리명 : SMBMnVslMapper.selectMnNewRow     설  명 : 메인 비주얼 정렬을 위한 row를 조회한다.      수정일     수정자       수정내용    ==========   ======    ==============    2023.10.23   임서화      최초생성-->    <select id="selectMnNewRow" parameterType="SMBMainVslDTO">        SELECT /* SMBMnVslMapper.selectMnNewRow */            SEQ,            ORD,            MD_CD        FROM            SM_MAIN_VSL_MST        WHERE            ORD = (                SELECT                    <if test='sortType == "UP"'>                        MIN(ORD)                    </if>                    <if test='sortType == "DOWN"'>                        MAX(ORD)                    </if>                FROM                    SM_MAIN_VSL_MST                WHERE                    1=1                    <if test='sortType == "UP"'>                        AND ORD <![CDATA[>]]> #{ord}                    </if>                    <if test='sortType == "DOWN"'>                        AND ORD <![CDATA[<]]> #{ord}                    </if>                     AND MD_CD = #{mdCd}            )        AND MD_CD = #{mdCd}        LIMIT 1    </select>    <!--     쿼리명 : SMBMnVslMapper.selectMnVslCnt     설  명 :  노출=Y 메인 비주얼 개수      수정일     수정자       수정내용    ==========   ======    ==============    2023.10.23   임서화      최초생성    -->    <select id="selectMnVslCnt" parameterType="SMBMainVslDTO"  resultType="java.lang.Integer">        SELECT /* SMBMnVslMapper.selectMnVslCnt */            COUNT(SEQ)        FROM            SM_MAIN_VSL_MST        WHERE 1=1            AND MD_CD = #{mdCd}            AND MAIN_YN = 'Y'        <if test="detailsKey != null and detailsKey != '' ">            AND SEQ <![CDATA[<>]]> #{detailsKey}        </if>    </select>    <!--     쿼리명 : SMBMnVslMapper.selectNowMnVsl     설  명 :  기존에 노출 중인 메인 비주얼      수정일     수정자       수정내용    ==========   ======    ==============    2023.10.23   임서화      최초생성    -->    <select id="selectNowMnVsl" parameterType="SMBMainVslDTO"  resultType="SMBMainVslDTO">        SELECT /* SMBMnVslMapper.selectNowMnVsl */        <choose>            <when test="mdCd eq 'pc'.toString()">                (CASE                    WHEN                        EXISTS(SELECT                                   'x'                               FROM                                   CO_FILE_DTL                               WHERE FILE_SEQ = A.PC_ATCH_FILE_SEQ                                 AND instr(#{imageExtns}, FILE_EXTN) <![CDATA[>]]> 0                               ) THEN 'image'                    WHEN                        EXISTS(SELECT                                   'x'                               FROM                                   CO_FILE_DTL                               WHERE FILE_SEQ = A.PC_ATCH_FILE_SEQ                                 AND instr(#{videoExtns}, FILE_EXTN) <![CDATA[>]]> 0                               )THEN 'video'                    ELSE NULL                END) AS BEFORE_GB            </when>            <when test="mdCd eq 'mobile'.toString()">                (CASE                    WHEN                        EXISTS(SELECT                                 'x'                                FROM                                    CO_FILE_DTL                                WHERE FILE_SEQ = A.MBL_ATCH_FILE_SEQ                                    AND instr(#{imageExtns}, FILE_EXTN) <![CDATA[>]]> 0                                ) THEN 'image'                WHEN                    EXISTS(SELECT                             'x'                            FROM                                CO_FILE_DTL                            WHERE FILE_SEQ = A.MBL_ATCH_FILE_SEQ                                AND instr(#{videoExtns}, FILE_EXTN) <![CDATA[>]]> 0                            ) THEN 'video'                ELSE NULL            END) AS BEFORE_GB            </when>        </choose>        <choose>            <when test="mdCd eq 'pc'.toString()">                , (CASE                    WHEN                        EXISTS(SELECT                                   'x'                               FROM                                   CO_FILE_DTL                               WHERE FILE_SEQ = #{pcAtchFileSeq}                                 AND instr(#{imageExtns}, FILE_EXTN) <![CDATA[>]]> 0                                     ) THEN 'image'                WHEN                    EXISTS(SELECT                               'x'                           FROM                               CO_FILE_DTL                           WHERE FILE_SEQ = #{pcAtchFileSeq}                             AND instr(#{videoExtns}, FILE_EXTN) <![CDATA[>]]> 0                           ) THEN 'video'                ELSE NULL            END) AS NOW_GB            </when>            <when test="mdCd eq 'mobile'.toString()">                , (CASE                    WHEN                        EXISTS(SELECT                                   'x'                               FROM                                   CO_FILE_DTL                               WHERE FILE_SEQ = #{mblAtchFileSeq}                                 AND instr(#{imageExtns}, FILE_EXTN) <![CDATA[>]]> 0                               ) THEN 'image'                WHEN                    EXISTS(SELECT                               'x'                           FROM                               CO_FILE_DTL                           WHERE FILE_SEQ = #{mblAtchFileSeq}                             AND instr(#{videoExtns}, FILE_EXTN) <![CDATA[>]]> 0                           ) THEN 'video'                ELSE NULL            END) AS NOW_GB            </when>        </choose>        FROM            SM_MAIN_VSL_MST A        WHERE 1=1            AND MD_CD = #{mdCd}            AND MAIN_YN = 'Y'        ORDER BY            MOD_DTM DESC        LIMIT 1    </select>    <!--		쿼리명 : selectMnVslwhereSql		설  명 : 비주얼 관리 where Sql	      수정일      수정자       수정내용        ==========   ========   ==============        2023.11.02    구은희       최초생성    -->    <sql id="selectMnVslwhereSql">        <where>            <if test="siteGubun == 'front' ">                AND MAIN_YN = 'Y'            </if>            <if test="mdCd != null and mdCd != ''.toString() ">                AND MD_CD = #{mdCd}            </if>            <if test="strtDtm != null and strtDtm != ''.toString() ">                AND STRT_DTM <![CDATA[ > ]]> STR_TO_DATE(#{strtDtm}, '%Y-%m-%d')            </if>            <if test="endDtm !=  null and endDtm != ''.toString() ">                AND END_DTM <![CDATA[ < ]]> DATE_ADD(STR_TO_DATE(#{endDtm}, '%Y-%m-%d'), INTERVAL 1 DAY)            </if>            <if test="srchDate != null and srchDate != ''.toString() ">                <choose>                    <when test="srchDate == 1">                        <if test="dStrDt != null and dStrDt != ''.toString() ">                            AND REG_DTM <![CDATA[ > ]]> str_to_date(#{dStrDt}, '%Y-%m-%d')                            AND REG_DTM <![CDATA[ < ]]> date_add(str_to_date(#{dEndDt}, '%Y-%m-%d'), INTERVAL 1 DAY)                        </if>                    </when>                    <when test="srchDate == 2">                        <if test="dEndDt != null and dEndDt != ''.toString() ">                            AND MOD_DTM <![CDATA[ > ]]> STR_TO_DATE(#{dStrDt}, '%Y-%m-%d')                            AND MOD_DTM <![CDATA[ < ]]> DATE_ADD(STR_TO_DATE(#{dEndDt}, '%Y-%m-%d'), INTERVAL 1 DAY)                        </if>                    </when>                    <otherwise>                    </otherwise>                </choose>            </if>            <if test="odtmYn != null and odtmYn != ''.toString() ">                AND ODTM_YN = #{odtmYn}            </if>            <if test="mainYnList != null and mainYnList.size() > 0">                AND (                <foreach collection="mainYnList" item="mainYnList" index="index" open="" close="" separator=" or ">                    MAIN_YN = #{mainYnList}                </foreach>                )            </if>            <if test="categoryList != null and categoryList.size() > 0">                AND (                <foreach collection="categoryList" item="category" index="index" open="" close="" separator=" OR ">                    CATEGORY = #{category}                </foreach>                )            </if>            <if test="q != null and q != ''">                <choose>                    <when test="f == 1">                        AND TITL LIKE CONCAT('%', #{q}, '%')                    </when>                    <when test="f == 2">                        AND (                        INSTR(#{q}, A.REG_ID) <![CDATA[>]]> 0 OR                        EXISTS(SELECT 'x' FROM CO_ADM_MST WHERE ID = A.REG_ID AND INSTR(#{q}, NAME) <![CDATA[>]]> 0)                        )                    </when>                    <when test="f == 3">                        AND (                        INSTR(#{q}, MOD_ID) <![CDATA[>]]> 0 OR                        EXISTS(SELECT 'x' FROM CO_ADM_MST WHERE ID = A.MOD_ID AND INSTR(#{q}, NAME) <![CDATA[>]]> 0)                        )                    </when>                    <otherwise>                        AND (                        INSTR(#{q}, TITL) <![CDATA[>]]> 0 OR                        INSTR(#{q}, REG_ID) <![CDATA[>]]> 0 OR                        EXISTS(SELECT 'x' FROM CO_ADM_MST WHERE ID = A.REG_ID AND INSTR(#{q}, NAME) <![CDATA[>]]> 0) OR                        INSTR(#{q}, MOD_ID) <![CDATA[>]]> 0 OR                        EXISTS(SELECT 'x' FROM CO_ADM_MST WHERE ID = A.MOD_ID AND INSTR(#{q}, NAME) <![CDATA[>]]> 0)                        )                    </otherwise>                </choose>            </if>        </where>    </sql></mapper>