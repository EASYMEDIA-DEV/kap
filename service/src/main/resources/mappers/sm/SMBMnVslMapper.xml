<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"><mapper namespace="com.kap.service.dao.sm.SMBMnVslMapper">    <!--         쿼리명 : SMBMnVslMapper.selectMnVslList         설  명 :  메인 비주얼 목록 조회.          수정일     수정자       수정내용        ==========   ======    ==============        2023.10.23   임서화      최초생성        2024.01.05   이옥정      사용자 노출을 위한 예외 조건문 추가    -->    <select id="selectMnVslList" parameterType="SMBMainVslDTO" resultType="SMBMainVslDTO">        SELECT /* SMBMnVslMapper.selectMnVslList */            VSL_SEQ,            TITL,            DATE_FORMAT(EXPS_STRT_DTM, '%Y-%m-%d %H:%i:%s') AS EXPS_STRT_DTM,            DATE_FORMAT(EXPS_END_DTM, '%Y-%m-%d %H:%i:%s') AS EXPS_END_DTM,            #{dStrDt} AS 'ptupSrchStrDt',            #{dEndDt} AS 'ptupSrchEndDt',            ODTM_YN,            EXPS_YN,            <if test='siteGubun != "front"'>            REG_ID,            (SELECT NAME FROM CO_ADM_MST WHERE ID = A.REG_ID) AS REG_NAME,            (SELECT NAME FROM CO_ADM_MST WHERE ID = A.MOD_ID) AS MOD_NAME,            REG_DTM,            MOD_ID,            MOD_DTM,            </if>            <if test='siteGubun == "front"'>                (SELECT web_path FROM CO_FILE_DTL  WHERE FILE_SEQ = A.FILE_SEQ ORDER BY FILE_ORD DESC LIMIT 1) WEB_PATH ,                (SELECT FILE_EXTN FROM CO_FILE_DTL  WHERE FILE_SEQ = A.FILE_SEQ ORDER BY FILE_ORD DESC LIMIT 1) FILE_EXTN ,                (SELECT file_dsc FROM CO_FILE_DTL  WHERE FILE_SEQ = A.FILE_SEQ ORDER BY FILE_ORD DESC LIMIT 1) FILE_DSC ,                mn_copy,                mn_hex_cd,                sub_copy,                sub_hex_cd,                url_url,                wnpp_yn,            </if>            EXPS_ORD,            MD_CD,            TAG_CD        FROM            SM_MAIN_VSL_MST A        WHERE            1=1            <include refid="selectMnVslwhereSql" />        LIMIT #{firstIndex}, #{recordCountPerPage}    </select>    <!--         쿼리명 : SMBMnVslMapper.selectMnVsldTotCnt         설  명 :  메인 비주얼 목록 카운트.          수정일     수정자       수정내용        ==========   ======    ==============        2023.10.23   임서화      최초생성    -->    <select id="selectMnVsldTotCnt" parameterType="SMBMainVslDTO" resultType="java.lang.Integer">        SELECT /* SMBMnVslMapper.selectMnVsldTotCnt */            count(*)        FROM            SM_MAIN_VSL_MST A        WHERE            1=1            <include refid="selectMnVslwhereSql" />    </select>    <!--         쿼리명 : SMBMnVslMapper.selectMnVslDtl         설  명 :  메인 비주얼 상세 조회          수정일     수정자       수정내용        ==========   ======    ==============        2023.10.23   임서화      최초생성    -->    <select id="selectMnVslDtl" parameterType="SMBMainVslDTO" resultType="SMBMainVslDTO">        SELECT /* SMBMnVslMapper.selectMnVslDtl */            VSL_SEQ             , TITL             , EXPS_STRT_DTM             , EXPS_END_DTM             , ODTM_YN             , (SELECT FILE_EXTN FROM CO_FILE_DTL  WHERE FILE_SEQ = A.FILE_SEQ ORDER BY FILE_ORD DESC LIMIT 1) FILE_EXTN             , FILE_SEQ             , MN_COPY             , MN_HEX_CD             , SUB_COPY             , SUB_HEX_CD             , URL_URL             , WNPP_YN             , EXPS_YN             , REG_ID             , (SELECT NAME FROM CO_ADM_MST WHERE ID = A.REG_ID) AS REG_NAME             , REG_DTM             , MOD_ID             , (SELECT NAME FROM CO_ADM_MST WHERE ID = A.MOD_ID) AS MOD_NAME             , MOD_DTM             , TAG_CD        FROM            SM_MAIN_VSL_MST A        WHERE 1=1          AND VSL_SEQ = #{detailsKey}          AND MD_CD = #{mdCd}    </select>    <!--     쿼리명 : SMBMnVslMapper.insertMnVsl     설  명 :  메인 비주얼 등록      수정일     수정자       수정내용    ==========   ======    ==============    2023.10.23   임서화      최초생성    -->    <insert id="insertMnVsl" parameterType="SMBMainVslDTO">        <selectKey keyProperty="expsOrd" resultType="java.lang.Integer" order="BEFORE">            SELECT IFNULL(MAX(EXPS_ORD), 0) + 1 FROM SM_MAIN_VSL_MST WHERE MD_CD = #{mdCd}        </selectKey>        INSERT /* SMBMnVslMapper.insertMnVsl */ INTO SM_MAIN_VSL_MST        ( VSL_SEQ        , MD_CD        , TITL        , EXPS_STRT_DTM        , EXPS_END_DTM        , ODTM_YN        , FILE_SEQ        , MN_COPY        , MN_HEX_CD        , SUB_COPY        , SUB_HEX_CD        , URL_URL        , WNPP_YN        , EXPS_ORD        , EXPS_YN        , REG_ID        , REG_IP        , REG_DTM        , TAG_CD        )        VALUES        ( #{vslSeq}        , #{mdCd}        , #{titl}        <choose>            <when test="odtmYn == 'Y'.toString()">                , NULL                , NULL            </when>            <otherwise>                , CONCAT(#{expsStrtDtm}, ' ', #{ptupStrtHh}, ':', #{ptupStrtMi})                , CONCAT(#{expsEndDtm}, ' ', #{ptupEndHh}, ':', #{ptupEndMi})            </otherwise>        </choose>        , #{odtmYn}        , #{fileSeq}        , #{mnCopy}        , #{mnHexCd}        , #{subCopy}        , #{subHexCd}        , #{urlUrl}        , #{wnppYn}        , #{expsOrd}        , #{expsYn}        , #{regId}        , #{regIp}        , NOW()        , #{tagCd}        )    </insert>    <!--     쿼리명 : SMBMnVslMapper.updateMnVsl     설  명 :  메인 비주얼 수정      수정일     수정자       수정내용    ==========   ======    ==============    2023.10.23   임서화      최초생성    -->    <update id="updateMnVsl" parameterType="SMBMainVslDTO">        UPDATE /* SMBMnVslMapper.updateMnVsl */ SM_MAIN_VSL_MST        SET        TITL = #{titl}        <choose>            <when test="odtmYn == 'Y'.toString()">                , EXPS_STRT_DTM = NULL                , EXPS_END_DTM = NULL            </when>            <otherwise>                , EXPS_STRT_DTM = CONCAT(#{expsStrtDtm}, ' ', #{ptupStrtHh}, ':', #{ptupStrtMi})                , EXPS_END_DTM = CONCAT(#{expsEndDtm}, ' ', #{ptupEndHh}, ':', #{ptupEndMi})            </otherwise>        </choose>        , ODTM_YN = #{odtmYn}        , FILE_SEQ = #{fileSeq}        , MN_COPY = #{mnCopy}        , MN_HEX_CD = #{mnHexCd}        , SUB_COPY = #{subCopy}        , SUB_HEX_CD = #{subHexCd}        , URL_URL = #{urlUrl}        , WNPP_YN = #{wnppYn}        , EXPS_YN = #{expsYn}        , MOD_ID = #{regId}        , MOD_IP = #{regIp}        , MOD_DTM = NOW()        , TAG_CD = #{tagCd}        WHERE 1=1        AND VSL_SEQ = #{detailsKey}        AND MD_CD = #{mdCd}    </update>    <!--     쿼리명 : SMBMnVslMapper.deleteMnVsl     설  명 :  메인 비주얼 삭제      수정일     수정자       수정내용    ==========   ======    ==============    2023.10.23   임서화      최초생성    -->    <delete id="deleteMnVsl" parameterType="SMBMainVslDTO">        DELETE /* SMBMnVslMapper.deleteMnVsl */        FROM        SM_MAIN_VSL_MST        <where>            <choose>                <when test="delValueList != null and delValueList.size() > 0">                    VSL_SEQ IN                    <foreach collection="delValueList" item="delValueList" index="index" separator=", " open="(" close=")">                        #{delValueList}                    </foreach>                </when>                <otherwise>                    VSL_SEQ = #{detailsKey}                </otherwise>            </choose>            AND MD_CD = #{mdCd}        </where>    </delete>    <!--     쿼리명 : SMBMnVslMapper.updateOrder     설  명 :  메인 비주얼 정렬 수정      수정일     수정자       수정내용    ==========   ======    ==============    2023.10.23   임서화      최초생성    -->    <update id="updateOrder" parameterType="SMBMainVslDTO">        UPDATE /* SMBMnVslMapper.updateOrder */ SM_MAIN_VSL_MST        SET            EXPS_ORD = #{expsOrd}          , MOD_ID = #{modId}          , MOD_IP = #{modIp}          , MOD_DTM = NOW()        WHERE 1=1          AND VSL_SEQ = #{vslSeq}          AND MD_CD = #{mdCd}    </update>    <!--     쿼리명 : SMBMnVslMapper.selectMnNewRow     설  명 : 메인 비주얼 정렬을 위한 row를 조회한다.      수정일     수정자       수정내용    ==========   ======    ==============    2023.10.23   임서화      최초생성-->    <select id="selectMnNewRow" parameterType="SMBMainVslDTO">        SELECT /* SMBMnVslMapper.selectMnNewRow */            VSL_SEQ,            EXPS_ORD,            MD_CD        FROM            SM_MAIN_VSL_MST        WHERE        EXPS_ORD = (                SELECT                    <if test='sortType == "UP"'>                        MIN(EXPS_ORD)                    </if>                    <if test='sortType == "DOWN"'>                        MAX(EXPS_ORD)                    </if>                FROM                    SM_MAIN_VSL_MST                WHERE                    1=1                    <if test='sortType == "UP"'>                        AND EXPS_ORD <![CDATA[>]]> #{expsOrd}                    </if>                    <if test='sortType == "DOWN"'>                        AND EXPS_ORD <![CDATA[<]]> #{expsOrd}                    </if>                     AND MD_CD = #{mdCd}            )        AND MD_CD = #{mdCd}        LIMIT 1    </select>    <!--     쿼리명 : SMBMnVslMapper.selectMnVslCnt     설  명 :  노출=Y 메인 비주얼 개수      수정일     수정자       수정내용    ==========   ======    ==============    2023.10.23   임서화      최초생성    -->        <select id="selectMnVslCnt" parameterType="SMBMainVslDTO"  resultType="java.lang.Integer">            SELECT /* SMBMnVslMapper.selectMnVslCnt */                COUNT(VSL_SEQ)            FROM                SM_MAIN_VSL_MST            WHERE 1=1                AND MD_CD = #{mdCd}                AND EXPS_YN = 'Y'                AND TAG_CD = #{tagCd}            <if test='odtmYn != "Y"'>                AND ( EXPS_STRT_DTM <![CDATA[>=]]> STR_TO_DATE(#{expsStrtDtm}, '%Y-%m-%d')                OR EXPS_END_DTM <![CDATA[<=]]> DATE_ADD(STR_TO_DATE(#{expsEndDtm}, '%Y-%m-%d'), INTERVAL 1 DAY) )            </if>            <if test='odtmYn =="Y"'>                AND ODTM_YN = 'Y'            </if>            <if test="vslSeq != null and vslSeq != ''.toString() ">                AND NOT VSL_SEQ IN (#{vslSeq})            </if>        </select>    <!--		쿼리명 : selectMnVslwhereSql		설  명 : 비주얼 관리 where Sql	      수정일      수정자       수정내용        ==========   ========   ==============        2023.11.02    구은희       최초생성        2024.01.05    이옥정      사용자 노출을 위한 예외 조건문 추가    -->    <sql id="selectMnVslwhereSql">        <if test='siteGubun == "front"'>            AND exps_yn = 'Y'            AND ( IFNULL(odtm_yn, 'N') = 'Y'            OR (exps_strt_dtm <![CDATA[ <= ]]> SYSDATE() AND exps_end_dtm <![CDATA[ > ]]> DATE_ADD(now(), INTERVAL 1 minute)            ))        </if>        <if test="dStrDt != null and dStrDt != ''.toString() and dEndDt !=  null and dEndDt != ''.toString()">            AND EXPS_STRT_DTM <![CDATA[ >= ]]> STR_TO_DATE(#{dStrDt}, '%Y-%m-%d')            AND EXPS_END_DTM <![CDATA[ <= ]]> DATE_ADD(STR_TO_DATE(#{dEndDt}, '%Y-%m-%d'), INTERVAL 1 DAY)            OR ODTM_YN = 'Y'        </if>        <if test="strtDt != null and strtDt != ''">            <choose>                <when test="srchDate == 1">                    AND REG_DTM <![CDATA[>=]]> DATE_FORMAT(#{strtDt}, '%Y-%m-%d')                </when>                <when test="srchDate == 2">                    AND MOD_DTM <![CDATA[>=]]> DATE_FORMAT(#{strtDt}, '%Y-%m-%d')                </when>            </choose>        </if>        <if test="endDt != null and endDt != ''">            <choose>                <when test="srchDate == 1">                    AND REG_DTM <![CDATA[<]]>  DATE_ADD(DATE_FORMAT(#{endDt}, '%Y-%m-%d'), INTERVAL 1 DAY)                </when>                <when test="srchDate == 2">                    AND MOD_DTM <![CDATA[<]]>  DATE_ADD(DATE_FORMAT(#{endDt}, '%Y-%m-%d'), INTERVAL 1 DAY)                </when>            </choose>        </if>        <if test="odtmYn != null and odtmYn != ''.toString() ">            AND ODTM_YN = #{odtmYn}        </if>        <if test="mainYnList != null and mainYnList.size() > 0">            AND (            <foreach collection="mainYnList" item="mainYnList" index="index" open="" close="" separator=" or ">                EXPS_YN = #{mainYnList}            </foreach>            )        </if>        <if test="tagCdList != null and tagCdList.size() > 0">            AND (            <foreach collection="tagCdList" item="tagCd" index="index" open="" close="" separator=" OR ">                TAG_CD = #{tagCd}            </foreach>            )        </if>        <if test="mdCd != null and mdCd != ''.toString() ">            AND MD_CD = #{mdCd}        </if>        <if test="q != null and q != ''">            <choose>                <when test="f == 1">                    AND TITL LIKE CONCAT('%', #{q}, '%')                </when>                <when test="f == 2">                    AND (                    A.REG_ID LIKE CONCAT('%', #{q}, '%') OR                    EXISTS(SELECT 'x' FROM CO_ADM_MST WHERE ID = A.REG_ID AND NAME LIKE CONCAT('%', #{q}, '%') <![CDATA[>]]> 0)                    )                </when>                <when test="f == 3">                    AND (                    A.MOD_ID LIKE CONCAT('%', #{q}, '%') OR                    EXISTS(SELECT 'x' FROM CO_ADM_MST WHERE ID = A.MOD_ID AND NAME LIKE CONCAT('%', #{q}, '%') <![CDATA[>]]> 0)                    )                </when>                <otherwise>                    AND (                    TITL LIKE CONCAT('%', #{q}, '%') OR                    A.REG_ID LIKE CONCAT('%', #{q}, '%') OR                    EXISTS(SELECT 'x' FROM CO_ADM_MST WHERE ID = A.REG_ID AND NAME LIKE CONCAT('%', #{q}, '%') <![CDATA[>]]> 0) OR                    A.MOD_ID LIKE CONCAT('%', #{q}, '%') OR                    EXISTS(SELECT 'x' FROM CO_ADM_MST WHERE ID = A.MOD_ID AND NAME LIKE CONCAT('%', #{q}, '%') <![CDATA[>]]> 0)                    )                </otherwise>            </choose>        </if>        ORDER BY            EXPS_ORD DESC    </sql></mapper>