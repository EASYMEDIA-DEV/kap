<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kap.service.dao.cb.cba.CBATechGuidanceMapper">
    <!--
         쿼리명 : CBATechGuidanceMapper.selectTechGuidanceList
         설  명 :  컨설팅 기술 관리 목록 조회.
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.11.14   임서화      최초 생성
    -->
    <select id="selectTechGuidanceList" parameterType="CBATechGuidanceInsertDTO" resultType="CBATechGuidanceInsertDTO">
        SELECT /* CBATechGuidanceMapper.selectTechGuidanceList */
            CNSTG_SEQ					/* 컨설팅순번 */
            , CNSTG_CD                  /* 컨설팅코드 */
            , BSN_YEAR					/* 사엽연도 */
            , RSUME_STTS_CD			    /* 진행상태코드 */
            , RSUME_STTS_NM			    /* 진행상태코드명 */
            , CMPN_NM					/* 부품사명 */
            , CTGRY_CD					/* 부품사구분코드 */
            , CTGRY_NM					/* 부품사구분코드명 */
            , SIZE_CD					/* 부품사규모코드 */
            , SIZE_NM					/* 부품사큐모코드명 */
            , APPCTN_BSNM_NO			/* 신청당시 사업자번호 */
            , APPCTN_MEM_SEQ            /* 신청자 멤버 시퀀스 */
            , SLS_PMT					/* 매출액(억원) */
            , MPLE_CNT					/* 부품사 직원수 */
            , CBSN_NM                   /* 신청 업종 */
            , CBSN_CD                   /* 신청 업종 코드 */
            , FIRST_RGNS_CD			    /* 첫번째 지역 코드 */
            , FIRST_RGNS_NM			    /* 첫번째 지역 코드명 */
            , SCND_RGNS_CD				/* 두번째 지역 코드 */
            , SCND_RGNS_NM				/* 첫번째 지역 코드명 */
            , CRTFN_CMPN_NM			    /* SQ 인증 주관사 */
            , MN_CMPN_NM				/* 주고객사 */
            , VST_DT					/* 방문일 */
            , CMSSR_SEQ					/* 위원순번 */
            , CMSSR_NM					/* 위원이름 */
            , VST_CNT                   /* 방문 횟수 */
            , CMSSR_CBSN_CD			    /* 담당위원지도분야 코드 */
            , CMSSR_CBSN_NM			    /* 담당위원지도분야 코드명 */
            , GUIDE_KICKF_DT			/* 킥오프시작일 */
            , KICKF_FILE_SEQ			/* 킥오프파일순번 */
            , KICKF_FILE_ORD            /* 킥오프파일ORD */
            , CNSTG_PSCND_CD			/* 컨설팅현황코드 */
            , CNSTG_PSCND_NM			/* 컨설팅현황코드명 */
            , CNSTG_PSCND_DT			/* 컨설팅현황일자 */
            , GUIDE_PSCND_DT            /* 렙업일 */
            , GUIDE_BGN_DT              /* 지도착수일 */
            , LVLUP_FILE_SEQ			/* 렙업파일순번 */
            , LVLUP_FILE_ORD			/* 렙업파일ORD */
            , APPCTN_DT					/* 신청일 */
            , REG_ID					/* 등록자ID */
            , REG_NAME					/* 등록자이름 */
            , REG_DTM					/* 등록일 */
            , MOD_ID					/* 수정자ID */
            , MOD_NAME					/* 수정자이름 */
            , MOD_DTM					/* 수정일 */
        FROM(
            SELECT
                CP_MST.CNSTG_SEQ
                , CP_MST.CNSTG_CD
                , CP_MST.BSN_YEAR
                , CP_MST.RSUME_STTS_CD
                , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = CP_MST.RSUME_STTS_CD AND CD_ID = 'MNGTECH_STATUS') RSUME_STTS_NM
                , CMPN_MST.CMPN_NM
                , CMPN_MST.CTGRY_CD
                , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = CMPN_MST.CTGRY_CD AND CD_ID = 'COMPANY_TYPE') CTGRY_NM
                , CMPN_MST.SIZE_CD
                , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = CMPN_MST.SIZE_CD AND CD_ID = 'COMPANY_TYPE') SIZE_NM
                , CP_MST.APPCTN_BSNM_NO
                , CP_MST.APPCTN_MEM_SEQ
                , CMPN_MST.SLS_PMT
                , CMPN_MST.MPLE_CNT
                , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = (SELECT CD FROM CP_CNSTG_CBSN_DTL WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ)) CBSN_NM
                , (SELECT CD FROM CO_CODE_MST WHERE CD = (SELECT CD FROM CP_CNSTG_CBSN_DTL WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ)) CBSN_CD
                , CP_MST.FIRST_RGNS_CD
                , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = CP_MST.FIRST_RGNS_CD AND CD_ID = 'ADDR_CD') FIRST_RGNS_NM
                , CP_MST.SCND_RGNS_CD
                , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = CP_MST.SCND_RGNS_CD AND CD_ID = 'ADDR_CD') SCND_RGNS_NM
                , (SELECT CRTFN_CMPN_NM FROM CP_CMPN_CBSN_DTL CMPNDTL WHERE BSNM_NO = CP_MST.APPCTN_BSNM_NO ORDER BY CMPNDTL.YEAR DESC, CMPNDTL.REG_DTM DESC LIMIT 1) CRTFN_CMPN_NM
                , (SELECT CMPN_NM FROM CP_CNSTG_DLVRY_DTL WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ ORDER BY RATE DESC LIMIT 1) MN_CMPN_NM
                , CPR_MST.VST_DT
                , CPR_MST.CMSSR_SEQ
                , (SELECT NAME FROM CO_MEM_MST WHERE MEM_CD = 'CS' AND MEM_SEQ = (SELECT CMSSR_SEQ FROM CP_CNSTG_RSUME_MST WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ)) CMSSR_NM
                , (SELECT COUNT(*) FROM CO_CMSSR_ATNDC_MST WHERE CNSTG_SEQ_1 = CP_MST.CNSTG_SEQ OR CNSTG_SEQ_2 = CP_MST.CNSTG_SEQ) VST_CNT
                , (SELECT CMSSR_CBSN_CD FROM CO_MEM_MST WHERE MEM_CD = 'CS' AND MEM_SEQ = (SELECT CMSSR_SEQ FROM CP_CNSTG_RSUME_MST WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ)) CMSSR_CBSN_CD
                , (SELECT CD_NM FROM CO_CODE_MST WHERE CD_ID = 'MEM_CD' AND CD = (SELECT CMSSR_CBSN_CD FROM CO_MEM_MST WHERE MEM_CD = 'CS' AND MEM_SEQ = (SELECT CMSSR_SEQ FROM CP_CNSTG_RSUME_MST WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ))) CMSSR_CBSN_NM
                , CPR_MST.GUIDE_KICKF_DT
                , CPR_MST.KICKF_FILE_SEQ
                , (SELECT FILE_ORD FROM CO_FILE_DTL WHERE FILE_SEQ = CPR_MST.KICKF_FILE_SEQ AND USE_YN = 'Y') KICKF_FILE_ORD
                , CPR_MST.CNSTG_PSCND_CD
                , CPR_MST.GUIDE_PSCND_DT
                , CPR_MST.GUIDE_BGN_DT
                , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = CPR_MST.CNSTG_PSCND_CD AND CD_ID = 'CNSTG_PSCND') CNSTG_PSCND_NM
                , CPR_MST.CNSTG_PSCND_DT
                , CPR_MST.LVLUP_FILE_SEQ
                , (SELECT FILE_ORD FROM CO_FILE_DTL WHERE FILE_SEQ = CPR_MST.LVLUP_FILE_SEQ AND USE_YN = 'Y') LVLUP_FILE_ORD
                , CP_MST.APPCTN_DT
                , CP_MST.REG_ID
                , (SELECT NAME FROM CO_MEM_MST WHERE ID = CP_MST.REG_ID) REG_NAME
                , CP_MST.REG_DTM
                , CP_MST.MOD_ID
                , (SELECT NAME FROM CO_MEM_MST WHERE ID = CP_MST.MOD_ID) MOD_NAME
                , CPR_MST.MOD_DTM
            FROM
                CP_CNSTG_APPCTN_MST CP_MST
            JOIN CO_MEM_MST MEM_MST
                ON MEM_MST.MEM_SEQ = CP_MST.APPCTN_MEM_SEQ
                LEFT JOIN CP_CMPN_MST CMPN_MST
                    ON CMPN_MST.BSNM_NO = CP_MST.APPCTN_BSNM_NO
                LEFT JOIN CP_CNSTG_RSUME_MST CPR_MST
                    ON CP_MST.CNSTG_SEQ = CPR_MST.CNSTG_SEQ
            ) MST
        <include refid="selectTechGuidancewhereSql" />
        ORDER BY
        REG_DTM DESC
        LIMIT #{firstIndex}, #{recordCountPerPage}
    </select>
    <!--
         쿼리명 : CBATechGuidanceMapper.selectTechGuidanceTotCnt
         설  명 :  컨설팅 기술 관리 목록 카운트.
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.11.14   임서화      최초 생성
    -->
    <select id="selectTechGuidanceTotCnt" parameterType="CBATechGuidanceInsertDTO" resultType="java.lang.Integer">

    SELECT  /* CBATechGuidanceMapper.selectTechGuidanceTotCnt */
        COUNT(*)
    FROM (
        SELECT
            CNSTG_SEQ					/* 컨설팅순번 */
             , CNSTG_CD                  /* 컨설팅코드 */
             , BSN_YEAR					/* 사엽연도 */
             , RSUME_STTS_CD			/* 진행상태코드 */
             , RSUME_STTS_NM			/* 진행상태코드명 */
             , CMPN_NM					/* 부품사명 */
             , CTGRY_CD					/* 부품사구분코드 */
             , CTGRY_NM					/* 부품사구분코드명 */
             , SIZE_CD					/* 부품사규모코드 */
             , SIZE_NM					/* 부품사큐모코드명 */
             , APPCTN_BSNM_NO			/* 신청당시 사업자번호 */
             , SLS_PMT					/* 매출액(억원) */
             , MPLE_CNT					/* 부품사 직원수 */
             , CBSN_NM                  /* 신청 업종 */
             , CBSN_CD                  /* 신청 업종 코드 */
             , FIRST_RGNS_CD			/* 첫번째 지역 코드 */
             , FIRST_RGNS_NM			/* 첫번째 지역 코드명 */
             , SCND_RGNS_CD				/* 두번째 지역 코드 */
             , SCND_RGNS_NM				/* 첫번째 지역 코드명 */
             , CRTFN_CMPN_NM			/* SQ 인증 주관사 */
             , MN_CMPN_NM				/* 주고객사 */
             , VST_DT					/* 방문일 */
             , CMSSR_SEQ				/* 위원순번 */
             , CMSSR_NM					/* 위원이름 */
             , VST_CNT                  /* 방문 횟수 */
             , CMSSR_CBSN_CD			/* 담당위원지도분야 코드 */
             , CMSSR_CBSN_NM			/* 담당위원지도분야 코드명 */
             , GUIDE_KICKF_DT			/* 킥오프시작일 */
             , KICKF_FILE_SEQ			/* 킥오프파일순번 */
             , KICKF_FILE_ORD           /* 킥오프파일ORD */
             , CNSTG_PSCND_CD			/* 컨설팅현황코드 */
             , CNSTG_PSCND_NM			/* 컨설팅현황코드명 */
             , CNSTG_PSCND_DT			/* 컨설팅현황일자 */
             , GUIDE_PSCND_DT           /* 렙업일 */
             , GUIDE_BGN_DT             /* 지도착수일 */
             , LVLUP_FILE_SEQ			/* 렙업파일순번 */
             , LVLUP_FILE_ORD			/* 렙업파일ORD */
             , APPCTN_DT				/* 신청일 */
             , REG_ID					/* 등록자ID */
             , REG_NAME					/* 등록자이름 */
             , REG_DTM					/* 등록일 */
             , MOD_ID					/* 수정자ID */
             , MOD_NAME					/* 수정자이름 */
             , MOD_DTM					/* 수정일 */
        FROM(
            SELECT
                CP_MST.CNSTG_SEQ
                 , CP_MST.CNSTG_CD
                 , CP_MST.BSN_YEAR
                 , CP_MST.RSUME_STTS_CD
                 , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = CP_MST.RSUME_STTS_CD AND CD_ID = 'MNGTECH_STATUS') RSUME_STTS_NM
                 , CMPN_MST.CMPN_NM
                 , CMPN_MST.CTGRY_CD
                 , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = CMPN_MST.CTGRY_CD AND CD_ID = 'COMPANY_TYPE') CTGRY_NM
                 , CMPN_MST.SIZE_CD
                 , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = CMPN_MST.SIZE_CD AND CD_ID = 'COMPANY_TYPE') SIZE_NM
                 , CP_MST.APPCTN_BSNM_NO
                 , CMPN_MST.SLS_PMT
                 , CMPN_MST.MPLE_CNT
                 , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = (SELECT CD FROM CP_CNSTG_CBSN_DTL WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ)) CBSN_NM
                 , (SELECT CD FROM CO_CODE_MST WHERE CD = (SELECT CD FROM CP_CNSTG_CBSN_DTL WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ)) CBSN_CD
                 , CP_MST.FIRST_RGNS_CD
                 , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = CP_MST.FIRST_RGNS_CD AND CD_ID = 'ADDR_CD') FIRST_RGNS_NM
                 , CP_MST.SCND_RGNS_CD
                 , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = CP_MST.SCND_RGNS_CD AND CD_ID = 'ADDR_CD') SCND_RGNS_NM
                 , (SELECT CRTFN_CMPN_NM FROM CP_CMPN_CBSN_DTL CMPNDTL WHERE BSNM_NO = CP_MST.APPCTN_BSNM_NO ORDER BY CMPNDTL.YEAR DESC, CMPNDTL.REG_DTM DESC LIMIT 1) CRTFN_CMPN_NM
           , (SELECT CMPN_NM FROM CP_CNSTG_DLVRY_DTL WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ ORDER BY RATE DESC LIMIT 1) MN_CMPN_NM
           , CPR_MST.VST_DT
           , CPR_MST.CMSSR_SEQ
           , (SELECT NAME FROM CO_MEM_MST WHERE MEM_CD = 'CS' AND MEM_SEQ = (SELECT CMSSR_SEQ FROM CP_CNSTG_RSUME_MST WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ)) CMSSR_NM
           , (SELECT COUNT(*) FROM CO_CMSSR_ATNDC_MST WHERE CNSTG_SEQ_1 = CP_MST.CNSTG_SEQ OR CNSTG_SEQ_2 = CP_MST.CNSTG_SEQ) VST_CNT
           , (SELECT CMSSR_CBSN_CD FROM CO_MEM_MST WHERE MEM_CD = 'CS' AND MEM_SEQ = (SELECT CMSSR_SEQ FROM CP_CNSTG_RSUME_MST WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ)) CMSSR_CBSN_CD
           , (SELECT CD_NM FROM CO_CODE_MST WHERE CD_ID = 'MEM_CD' AND CD = (SELECT CMSSR_CBSN_CD FROM CO_MEM_MST WHERE MEM_CD = 'CS' AND MEM_SEQ = (SELECT CMSSR_SEQ FROM CP_CNSTG_RSUME_MST WHERE CNSTG_SEQ = CP_MST.CNSTG_SEQ))) CMSSR_CBSN_NM
           , CPR_MST.GUIDE_KICKF_DT
           , CPR_MST.KICKF_FILE_SEQ
           , (SELECT FILE_ORD FROM CO_FILE_DTL WHERE FILE_SEQ = CPR_MST.KICKF_FILE_SEQ AND USE_YN = 'Y') KICKF_FILE_ORD
           , CPR_MST.CNSTG_PSCND_CD
           , CPR_MST.GUIDE_PSCND_DT
           , CPR_MST.GUIDE_BGN_DT
           , (SELECT CD_NM FROM CO_CODE_MST WHERE CD = CPR_MST.CNSTG_PSCND_CD AND CD_ID = 'CNSTG_PSCND') CNSTG_PSCND_NM
           , CPR_MST.CNSTG_PSCND_DT
           , CPR_MST.LVLUP_FILE_SEQ
           , (SELECT FILE_ORD FROM CO_FILE_DTL WHERE FILE_SEQ = CPR_MST.LVLUP_FILE_SEQ AND USE_YN = 'Y') LVLUP_FILE_ORD
           , CP_MST.APPCTN_DT
           , CP_MST.REG_ID
            , (SELECT NAME FROM CO_MEM_MST WHERE ID = CP_MST.REG_ID) REG_NAME
           , CP_MST.REG_DTM
           , CPR_MST.MOD_ID
           , (SELECT NAME FROM CO_MEM_MST WHERE ID = CPR_MST.MOD_ID) MOD_NAME
           , CPR_MST.MOD_DTM
            FROM
                CP_CNSTG_APPCTN_MST CP_MST
            JOIN CO_MEM_MST MEM_MST
        ON MEM_MST.MEM_SEQ = CP_MST.APPCTN_MEM_SEQ
            LEFT JOIN CP_CMPN_MST CMPN_MST
            ON CMPN_MST.BSNM_NO = CP_MST.APPCTN_BSNM_NO
            LEFT JOIN CP_CNSTG_RSUME_MST CPR_MST
            ON CP_MST.CNSTG_SEQ = CPR_MST.CNSTG_SEQ
            ) MST
        <include refid="selectTechGuidancewhereSql" />
    )A
    </select>

    <!--
         쿼리명 : CBATechGuidanceMapper.selectTechGuidanceDtl
         설  명 :  컨설팅 기술 관리 상세 조회
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.11.14   임서화      최초 생성
    -->
    <select id="selectTechGuidanceDtl" parameterType="CBATechGuidanceInsertDTO" resultType="CBATechGuidanceInsertDTO">
        SELECT /* CBATechGuidanceMapper.selectTechGuidanceDtl */
            A.CNSTG_SEQ,
            A.APPCTN_BSNM_NO AS BSNM_NO,
            A.APPCTN_MEM_SEQ,
            A.CNSTG_CD,
            (SELECT CD_NM FROM CO_CODE_MST WHERE CD = A.CNSTG_CD) CNSTG_NM,
            A.RSUME_STTS_CD,
            (SELECT CD_NM FROM CO_CODE_MST WHERE CD = A.RSUME_STTS_CD AND CD_ID = 'MNGTECH_STATUS') RSUME_STTS_NM,
            A.APPCTN_DT,
            A.BSN_YEAR,
            A.CMPN_SIZE_CD AS SIZE_CD,
            A.CMPN_ADDR_SAME_YN,
            A.FCTRY_ZIPCODE,
            A.FCTRY_BSC_ADDR,
            A.FCTRY_DTL_ADDR,
            A.QLTY_PIC_CNT,
            A.FAX_NO,
            A.RPRSNT_APPRV_YN,
            A.FIRST_RGNS_CD,
            A.SCND_RGNS_CD,
            A.APPCTN_RSN_CD,
            A.APPCTN_FLD_CD,
            A.ITRDC_FILE_SEQ,
            A.IMPVM_FILE_SEQ,
            B.MEM_SEQ,
            B.ID,
            B.NAME,
            B.HP_NO,
            B.EMAIL,
            B.TEL_NO,
            B.DEPT_CD,
            B.DEPT_DTL_NM,
            B.PSTN_CD,
            B.PSTN_NM,
            (SELECT CD FROM CP_CNSTG_CBSN_DTL where cnstg_seq = A.CNSTG_SEQ) CBSN_CD,
            (SELECT CD_NM FROM CO_CODE_MST WHERE CD = CBSN_CD) CBSN_NM,
            (SELECT ETC_NM FROM CP_CNSTG_CBSN_DTL where cnstg_seq = A.CNSTG_SEQ) ETC_NM,
            (SELECT FILE_SEQ FROM CO_FILE_MST WHERE FILE_SEQ = A.ITRDC_FILE_SEQ ) ITRDC_FILE_SEQ,
            (SELECT FILE_SEQ FROM CO_FILE_MST WHERE FILE_SEQ = A.IMPVM_FILE_SEQ ) IMPVM_FILE_SEQ,
            (SELECT CMPN_NFRML_NM from cp_cmpn_mst where bsnm_no = A.APPCTN_BSNM_NO) AS CMPN_NFRML_NM,
            (SELECT CMPN_CD from cp_cmpn_mst where bsnm_no = A.APPCTN_BSNM_NO) AS CMPN_CD,
            A.ADM_MEMO,
            A.REG_DTM,
            A.REG_ID,
            (SELECT NAME FROM CO_MEM_MST WHERE ID = A.REG_ID) REG_NAME,
            A.MOD_DTM,
            A.MOD_ID,
            (SELECT NAME CO_MEM_MST WHERE ID = B.MOD_ID) AS MOD_NAME
        FROM
            CP_CNSTG_APPCTN_MST A, CO_MEM_MST B
        WHERE 1=1
          AND A.CNSTG_SEQ = #{detailsKey}
          AND A.APPCTN_BSNM_NO = B.WORK_BSNM_NO
          AND A.APPCTN_MEM_SEQ = B.MEM_SEQ
    </select>

    <!--
     쿼리명 : CBATechGuidanceMapper.selectCnstgDlvryInfo
     설  명 :  고객사 비율 상세 조회
      수정일     수정자       수정내용
    ==========   ======    ==============
    2023.11.14   임서화      최초 생성
    -->
    <select id="selectCnstgDlvryInfo" parameterType="java.lang.Integer" resultType="CBATechGuidanceInsertDTO">
        SELECT /* CBATechGuidanceMapper.selectCnstgDlvryInfo */
            CNSTG_SEQ,
            CMPN_DLVRY_SEQ,
            CMPN_NM AS DLVRY_CMPN_NM,
            RATE AS DLVRY_RATE
        FROM
            CP_CNSTG_DLVRY_DTL
        WHERE
            CNSTG_SEQ =  #{cnstgSeq}
    </select>

    <!--
     쿼리명 : CBATechGuidanceMapper.selectCnstgDpndnInfo
     설  명 :  완성차 의존 비율 상세 조회
      수정일     수정자       수정내용
    ==========   ======    ==============
    2023.11.14   임서화      최초 생성
    -->
    <select id="selectCnstgDpndnInfo" parameterType="java.lang.Integer" resultType="CBATechGuidanceInsertDTO">
        SELECT /* CBATechGuidanceMapper.selectCnstgDpndnInfo */
            CNSTG_SEQ,
            DPNDN_SEQ,
            CMPN_NM as DPNDN_CMPN_NM,
            RATE as DPNDN_RATE
        FROM
            CP_CNSTG_DPNDN_DTL
        WHERE
            CNSTG_SEQ =  #{cnstgSeq}
    </select>


    <!--
     쿼리명 : CBATechGuidanceMapper.insertTechGuidance
     설  명 :  컨설팅 기술 관리 등록
      수정일     수정자       수정내용
    ==========   ======    ==============
    2023.11.14   임서화      최초 생성
    -->
    <insert id="insertTechGuidance" parameterType="CBATechGuidanceInsertDTO">
        INSERT /* CBATechGuidanceMapper.insertTechGuidance */ INTO CP_CNSTG_APPCTN_MST (
             CNSTG_SEQ
           , APPCTN_BSNM_NO
           , APPCTN_MEM_SEQ
           , RSUME_STTS_CD
           , CNSTG_CD
           , APPCTN_DT
           , BSN_YEAR
           , CMPN_SIZE_CD
           , CMPN_ADDR_SAME_YN
           , FCTRY_ZIPCODE
           , FCTRY_BSC_ADDR
           , FCTRY_DTL_ADDR
           , FIRST_RGNS_CD
           , SCND_RGNS_CD
           , QLTY_PIC_CNT
           , FAX_NO
           , RPRSNT_APPRV_YN
           , APPCTN_RSN_CD
           , RQST_CNTN
           , ITRDC_FILE_SEQ
           , IMPVM_FILE_SEQ
           , REG_ID
           , REG_IP
           , REG_DTM
        )
        VALUES (
           #{cnstgSeq}
           , #{bsnmNo}
           , #{memSeq}
           , "MNGTECH_STATUS_01"
           , "CONSULT_GB01"
           , #{appctnDt}
           , DATE_FORMAT(#{appctnDt}, '%Y')
           , #{sizeCd}
           , #{cmpnAddrSameYn}
           , #{fctryZipcode}
           , #{fctryBscAddr}
           , #{fctryDtlAddr}
           , #{firstRgnsCd}
           , #{scndRgnsCd}
           , #{qltyPicCnt}
           , #{faxNo}
           , #{rprsntApprvYn}
           , #{appctnRsnCd}
           , #{rqstCntn}
           , #{itrdcFileSeq}
           , #{impvmFileSeq}
           , #{regId}
           , #{regIp}
           , NOW()
           )
    </insert>

    <!--
     쿼리명 : CBATechGuidanceMapper.updateTechGuidance
     설  명 :  컨설팅 기술 관리 수정
      수정일     수정자       수정내용
    ==========   ======    ==============
    2023.11.14   임서화      최초 생성
    -->
    <update id="updateTechGuidance" parameterType="CBATechGuidanceInsertDTO">
        UPDATE CP_CNSTG_APPCTN_MST  /*CBATechGuidanceMapper.updateTechGuidance*/
        SET
            APPCTN_MEM_SEQ = #{memSeq},
            RSUME_STTS_CD = #{rsumeSttsCd},
            APPCTN_DT = #{appctnDt},
            CMPN_SIZE_CD = #{sizeCd},
            CMPN_ADDR_SAME_YN = #{cmpnAddrSameYn},
            FCTRY_ZIPCODE = #{fctryZipcode},
            FCTRY_BSC_ADDR = #{fctryBscAddr},
            FCTRY_DTL_ADDR = #{fctryDtlAddr},
            FIRST_RGNS_CD = #{firstRgnsCd},
            SCND_RGNS_CD = #{scndRgnsCd},
            QLTY_PIC_CNT = #{qltyPicCnt},
            FAX_NO =  #{faxNo},
            RPRSNT_APPRV_YN = #{rprsntApprvYn},
            APPCTN_RSN_CD = #{appctnRsnCd},
            RQST_CNTN = #{rqstCntn},
            ITRDC_FILE_SEQ = #{itrdcFileSeq},
            IMPVM_FILE_SEQ = #{impvmFileSeq},
            ADM_MEMO = #{admMemo},
            MOD_DTM = now(),
            MOD_ID = #{regId},
            MOD_IP = #{regIp}
        WHERE
            CNSTG_SEQ = #{cnstgSeq}
    </update>

    <!--
     쿼리명 : CBATechGuidanceMapper.selectCnstgDpndnInfoCnt
     설  명 :  부품사 업종 카운트
      수정일     수정자       수정내용
    ==========   ======    ==============
    2023.11.14   임서화      최초 생성
    -->
    <select id="selectCnstgDpndnInfoCnt" parameterType="java.lang.Integer" resultType="java.lang.Integer">
        SELECT /* CBATechGuidanceMapper.selectCnstgDpndnInfoCnt */
            COUNT(*)
        FROM
            CP_CNSTG_CBSN_DTL
        WHERE
            CNSTG_SEQ = #{cnstgSeq}
    </select>

    <!--
     쿼리명 : CBATechGuidanceMapper.insertCbsnDtl
     설  명 :  부품사 업종 상세 등록
      수정일     수정자       수정내용
    ==========   ======    ==============
    2023.11.14   임서화      최초 생성
    -->
    <insert id="insertCbsnDtl" parameterType="java.util.HashMap">
        Insert /* CBATechGuidanceMapper.insertCbsnDtl */ INTO CP_CNSTG_CBSN_DTL(
             CNSTG_SEQ
           , CD
           , ETC_NM
           , REG_ID
           , REG_IP
           , REG_DTM
        )
        VALUES(
          #{cnstgSeq}
          , #{cbsnCd}
          , #{etcNm}
          , #{regId}
          , #{regIp}
          , NOW()
          )
    </insert>

    <!--
     쿼리명 : CBATechGuidanceMapper.updateCbsnDtl
     설  명 :  부품사 업종 상세 수정
      수정일     수정자       수정내용
    ==========   ======    ==============
    2023.11.14   임서화      최초 생성
    -->
    <update id="updateCbsnDtl" parameterType="java.util.HashMap">
        UPDATE CP_CNSTG_CBSN_DTL /*CBATechGuidanceMapper.updateCbsnDtl*/
        SET
            CD = #{cbsnCd},
            ETC_NM = #{etcNm},
            MOD_ID = #{regId},
            MOD_IP = #{regIp}
        WHERE CNSTG_SEQ = #{cnstgSeq}
    </update>

    <!--
     쿼리명 : CBATechGuidanceMapper.insertCnstgDlvryInfo
     설  명 :  고객사 비율 비율 등록
      수정일     수정자       수정내용
    ==========   ======    ==============
    2023.11.14   임서화      최초 생성
    -->
    <insert id="insertCnstgDlvryInfo" parameterType="java.util.HashMap">
        INSERT /* CBATechGuidanceMapper.insertCnstgDlvryInfo */ INTO CP_CNSTG_DLVRY_DTL(
             CNSTG_SEQ
           , CMPN_DLVRY_SEQ
           , CMPN_NM
           , RATE
           , REG_ID
           , REG_IP
           , REG_DTM
        )
        VALUES(
          #{cnstgSeq}
          , #{cmpnDlvrySeq}
          , #{dlvryCmpnNm}
          , #{dlvryRate}
          , #{regId}
          , #{regIp}
          , now()
          )
    </insert>

    <!--
     쿼리명 : CBATechGuidanceMapper.updateCnstgDlvryInfo
     설  명 :  고객사 비율 비율 수정
      수정일     수정자       수정내용
    ==========   ======    ==============
    2023.11.14   임서화      최초 생성
    -->
    <update id="updateCnstgDlvryInfo" parameterType="java.util.HashMap">
        UPDATE /* CBATechGuidanceMapper.updateCnstgDlvryInfo */ CP_CNSTG_DLVRY_DTL
        SET
            CMPN_NM = #{dlvryCmpnNm},
            RATE = #{dlvryRate},
            MOD_ID = #{regId},
            MOD_IP = #{regIp},
            MOD_DTM = now()
        WHERE CNSTG_SEQ = #{cnstgSeq}
          AND CMPN_DLVRY_SEQ = #{cmpnDlvrySeq}
    </update>

    <!--
     쿼리명 : CBATechGuidanceMapper.selectCmpnCbsnInfoCnt
     설  명 :  회사 업종 카운트
      수정일     수정자       수정내용
    ==========   ======    ==============
    2023.11.14   임서화      최초 생성
    -->
    <select id="selectCmpnCbsnInfoCnt" parameterType="java.lang.Integer" resultType="java.lang.Integer">
        SELECT /* CBATechGuidanceMapper.selectCmpnCbsnInfoCnt */
            COUNT(*)
        FROM
            CP_CMPN_CBSN_DTL
        WHERE 1=1
          AND CBSN_SEQ = #{cbsnSeq}
    </select>

    <!--
     쿼리명 : CBATechGuidanceMapper.insertCnstgDpndnInfo
     설  명 :  완성차 의존 비율 등록
      수정일     수정자       수정내용
    ==========   ======    ==============
    2023.11.14   임서화      최초 생성
    -->
    <insert id="insertCnstgDpndnInfo" parameterType="java.util.HashMap">
        INSERT /* CBATechGuidanceMapper.insertCnstgDpndnInfo */ INTO CP_CNSTG_DPNDN_DTL
        (
        CNSTG_SEQ
        , DPNDN_SEQ
        , CMPN_NM
        , RATE
        , REG_ID
        , REG_IP
        , REG_DTM
        )
        VALUES(
          #{cnstgSeq}
          , #{dpndnSeq}
          , #{cmpnNm}
          , #{dpndnRate}
          , #{regId}
          , #{regIp}
          , now()
        )
    </insert>

    <!--
     쿼리명 : CBATechGuidanceMapper.insertCnstgAppctnType
     설  명 :  신청 분야 상세
      수정일     수정자       수정내용
    ==========   ======    ==============
    2023.11.14   임서화      최초 생성
    -->
    <insert id="insertCnstgAppctnType" parameterType="java.util.HashMap">
        INSERT /* CBATechGuidanceMapper.insertCnstgAppctnType */INTO CP_CNSTG_APPCTN_TYPE_DTL
        (
        CNSTG_SEQ
        , CD
        , REG_ID
        , REG_IP
        , REG_DTM
        )
        VALUES(
          #{cnstgSeq}
          , #{appctnTypeCd}
          , #{regId}
          , #{regIp}
          , now()
        )
    </insert>

    <!--
     쿼리명 : CBATechGuidanceMapper.selectCnstgAppctnType
     설  명 :  신청 분야 상세
      수정일     수정자       수정내용
    ==========   ======    ==============
    2023.11.14   임서화      최초 생성
    -->
    <select id="selectCnstgAppctnType" parameterType="java.util.HashMap" resultType="CBATechGuidanceInsertDTO">
        SELECT /* CBATechGuidanceMapper.selectCnstgAppctnType */
            CNSTG_SEQ,
            CD AS APPCTN_TYPE_CD,
            (SELECT CD_NM FROM CO_CODE_MST WHERE CD = APPCTN_TYPE_CD) APPCTN_TYPE_NM,
            REG_ID,
            REG_IP,
            REG_DTM
        FROM
            CP_CNSTG_APPCTN_TYPE_DTL
        WHERE 1=1
          AND CNSTG_SEQ = #{cnstgSeq}
    </select>

    <!--
     쿼리명 : CBATechGuidanceMapper.deleteCnstgAppctnType
     설  명 : 신청 분야 상세 삭제
      수정일     수정자       수정내용
    ==========   ======    ==============
    2023.11.14   임서화      최초 생성
    -->
    <delete id="deleteCnstgAppctnType" parameterType="java.util.HashMap">
        DELETE /*CBATechGuidanceMapper.deleteCnstgAppctnType*/
        FROM
            CP_CNSTG_APPCTN_TYPE_DTL
        WHERE
            CNSTG_SEQ = #{cnstgSeq}
    </delete>

    <!--
     쿼리명 : CBATechGuidanceMapper.updateCnstgDpndnInfo
     설  명 :  고객사 비율 비율 수정
      수정일     수정자       수정내용
    ==========   ======    ==============
    2023.11.14   임서화      최초 생성
    -->
    <update id="updateCnstgDpndnInfo" parameterType="java.util.HashMap">
        UPDATE /* CBATechGuidanceMapper.updateCnstgDpndnInfo */ CP_CNSTG_DPNDN_DTL
        SET
            CMPN_NM = #{cmpnNm},
            RATE = #{dpndnRate},
            MOD_ID = #{regId},
            MOD_IP = #{regIp},
            MOD_DTM = now()
        WHERE CNSTG_SEQ = #{cnstgSeq}
          AND DPNDN_SEQ = #{dpndnSeq}
    </update>

    <!--
     쿼리명 : CBATechGuidanceMapper.insertTechGuidanceRsume
     설  명 :  컨설팅 진행 마스터
      수정일     수정자       수정내용
    ==========   ======    ==============
    2023.11.14   임서화      최초 생성
    -->
    <insert id="insertTechGuidanceRsume" parameterType="CBATechGuidanceUpdateDTO">
        INSERT /* CBATechGuidanceMapper.insertTechGuidanceRsume */ INTO CP_CNSTG_RSUME_MST(
            CNSTG_SEQ
          , BFRE_JDGMT_RSLT_CD
          , BFRE_JDGMT_RSLT_CNTN
          , VST_DT
          , VSTR_NM
          , NTRVR_NM
          , INIT_VST_RSLT_CD
          , INIT_VST_RSLT_CNTN
          , INIT_VST_OPNN_CNTN
          , CMSSR_SEQ
          , GUIDE_TYPE_CD
          , GUIDE_PSCND_CD
          , GUIDE_PSCND_DT
          , GUIDE_BGN_DT
          , GUIDE_KICKF_DT
          , XTNSN_CNCL_RSN
          , FLTY_IMPVM_BFRE_RATE
          , FLTY_IMPVM_AFTR_RATE
          , FLTY_IMPVM_RATE
          , INIT_VST_FILE_SEQ
          , KICKF_FILE_SEQ
          , LVLUP_FILE_SEQ
          , ETC_FILE_SEQ
          , SRV_SEQ
          , SRV_STRT_DTM
          , SRV_END_DTM
          , REG_ID
          , REG_IP
          , REG_DTM
        )
        VALUES(
          #{detailsKey} ,
          #{bfreJdgmtRsltCd},
          #{bfreJdgmtRsltCntn},
          #{vstDt} ,
          #{vstrNm} ,
          #{ntrvrNm} ,
          #{initVstRsltCd} ,
          #{initVstRsltCntn} ,
          #{initVstOpnnCntn} ,
          #{cmssrSeq} ,
          #{guideTypeCd} ,
          #{guidePscndCd} ,
          #{guidePscndDt} ,
          #{guideBgnDt} ,
          #{guideKickfDt} ,
          #{xtnsnCnclRsn} ,
          #{fltyImpvmBfreRate} ,
          #{fltyImpvmAftrRate} ,
          #{fltyImpvmRate} ,
          #{initVstFileSeq} ,
          #{kickfFileSeq} ,
          #{lvlupFileSeq} ,
          #{etcFileSeq},
          #{srvSeq},
          #{srvStrtDtm},
          #{srvEndDtm},
          #{regId},
          #{regIp},
          now()
              )
    </insert>

    <!--
     쿼리명 : CBATechGuidanceMapper.updateTechGuidanceRseume
     설  명 :  컨설팅 진행 마스터 업데이트
      수정일     수정자       수정내용
    ==========   ======    ==============
    2023.11.20   임서화      최초 생성
    -->
    <update id="updateTechGuidanceRsume" parameterType="CBATechGuidanceUpdateDTO">
        UPDATE /* CBATechGuidanceMapper.updateTechGuidanceRsume */ CP_CNSTG_RSUME_MST
        SET
            BFRE_JDGMT_RSLT_CD =  #{bfreJdgmtRsltCd} ,
            bfre_jdgmt_rslt_cntn =  #{bfreJdgmtRsltCntn} ,
            VST_DT =  #{vstDt} ,
            VSTR_NM = #{vstrNm} ,
            NTRVR_NM =  #{ntrvrNm} ,
            INIT_VST_RSLT_CD = #{initVstRsltCd} ,
            INIT_VST_OPNN_CNTN = #{initVstOpnnCntn},
            CMSSR_SEQ =  #{cmssrSeq} ,
            GUIDE_TYPE_CD = #{guideTypeCd} ,
            GUIDE_PSCND_CD =  #{guidePscndCd} ,
            GUIDE_PSCND_DT =  #{guidePscndDt} ,
            GUIDE_BGN_DT =  #{guideBgnDt} ,
            GUIDE_KICKF_DT =  #{guideKickfDt} ,
            XTNSN_CNCL_RSN =  #{xtnsnCnclRsn} ,
            FLTY_IMPVM_BFRE_RATE =  #{fltyImpvmBfreRate} ,
            FLTY_IMPVM_AFTR_RATE =  #{fltyImpvmAftrRate} ,
            FLTY_IMPVM_RATE =  #{fltyImpvmRate} ,
            INIT_VST_FILE_SEQ =  #{initVstFileSeq} ,
            KICKF_FILE_SEQ =  #{kickfFileSeq} ,
            LVLUP_FILE_SEQ =  #{lvlupFileSeq} ,
            ETC_FILE_SEQ =  #{etcFileSeq} ,
            SRV_SEQ = #{srvSeq},
            SRV_STRT_DTM = #{srvStrtDtm},
            SRV_END_DTM = #{srvEndDtm},
            MOD_ID =  #{regId},
            MOD_IP =  #{regIp},
            MOD_DTM = NOW()
        WHERE CNSTG_SEQ =  #{cnstgSeq}
    </update>

    <!--
         쿼리명 : CBATechGuidanceMapper.selectTechGuidanceRsume
         설  명 : 컨설팅 진행 사항
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.11.14   임서화      최초 생성
    -->
    <select id="selectTechGuidanceRsume" parameterType="CBATechGuidanceInsertDTO" resultType="CBATechGuidanceUpdateDTO">
        SELECT /* CBATechGuidanceMapper.selectTechGuidanceRsume */
            CNSTG_SEQ
             , BFRE_JDGMT_RSLT_CD
             , BFRE_JDGMT_RSLT_CNTN
             , VST_DT
             , VSTR_NM
             , NTRVR_NM
             , INIT_VST_RSLT_CD
             , INIT_VST_RSLT_CNTN
             , INIT_VST_OPNN_CNTN
             , CMSSR_SEQ
             , (SELECT NAME FROM CO_MEM_MST WHERE MEM_SEQ = A.CMSSR_SEQ) CMSSR_NAME
             , GUIDE_TYPE_CD
             , GUIDE_PSCND_CD
             , GUIDE_PSCND_DT
             , GUIDE_BGN_DT
             , GUIDE_KICKF_DT
             , XTNSN_CNCL_RSN
             , FLTY_IMPVM_BFRE_RATE
             , FLTY_IMPVM_AFTR_RATE
             , FLTY_IMPVM_RATE
             , INIT_VST_FILE_SEQ
             , KICKF_FILE_SEQ
             , LVLUP_FILE_SEQ
             , ETC_FILE_SEQ
             , SRV_SEQ
             , (SELECT CD_ID FROM CO_CODE_MST WHERE CD_ID = 'SURVEY_TYPE' AND CD = (SELECT TYPE_CD FROM SV_MST WHERE SRV_SEQ = A.SRV_SEQ)) AS TYPE_NM
             , (SELECT TITL FROM SV_MST WHERE SRV_SEQ = A.SRV_SEQ) AS SRV_NM
             , SRV_STRT_DTM
             , SRV_END_DTM
             , REG_ID
             , REG_IP
             , REG_DTM
        FROM CP_CNSTG_RSUME_MST A
        WHERE CNSTG_SEQ = #{cnstgSeq}
    </select>

    <!--
        쿼리명 : CBATechGuidanceMapper.selectRsumeTotCnt
        설  명 :  컨설팅 기술 관리 목록 카운트.
        수정일     수정자       수정내용
        ==========   ======    ==============
        2023.11.14   임서화      최초 생성
    -->
    <select id="selectRsumeTotCnt" parameterType="CBATechGuidanceInsertDTO" resultType="java.lang.Integer">
        SELECT /*CBATechGuidanceMapper.selectRsumeTotCnt*/
            COUNT(*)
        FROM
            CP_CNSTG_RSUME_MST
        WHERE
            CNSTG_SEQ = #{cnstgSeq}
    </select>

    <!--
        쿼리명 : CBATechGuidanceMapper.selectTrsfGuidanceList
        설  명 : 컨설팅 참여 이관 로그
        수정일     수정자       수정내용
        ==========   ======    ==============
        2023.11.14   임서화      최초 생성
    -->
    <select id="selectTrsfGuidanceList" parameterType="CBATechGuidanceInsertDTO" resultType="CBATechGuidanceInsertDTO">
        SELECT /* CBATechGuidanceMapper.selectTrsfGuidanceList */
            CNSTG_SEQ,
            (SELECT NAME FROM CO_MEM_MST WHERE MEM_SEQ = A.BFRE_MEM_SEQ) BF_NAME,
            (SELECT ID FROM CO_MEM_MST WHERE MEM_SEQ = A.BFRE_MEM_SEQ) BF_ID,
            (SELECT NAME FROM CO_MEM_MST WHERE MEM_SEQ = A.AFTR_MEM_SEQ) AF_NAME,
            (SELECT ID FROM CO_MEM_MST WHERE MEM_SEQ = A.AFTR_MEM_SEQ) AF_ID,
            BFRE_MEM_SEQ,
            AFTR_MEM_SEQ,
            REG_DTM,
            REG_ID,
            (SELECT NAME FROM CO_ADM_MST WHERE ID=A.REG_ID) REG_NAME
        FROM CP_CNSTG_APPCTN_TRNSF_DTL A
        WHERE CNSTG_SEQ = #{detailsKey}
            LIMIT #{firstIndex}, #{recordCountPerPage}
    </select>

    <!--
        쿼리명 : CBATechGuidanceMapper.insertTrsfGuidanceList
        설  명 : 컨설팅 참여 이관 로그
        수정일     수정자       수정내용
        ==========   ======    ==============
        2023.11.14   임서화      최초 생성
    -->
    <insert id="insertTrsfGuidanceList" parameterType="CBATechGuidanceInsertDTO" >
        INSERT /* CBATechGuidanceMapper.insertTrsfGuidanceList */ INTO CP_CNSTG_APPCTN_TRNSF_DTL
        ( TRNSF_SEQ,
          CNSTG_SEQ,
          BFRE_MEM_SEQ,
          AFTR_MEM_SEQ,
          REG_ID,
          REG_IP,
          REG_DTM
        )
        VALUES(
          #{trnsfSeq},
          #{cnstgSeq},
          #{bfreMemSeq},
          #{aftrMemSeq},
          #{regId},
          #{regIp},
          NOW()
              )
    </insert>

    <!--
        쿼리명 : CBATechGuidanceMapper.deleteTechGuidance
        설  명 :  컨설팅 기술 관리 삭제
        수정일     수정자       수정내용
        ==========   ======    ==============
        2023.11.14   임서화      최초 생성
    -->
    <delete id="deleteTechGuidance" parameterType="CBATechGuidanceDTO">
        DELETE /* CBATechGuidanceMapper.deleteTechGuidance */
        FROM
        CP_CNSTG_APPCTN_MST
        <where>
            <choose>
                <when test="delValueList != null and delValueList.size() > 0">
                    CNSTG_SEQ IN
                    <foreach collection="delValueList" item="delValueList" index="index" separator=", " open="(" close=")">
                        #{delValueList}
                    </foreach>
                </when>
                <otherwise>
                    CNSTG_SEQ = #{cnstgSeq}
                </otherwise>
            </choose>
        </where>
    </delete>

    <!--
        쿼리명 : CBATechGuidanceMapper.selectTrsfGuidanceCnt
        설  명 :  컨설팅 기술 관리 이관 내역 카운트
        수정일     수정자       수정내용
        ==========   ======    ==============
        2023.11.14   임서화      최초 생성
    -->
    <select id="selectTrsfGuidanceCnt" parameterType="CBATechGuidanceUpdateDTO" resultType="java.lang.Integer">
        SELECT /*CBATechGuidanceMapper.selectTrsfGuidanceCnt*/
            COUNT(*)
        FROM
            CP_CNSTG_APPCTN_TRNSF_DTL
        WHERE
            CNSTG_SEQ = #{detailsKey}
    </select>

    <!--
        쿼리명 : CBATechGuidanceMapper.selectTechGuidanceSurvey
        설  명 :  컨설팅 기술 관리 만족도 결과
        수정일     수정자       수정내용
        ==========   ======    ==============
        2023.12.15   임서화      최초 생성
    -->
    <select id="selectTechGuidanceSurvey"  parameterType="java.lang.Integer" resultType="CBAConsultSuveyRsltListDTO">
        SELECT /* CBATechGuidanceMapper.selectTechGuidanceSurvey */
            PTCPT_NAME,
            PTCPT_TELNO,
            PTCPT_PSTN,
            TTL_SCORE,
            GUIDE_RSLT_SCORE,
            MND_SCORE,
            CMMNCTN_SCORE,
            PLNNGABLT_SCORE,
            EXCTVABLT_SCORE,
            EXPRTS_SCORE
        FROM
            CP_CNSTG_SRV_RSLT_DTL
        WHERE
            CNSTG_SEQ = #{detailsKey}
    </select>

    <!--
		쿼리명 : selectTechGuidancewhereSql
		설  명 : 비주얼 관리 where Sql
	      수정일      수정자       수정내용
        ==========   ========   ==============
        2023.11.14    임서화       최초 생성
    -->
    <sql id="selectTechGuidancewhereSql">
        <where>
            and CNSTG_CD = 'CONSULT_GB01'
            <!--기간검색 -->
            <if test="strtDt != null and strtDt != ''.toString() ">
                <choose>
                    <when test="srchDate == 1">
                        AND APPCTN_DT <![CDATA[ > ]]> STR_TO_DATE(#{strtDt}, '%Y-%m-%d')
                    </when>
                    <when test="srchDate == 2">
                        AND VST_DT <![CDATA[ > ]]> STR_TO_DATE(#{strtDt}, '%Y-%m-%d')
                    </when>
                    <when test="srchDate == 3">
                        AND CNSTG_KICKF_DT <![CDATA[ > ]]> STR_TO_DATE(#{strtDt}, '%Y-%m-%d')
                    </when>
                    <when test="srchDate == 4">
                        AND GUIDE_PSCND_DT <![CDATA[ > ]]> STR_TO_DATE(#{strtDt}, '%Y-%m-%d')
                    </when>
                    <when test="srchDate == 5">
                        AND REG_DTM <![CDATA[ > ]]> STR_TO_DATE(#{strtDt}, '%Y-%m-%d')
                    </when>
                    <when test="srchDate == 6">
                        AND MOD_DTM <![CDATA[ > ]]> STR_TO_DATE(#{strtDt}, '%Y-%m-%d')
                    </when>
                </choose>
            </if>
            <if test="endDt != null and endDt != ''.toString() ">
                <choose>
                    <when test="srchDate == 1">
                        AND APPCTN_DT <![CDATA[ < ]]> DATE_ADD(STR_TO_DATE(#{endDt}, '%Y-%m-%d'), interval 1 day)
                    </when>
                    <when test="srchDate == 2">
                        AND VST_DT <![CDATA[ < ]]> DATE_ADD(STR_TO_DATE(#{endDt}, '%Y-%m-%d'), interval 1 day)
                    </when>
                    <when test="srchDate == 3">
                        AND CNSTG_KICKF_DT <![CDATA[ < ]]> DATE_ADD(STR_TO_DATE(#{endDt}, '%Y-%m-%d'), interval 1 day)
                    </when>
                    <when test="srchDate == 4">
                        AND GUIDE_PSCND_DT <![CDATA[ < ]]> DATE_ADD(STR_TO_DATE(#{endDt}, '%Y-%m-%d'), interval 1 day)
                    </when>
                    <when test="srchDate == 5">
                        AND REG_DTM <![CDATA[ < ]]> DATE_ADD(STR_TO_DATE(#{endDt}, '%Y-%m-%d'), interval 1 day)
                    </when>
                    <when test="srchDate == 6">
                        AND MOD_DTM <![CDATA[ < ]]> DATE_ADD(STR_TO_DATE(#{endDt}, '%Y-%m-%d'), interval 1 day)
                    </when>
                </choose>
            </if>
            <!-- 구분 -->
            <if test="ctgryCdList != null and ctgryCdList.size() > 0">
                AND
                <foreach collection="ctgryCdList" item="list" index="index" open="(" close=")" separator=" or ">
                    CTGRY_CD = #{list}
                </foreach>
            </if>
            <!-- 신청업종 -->
            <if test="cbsnCd != null and cbsnCd != ''">
                AND CBSN_CD = #{cbsnCd}
            </if>
            <!-- 진행상태 -->
            <if test="rsumeSttsCd != null and rsumeSttsCd != ''">
                AND RSUME_STTS_CD = #{rsumeSttsCd}
            </if>
            <!-- 멤버 seq로 검색 -->
            <if test="memSeq != null and memSeq != ''">
                AND RSUME_STTS_CD = #{rsumeSttsCd}
            </if>
            <if test="q != null and q != ''.toString() ">
                <choose>
                    <when test="f == 1">
                        <!-- 부품사명 -->
                        AND EXISTS(SELECT BSNM_NO FROM CP_CMPN_MST WHERE BSNM_NO = MST.APPCTN_BSNM_NO AND CMPN_NM LIKE CONCAT('%', #{q}, '%'))
                    </when>
                    <when test="f == 2 ">
                        <!-- 사업자등록번호 -->
                        AND EXISTS(SELECT BSNM_NO FROM CP_CMPN_MST WHERE BSNM_NO = MST.APPCTN_BSNM_NO AND BSNM_NO LIKE CONCAT('%', #{q}, '%'))
                    </when>
                    <when test="f == 3 ">
                        <!-- 매출액 -->
                        AND EXISTS(SELECT BSNM_NO FROM CP_CMPN_MST WHERE BSNM_NO = MST.APPCTN_BSNM_NO AND SLS_PMT LIKE CONCAT('%', #{q}, '%'))
                    </when>
                    <when test="f == 4 ">
                        <!-- 직원수 -->
                        AND EXISTS(SELECT BSNM_NO FROM CP_CMPN_MST WHERE BSNM_NO = MST.APPCTN_BSNM_NO AND MPLE_CNT LIKE CONCAT('%', #{q}, '%'))
                    </when>
                    <when test="f == 5 ">
                        <!-- 신청소재지 -->
                        AND EXISTS(SELECT CNSTG_SEQ FROM CP_CNSTG_APPCTN_MST WHERE CNSTG_SEQ = MST.CNSTG_SEQ and ( FIRST_RGNS_NM LIKE CONCAT('%', #{q}, '%') OR SCND_RGNS_NM LIKE CONCAT('%', #{q}, '%')))
                    </when>
                    <when test="f == 6 ">
                        <!-- SQ인증주관사 -->
                        AND EXISTS(SELECT CNSTG_SEQ FROM CP_CNSTG_APPCTN_MST WHERE CNSTG_SEQ = MST.CNSTG_SEQ AND CRTFN_CMPN_NM LIKE CONCAT('%', #{q}, '%'))
                    </when>
                    <when test="f == 7 ">
                        <!-- 담당위원 -->
                        AND EXISTS(SELECT MEM_SEQ FROM CO_MEM_MST WHERE MEM_SEQ = MST.CMSSR_SEQ AND NAME LIKE CONCAT('%', #{q}, '%'))
                    </when>
                    <when test="f == 8 ">
                        <!-- 최초등록자 -->
                        AND (
                            INSTR(#{q}, MST.REG_ID) <![CDATA[>]]> 0
                            OR EXISTS(SELECT ADM_SEQ FROM CO_ADM_MST WHERE ID = MST.REG_ID AND INSTR(#{q}, NAME) <![CDATA[>]]> 0)
                            OR EXISTS(SELECT MEM_SEQ FROM CO_MEM_MST WHERE ID = MST.REG_ID AND INSTR(#{q}, NAME) <![CDATA[>]]> 0)
                        )
                    </when>
                    <when test="f == 9 ">
                        <!-- 최종등록자 -->
                        AND (
                            INSTR(#{q}, MST.MOD_ID) <![CDATA[>]]> 0
                            OR EXISTS(SELECT 'x' FROM CO_ADM_MST WHERE ID = MST.MOD_ID AND INSTR(#{q}, NAME) <![CDATA[>]]> 0)
                        )
                    </when>
                    <otherwise>
                        AND (
                            EXISTS(SELECT BSNM_NO FROM CP_CMPN_MST WHERE BSNM_NO = MST.APPCTN_BSNM_NO AND CMPN_NM LIKE CONCAT('%', #{q}, '%'))
                            OR EXISTS(SELECT BSNM_NO FROM CP_CMPN_MST WHERE BSNM_NO = MST.APPCTN_BSNM_NO AND BSNM_NO LIKE CONCAT('%', #{q}, '%'))
                            OR EXISTS(SELECT BSNM_NO FROM CP_CMPN_MST WHERE BSNM_NO = MST.APPCTN_BSNM_NO AND SLS_PMT LIKE CONCAT('%', #{q}, '%'))
                            OR EXISTS(SELECT BSNM_NO FROM CP_CMPN_MST WHERE BSNM_NO = MST.APPCTN_BSNM_NO AND MPLE_CNT LIKE CONCAT('%', #{q}, '%'))
                            OR EXISTS(SELECT CNSTG_SEQ FROM CP_CNSTG_APPCTN_MST WHERE CNSTG_SEQ = MST.CNSTG_SEQ AND (INSTR(#{q}, FIRST_RGNS_NM) <![CDATA[>]]> 0 or INSTR(#{q}, SCND_RGNS_NM) <![CDATA[>]]> 0 ))
                            OR EXISTS(SELECT CNSTG_SEQ FROM CP_CNSTG_APPCTN_MST WHERE CNSTG_SEQ = MST.CNSTG_SEQ AND CRTFN_CMPN_NM LIKE CONCAT('%', #{q}, '%'))
                            OR EXISTS(SELECT MEM_SEQ FROM CO_MEM_MST WHERE MEM_SEQ = MST.CMSSR_SEQ AND NAME LIKE CONCAT('%', #{q}, '%'))
                            OR INSTR(#{q}, MST.REG_ID) <![CDATA[>]]> 0
                            OR EXISTS(SELECT ADM_SEQ FROM CO_ADM_MST WHERE ID = MST.REG_ID AND INSTR(#{q}, NAME) <![CDATA[>]]> 0)
                            OR EXISTS(SELECT MEM_SEQ FROM CO_MEM_MST WHERE ID = MST.REG_ID AND INSTR(#{q}, NAME) <![CDATA[>]]> 0)
                            OR INSTR(#{q}, MST.MOD_ID) <![CDATA[>]]> 0
                            OR EXISTS(SELECT 'x' FROM CO_ADM_MST WHERE ID = MST.MOD_ID AND INSTR(#{q}, NAME) <![CDATA[>]]> 0)
                        )
                    </otherwise>
                </choose>
            </if>
        </where>
    </sql>

    <!--
        쿼리명 : CBATechGuidanceMapper.getConsultSuveyRsltCnt
        설  명 : 만족도 종합결과 목록 전체 갯수
          수정일      수정자       수정내용
        ==========   ========   ==============
        2023.12.04    이옥정       최초 생성
    -->
    <select id="getConsultSuveyRsltCnt" parameterType="CBAConsultSuveyRsltListDTO" resultType="java.lang.Integer">
        SELECT /* CBATechGuidanceMapper.getConsultSuveyRsltCnt */
            COUNT(*)
        FROM(
            SELECT
                BSN_YEAR
            FROM (
            SELECT
                CP_MST.BSN_YEAR
                , CP_MST.APPCTN_BSNM_NO
                , (SELECT COUNT(TTL_SCORE) FROM CP_CNSTG_SRV_RSLT_DTL CCSR WHERE CP_MST.CNSTG_SEQ = CCSR.CNSTG_SEQ ) SRV_CMPLT_CMPN_CNT
                , (SELECT COUNT(*) FROM CP_CNSTG_RSUME_MST CCR WHERE CP_MST.CNSTG_SEQ = CCR.CNSTG_SEQ AND CCR.GUIDE_TYPE_CD = 'GUIDE_TYPE_CD01' ) SHRT_CMPN_CNT
                , (SELECT COUNT(*) FROM CP_CNSTG_RSUME_MST CCR WHERE CP_MST.CNSTG_SEQ = CCR.CNSTG_SEQ AND CCR.GUIDE_TYPE_CD = 'GUIDE_TYPE_CD02' ) RGLR_CMPN_CNT
                , (SELECT COUNT(CMSSR_SEQ) FROM CP_CNSTG_RSUME_MST CCR WHERE CP_MST.CNSTG_SEQ = CCR.CNSTG_SEQ ) CMSSR_CNT
                , CPSR.TTL_SCORE
                , (SELECT TTL_SCORE FROM CP_CNSTG_SRV_RSLT_DTL WHERE CNSTG_SEQ = (SELECT CNSTG_SEQ FROM CP_CNSTG_RSUME_MST CCR WHERE CP_MST.CNSTG_SEQ = CCR.CNSTG_SEQ AND CCR.GUIDE_TYPE_CD = 'GUIDE_TYPE_CD01' )) SHRT_SCORE
                , (SELECT TTL_SCORE FROM CP_CNSTG_SRV_RSLT_DTL WHERE CNSTG_SEQ = (SELECT CNSTG_SEQ FROM CP_CNSTG_RSUME_MST CCR WHERE CP_MST.CNSTG_SEQ = CCR.CNSTG_SEQ AND CCR.GUIDE_TYPE_CD = 'GUIDE_TYPE_CD02' )) RGLR_SCORE
            FROM
                CP_CNSTG_APPCTN_MST CP_MST
            JOIN CO_MEM_MST MEM_MST
                ON MEM_MST.MEM_SEQ = CP_MST.APPCTN_MEM_SEQ
                LEFT JOIN CP_CMPN_MST CMPN_MST
                    ON CMPN_MST.BSNM_NO = CP_MST.APPCTN_BSNM_NO
                LEFT JOIN CP_CNSTG_RSUME_MST CPR_MST
                    ON CP_MST.CNSTG_SEQ = CPR_MST.CNSTG_SEQ
                LEFT JOIN CP_CNSTG_SRV_RSLT_DTL CPSR
                    ON CP_MST.CNSTG_SEQ = CPSR.CNSTG_SEQ
            WHERE 1=1
            <if test="rtnBsnGubun != null and rtnBsnGubun != ''">
                AND CP_MST.CNSTG_CD = '${rtnBsnGubun}'
            </if>
                AND CP_MST.CNSTG_CD = 'CONSULT_GB01'
                AND CPR_MST.BFRE_JDGMT_RSLT_CD = 'BF_JDGMT_RSLT01'
                AND CPR_MST.INIT_VST_RSLT_CD = 'INIT_VST_RSLT01'
                AND CPR_MST.CNSTG_PSCND_CD = 'CNSTG_PSCND03'
                AND GUIDE_PSCND_CD = 'GUIDE_PSCND04'
            ) MST
            GROUP BY MST.BSN_YEAR
        ) AA
    </select>

    <!--
        쿼리명 : CBATechGuidanceMapper.selectConsultSuveyRsltList
        설  명 : 만족도 종합결과 리스트 조회
          수정일      수정자       수정내용
        ==========   ========   ==============
        2023.12.04    이옥정       최초 생성
    -->
    <select id="selectConsultSuveyRsltList" parameterType="CBAConsultSuveyRsltListDTO" resultType="CBAConsultSuveyRsltListDTO">
        SELECT /* CBATechGuidanceMapper.selectConsultSuveyRsltList */
            BSN_YEAR                                                                           <!-- 사업연도 -->
            , COUNT(APPCTN_BSNM_NO) CMPN_CNT                                                   <!-- 대상부품사 -->
            , SUM(SRV_CMPLT_CMPN_CNT) SRV_CMPLT_CMPN_CNT                                       <!-- 설문완료 부품사 -->
            , SUM(RGLR_CMPN_CNT) RGLR_CMPN_CNT                                                 <!-- 정규 부품사 -->
            , SUM(SHRT_CMPN_CNT) SHRT_CMPN_CNT                                                 <!-- 단기 부품사 -->
            , SUM(CMSSR_CNT) CMSSR_CNT                                                         <!-- 위원 -->
            , IFNULL(ROUND((SUM(TTL_SCORE) / SUM(SRV_CMPLT_CMPN_CNT)),1),0) TTL_AVG_SCORE      <!-- 총합점수평균 -->
            , IFNULL(ROUND((SUM(RGLR_SCORE) / SUM(RGLR_CMPN_CNT)),1),0) RGLR_AVG_SCORE         <!-- 정규점수평균 -->
            , IFNULL(ROUND((SUM(SHRT_SCORE) / SUM(SHRT_CMPN_CNT)),1),0) SHRT_AVG_SCORE         <!-- 단기점수평균 -->
        FROM (
            SELECT
                CP_MST.BSN_YEAR
                , CP_MST.APPCTN_BSNM_NO
                , (SELECT COUNT(TTL_SCORE) FROM CP_CNSTG_SRV_RSLT_DTL CCSR WHERE CP_MST.CNSTG_SEQ = CCSR.CNSTG_SEQ ) SRV_CMPLT_CMPN_CNT
                , (SELECT COUNT(*) FROM CP_CNSTG_RSUME_MST CCR WHERE CP_MST.CNSTG_SEQ = CCR.CNSTG_SEQ AND CCR.GUIDE_TYPE_CD = 'GUIDE_TYPE_CD01' ) SHRT_CMPN_CNT
                , (SELECT COUNT(*) FROM CP_CNSTG_RSUME_MST CCR WHERE CP_MST.CNSTG_SEQ = CCR.CNSTG_SEQ AND CCR.GUIDE_TYPE_CD = 'GUIDE_TYPE_CD02' ) RGLR_CMPN_CNT
                , (SELECT COUNT(CMSSR_SEQ) FROM CP_CNSTG_RSUME_MST CCR WHERE CP_MST.CNSTG_SEQ = CCR.CNSTG_SEQ ) CMSSR_CNT
                , CPSR.TTL_SCORE
                , (SELECT TTL_SCORE FROM CP_CNSTG_SRV_RSLT_DTL WHERE CNSTG_SEQ = (SELECT CNSTG_SEQ FROM CP_CNSTG_RSUME_MST CCR WHERE CP_MST.CNSTG_SEQ = CCR.CNSTG_SEQ AND CCR.GUIDE_TYPE_CD = 'GUIDE_TYPE_CD01' )) SHRT_SCORE
                , (SELECT TTL_SCORE FROM CP_CNSTG_SRV_RSLT_DTL WHERE CNSTG_SEQ = (SELECT CNSTG_SEQ FROM CP_CNSTG_RSUME_MST CCR WHERE CP_MST.CNSTG_SEQ = CCR.CNSTG_SEQ AND CCR.GUIDE_TYPE_CD = 'GUIDE_TYPE_CD02' )) RGLR_SCORE
            FROM
                CP_CNSTG_APPCTN_MST CP_MST
            JOIN CO_MEM_MST MEM_MST
                ON MEM_MST.MEM_SEQ = CP_MST.APPCTN_MEM_SEQ
                LEFT JOIN CP_CMPN_MST CMPN_MST
                    ON CMPN_MST.BSNM_NO = CP_MST.APPCTN_BSNM_NO
                LEFT JOIN CP_CNSTG_RSUME_MST CPR_MST
                    ON CP_MST.CNSTG_SEQ = CPR_MST.CNSTG_SEQ
                LEFT JOIN CP_CNSTG_SRV_RSLT_DTL CPSR
                    ON CP_MST.CNSTG_SEQ = CPSR.CNSTG_SEQ
            WHERE 1=1
            <if test="rtnBsnGubun != null and rtnBsnGubun != ''">
                AND CP_MST.CNSTG_CD = '${rtnBsnGubun}'
            </if>
                AND CPR_MST.BFRE_JDGMT_RSLT_CD = 'BF_JDGMT_RSLT01'
                AND CPR_MST.INIT_VST_RSLT_CD = 'INIT_VST_RSLT01'
                AND CPR_MST.CNSTG_PSCND_CD = 'CNSTG_PSCND03'
                AND GUIDE_PSCND_CD = 'GUIDE_PSCND04'
        ) MST
        <if test="rtnBsnYear != null and rtnBsnYear != ''">
            WHERE
                BSN_YEAR = ${rtnBsnYear}
        </if>
        GROUP BY
            MST.BSN_YEAR
        ORDER BY
            MST.BSN_YEAR DESC
        LIMIT #{firstIndex}, #{recordCountPerPage}
    </select>

    <!--
     쿼리명 : CBATechGuidanceMapper.deleteManageConsult
     설  명 : 컨설팅사업 경영컨설팅 신청마스터 테이블 삭제
      수정일     수정자       수정내용
    ==========   ======    ==============
    2023.12.14   이옥정       최초생성
    -->
    <delete id="deleteManageConsult" parameterType="CBBManageConsultSearchDTO">
        DELETE /* CBATechGuidanceMapper.deleteManageConsult */
        FROM
            CP_CNSTG_APPCTN_MST
        <where>
            <choose>
                <when test="delValueList != null and delValueList.size() > 0">
                    CNSTG_SEQ IN
                    <foreach collection="delValueList" item="delValueList" index="index" separator=", " open="(" close=")">
                        #{delValueList}
                    </foreach>
                </when>
            </choose>
        </where>
    </delete>

    <!--
         쿼리명 : CBATechGuidanceMapper.deleteConsultRsumeMst
         설  명 : 컨설팅사업 진행마스터 테이블 삭제
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.12.15   이옥정       최초생성
    -->
    <delete id="deleteConsultRsumeMst" parameterType="CBBManageConsultSearchDTO">
        DELETE /* CBATechGuidanceMapper.deleteConsultRsumeMst */
        FROM
            CP_CNSTG_RSUME_MST
        <where>
            <choose>
                <when test="delValueList != null and delValueList.size() > 0">
                    CNSTG_SEQ IN
                    <foreach collection="delValueList" item="delValueList" index="index" separator=", " open="(" close=")">
                        #{delValueList}
                    </foreach>
                </when>
            </choose>
        </where>
    </delete>

    <!--
         쿼리명 : CBATechGuidanceMapper.deleteConsultPicDtl
         설  명 : 컨설팅사업 담당임원 테이블 삭제
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.12.15   이옥정       최초생성
    -->
    <delete id="deleteConsultPicDtl" parameterType="CBBManageConsultSearchDTO">
        DELETE /* CBATechGuidanceMapper.deleteConsultPicDtl */
        FROM
            CP_CNSTG_PIC_DTL
        <where>
            <choose>
                <when test="delValueList != null and delValueList.size() > 0">
                    CNSTG_SEQ IN
                    <foreach collection="delValueList" item="delValueList" index="index" separator=", " open="(" close=")">
                        #{delValueList}
                    </foreach>
                </when>
            </choose>
        </where>
    </delete>

    <!--
         쿼리명 : CBATechGuidanceMapper.deleteConsultCbsnDtl
         설  명 : 컨설팅사업 부품사 업종 상세 테이블 삭제
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.12.15   이옥정       최초생성
    -->
    <delete id="deleteConsultCbsnDtl" parameterType="CBBManageConsultSearchDTO">
        DELETE /* CBATechGuidanceMapper.deleteConsultCbsnDtl */
        FROM
            CP_CNSTG_CBSN_DTL
        <where>
            <choose>
                <when test="delValueList != null and delValueList.size() > 0">
                    CNSTG_SEQ IN
                    <foreach collection="delValueList" item="delValueList" index="index" separator=", " open="(" close=")">
                        #{delValueList}
                    </foreach>
                </when>
            </choose>
        </where>
    </delete>

    <!--
         쿼리명 : CBATechGuidanceMapper.deleteConsultDlvryDtl
         설  명 : 컨설팅사업 고객사비율 상세 테이블 삭제
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.12.15   이옥정       최초생성
    -->
    <delete id="deleteConsultDlvryDtl" parameterType="CBBManageConsultSearchDTO">
        DELETE /* CBATechGuidanceMapper.deleteConsultDlvryDtl */
        FROM
            CP_CNSTG_DLVRY_DTL
        <where>
            <choose>
                <when test="delValueList != null and delValueList.size() > 0">
                    CNSTG_SEQ IN
                    <foreach collection="delValueList" item="delValueList" index="index" separator=", " open="(" close=")">
                        #{delValueList}
                    </foreach>
                </when>
            </choose>
        </where>
    </delete>

    <!--
         쿼리명 : CBATechGuidanceMapper.deleteConsultDpndnDtl
         설  명 : 컨설팅사업 완성차의존율 상세 테이블 삭제
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.12.15   이옥정       최초생성
    -->
    <delete id="deleteConsultDpndnDtl" parameterType="CBBManageConsultSearchDTO">
        DELETE /* CBATechGuidanceMapper.deleteConsultDpndnDtl */
        FROM
            CP_CNSTG_DPNDN_DTL
        <where>
            <choose>
                <when test="delValueList != null and delValueList.size() > 0">
                    CNSTG_SEQ IN
                    <foreach collection="delValueList" item="delValueList" index="index" separator=", " open="(" close=")">
                        #{delValueList}
                    </foreach>
                </when>
            </choose>
        </where>
    </delete>

    <!--
         쿼리명 : CBATechGuidanceMapper.deleteConsultAppctnTypeDtl
         설  명 : 컨설팅사업 신청분야 상세 테이블 삭제
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.12.15   이옥정       최초생성
    -->
    <delete id="deleteConsultAppctnTypeDtl" parameterType="CBBManageConsultSearchDTO">
        DELETE /* CBATechGuidanceMapper.deleteConsultAppctnTypeDtl */
        FROM
            CP_CNSTG_APPCTN_TYPE_DTL
        <where>
            <choose>
                <when test="delValueList != null and delValueList.size() > 0">
                    CNSTG_SEQ IN
                    <foreach collection="delValueList" item="delValueList" index="index" separator=", " open="(" close=")">
                        #{delValueList}
                    </foreach>
                </when>
            </choose>
        </where>
    </delete>

    <!--
         쿼리명 : CBATechGuidanceMapper.deleteConsultSrvRsltDtl
         설  명 : 컨설팅사업 만족도 결과 상세 테이블 삭제
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.12.15   이옥정       최초생성
    -->
    <delete id="deleteConsultSrvRsltDtl" parameterType="CBBManageConsultSearchDTO">
        DELETE /* CBATechGuidanceMapper.deleteConsultSrvRsltDtl */
        FROM
            CP_CNSTG_SRV_RSLT_DTL
        <where>
            <choose>
                <when test="delValueList != null and delValueList.size() > 0">
                    CNSTG_SEQ IN
                    <foreach collection="delValueList" item="delValueList" index="index" separator=", " open="(" close=")">
                        #{delValueList}
                    </foreach>
                </when>
            </choose>
        </where>
    </delete>

    <!--
         쿼리명 : CBATechGuidanceMapper.deleteConsultAppctnTrnsfDtl
         설  명 : 컨설팅사업 참여이관로그 테이블 삭제
          수정일     수정자       수정내용
        ==========   ======    ==============
        2023.12.15   이옥정       최초생성
    -->
    <delete id="deleteConsultAppctnTrnsfDtl" parameterType="CBBManageConsultSearchDTO">
        DELETE /* CBATechGuidanceMapper.deleteConsultAppctnTrnsfDtl */
        FROM
            CP_CNSTG_APPCTN_TRNSF_DTL
        <where>
            <choose>
                <when test="delValueList != null and delValueList.size() > 0">
                    CNSTG_SEQ IN
                    <foreach collection="delValueList" item="delValueList" index="index" separator=", " open="(" close=")">
                        #{delValueList}
                    </foreach>
                </when>
            </choose>
        </where>
    </delete>

    <!--
         쿼리명 : CBATechGuidanceMapper.selectMemSeqAppctnMst
         설  명 : 사용자 마이페이지 - 컨설팅 사업 신청 내역 조회
          수정일     수정자       수정내용
        ==========   ======    ==============
        2024.01.02   임서화       최초생성
    -->
    <select id="selectMemSeqAppctnMst" parameterType="CBATechGuidanceInsertDTO">
        SELECT
            CNSTG_SEQ,
            CNSTG_CD,
            (SELECT CD_NM FROM CO_CODE_MST WHERE CD = A.CNSTG_CD) CNSTG_NM,
            RSUME_STTS_CD,
            (SELECT CD_NM FROM CO_CODE_MST WHERE CD = A.RSUME_STTS_CD) RSUME_STTS_NM,
            (SELECT BFRE_JDGMT_RSLT_CNTN FROM CP_CNSTG_RSUME_MST WHERE CNSTG_SEQ = A.CNSTG_SEQ) RSLT_CNTN,
            APPCTN_DT,
            BSN_YEAR,
            (SELECT CD FROM CP_CNSTG_CBSN_DTL WHERE CNSTG_SEQ = A.CNSTG_SEQ) CBSN_CD,
            (SELECT CD_NM FROM CO_CODE_MST WHERE CD = CBSN_CD) CBSN_NM
        FROM CP_CNSTG_APPCTN_MST A WHERE APPCTN_MEM_SEQ = #{memSeq}
    </select>


    <!--
         쿼리명 : CBATechGuidanceMapper.selectTechGuidanceDtlCheck
         설  명 :  컨설팅 기술 관리 상세 조회(설문 유효성)
          수정일     수정자       수정내용
        ==========   ======    ==============
        2024.01.08   박준희      최초 생성
    -->
    <select id="selectTechGuidanceDtlCheck" parameterType="CBATechGuidanceInsertDTO" resultType="CBATechGuidanceInsertDTO">
        SELECT /* CBATechGuidanceMapper.selectTechGuidanceDtlCheck */
            A.CNSTG_SEQ,
            B.MEM_SEQ,
            B.NAME,
            B.TEL_NO,
            B.PSTN_NM,
            B.EMAIL,
            C.SRV_SEQ,
            (SELECT COUNT(SRV_SEQ) FROM SV_QSTN_DTL WHERE SRV_SEQ = C.SRV_SEQ) AS QSTN_CNT,
            (SELECT COUNT(SRV_RSPN_SEQ) FROM SV_RSPN_MST WHERE SRV_SEQ = C.SRV_SEQ AND RFNC_SEQ = A.CNSTG_SEQ AND RFNC_CD = 'CON') AS RSPN_CNT
        FROM
            CP_CNSTG_APPCTN_MST A
            LEFT JOIN  CO_MEM_MST B ON A.APPCTN_MEM_SEQ = B.MEM_SEQ
            LEFT JOIN CP_CNSTG_RSUME_MST C ON A.CNSTG_SEQ = C.CNSTG_SEQ
        WHERE A.CNSTG_SEQ = #{detailsKey}
    </select>
</mapper>